/**
 * name: @tresjs/cientos
 * version: v4.0.3
 * (c) 2024
 * description: Collection of useful helpers and fully functional, ready-made abstractions for Tres
 * author: Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)
 */
(function(se,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("three"),require("vue"),require("@tresjs/core")):typeof define=="function"&&define.amd?define(["exports","three","vue","@tresjs/core"],l):(se=typeof globalThis<"u"?globalThis:se||self,l(se.trescientos={},se.Three,se.Vue,se.TresjsCore))})(this,function(se,l,u,ee){"use strict";var qd=Object.defineProperty;var Qd=(se,l,u)=>l in se?qd(se,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):se[l]=u;var ue=(se,l,u)=>Qd(se,typeof l!="symbol"?l+"":l,u);function ro(o){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const t in o)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>o[t]})}}return e.default=o,Object.freeze(e)}const Zr=ro(l);function so(o){const e=io(o),t=[];for(const{startFrame:n,endFrame:r,duration:s}of e)if(!(s<=0))if(r<0||n===r){for(let i=0;i<s;i++)t.push(n);continue}else{const i=Math.sign(r-n);for(let a=n;a!==r+i;a+=i)for(let c=0;c<s;c++)t.push(a)}return t}function io(o){let e="START_FRAME_IN";const t=[];for(const{name:n,value:r,startI:s}of oo(o))e==="START_FRAME_IN"?n==="NUMBER"?(t.push({startFrame:r,endFrame:r,duration:1}),e="START_FRAME_OUT"):Ot("number",n,o,s):e==="START_FRAME_OUT"?n==="COMMA"?e="START_FRAME_IN":n==="HYPHEN"?e="END_FRAME_IN":n==="OPEN_PAREN"?e="DURATION_IN":Ot('",", "-", "("',n,o,s):e==="END_FRAME_IN"?n==="NUMBER"?(t[t.length-1].endFrame=r,e="END_FRAME_OUT"):Ot("number",n,o,s):e==="END_FRAME_OUT"?n==="COMMA"?e="START_FRAME_IN":n==="OPEN_PAREN"?e="DURATION_IN":Ot("',' or '('",n,o,s):e==="DURATION_IN"?n==="NUMBER"?(t[t.length-1].duration=r,e="DURATION_OUT"):Ot("number",n,o,s):e==="DURATION_OUT"?n==="CLOSE_PAREN"?e="NEXT_OR_DONE":Ot('"("',n,o,s):e==="NEXT_OR_DONE"&&(n==="COMMA"?e="START_FRAME_IN":Ot('","',n,o,s));return t}function oo(o){const e=[];for(let t=0;t<o.length;t++){const n=o[t];if("0123456789".includes(n))e.length&&e[e.length-1].name==="NUMBER"?(e[e.length-1].value*=10,e[e.length-1].value+=Number.parseInt(n)):e.push({name:"NUMBER",value:Number.parseInt(n),startI:t});else{if(n===" ")continue;n===","?e.push({name:"COMMA",value:-1,startI:t}):n==="("?e.push({name:"OPEN_PAREN",value:-1,startI:t}):n===")"?e.push({name:"CLOSE_PAREN",value:-1,startI:t}):n==="-"?e.push({name:"HYPHEN",value:-1,startI:t}):ao("0123456789,-()",n,o,t)}}return e}function ao(o,e,t,n){ee.useLogger().logError(`Cientos AnimationDefinitionParser: Unexpected character while processing animation definition: expected ${o}, got ${e}.
${t}
${Array.from({length:n+1}).join(" ")}^`)}function Ot(o,e,t,n){ee.useLogger().logError(`Cientos AnimationDefinitionParser: Syntax error while processing animation definition: expected ${o}, got ${e}.
${t}
${Array.from({length:n+1}).join(" ")}^`)}const lo=/\d*$/,co=/_*\d*$/;function uo(o){return o.replace(co,"")}function ho(o){const e=o.match(lo);return e?Number.parseInt(e[e.length-1]):null}async function fo(o,e){const t=ee.useLoader(l.TextureLoader,o),n=typeof e!="string"?new Promise(r=>r(e)):fetch(e).then(r=>r.json()).catch(r=>ee.useLogger().logError(`Cientos Atlas - ${r}`));return Promise.all([t,n]).then(([r,s])=>{const i=po(s,r.image.width,r.image.height);return[r,i]})}function po(o,e,t){const n=typeof o=="number"||Array.isArray(o)?_o(o,e,t):mo(o,e,t);return{frames:n,animations:qr(n)}}function Zt(o,e,t){let n;return typeof e=="string"?n=vo(o,e):typeof e=="number"?n=Kr(o,e,e):n=Kr(o,e[0],e[1]),t?n.toReversed():n}function Yn(){return{name:"null",width:0,height:0,offsetX:0,offsetY:0,repeatX:0,repeatY:0}}function mo(o,e,t){return Array.isArray(o.frames)?go(o,e,t):yo(o,e,t)}function go(o,e,t){const n=1/e,r=1/t;return o.frames.map(s=>({name:s.filename,offsetX:s.frame.x*n,offsetY:1-(s.frame.y+s.frame.h)*r,repeatX:s.frame.w*n,repeatY:s.frame.h*r,width:s.frame.w,height:s.frame.h}))}function yo(o,e,t){const n=1/e,r=1/t;return Object.entries(o.frames).map(([s,i])=>({name:s,offsetX:i.frame.x*n,offsetY:1-(i.frame.y+i.frame.h)*r,repeatX:i.frame.w*n,repeatY:i.frame.h*r,width:i.frame.w,height:i.frame.h}))}function _o(o,e,t,n="default"){const[r,s]=Array.isArray(o)?o:[o,1],i=e/r,a=t/s,c=(r*s).toString().length,h=1/r,d=1/s,f=[];let g=0;for(let p=s-1;p>=0;p--)for(let _=0;_<r;_++)g++,f.push({name:n+String(g).padStart(c,"0"),offsetX:_*h,offsetY:p*d,repeatX:h,repeatY:d,width:i,height:a});return f}function xo(o,e={}){const t=qr(o.frames);for(const[n,r]of Object.entries(e)){const s=Zt(o,n,!1),i=so(r);for(const a of i)(a<0||s.length<=a)&&ee.useLogger().logError(`Cientos Atlas: Attempting to access frame index ${a} in animation ${n}, but it does not exist.`);t[n]=i.map(a=>s[a])}o.animations=t}function vo(o,e){if(!(e in o.animations)){const t=Object.keys(o.animations).map(n=>`* ${n}
`).join("");return ee.useLogger().logError(`Cientos Atlas: getAtlasFramesByAnimationName
The animation name "${e}" does not exist in this atlas.
Available names:
${t}`),[Yn()]}return o.animations[e]}function Kr(o,e,t){if(e<0||o.frames.length<=e||t<0||o.frames.length<=t)return ee.useLogger().logError(`Cientos Atlas: getFramesByIndex â€“ [${e}, ${t}] is out of bounds.`),[Yn()];const n=[],r=Math.sign(t-e);if(r===0)return[o.frames[e]];for(let s=e;s!==t+r;s+=r)n.push(o.frames[s]);return n}function qr(o){const e={};for(const t of o)if(ho(t.name)!==null){const n=uo(t.name);Object.prototype.hasOwnProperty.call(e,n)?e[n].push(t):e[n]=[t]}for(const t of Object.values(e))t.sort((n,r)=>n.name.localeCompare(r.name));return e}const wo=["scale","position"],bo=["map","alphaTest"],Mo=["scale","position"],So=["side","map","alphaTest","depthWrite","depthTest"],yn=.01,Ao=u.defineComponent({__name:"component",props:{image:{},atlas:{},definitions:{},fps:{default:30},loop:{type:Boolean,default:!0},animation:{default:0},paused:{type:Boolean,default:!1},reversed:{type:Boolean,default:!1},flipX:{type:Boolean,default:!1},resetOnEnd:{type:Boolean,default:!1},asSprite:{type:Boolean,default:!0},center:{default:()=>[.5,.5]},alphaTest:{default:0},depthTest:{type:Boolean,default:!0},depthWrite:{type:Boolean,default:!0}},emits:["frame","end","loop"],async setup(o,{expose:e,emit:t}){let n,r;const s=o,i=t,{invalidate:a}=ee.useTresContext();u.watch(s,()=>{a()});const c=u.ref(0),h=u.ref(0),d=u.ref(0),f=u.ref(0),g=u.shallowRef();e({instance:g});const[p,_]=([n,r]=u.withAsyncContext(()=>fo(s.image,s.atlas)),n=await n,r(),n);p.matrixAutoUpdate=!1;let y=Zt(_,s.animation,s.reversed),x=.5,m=.5,M=1,v=Yn(),C=null,O=0,S=!1,A=!0;ee.useLoop().onBeforeRender(({delta:P})=>{for(!s.paused&&!S&&(M-=P*s.fps);M<=0;)M++,O++,s.loop?(O>=y.length&&i("loop",y[y.length-1].name),O%=y.length):O>=y.length&&(S=!0,O=s.resetOnEnd?0:y.length-1,i("end",y[y.length-1].name));y[O]!==v&&(v=y[O],C=v.name,b()),A&&(A=!1,p.offset.x=v.offsetX+(s.flipX?v.repeatX:0),p.offset.y=v.offsetY,p.repeat.x=v.repeatX*(s.flipX?-1:1),p.repeat.y=v.repeatY,p.updateMatrix(),d.value=v.width*yn,f.value=v.height*yn,c.value=(.5-x)*v.width*yn,h.value=(.5-m)*v.height*yn),C&&(i("frame",C),C=null)});function b(){A=!0}return u.watch(()=>s.animation,(P,w)=>{JSON.stringify(P)!==JSON.stringify(w)&&(y=Zt(_,s.animation,s.reversed),O=0,M=1,S=!1,b())},{immediate:!0}),u.watch(()=>s.reversed,()=>{O=(y.length-O-1)%y.length,y=Zt(_,s.animation,s.reversed),S&&(O=s.resetOnEnd?0:y.length-1),b()}),u.watch(()=>s.paused,()=>{S=!1}),u.watch(()=>s.loop,()=>{S&&s.loop&&(S=!1)}),u.watch(()=>s.resetOnEnd,()=>{S&&(O=s.resetOnEnd?0:y.length-1,b())}),u.watch(()=>s.flipX,b),u.watch(()=>[s.center],()=>{[x,m]=ee.normalizeVectorFlexibleParam(s.center),b()},{immediate:!0}),u.watch(()=>[s.definitions],()=>{xo(_,s.definitions),y=Zt(_,s.animation,s.reversed),M=1,O=0,b()},{immediate:!0}),u.onUnmounted(()=>{p.dispose()}),(P,w)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"groupRef",ref:g},[s.asSprite?(u.openBlock(),u.createElementBlock("TresSprite",{key:0,scale:[d.value,f.value,1],position:[c.value,h.value,0]},[u.createElementVNode("TresSpriteMaterial",{toneMapped:!1,map:u.unref(p),transparent:!0,alphaTest:s.alphaTest},null,8,bo)],8,wo)):(u.openBlock(),u.createElementBlock("TresMesh",{key:1,scale:[d.value,f.value,1],position:[c.value,h.value,0]},[w[0]||(w[0]=u.createElementVNode("TresPlaneGeometry",{args:[1,1]},null,-1)),u.createElementVNode("TresMeshBasicMaterial",{toneMapped:!1,side:u.unref(l.DoubleSide),map:u.unref(p),transparent:!0,alphaTest:s.alphaTest,depthWrite:s.depthWrite,depthTest:s.depthTest},null,8,So)],8,Mo)),u.renderSlot(P.$slots,"default")],512))}});function Wn(o){return u.getCurrentScope()?(u.onScopeDispose(o),!0):!1}function Re(o){return typeof o=="function"?o():u.unref(o)}const Co=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Po=Object.prototype.toString,To=o=>Po.call(o)==="[object Object]",gt=()=>{};function Xn(o,e){function t(...n){return new Promise((r,s)=>{Promise.resolve(o(()=>e.apply(this,n),{fn:e,thisArg:this,args:n})).then(r).catch(s)})}return t}const Io=o=>o();function Oo(o,e={}){let t,n,r=gt;const s=a=>{clearTimeout(a),r(),r=gt};return a=>{const c=Re(o),h=Re(e.maxWait);return t&&s(t),c<=0||h!==void 0&&h<=0?(n&&(s(n),n=null),Promise.resolve(a())):new Promise((d,f)=>{r=e.rejectOnCancel?f:d,h&&!n&&(n=setTimeout(()=>{t&&s(t),n=null,d(a())},h)),t=setTimeout(()=>{n&&s(n),n=null,d(a())},c)})}}function Qr(...o){let e=0,t,n=!0,r=gt,s,i,a,c,h;!u.isRef(o[0])&&typeof o[0]=="object"?{delay:i,trailing:a=!0,leading:c=!0,rejectOnCancel:h=!1}=o[0]:[i,a=!0,c=!0,h=!1]=o;const d=()=>{t&&(clearTimeout(t),t=void 0,r(),r=gt)};return g=>{const p=Re(i),_=Date.now()-e,y=()=>s=g();return d(),p<=0?(e=Date.now(),y()):(_>p&&(c||!n)?(e=Date.now(),y()):a&&(s=new Promise((x,m)=>{r=h?m:x,t=setTimeout(()=>{e=Date.now(),n=!0,x(y()),d()},Math.max(0,p-_))})),!c&&!t&&(t=setTimeout(()=>n=!0,p)),n=!1,s)}}function Lo(o){return u.getCurrentInstance()}function Do(o,e=200,t={}){return Xn(Oo(e,t),o)}function Bo(o,e=200,t=!1,n=!0,r=!1){return Xn(Qr(e,t,n,r),o)}function ko(o,e,t={}){const{eventFilter:n=Io,...r}=t;return u.watch(o,Xn(n,e),r)}function Zn(o,e=!0,t){Lo()?u.onMounted(o,t):e?o():u.nextTick(o)}function Fo(o,e,t={}){const{throttle:n=0,trailing:r=!0,leading:s=!0,...i}=t;return ko(o,e,{...i,eventFilter:Qr(n,r,s)})}function yt(o){var e;const t=Re(o);return(e=t==null?void 0:t.$el)!=null?e:t}const ct=Co?window:void 0;function Ce(...o){let e,t,n,r;if(typeof o[0]=="string"||Array.isArray(o[0])?([t,n,r]=o,e=ct):[e,t,n,r]=o,!e)return gt;Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]);const s=[],i=()=>{s.forEach(d=>d()),s.length=0},a=(d,f,g,p)=>(d.addEventListener(f,g,p),()=>d.removeEventListener(f,g,p)),c=u.watch(()=>[yt(e),Re(r)],([d,f])=>{if(i(),!d)return;const g=To(f)?{...f}:f;s.push(...t.flatMap(p=>n.map(_=>a(d,p,_,g))))},{immediate:!0,flush:"post"}),h=()=>{c(),i()};return Wn(h),h}function Uo(){const o=u.ref(!1),e=u.getCurrentInstance();return e&&u.onMounted(()=>{o.value=!0},e),o}function Jr(o){const e=Uo();return u.computed(()=>(e.value,!!o()))}function No(o,e={}){const{window:t=ct}=e,n=Jr(()=>t&&"matchMedia"in t&&typeof t.matchMedia=="function");let r;const s=u.ref(!1),i=h=>{s.value=h.matches},a=()=>{r&&("removeEventListener"in r?r.removeEventListener("change",i):r.removeListener(i))},c=u.watchEffect(()=>{n.value&&(a(),r=t.matchMedia(Re(o)),"addEventListener"in r?r.addEventListener("change",i):r.addListener(i),s.value=r.matches)});return Wn(()=>{c(),a(),r=void 0}),s}function zo(o,e,t={}){const{window:n=ct,...r}=t;let s;const i=Jr(()=>n&&"ResizeObserver"in n),a=()=>{s&&(s.disconnect(),s=void 0)},c=u.computed(()=>{const f=Re(o);return Array.isArray(f)?f.map(g=>yt(g)):[yt(f)]}),h=u.watch(c,f=>{if(a(),i.value&&n){s=new ResizeObserver(e);for(const g of f)g&&s.observe(g,r)}},{immediate:!0,flush:"post"}),d=()=>{a(),h()};return Wn(d),{isSupported:i,stop:d}}function Vo(o,e={width:0,height:0},t={}){const{window:n=ct,box:r="content-box"}=t,s=u.computed(()=>{var f,g;return(g=(f=yt(o))==null?void 0:f.namespaceURI)==null?void 0:g.includes("svg")}),i=u.ref(e.width),a=u.ref(e.height),{stop:c}=zo(o,([f])=>{const g=r==="border-box"?f.borderBoxSize:r==="content-box"?f.contentBoxSize:f.devicePixelContentBoxSize;if(n&&s.value){const p=yt(o);if(p){const _=p.getBoundingClientRect();i.value=_.width,a.value=_.height}}else if(g){const p=Array.isArray(g)?g:[g];i.value=p.reduce((_,{inlineSize:y})=>_+y,0),a.value=p.reduce((_,{blockSize:y})=>_+y,0)}else i.value=f.contentRect.width,a.value=f.contentRect.height},t);Zn(()=>{const f=yt(o);f&&(i.value="offsetWidth"in f?f.offsetWidth:e.width,a.value="offsetHeight"in f?f.offsetHeight:e.height)});const h=u.watch(()=>yt(o),f=>{i.value=f?e.width:0,a.value=f?e.height:0});function d(){c(),h()}return{width:i,height:a,stop:d}}const Hr=1;function Go(o,e={}){const{throttle:t=0,idle:n=200,onStop:r=gt,onScroll:s=gt,offset:i={left:0,right:0,top:0,bottom:0},eventListenerOptions:a={capture:!1,passive:!0},behavior:c="auto",window:h=ct,onError:d=A=>{console.error(A)}}=e,f=u.ref(0),g=u.ref(0),p=u.computed({get(){return f.value},set(A){y(A,void 0)}}),_=u.computed({get(){return g.value},set(A){y(void 0,A)}});function y(A,b){var P,w,L,D;if(!h)return;const V=Re(o);if(!V)return;(L=V instanceof Document?h.document.body:V)==null||L.scrollTo({top:(P=Re(b))!=null?P:_.value,left:(w=Re(A))!=null?w:p.value,behavior:Re(c)});const G=((D=V==null?void 0:V.document)==null?void 0:D.documentElement)||(V==null?void 0:V.documentElement)||V;p!=null&&(f.value=G.scrollLeft),_!=null&&(g.value=G.scrollTop)}const x=u.ref(!1),m=u.reactive({left:!0,right:!1,top:!0,bottom:!1}),M=u.reactive({left:!1,right:!1,top:!1,bottom:!1}),v=A=>{x.value&&(x.value=!1,M.left=!1,M.right=!1,M.top=!1,M.bottom=!1,r(A))},C=Do(v,t+n),O=A=>{var b;if(!h)return;const P=((b=A==null?void 0:A.document)==null?void 0:b.documentElement)||(A==null?void 0:A.documentElement)||yt(A),{display:w,flexDirection:L}=getComputedStyle(P),D=P.scrollLeft;M.left=D<f.value,M.right=D>f.value;const V=Math.abs(D)<=(i.left||0),G=Math.abs(D)+P.clientWidth>=P.scrollWidth-(i.right||0)-Hr;w==="flex"&&L==="row-reverse"?(m.left=G,m.right=V):(m.left=V,m.right=G),f.value=D;let Y=P.scrollTop;A===h.document&&!Y&&(Y=h.document.body.scrollTop),M.top=Y<g.value,M.bottom=Y>g.value;const W=Math.abs(Y)<=(i.top||0),$=Math.abs(Y)+P.clientHeight>=P.scrollHeight-(i.bottom||0)-Hr;w==="flex"&&L==="column-reverse"?(m.top=$,m.bottom=W):(m.top=W,m.bottom=$),g.value=Y},S=A=>{var b;if(!h)return;const P=(b=A.target.documentElement)!=null?b:A.target;O(P),x.value=!0,C(A),s(A)};return Ce(o,"scroll",t?Bo(S,t,!0,!1):S,a),Zn(()=>{try{const A=Re(o);if(!A)return;O(A)}catch(A){d(A)}}),Ce(o,"scrollend",v,a),{x:p,y:_,isScrolling:x,arrivedState:m,directions:M,measure(){const A=Re(o);h&&A&&O(A)}}}const Ro={ctrl:"control",command:"meta",cmd:"meta",option:"alt",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};function jo(o={}){const{reactive:e=!1,target:t=ct,aliasMap:n=Ro,passive:r=!0,onEventFired:s=gt}=o,i=u.reactive(new Set),a={toJSON(){return{}},current:i},c=e?u.reactive(a):a,h=new Set,d=new Set;function f(y,x){y in c&&(e?c[y]=x:c[y].value=x)}function g(){i.clear();for(const y of d)f(y,!1)}function p(y,x){var m,M;const v=(m=y.key)==null?void 0:m.toLowerCase(),O=[(M=y.code)==null?void 0:M.toLowerCase(),v].filter(Boolean);v&&(x?i.add(v):i.delete(v));for(const S of O)d.add(S),f(S,x);v==="meta"&&!x?(h.forEach(S=>{i.delete(S),f(S,!1)}),h.clear()):typeof y.getModifierState=="function"&&y.getModifierState("Meta")&&x&&[...i,...O].forEach(S=>h.add(S))}Ce(t,"keydown",y=>(p(y,!0),s(y)),{passive:r}),Ce(t,"keyup",y=>(p(y,!1),s(y)),{passive:r}),Ce("blur",g,{passive:!0}),Ce("focus",g,{passive:!0});const _=new Proxy(c,{get(y,x,m){if(typeof x!="string")return Reflect.get(y,x,m);if(x=x.toLowerCase(),x in n&&(x=n[x]),!(x in c))if(/[+_-]/.test(x)){const v=x.split(/[+_-]/g).map(C=>C.trim());c[x]=u.computed(()=>v.every(C=>Re(_[C])))}else c[x]=u.ref(!1);const M=Reflect.get(y,x,m);return e?Re(M):M}});return _}const Eo={page:o=>[o.pageX,o.pageY],client:o=>[o.clientX,o.clientY],screen:o=>[o.screenX,o.screenY],movement:o=>o instanceof Touch?null:[o.movementX,o.movementY]};function Yo(o={}){const{type:e="page",touch:t=!0,resetOnTouchEnds:n=!1,initialValue:r={x:0,y:0},window:s=ct,target:i=s,scroll:a=!0,eventFilter:c}=o;let h=null;const d=u.ref(r.x),f=u.ref(r.y),g=u.ref(null),p=typeof e=="function"?e:Eo[e],_=O=>{const S=p(O);h=O,S&&([d.value,f.value]=S,g.value="mouse")},y=O=>{if(O.touches.length>0){const S=p(O.touches[0]);S&&([d.value,f.value]=S,g.value="touch")}},x=()=>{if(!h||!s)return;const O=p(h);h instanceof MouseEvent&&O&&(d.value=O[0]+s.scrollX,f.value=O[1]+s.scrollY)},m=()=>{d.value=r.x,f.value=r.y},M=c?O=>c(()=>_(O),{}):O=>_(O),v=c?O=>c(()=>y(O),{}):O=>y(O),C=c?()=>c(()=>x(),{}):()=>x();if(i){const O={passive:!0};Ce(i,["mousemove","dragover"],M,O),t&&e!=="movement"&&(Ce(i,["touchstart","touchmove"],v,O),n&&Ce(i,"touchend",m,O)),a&&e==="page"&&Ce(s,"scroll",C,{passive:!0})}return{x:d,y:f,sourceType:g}}function Wo(o={}){const{window:e=ct,behavior:t="auto"}=o;if(!e)return{x:u.ref(0),y:u.ref(0)};const n=u.ref(e.scrollX),r=u.ref(e.scrollY),s=u.computed({get(){return n.value},set(a){scrollTo({left:a,behavior:t})}}),i=u.computed({get(){return r.value},set(a){scrollTo({top:a,behavior:t})}});return Ce(e,"scroll",()=>{n.value=e.scrollX,r.value=e.scrollY},{capture:!1,passive:!0}),{x:s,y:i}}function $r(o={}){const{window:e=ct,initialWidth:t=Number.POSITIVE_INFINITY,initialHeight:n=Number.POSITIVE_INFINITY,listenOrientation:r=!0,includeScrollbar:s=!0,type:i="inner"}=o,a=u.ref(t),c=u.ref(n),h=()=>{e&&(i==="outer"?(a.value=e.outerWidth,c.value=e.outerHeight):s?(a.value=e.innerWidth,c.value=e.innerHeight):(a.value=e.document.documentElement.clientWidth,c.value=e.document.documentElement.clientHeight))};if(h(),Zn(h),Ce("resize",h,{passive:!0}),r){const d=No("(orientation: portrait)");u.watch(d,()=>h())}return{width:a,height:c}}const Xo=u.defineComponent({name:"GlobalAudio",props:["src","loop","volume","playbackRate","playTrigger","stopTrigger"],async setup(o,{expose:e,emit:t}){var f;const{camera:n,renderer:r}=ee.useTresContext(),s=new l.AudioListener;(f=n.value)==null||f.add(s);const i=new l.Audio(s),a=new l.AudioLoader;e({instance:i}),u.onUnmounted(()=>{i&&i.disconnect()}),u.watch(()=>[o.playbackRate],()=>i.setPlaybackRate(o.playbackRate??1),{immediate:!0}),u.watch(()=>[o.volume],()=>i.setVolume(o.volume??.5),{immediate:!0}),u.watch(()=>[o.loop],()=>i.setLoop(o.loop??!1),{immediate:!0}),u.watch(()=>[o.src],async()=>{const g=await a.loadAsync(o.src);i.setBuffer(g)},{immediate:!0});const h=document.getElementById(o.playTrigger??"")||r.value.domElement;Ce(h,"click",()=>{i.isPlaying?i.pause():i.play(),t("isPlaying",i.isPlaying)});const d=document.getElementById(o.stopTrigger??"");return d&&Ce(d,"click",()=>{i.stop(),t("isPlaying",i.isPlaying)}),null}});class Kt extends l.Mesh{constructor(){super(Kt.Geometry,new l.MeshBasicMaterial({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const e=new l.Vector3,t=new l.Vector3,n=new l.FramebufferTexture(16,16),r=new l.FramebufferTexture(16,16);let s=l.UnsignedByteType;const i=Kt.Geometry,a=new l.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),c=new l.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),h=new l.Mesh(i,a),d=[],f=es.Shader,g=new l.RawShaderMaterial({name:f.name,uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new l.Color(16777215)},scale:{value:new l.Vector2},screenPosition:{value:new l.Vector3}},vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,blending:l.AdditiveBlending,transparent:!0,depthWrite:!1}),p=new l.Mesh(i,g);this.addElement=function(M){d.push(M)};const _=new l.Vector2,y=new l.Vector2,x=new l.Box2,m=new l.Vector4;this.onBeforeRender=function(M,v,C){M.getCurrentViewport(m);const O=M.getRenderTarget(),S=O!==null?O.texture.type:l.UnsignedByteType;s!==S&&(n.dispose(),r.dispose(),n.type=r.type=S,s=S);const A=m.w/m.z,b=m.z/2,P=m.w/2;let w=16/m.w;if(_.set(w*A,w),x.min.set(m.x,m.y),x.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(C.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(C.projectionMatrix),y.x=m.x+e.x*b+b-8,y.y=m.y+e.y*P+P-8,x.containsPoint(y))){M.copyFramebufferToTexture(n,y);let L=a.uniforms;L.scale.value=_,L.screenPosition.value=e,M.renderBufferDirect(C,null,i,a,h,null),M.copyFramebufferToTexture(r,y),L=c.uniforms,L.scale.value=_,L.screenPosition.value=e,M.renderBufferDirect(C,null,i,c,h,null);const D=-e.x*2,V=-e.y*2;for(let G=0,Y=d.length;G<Y;G++){const W=d[G],$=g.uniforms;$.color.value.copy(W.color),$.map.value=W.texture,$.screenPosition.value.x=e.x+D*W.distance,$.screenPosition.value.y=e.y+V*W.distance,w=W.size/m.w;const q=m.w/m.z;$.scale.value.set(w*q,w),g.uniformsNeedUpdate=!0,M.renderBufferDirect(C,null,i,g,p,null)}}},this.dispose=function(){a.dispose(),c.dispose(),g.dispose(),n.dispose(),r.dispose();for(let M=0,v=d.length;M<v;M++)d[M].texture.dispose()}}}class es{constructor(e,t=1,n=0,r=new l.Color(16777215)){this.texture=e,this.size=t,this.distance=n,this.color=r}}es.Shader={name:"LensflareElementShader",uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`},Kt.Geometry=function(){const o=new l.BufferGeometry,e=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),t=new l.InterleavedBuffer(e,5);return o.setIndex([0,1,2,0,2,3]),o.setAttribute("position",new l.InterleavedBufferAttribute(t,3,0,!1)),o.setAttribute("uv",new l.InterleavedBufferAttribute(t,2,3,!1)),o}();function Zo(o){return o}function Ko(o){return o*o*o}function qo(o){return o<.5?4*o*o*o:1-(-2*o+2)**3/2}function Qo(o){return o*o*o*o}function Jo(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375}const ut="https://raw.githubusercontent.com/Tresjs/assets/93976c7d63ac83d4a254a41a10b2362bc17e90c9/textures/lensflare/",Kn=`${ut}circle.png`,_n=`${ut}circleBlur.png`,Ho=`${ut}circleRainbow.png`,$o=`${ut}line.png`,ts=`${ut}poly6.png`,ns=`${ut}polyStroke6.png`,ea=`${ut}rays.png`,xn=`${ut}ring.png`,ta=`${ut}starThin6.png`,na={texture:[$o,xn],color:["white"],distance:[0,0],size:[750,1024],length:[0,2]},ra={texture:[_n],color:["white"],distance:[0,0],size:[180,512],length:[1,1]},sa={texture:[ea],color:["white"],distance:[0,0],size:[180,512],length:[1,1]},ia={texture:[Kn,Ho,xn,ta],color:["white"],distance:[0,0],size:[180,512],length:[2,3]},[rs,ss]=[3679071,132442],qn=[na,ra,sa,ia,{texture:[_n,Kn,xn,ts,ns],color:["dimgray","gray","darkgray",rs,ss],distance:[.5,2.5],size:[20,180],length:[5,21]},{texture:[_n,Kn,xn,ts,ns],color:["dimgray","gray","darkgray",rs,ss],distance:[-.6,-.1],size:[180,360],length:[0,5]}],vn={color:"white",distance:0,size:512,texture:_n},is=l.MathUtils.clamp;class os{constructor(e=0,t){ue(this,"_getNext");ue(this,"_getGenerator");this._getGenerator=t??this.getMulberry32,this._getNext=this._getGenerator(e)}seed(e){this._getNext=this._getGenerator(e)}rand(){return this._getNext()}float(e,t){return e+this._getNext()*(t-e)}floatSpread(e){return this.float(-.5*e,.5*e)}int(e,t){return e+Math.floor(this._getNext()*(t-e+1))}choice(e){return e.length?e[Math.floor(this._getNext()*e.length)]:null}defaultChoice(e,t){return e.length?e[Math.floor(this._getNext()*e.length)]:t}sample(e,t,n){const r=e.length;t=is(t,0,r-1),n=is(n??r-1,0,r-1);const s=this.int(t,n),i=this.shuffle(e.map((c,h)=>h)),a=Math.min(e.length,s);return i.slice(0,a).sort().map(c=>e[c])}shuffle(e){return e.map(t=>({value:t,sort:this._getNext()})).sort((t,n)=>t.sort-n.sort).map(({value:t})=>t)}getMulberry32(e=0){return e>0&&e<1&&(e=Math.floor(e*2**16)),()=>{e+=1831565813;let t=e;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}}const oa=[Zo,Ko,qo,Qo,Jo],as=l.MathUtils.lerp,ls=(o=0,e=qn)=>{const n=new os(o).choice(oa);return e.map((r,s)=>{const i=new os(o*(s*7907+1)+(typeof r.seed=="number"?r.seed:0)),a=i.int(r.length[0],r.length[1]);return Array.from({length:a}).fill(0).map(()=>{const c=n(i.rand());return{texture:i.defaultChoice(r.texture,vn.texture),size:as(r.size[0],r.size[1],n(1-c)),distance:as(r.distance[0],r.distance[1],c),color:i.defaultChoice(r.color,vn.color)}})}).flat()},cs=(o,e,t=void 0,n=void 0,r=vn)=>{if(o!==void 0&&o.length>0&&(typeof t=="number"||typeof n<"u")){const a=ls(t??0,n??qn),c=a.length,h=o.length;return c>=h?a.map((d,f)=>Object.assign(d,e,f<h?o[f]:{})):o.map((d,f)=>Object.assign({},r,f<c?a[f]:{},e,d))}if(o!==void 0&&o.length>0){const a=Object.assign({},r,e);return o.map(c=>Object.assign({},a,c))}const s=n===void 0||n.length===0?qn:n;return ls(t??0,s).map(a=>Object.assign({},a,e))};function aa(o){return la(o,(e,t)=>t in vn&&e!==void 0)}function la(o,e){const t={};return Object.keys(o).forEach(n=>{e(o[n],n)&&(t[n]=o[n])}),t}const ca=u.defineComponent({__name:"component",props:{scale:{default:1},elements:{default:void 0},seed:{default:void 0},seedProps:{default:void 0},color:{default:void 0},distance:{default:void 0},size:{default:void 0},texture:{default:void 0}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),r=u.shallowRef([]),s=u.shallowRef(aa(t));e({instance:n});const i=new l.TextureLoader,a=new Kt,c=[],h=()=>{var p,_,y;for(;c.length;)c.pop();(p=n.value)==null||p.children.forEach(x=>{"dispose"in x&&x.dispose()}),(_=n.value)==null||_.remove(...n.value.children),(y=n.value)==null||y.dispose()},d=p=>{if(typeof p.texture=="string"){const _=p.texture;p.texture=i.load(_),p.texture.name=_}return p.color=ee.normalizeColor(p.color),p},f=()=>{for(let p=r.value.length-1;p<c.length;p++)c[p].size=0;r.value.forEach((p,_)=>{c[_].size=p.size*t.scale})},g=()=>{for(;r.value.length>c.length;){const _={...d(r.value[c.length])};c.push(_),a.addElement(_)}r.value.forEach((p,_)=>{const y=c[_],{texture:x,size:m,distance:M,color:v}=p;if(typeof x=="string"){if(y.texture.name!==x){y.texture.dispose();const C=x;y.texture=i.load(C),y.texture.name=C}}else y.texture!==x&&(y.texture.dispose(),y.texture=x);y.size=m,y.distance=M,y.color=ee.normalizeColor(v)}),f()};return u.onUnmounted(()=>{h()}),u.onMounted(()=>{var p;(p=n.value)==null||p.add(a),r.value=cs(t.elements,s.value,t.seed,t.seedProps)}),u.watch(()=>[t.color,t.distance,t.size,t.texture],()=>{s.value={color:t.color,distance:t.distance,size:t.size,texture:t.texture}}),u.watch(()=>[s.value,t.elements,t.seed,t.seedProps],()=>{r.value=cs(t.elements,s.value,t.seed,t.seedProps)}),u.watch(()=>t.scale,()=>{f()}),u.watch(()=>r.value,()=>{g()}),(p,_)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"lensflareRef",ref:n},null,512))}}),ua=u.defineComponent({__name:"Levioso",props:{speed:{default:1},rotationFactor:{default:1},floatFactor:{default:1},range:{default:()=>[-.1,.1]}},setup(o,{expose:e}){const t=o,n=u.shallowRef();e({instance:n});{const c=Math.random()*1e4,{onBeforeRender:h}=ee.useLoop();let d=c;h(({delta:f,invalidate:g})=>{if(!n.value)return;d+=f*t.speed;const p=d*.25,_=n.value;_.rotation.x=Math.cos(p)*.125*t.rotationFactor,_.rotation.y=Math.sin(p)*.125*t.rotationFactor,_.rotation.z=Math.sin(p)*.05*t.rotationFactor,_.position.y=l.MathUtils.mapLinear(Math.sin(p),-1,1,t.range[0],t.range[1])*t.floatFactor,g()})}return(r,s)=>(u.openBlock(),u.createElementBlock("TresGroup",u.mergeProps(r.$attrs,{ref_key:"groupRef",ref:n}),[u.renderSlot(r.$slots,"default")],16))}}),ha=u.defineComponent({__name:"MouseParallax",props:{disabled:{type:Boolean,default:!1},factor:{default:2.5},ease:{default:.1},local:{type:Boolean,default:!1}},setup(o){const e=o,{camera:t,renderer:n}=ee.useTresContext(),{disabled:r,factor:s,ease:i,local:a}=u.toRefs(e),c={};a.value&&(c.target=n.value.domElement,c.type="client");const{x:h,y:d}=Yo(c),{width:f,height:g}=a.value?Vo(n.value.domElement):$r(),p=u.shallowRef(),_=u.ref(),y=u.ref();u.watch([s,i],()=>{_.value=Array.isArray(s.value)?s.value:[s.value,s.value],y.value=Array.isArray(i.value)?i.value:[i.value,i.value]},{immediate:!0});const x=u.computed(()=>(h.value/f.value-.5)*_.value[0]),m=u.computed(()=>-(d.value/g.value-.5)*_.value[1]),{onBeforeRender:M}=ee.useLoop();return M(({delta:v,invalidate:C})=>{r.value||!p.value||Number.isNaN(x.value)||Number.isNaN(m.value)||(p.value.position.x+=(x.value-p.value.position.x)*y.value[0]*v,p.value.position.y+=(m.value-p.value.position.y)*y.value[1]*v,C())}),u.watch(()=>p.value,v=>v==null?void 0:v.add(t.value)),(v,C)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"cameraGroupRef",ref:p},null,512))}});class fa extends l.Line{constructor(e,t=1,n=16,r=2){const s=new l.BufferGeometry,i=n+r*2,a=new Float32Array((i*3+3)*3);s.setAttribute("position",new l.BufferAttribute(a,3));const c=new l.LineBasicMaterial({color:65280}),h=new l.LineBasicMaterial({color:16776960});super(s,[h,c]),this.audio=e,this.range=t,this.divisionsInnerAngle=n,this.divisionsOuterAngle=r,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,n=this.divisionsInnerAngle,r=this.divisionsOuterAngle,s=l.MathUtils.degToRad(e.panner.coneInnerAngle),i=l.MathUtils.degToRad(e.panner.coneOuterAngle),a=s/2,c=i/2;let h=0,d=0,f,g;const p=this.geometry,_=p.attributes.position;p.clearGroups();function y(x,m,M,v){const C=(m-x)/M;for(_.setXYZ(h,0,0,0),d++,f=x;f<m;f+=C)g=h+d,_.setXYZ(g,Math.sin(f)*t,0,Math.cos(f)*t),_.setXYZ(g+1,Math.sin(Math.min(f+C,m))*t,0,Math.cos(Math.min(f+C,m))*t),_.setXYZ(g+2,0,0,0),d+=3;p.addGroup(h,d,v),h+=d,d=0}y(-c,-a,r,0),y(-a,a,n,1),y(a,c,r,0),_.needsUpdate=!0,s===i&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const da=["args"],pa=u.defineComponent({__name:"PositionalAudio",props:{ready:{type:Boolean,default:!1},url:{},distance:{default:2},helper:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},innerAngle:{default:360},outerAngle:{default:360},outerGain:{default:0}},emits:["isPlaying"],async setup(o,{expose:e,emit:t}){let n,r;const s=o,i=t,{ready:a,url:c,distance:h,helper:d,loop:f,autoplay:g,innerAngle:p,outerAngle:_,outerGain:y}=u.toRefs(s),{camera:x}=ee.useTresContext(),m=u.shallowRef(null),M=u.shallowRef(null),v=u.shallowRef(null),C=u.shallowReactive(new l.AudioListener),O=()=>{var V,G,Y;(V=m==null?void 0:m.value)!=null&&V.isPlaying||((G=m==null?void 0:m.value)==null||G.play(),i("isPlaying",(Y=m==null?void 0:m.value)==null?void 0:Y.isPlaying))},S=()=>{var V,G;(V=m==null?void 0:m.value)!=null&&V.isPlaying&&(m.value.pause(),i("isPlaying",(G=m==null?void 0:m.value)==null?void 0:G.isPlaying))},A=()=>{var V;m.value&&(m.value.stop(),i("isPlaying",(V=m==null?void 0:m.value)==null?void 0:V.isPlaying))},b=()=>{if(!(m!=null&&m.value))return;A();const V=m.value;V.source&&V.disconnect()},P=()=>{var V,G;!(m!=null&&m.value)||!(M!=null&&M.value)||((V=M==null?void 0:M.value)==null||V.dispose(),(G=m==null?void 0:m.value)==null||G.remove(M==null?void 0:M.value))},w=()=>{var V;if(m.value&&(m.value.setBuffer(v.value),m.value.setRefDistance(h.value),m.value.setLoop(f.value),m.value.setDirectionalCone(p.value,_.value,y.value),(V=M==null?void 0:M.value)==null||V.update(),M!=null&&M.value)){const G=M.value.material[0];!G.visible&&_.value!==p.value&&(G.visible=!0)}},L=()=>{var W,$;w();const V=(W=m.value)==null?void 0:W.parent,G=new l.Box3().setFromObject(V),Y=(G.max.z-G.min.z)*2;M.value=new fa(m.value,Y,32,16),($=m==null?void 0:m.value)==null||$.add(M.value),M.value.update()},D=()=>{var V;(V=x==null?void 0:x.value)==null||V.remove(C),b(),P()};return e({root:m,play:O,stop:A,pause:S,dispose:D}),v.value=([n,r]=u.withAsyncContext(()=>ee.useLoader(l.AudioLoader,c.value)),n=await n,r(),n),u.watch(m,()=>{m!=null&&m.value&&(d.value&&L(),a.value&&g&&O())}),u.watch(d,()=>{d.value?L():P()}),u.watch(a,()=>{a.value&&w(),g.value&&a.value&&O(),!g.value&&a.value&&A()}),u.watch([h,f,v,p,_,y,g],()=>{w()}),u.onMounted(()=>{var V;(V=x==null?void 0:x.value)==null||V.add(C)}),u.onBeforeUnmount(()=>{D()}),(V,G)=>(u.openBlock(),u.createElementBlock("TresPositionalAudio",u.mergeProps({ref_key:"positionalAudioRef",ref:m,args:[u.unref(C)]},V.$attrs),null,16,da))}}),wn=parseInt(l.REVISION.replace(/\D+/g,"")),ma=wn>=125?"uv1":"uv2";var ga=Object.defineProperty,ya=(o,e,t)=>e in o?ga(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,_a=(o,e,t)=>(ya(o,e+"",t),t);async function us(o){const e=await o.arrayBuffer(),t=btoa(String.fromCharCode(...new Uint8Array(e)));return`data:${o.type||""};base64,${t}`}let bn,Qn,Ft,Mn;function Jn(o,e=1/0,t=null){Qn||(Qn=new l.PlaneGeometry(2,2,1,1)),Ft||(Ft=new l.ShaderMaterial({uniforms:{blitTexture:new l.Uniform(o)},vertexShader:`
        varying vec2 vUv;
        void main(){
            vUv = uv;
            gl_Position = vec4(position.xy * 1.0,0.,.999999);
        }
      `,fragmentShader:`
          uniform sampler2D blitTexture; 
          varying vec2 vUv;

          void main(){ 
              gl_FragColor = vec4(vUv.xy, 0, 1);
              
              #ifdef IS_SRGB
              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
              #else
              gl_FragColor = texture2D( blitTexture, vUv);
              #endif
          }
      `})),Ft.uniforms.blitTexture.value=o,Ft.defines.IS_SRGB="colorSpace"in o?o.colorSpace==="srgb":o.encoding===3001,Ft.needsUpdate=!0,Mn||(Mn=new l.Mesh(Qn,Ft),Mn.frustrumCulled=!1);const n=new l.PerspectiveCamera,r=new l.Scene;r.add(Mn),t||(t=bn=new l.WebGLRenderer({antialias:!1})),t.setSize(Math.min(o.image.width,e),Math.min(o.image.height,e)),t.clear(),t.render(r,n);const s=new l.Texture(t.domElement);return s.minFilter=o.minFilter,s.magFilter=o.magFilter,s.wrapS=o.wrapS,s.wrapT=o.wrapT,s.name=o.name,bn&&(bn.dispose(),bn=null),s}const hs={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Hn{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Ta(e)}),this.register(function(e){return new Ia(e)}),this.register(function(e){return new Da(e)}),this.register(function(e){return new Ba(e)}),this.register(function(e){return new ka(e)}),this.register(function(e){return new Fa(e)}),this.register(function(e){return new Oa(e)}),this.register(function(e){return new La(e)}),this.register(function(e){return new Ua(e)}),this.register(function(e){return new Na(e)}),this.register(function(e){return new za(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){const s=new Pa,i=[];for(let a=0,c=this.pluginCallbacks.length;a<c;a++)i.push(this.pluginCallbacks[a](s));s.setPlugins(i),s.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,r,s,t)})}}_a(Hn,"Utils",{insertKeyframe:function(o,e){const n=o.getValueSize(),r=new o.TimeBufferType(o.times.length+1),s=new o.ValueBufferType(o.values.length+n),i=o.createInterpolant(new o.ValueBufferType(n));let a;if(o.times.length===0){r[0]=e;for(let c=0;c<n;c++)s[c]=0;a=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;r[0]=e,r.set(o.times,1),s.set(i.evaluate(e),0),s.set(o.values,n),a=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;r[r.length-1]=e,r.set(o.times,0),s.set(o.values,0),s.set(i.evaluate(e),o.values.length),a=r.length-1}else for(let c=0;c<o.times.length;c++){if(Math.abs(o.times[c]-e)<.001)return c;if(o.times[c]<e&&o.times[c+1]>e){r.set(o.times.slice(0,c+1),0),r[c+1]=e,r.set(o.times.slice(c+1),c+2),s.set(o.values.slice(0,(c+1)*n),0),s.set(i.evaluate(e),(c+1)*n),s.set(o.values.slice((c+1)*n),(c+2)*n),a=c+1;break}}return o.times=r,o.values=s,a},mergeMorphTargetTracks:function(o,e){const t=[],n={},r=o.tracks;for(let s=0;s<r.length;++s){let i=r[s];const a=l.PropertyBinding.parseTrackName(i.name),c=l.PropertyBinding.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(i);continue}if(i.createInterpolant!==i.InterpolantFactoryMethodDiscrete&&i.createInterpolant!==i.InterpolantFactoryMethodLinear){if(i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),i=i.clone(),i.setInterpolation(l.InterpolateLinear)}const h=c.morphTargetInfluences.length,d=c.morphTargetDictionary[a.propertyIndex];if(d===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let f;if(n[c.uuid]===void 0){f=i.clone();const p=new f.ValueBufferType(h*f.times.length);for(let _=0;_<f.times.length;_++)p[_*h+d]=f.values[_];f.name=(a.nodeName||"")+".morphTargetInfluences",f.values=p,n[c.uuid]=f,t.push(f);continue}const g=i.createInterpolant(new i.ValueBufferType(1));f=n[c.uuid];for(let p=0;p<f.times.length;p++)f.values[p*h+d]=g.evaluate(f.times[p]);for(let p=0;p<i.times.length;p++){const _=this.insertKeyframe(f,i.times[p]);f.values[_*h+d]=i.values[p]}}return o.tracks=t,o}});const we={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},$n="KHR_mesh_quantization",Xe={};Xe[l.NearestFilter]=we.NEAREST,Xe[l.NearestMipmapNearestFilter]=we.NEAREST_MIPMAP_NEAREST,Xe[l.NearestMipmapLinearFilter]=we.NEAREST_MIPMAP_LINEAR,Xe[l.LinearFilter]=we.LINEAR,Xe[l.LinearMipmapNearestFilter]=we.LINEAR_MIPMAP_NEAREST,Xe[l.LinearMipmapLinearFilter]=we.LINEAR_MIPMAP_LINEAR,Xe[l.ClampToEdgeWrapping]=we.CLAMP_TO_EDGE,Xe[l.RepeatWrapping]=we.REPEAT,Xe[l.MirroredRepeatWrapping]=we.MIRRORED_REPEAT;const fs={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},xa=new l.Color,ds=12,va=1179937895,wa=2,ps=8,ba=1313821514,Ma=5130562;function qt(o,e){return o.length===e.length&&o.every(function(t,n){return t===e[n]})}function Sa(o){return new TextEncoder().encode(o).buffer}function Aa(o){return qt(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Ca(o,e,t){const n={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+t;r++)for(let s=0;s<o.itemSize;s++){let i;o.itemSize>4?i=o.array[r*o.itemSize+s]:(s===0?i=o.getX(r):s===1?i=o.getY(r):s===2?i=o.getZ(r):s===3&&(i=o.getW(r)),o.normalized===!0&&(i=l.MathUtils.normalize(i,o.array))),n.min[s]=Math.min(n.min[s],i),n.max[s]=Math.max(n.max[s],i)}return n}function ms(o){return Math.ceil(o/4)*4}function er(o,e=0){const t=ms(o.byteLength);if(t!==o.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(o)),e!==0)for(let r=o.byteLength;r<t;r++)n[r]=e;return n.buffer}return o}function gs(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function ys(o,e){if(o.toBlob!==void 0)return new Promise(n=>o.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),o.convertToBlob({type:e,quality:t})}class Pa{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,s=r.buffers,i=r.json;n=r.options;const a=r.extensionsUsed,c=r.extensionsRequired,h=new Blob(s,{type:"application/octet-stream"}),d=Object.keys(a),f=Object.keys(c);d.length>0&&(i.extensionsUsed=d),f.length>0&&(i.extensionsRequired=f),i.buffers&&i.buffers.length>0&&(i.buffers[0].byteLength=h.size),n.binary===!0?h.arrayBuffer().then(g=>{const p=er(g),_=new DataView(new ArrayBuffer(ps));_.setUint32(0,p.byteLength,!0),_.setUint32(4,Ma,!0);const y=er(Sa(JSON.stringify(i)),32),x=new DataView(new ArrayBuffer(ps));x.setUint32(0,y.byteLength,!0),x.setUint32(4,ba,!0);const m=new ArrayBuffer(ds),M=new DataView(m);M.setUint32(0,va,!0),M.setUint32(4,wa,!0);const v=ds+x.byteLength+y.byteLength+_.byteLength+p.byteLength;M.setUint32(8,v,!0),new Blob([m,x,y,_,p],{type:"application/octet-stream"}).arrayBuffer().then(t)}):i.buffers&&i.buffers.length>0?us(h).then(g=>{i.buffers[0].uri=g,t(i)}):t(i)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,r=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const i in s.gltfExtensions)t.extensions[i]=s.gltfExtensions[i],r[i]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const n=new l.Vector3;for(let r=0,s=e.count;r<s;r++)if(Math.abs(n.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new l.Vector3;for(let s=0,i=n.count;s<i;s++)r.fromBufferAttribute(n,s),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),n.setXYZ(s,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};(t.offset.x!==0||t.offset.y!==0)&&(r.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(r.rotation=t.rotation,n=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(p){return("colorSpace"in p?p.colorSpace==="srgb":p.encoding===3001)?function(y){return y<.04045?y*.0773993808:Math.pow(y*.9478672986+.0521327014,2.4)}:function(y){return y}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof l.CompressedTexture&&(e=Jn(e)),t instanceof l.CompressedTexture&&(t=Jn(t));const r=e?e.image:null,s=t?t.image:null,i=Math.max(r?r.width:0,s?s.width:0),a=Math.max(r?r.height:0,s?s.height:0),c=gs();c.width=i,c.height=a;const h=c.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,i,a);const d=h.getImageData(0,0,i,a);if(r){h.drawImage(r,0,0,i,a);const p=n(e),_=h.getImageData(0,0,i,a).data;for(let y=2;y<_.length;y+=4)d.data[y]=p(_[y]/256)*256}if(s){h.drawImage(s,0,0,i,a);const p=n(t),_=h.getImageData(0,0,i,a).data;for(let y=1;y<_.length;y+=4)d.data[y]=p(_[y]/256)*256}h.putImageData(d,0,0);const g=(e||t).clone();return g.source=new l.Texture(c).source,"colorSpace"in g?g.colorSpace="":g.encoding=3e3,g.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),g}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,s){const i=this.json;i.bufferViews||(i.bufferViews=[]);let a;switch(t){case we.BYTE:case we.UNSIGNED_BYTE:a=1;break;case we.SHORT:case we.UNSIGNED_SHORT:a=2;break;default:a=4}const c=ms(r*e.itemSize*a),h=new DataView(new ArrayBuffer(c));let d=0;for(let p=n;p<n+r;p++)for(let _=0;_<e.itemSize;_++){let y;e.itemSize>4?y=e.array[p*e.itemSize+_]:(_===0?y=e.getX(p):_===1?y=e.getY(p):_===2?y=e.getZ(p):_===3&&(y=e.getW(p)),e.normalized===!0&&(y=l.MathUtils.normalize(y,e.array))),t===we.FLOAT?h.setFloat32(d,y,!0):t===we.INT?h.setInt32(d,y,!0):t===we.UNSIGNED_INT?h.setUint32(d,y,!0):t===we.SHORT?h.setInt16(d,y,!0):t===we.UNSIGNED_SHORT?h.setUint16(d,y,!0):t===we.BYTE?h.setInt8(d,y):t===we.UNSIGNED_BYTE&&h.setUint8(d,y),d+=a}const f={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:c};return s!==void 0&&(f.target=s),s===we.ARRAY_BUFFER&&(f.byteStride=e.itemSize*a),this.byteOffset+=c,i.bufferViews.push(f),{id:i.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),e.arrayBuffer().then(r=>{const s=er(r),i={buffer:t.processBuffer(s),byteOffset:t.byteOffset,byteLength:s.byteLength};return t.byteOffset+=s.byteLength,n.bufferViews.push(i)-1})}processAccessor(e,t,n,r){const s=this.json,i={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=we.FLOAT;else if(e.array.constructor===Int32Array)a=we.INT;else if(e.array.constructor===Uint32Array)a=we.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=we.SHORT;else if(e.array.constructor===Uint16Array)a=we.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=we.BYTE;else if(e.array.constructor===Uint8Array)a=we.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(n===void 0&&(n=0),r===void 0&&(r=e.count),r===0)return null;const c=Ca(e,n,r);let h;t!==void 0&&(h=e===t.index?we.ELEMENT_ARRAY_BUFFER:we.ARRAY_BUFFER);const d=this.processBufferView(e,a,n,r,h),f={bufferView:d.id,byteOffset:d.byteOffset,componentType:a,count:r,max:c.max,min:c.min,type:i[e.itemSize]};return e.normalized===!0&&(f.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(f)-1}processImage(e,t,n,r="image/png"){if(e!==null){const s=this,i=s.cache,a=s.json,c=s.options,h=s.pending;i.images.has(e)||i.images.set(e,{});const d=i.images.get(e),f=r+":flipY/"+n.toString();if(d[f]!==void 0)return d[f];a.images||(a.images=[]);const g={mimeType:r},p=gs();p.width=Math.min(e.width,c.maxTextureSize),p.height=Math.min(e.height,c.maxTextureSize);const _=p.getContext("2d");if(n===!0&&(_.translate(0,p.height),_.scale(1,-1)),e.data!==void 0){t!==l.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const x=new Uint8ClampedArray(e.height*e.width*4);for(let m=0;m<x.length;m+=4)x[m+0]=e.data[m+0],x[m+1]=e.data[m+1],x[m+2]=e.data[m+2],x[m+3]=e.data[m+3];_.putImageData(new ImageData(x,e.width,e.height),0,0)}else _.drawImage(e,0,0,p.width,p.height);c.binary===!0?h.push(ys(p,r).then(x=>s.processBufferViewImage(x)).then(x=>{g.bufferView=x})):p.toDataURL!==void 0?g.uri=p.toDataURL(r):h.push(ys(p,r).then(us).then(x=>{g.uri=x}));const y=a.images.push(g)-1;return d[f]=y,y}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Xe[e.magFilter],minFilter:Xe[e.minFilter],wrapS:Xe[e.wrapS],wrapT:Xe[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const n=this.options,r=this.cache,s=this.json;if(r.textures.has(e))return r.textures.get(e);s.textures||(s.textures=[]),e instanceof l.CompressedTexture&&(e=Jn(e,n.maxTextureSize));let i=e.userData.mimeType;i==="image/webp"&&(i="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(a.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,a)});const c=s.textures.push(a)-1;return r.textures.set(e,c),c}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(qt(s,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),c={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(c,a),r.pbrMetallicRoughness.metallicRoughnessTexture=c}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),r.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const h={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(h,e.emissiveMap),r.emissiveTexture=h}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),r.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),r.occlusionTexture=a}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===l.DoubleSide&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,r)});const i=n.materials.push(r)-1;return t.materials.set(e,i),i}processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let v=0,C=e.material.length;v<C;v++)r.push(e.material[v].uuid);else r.push(e.material.uuid);const s=r.join(":");if(t.meshes.has(s))return t.meshes.get(s);const i=e.geometry;let a;e.isLineSegments?a=we.LINES:e.isLineLoop?a=we.LINE_LOOP:e.isLine?a=we.LINE_STRIP:e.isPoints?a=we.POINTS:a=e.material.wireframe?we.LINES:we.TRIANGLES;const c={},h={},d=[],f=[],g={...wn>=152?{uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3"}:{uv:"TEXCOORD_0",uv2:"TEXCOORD_1"},color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=i.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let _=null;for(let v in i.attributes){if(v.slice(0,5)==="morph")continue;const C=i.attributes[v];if(v=g[v]||v.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(v)||(v="_"+v),t.attributes.has(this.getUID(C))){h[v]=t.attributes.get(this.getUID(C));continue}_=null;const S=C.array;v==="JOINTS_0"&&!(S instanceof Uint16Array)&&!(S instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),_=new l.BufferAttribute(new Uint16Array(S),C.itemSize,C.normalized));const A=this.processAccessor(_||C,i);A!==null&&(v.startsWith("_")||this.detectMeshQuantization(v,C),h[v]=A,t.attributes.set(this.getUID(C),A))}if(p!==void 0&&i.setAttribute("normal",p),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const v=[],C=[],O={};if(e.morphTargetDictionary!==void 0)for(const S in e.morphTargetDictionary)O[e.morphTargetDictionary[S]]=S;for(let S=0;S<e.morphTargetInfluences.length;++S){const A={};let b=!1;for(const P in i.morphAttributes){if(P!=="position"&&P!=="normal"){b||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),b=!0);continue}const w=i.morphAttributes[P][S],L=P.toUpperCase(),D=i.attributes[P];if(t.attributes.has(this.getUID(w,!0))){A[L]=t.attributes.get(this.getUID(w,!0));continue}const V=w.clone();if(!i.morphTargetsRelative)for(let G=0,Y=w.count;G<Y;G++)for(let W=0;W<w.itemSize;W++)W===0&&V.setX(G,w.getX(G)-D.getX(G)),W===1&&V.setY(G,w.getY(G)-D.getY(G)),W===2&&V.setZ(G,w.getZ(G)-D.getZ(G)),W===3&&V.setW(G,w.getW(G)-D.getW(G));A[L]=this.processAccessor(V,i),t.attributes.set(this.getUID(D,!0),A[L])}f.push(A),v.push(e.morphTargetInfluences[S]),e.morphTargetDictionary!==void 0&&C.push(O[S])}c.weights=v,C.length>0&&(c.extras={},c.extras.targetNames=C)}const y=Array.isArray(e.material);if(y&&i.groups.length===0)return null;const x=y?e.material:[e.material],m=y?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let v=0,C=m.length;v<C;v++){const O={mode:a,attributes:h};if(this.serializeUserData(i,O),f.length>0&&(O.targets=f),i.index!==null){let A=this.getUID(i.index);(m[v].start!==void 0||m[v].count!==void 0)&&(A+=":"+m[v].start+":"+m[v].count),t.attributes.has(A)?O.indices=t.attributes.get(A):(O.indices=this.processAccessor(i.index,i,m[v].start,m[v].count),t.attributes.set(A,O.indices)),O.indices===null&&delete O.indices}const S=this.processMaterial(x[m[v].materialIndex]);S!==null&&(O.material=S),d.push(O)}c.primitives=d,n.meshes||(n.meshes=[]),this._invokeAll(function(v){v.writeMesh&&v.writeMesh(e,c)});const M=n.meshes.push(c)-1;return t.meshes.set(s,M),M}detectMeshQuantization(e,t){if(this.extensionsUsed[$n])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const r=e.split("_",1)[0];hs[r]&&hs[r].includes(n)&&(this.extensionsUsed[$n]=!0,this.extensionsRequired[$n]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:l.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]),e=Hn.Utils.mergeMorphTargetTracks(e.clone(),t);const s=e.tracks,i=[],a=[];for(let c=0;c<s.length;++c){const h=s[c],d=l.PropertyBinding.parseTrackName(h.name);let f=l.PropertyBinding.findNode(t,d.nodeName);const g=fs[d.propertyName];if(d.objectName==="bones"&&(f.isSkinnedMesh===!0?f=f.skeleton.getBoneByName(d.objectIndex):f=void 0),!f||!g)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const p=1;let _=h.values.length/h.times.length;g===fs.morphTargetInfluences&&(_/=f.morphTargetInfluences.length);let y;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(y="CUBICSPLINE",_/=3):h.getInterpolation()===l.InterpolateDiscrete?y="STEP":y="LINEAR",a.push({input:this.processAccessor(new l.BufferAttribute(h.times,p)),output:this.processAccessor(new l.BufferAttribute(h.values,_)),interpolation:y}),i.push({sampler:a.length-1,target:{node:r.get(f),path:g}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:a,channels:i}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],s=e.skeleton;if(s===void 0)return null;const i=e.skeleton.bones[0];if(i===void 0)return null;const a=[],c=new Float32Array(s.bones.length*16),h=new l.Matrix4;for(let f=0;f<s.bones.length;++f)a.push(n.get(s.bones[f])),h.copy(s.boneInverses[f]),h.multiply(e.bindMatrix).toArray(c,f*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new l.BufferAttribute(c,16)),joints:a,skeleton:n.get(i)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(n.trs){const a=e.quaternion.toArray(),c=e.position.toArray(),h=e.scale.toArray();qt(a,[0,0,0,1])||(s.rotation=a),qt(c,[0,0,0])||(s.translation=c),qt(h,[1,1,1])||(s.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),Aa(e.matrix)===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(s.mesh=a)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let c=0,h=e.children.length;c<h;c++){const d=e.children[c];if(d.visible||n.onlyVisible===!1){const f=this.processNode(d);f!==null&&a.push(f)}}a.length>0&&(s.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,s)});const i=t.nodes.push(s)-1;return r.set(e,i),i}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);const s=[];for(let i=0,a=e.children.length;i<a;i++){const c=e.children[i];if(c.visible||n.onlyVisible===!1){const h=this.processNode(c);h!==null&&s.push(h)}}s.length>0&&(r.nodes=s),this.serializeUserData(e,r)}processObjects(e){const t=new l.Scene;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const n=[];for(let r=0;r<e.length;r++)e[r]instanceof l.Scene?this.processScene(e[r]):n.push(e[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class Ta{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const n=this.writer,r=n.json,s=n.extensionsUsed,i={};e.name&&(i.name=e.name),i.color=e.color.toArray(),i.intensity=e.intensity,e.isDirectionalLight?i.type="directional":e.isPointLight?(i.type="point",e.distance>0&&(i.range=e.distance)):e.isSpotLight&&(i.type="spot",e.distance>0&&(i.range=e.distance),i.spot={},i.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,i.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},s[this.name]=!0);const a=r.extensions[this.name].lights;a.push(i),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}let Ia=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},Oa=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const i={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(i,e.clearcoatMap),s.clearcoatTexture=i}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const i={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(i,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=i}if(e.clearcoatNormalMap){const i={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(i,e.clearcoatNormalMap),s.clearcoatNormalTexture=i}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},La=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const i={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(i,e.iridescenceMap),s.iridescenceTexture=i}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const i={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(i,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=i}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},Da=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const i={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(i,e.transmissionMap),s.transmissionTexture=i}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},Ba=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const i={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(i,e.thicknessMap),s.thicknessTexture=i}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},ka=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const r=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},Fa=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(xa)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,r=n.extensionsUsed,s={};if(e.specularIntensityMap){const i={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(i,e.specularIntensityMap),s.specularTexture=i}if(e.specularColorMap){const i={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(i,e.specularColorMap),s.specularColorTexture=i}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},Ua=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const n=this.writer,r=n.extensionsUsed,s={};if(e.sheenRoughnessMap){const i={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(i,e.sheenRoughnessMap),s.sheenRoughnessTexture=i}if(e.sheenColorMap){const i={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(i,e.sheenColorMap),s.sheenColorTexture=i}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},Na=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const n=this.writer,r=n.extensionsUsed,s={};if(e.anisotropyMap){const i={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(i,e.anisotropyMap),s.anisotropyTexture=i}s.anisotropyStrength=e.anisotropy,s.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},za=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const r=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}};var Ke=Uint8Array,_t=Uint16Array,tr=Uint32Array,_s=new Ke([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xs=new Ke([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Va=new Ke([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vs=function(o,e){for(var t=new _t(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var r=new tr(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)r[s]=s-t[n]<<5|n;return[t,r]},ws=vs(_s,2),bs=ws[0],Ga=ws[1];bs[28]=258,Ga[258]=28;for(var Ra=vs(xs,0),ja=Ra[0],nr=new _t(32768),Te=0;Te<32768;++Te){var xt=(Te&43690)>>>1|(Te&21845)<<1;xt=(xt&52428)>>>2|(xt&13107)<<2,xt=(xt&61680)>>>4|(xt&3855)<<4,nr[Te]=((xt&65280)>>>8|(xt&255)<<8)>>>1}for(var Qt=function(o,e,t){for(var n=o.length,r=0,s=new _t(e);r<n;++r)++s[o[r]-1];var i=new _t(e);for(r=0;r<e;++r)i[r]=i[r-1]+s[r-1]<<1;var a;if(t){a=new _t(1<<e);var c=15-e;for(r=0;r<n;++r)if(o[r])for(var h=r<<4|o[r],d=e-o[r],f=i[o[r]-1]++<<d,g=f|(1<<d)-1;f<=g;++f)a[nr[f]>>>c]=h}else for(a=new _t(n),r=0;r<n;++r)o[r]&&(a[r]=nr[i[o[r]-1]++]>>>15-o[r]);return a},Jt=new Ke(288),Te=0;Te<144;++Te)Jt[Te]=8;for(var Te=144;Te<256;++Te)Jt[Te]=9;for(var Te=256;Te<280;++Te)Jt[Te]=7;for(var Te=280;Te<288;++Te)Jt[Te]=8;for(var Ms=new Ke(32),Te=0;Te<32;++Te)Ms[Te]=5;var Ea=Qt(Jt,9,1),Ya=Qt(Ms,5,1),rr=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},et=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},sr=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},Wa=function(o){return(o/8|0)+(o&7&&1)},Xa=function(o,e,t){(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof _t?_t:o instanceof tr?tr:Ke)(t-e);return n.set(o.subarray(e,t)),n},Za=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new Ke(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new Ke(n*3));var i=function(F){var k=e.length;if(F>k){var R=new Ke(Math.max(k*2,F));R.set(e),e=R}},a=t.f||0,c=t.p||0,h=t.b||0,d=t.l,f=t.d,g=t.m,p=t.n,_=n*8;do{if(!d){t.f=a=et(o,c,1);var y=et(o,c+1,3);if(c+=3,y)if(y==1)d=Ea,f=Ya,g=9,p=5;else if(y==2){var v=et(o,c,31)+257,C=et(o,c+10,15)+4,O=v+et(o,c+5,31)+1;c+=14;for(var S=new Ke(O),A=new Ke(19),b=0;b<C;++b)A[Va[b]]=et(o,c+b*3,7);c+=C*3;for(var P=rr(A),w=(1<<P)-1,L=Qt(A,P,1),b=0;b<O;){var D=L[et(o,c,w)];c+=D&15;var x=D>>>4;if(x<16)S[b++]=x;else{var V=0,G=0;for(x==16?(G=3+et(o,c,3),c+=2,V=S[b-1]):x==17?(G=3+et(o,c,7),c+=3):x==18&&(G=11+et(o,c,127),c+=7);G--;)S[b++]=V}}var Y=S.subarray(0,v),W=S.subarray(v);g=rr(Y),p=rr(W),d=Qt(Y,g,1),f=Qt(W,p,1)}else throw"invalid block type";else{var x=Wa(c)+4,m=o[x-4]|o[x-3]<<8,M=x+m;if(M>n){if(s)throw"unexpected EOF";break}r&&i(h+m),e.set(o.subarray(x,M),h),t.b=h+=m,t.p=c=M*8;continue}if(c>_){if(s)throw"unexpected EOF";break}}r&&i(h+131072);for(var $=(1<<g)-1,q=(1<<p)-1,ne=c;;ne=c){var V=d[sr(o,c)&$],te=V>>>4;if(c+=V&15,c>_){if(s)throw"unexpected EOF";break}if(!V)throw"invalid length/literal";if(te<256)e[h++]=te;else if(te==256){ne=c,d=null;break}else{var ce=te-254;if(te>264){var b=te-257,le=_s[b];ce=et(o,c,(1<<le)-1)+bs[b],c+=le}var me=f[sr(o,c)&q],B=me>>>4;if(!me)throw"invalid distance";c+=me&15;var W=ja[B];if(B>3){var le=xs[B];W+=sr(o,c)&(1<<le)-1,c+=le}if(c>_){if(s)throw"unexpected EOF";break}r&&i(h+131072);for(var z=h+ce;h<z;h+=4)e[h]=e[h-W],e[h+1]=e[h+1-W],e[h+2]=e[h+2-W],e[h+3]=e[h+3-W];h=z}}t.l=d,t.p=ne,t.b=h,d&&(a=1,t.m=g,t.d=f,t.n=p)}while(!a);return h==e.length?e:Xa(e,0,h)},Ka=new Ke(0),qa=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Qa(o,e){return Za((qa(o),o.subarray(2,-4)),e)}var Ja=typeof TextDecoder<"u"&&new TextDecoder,Ha=0;try{Ja.decode(Ka,{stream:!0}),Ha=1}catch{}var $a=Object.defineProperty,el=(o,e,t)=>e in o?$a(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,tl=(o,e,t)=>(el(o,e+"",t),t);const Ss=class extends l.Mesh{constructor(o,e={}){super(o),this.isReflector=!0,this.type="Reflector",this.camera=new l.PerspectiveCamera;const t=this,n=e.color!==void 0?new l.Color(e.color):new l.Color(8355711),r=e.textureWidth||512,s=e.textureHeight||512,i=e.clipBias||0,a=e.shader||Ss.ReflectorShader,c=e.multisample!==void 0?e.multisample:4,h=new l.Plane,d=new l.Vector3,f=new l.Vector3,g=new l.Vector3,p=new l.Matrix4,_=new l.Vector3(0,0,-1),y=new l.Vector4,x=new l.Vector3,m=new l.Vector3,M=new l.Vector4,v=new l.Matrix4,C=this.camera,O=new l.WebGLRenderTarget(r,s,{samples:c,type:l.HalfFloatType}),S=new l.ShaderMaterial({uniforms:l.UniformsUtils.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});S.uniforms.tDiffuse.value=O.texture,S.uniforms.color.value=n,S.uniforms.textureMatrix.value=v,this.material=S,this.onBeforeRender=function(A,b,P){if(f.setFromMatrixPosition(t.matrixWorld),g.setFromMatrixPosition(P.matrixWorld),p.extractRotation(t.matrixWorld),d.set(0,0,1),d.applyMatrix4(p),x.subVectors(f,g),x.dot(d)>0)return;x.reflect(d).negate(),x.add(f),p.extractRotation(P.matrixWorld),_.set(0,0,-1),_.applyMatrix4(p),_.add(g),m.subVectors(f,_),m.reflect(d).negate(),m.add(f),C.position.copy(x),C.up.set(0,1,0),C.up.applyMatrix4(p),C.up.reflect(d),C.lookAt(m),C.far=P.far,C.updateMatrixWorld(),C.projectionMatrix.copy(P.projectionMatrix),v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(C.projectionMatrix),v.multiply(C.matrixWorldInverse),v.multiply(t.matrixWorld),h.setFromNormalAndCoplanarPoint(d,f),h.applyMatrix4(C.matrixWorldInverse),y.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const w=C.projectionMatrix;M.x=(Math.sign(y.x)+w.elements[8])/w.elements[0],M.y=(Math.sign(y.y)+w.elements[9])/w.elements[5],M.z=-1,M.w=(1+w.elements[10])/w.elements[14],y.multiplyScalar(2/y.dot(M)),w.elements[2]=y.x,w.elements[6]=y.y,w.elements[10]=y.z+1-i,w.elements[14]=y.w,t.visible=!1;const L=A.getRenderTarget(),D=A.xr.enabled,V=A.shadowMap.autoUpdate,G=A.toneMapping;let Y=!1;"outputColorSpace"in A?Y=A.outputColorSpace==="srgb":Y=A.outputEncoding===3001,A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,"outputColorSpace"in A?A.outputColorSpace="srgb-linear":A.outputEncoding=3e3,A.toneMapping=l.NoToneMapping,A.setRenderTarget(O),A.state.buffers.depth.setMask(!0),A.autoClear===!1&&A.clear(),A.render(b,C),A.xr.enabled=D,A.shadowMap.autoUpdate=V,A.toneMapping=G,"outputColorSpace"in A?A.outputColorSpace=Y?"srgb":"srgb-linear":A.outputEncoding=Y?3001:3e3,A.setRenderTarget(L);const W=P.viewport;W!==void 0&&A.state.viewport(W),t.visible=!0},this.getRenderTarget=function(){return O},this.dispose=function(){O.dispose(),t.material.dispose()}}};let ir=Ss;tl(ir,"ReflectorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${wn>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});class nl extends l.Mesh{constructor(e,t={}){super(e),this.isWater=!0;const n=this,r=t.textureWidth!==void 0?t.textureWidth:512,s=t.textureHeight!==void 0?t.textureHeight:512,i=t.clipBias!==void 0?t.clipBias:0,a=t.alpha!==void 0?t.alpha:1,c=t.time!==void 0?t.time:0,h=t.waterNormals!==void 0?t.waterNormals:null,d=t.sunDirection!==void 0?t.sunDirection:new l.Vector3(.70707,.70707,0),f=new l.Color(t.sunColor!==void 0?t.sunColor:16777215),g=new l.Color(t.waterColor!==void 0?t.waterColor:8355711),p=t.eye!==void 0?t.eye:new l.Vector3(0,0,0),_=t.distortionScale!==void 0?t.distortionScale:20,y=t.side!==void 0?t.side:l.FrontSide,x=t.fog!==void 0?t.fog:!1,m=new l.Plane,M=new l.Vector3,v=new l.Vector3,C=new l.Vector3,O=new l.Matrix4,S=new l.Vector3(0,0,-1),A=new l.Vector4,b=new l.Vector3,P=new l.Vector3,w=new l.Vector4,L=new l.Matrix4,D=new l.PerspectiveCamera,V=new l.WebGLRenderTarget(r,s),G={uniforms:l.UniformsUtils.merge([l.UniformsLib.fog,l.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new l.Matrix4},sunColor:{value:new l.Color(8355711)},sunDirection:{value:new l.Vector3(.70707,.70707,0)},eye:{value:new l.Vector3},waterColor:{value:new l.Color(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <${parseInt(l.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>	
				}`},Y=new l.ShaderMaterial({fragmentShader:G.fragmentShader,vertexShader:G.vertexShader,uniforms:l.UniformsUtils.clone(G.uniforms),lights:!0,side:y,fog:x});Y.uniforms.mirrorSampler.value=V.texture,Y.uniforms.textureMatrix.value=L,Y.uniforms.alpha.value=a,Y.uniforms.time.value=c,Y.uniforms.normalSampler.value=h,Y.uniforms.sunColor.value=f,Y.uniforms.waterColor.value=g,Y.uniforms.sunDirection.value=d,Y.uniforms.distortionScale.value=_,Y.uniforms.eye.value=p,n.material=Y,n.onBeforeRender=function(W,$,q){if(v.setFromMatrixPosition(n.matrixWorld),C.setFromMatrixPosition(q.matrixWorld),O.extractRotation(n.matrixWorld),M.set(0,0,1),M.applyMatrix4(O),b.subVectors(v,C),b.dot(M)>0)return;b.reflect(M).negate(),b.add(v),O.extractRotation(q.matrixWorld),S.set(0,0,-1),S.applyMatrix4(O),S.add(C),P.subVectors(v,S),P.reflect(M).negate(),P.add(v),D.position.copy(b),D.up.set(0,1,0),D.up.applyMatrix4(O),D.up.reflect(M),D.lookAt(P),D.far=q.far,D.updateMatrixWorld(),D.projectionMatrix.copy(q.projectionMatrix),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(D.projectionMatrix),L.multiply(D.matrixWorldInverse),m.setFromNormalAndCoplanarPoint(M,v),m.applyMatrix4(D.matrixWorldInverse),A.set(m.normal.x,m.normal.y,m.normal.z,m.constant);const ne=D.projectionMatrix;w.x=(Math.sign(A.x)+ne.elements[8])/ne.elements[0],w.y=(Math.sign(A.y)+ne.elements[9])/ne.elements[5],w.z=-1,w.w=(1+ne.elements[10])/ne.elements[14],A.multiplyScalar(2/A.dot(w)),ne.elements[2]=A.x,ne.elements[6]=A.y,ne.elements[10]=A.z+1-i,ne.elements[14]=A.w,p.setFromMatrixPosition(q.matrixWorld);const te=W.getRenderTarget(),ce=W.xr.enabled,le=W.shadowMap.autoUpdate;n.visible=!1,W.xr.enabled=!1,W.shadowMap.autoUpdate=!1,W.setRenderTarget(V),W.state.buffers.depth.setMask(!0),W.autoClear===!1&&W.clear(),W.render($,D),n.visible=!0,W.xr.enabled=ce,W.shadowMap.autoUpdate=le,W.setRenderTarget(te);const me=q.viewport;me!==void 0&&W.state.viewport(me)}}}var rl=Object.defineProperty,sl=(o,e,t)=>e in o?rl(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,As=(o,e,t)=>(sl(o,typeof e!="symbol"?e+"":e,t),t);const Sn={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new l.Vector3},up:{value:new l.Vector3(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${wn>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},Cs=new l.ShaderMaterial({name:"SkyShader",fragmentShader:Sn.fragmentShader,vertexShader:Sn.vertexShader,uniforms:l.UniformsUtils.clone(Sn.uniforms),side:l.BackSide,depthWrite:!1});class or extends l.Mesh{constructor(){super(new l.BoxGeometry(1,1,1),Cs)}}As(or,"SkyShader",Sn),As(or,"material",Cs);const Fe=new l.Triangle,An=new l.Vector3;class il{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let s=0;s<e.count;s+=3){let i=1;t&&(i=t.getX(s)+t.getX(s+1)+t.getX(s+2)),Fe.a.fromBufferAttribute(e,s),Fe.b.fromBufferAttribute(e,s+1),Fe.c.fromBufferAttribute(e,s+2),i*=Fe.getArea(),n[s/3]=i}this.distribution=new Float32Array(e.count/3);let r=0;for(let s=0;s<n.length;s++)r+=n[s],this.distribution[s]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,r=t.length-1,s=-1;for(;n<=r;){const i=Math.ceil((n+r)/2);if(i===0||t[i-1]<=e&&t[i]>e){s=i;break}else e<t[i]?r=i-1:n=i+1}return s}sampleFace(e,t,n,r){let s=this.randomFunction(),i=this.randomFunction();return s+i>1&&(s=1-s,i=1-i),Fe.a.fromBufferAttribute(this.positionAttribute,e*3),Fe.b.fromBufferAttribute(this.positionAttribute,e*3+1),Fe.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Fe.a,s).addScaledVector(Fe.b,i).addScaledVector(Fe.c,1-(s+i)),n!==void 0&&Fe.getNormal(n),r!==void 0&&this.colorAttribute!==void 0&&(Fe.a.fromBufferAttribute(this.colorAttribute,e*3),Fe.b.fromBufferAttribute(this.colorAttribute,e*3+1),Fe.c.fromBufferAttribute(this.colorAttribute,e*3+2),An.set(0,0,0).addScaledVector(Fe.a,s).addScaledVector(Fe.b,i).addScaledVector(Fe.c,1-(s+i)),r.r=An.x,r.g=An.y,r.b=An.z),this}}var ol=Object.defineProperty,al=(o,e,t)=>e in o?ol(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Q=(o,e,t)=>(al(o,typeof e!="symbol"?e+"":e,t),t);class ll extends l.Object3D{constructor(e,t){super(),Q(this,"isTransformControls",!0),Q(this,"visible",!1),Q(this,"domElement"),Q(this,"raycaster",new l.Raycaster),Q(this,"gizmo"),Q(this,"plane"),Q(this,"tempVector",new l.Vector3),Q(this,"tempVector2",new l.Vector3),Q(this,"tempQuaternion",new l.Quaternion),Q(this,"unit",{X:new l.Vector3(1,0,0),Y:new l.Vector3(0,1,0),Z:new l.Vector3(0,0,1)}),Q(this,"pointStart",new l.Vector3),Q(this,"pointEnd",new l.Vector3),Q(this,"offset",new l.Vector3),Q(this,"rotationAxis",new l.Vector3),Q(this,"startNorm",new l.Vector3),Q(this,"endNorm",new l.Vector3),Q(this,"rotationAngle",0),Q(this,"cameraPosition",new l.Vector3),Q(this,"cameraQuaternion",new l.Quaternion),Q(this,"cameraScale",new l.Vector3),Q(this,"parentPosition",new l.Vector3),Q(this,"parentQuaternion",new l.Quaternion),Q(this,"parentQuaternionInv",new l.Quaternion),Q(this,"parentScale",new l.Vector3),Q(this,"worldPositionStart",new l.Vector3),Q(this,"worldQuaternionStart",new l.Quaternion),Q(this,"worldScaleStart",new l.Vector3),Q(this,"worldPosition",new l.Vector3),Q(this,"worldQuaternion",new l.Quaternion),Q(this,"worldQuaternionInv",new l.Quaternion),Q(this,"worldScale",new l.Vector3),Q(this,"eye",new l.Vector3),Q(this,"positionStart",new l.Vector3),Q(this,"quaternionStart",new l.Quaternion),Q(this,"scaleStart",new l.Vector3),Q(this,"camera"),Q(this,"object"),Q(this,"enabled",!0),Q(this,"axis",null),Q(this,"mode","translate"),Q(this,"translationSnap",null),Q(this,"rotationSnap",null),Q(this,"scaleSnap",null),Q(this,"space","world"),Q(this,"size",1),Q(this,"dragging",!1),Q(this,"showX",!0),Q(this,"showY",!0),Q(this,"showZ",!0),Q(this,"changeEvent",{type:"change"}),Q(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),Q(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),Q(this,"objectChangeEvent",{type:"objectChange"}),Q(this,"intersectObjectWithRay",(r,s,i)=>{const a=s.intersectObject(r,!0);for(let c=0;c<a.length;c++)if(a[c].object.visible||i)return a[c];return!1}),Q(this,"attach",r=>(this.object=r,this.visible=!0,this)),Q(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),Q(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),Q(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),Q(this,"pointerHover",r=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),Q(this,"pointerDown",r=>{if(!(this.object===void 0||this.dragging===!0||r.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let i=this.space;if(this.mode==="scale"?i="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(i="world"),i==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),Q(this,"pointerMove",r=>{const s=this.axis,i=this.mode,a=this.object;let c=this.space;if(i==="scale"?c="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(c="world"),a===void 0||s===null||this.dragging===!1||r.button!==-1)return;this.raycaster.setFromCamera(r,this.camera);const h=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(h){if(this.pointEnd.copy(h.point).sub(this.worldPositionStart),i==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),c==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(c==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),c==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(i==="scale"){if(s.search("XYZ")!==-1){let d=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(d*=-1),this.tempVector2.set(d,d,d)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const d=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*d):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),c==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*d),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&s!=="E"&&s!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),Q(this,"pointerUp",r=>{r.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),Q(this,"getPointer",r=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:r.button};{const i=r.changedTouches?r.changedTouches[0]:r,a=this.domElement.getBoundingClientRect();return{x:(i.clientX-a.left)/a.width*2-1,y:-(i.clientY-a.top)/a.height*2+1,button:r.button}}}),Q(this,"onPointerHover",r=>{if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(r));break}}),Q(this,"onPointerDown",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(r)),this.pointerDown(this.getPointer(r)))}),Q(this,"onPointerMove",r=>{this.enabled&&this.pointerMove(this.getPointer(r))}),Q(this,"onPointerUp",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(r)))}),Q(this,"getMode",()=>this.mode),Q(this,"setMode",r=>{this.mode=r}),Q(this,"setTranslationSnap",r=>{this.translationSnap=r}),Q(this,"setRotationSnap",r=>{this.rotationSnap=r}),Q(this,"setScaleSnap",r=>{this.scaleSnap=r}),Q(this,"setSize",r=>{this.size=r}),Q(this,"setSpace",r=>{this.space=r}),Q(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),Q(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),Q(this,"dispose",()=>{var r,s,i,a,c,h;(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(a=(i=this.domElement)==null?void 0:i.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(h=(c=this.domElement)==null?void 0:c.ownerDocument)==null||h.removeEventListener("pointerup",this.onPointerUp),this.traverse(d=>{const f=d;f.geometry&&f.geometry.dispose(),f.material&&f.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new cl,this.add(this.gizmo),this.plane=new ul,this.add(this.plane);const n=(r,s)=>{let i=s;Object.defineProperty(this,r,{get:function(){return i!==void 0?i:s},set:function(a){i!==a&&(i=a,this.plane[r]=a,this.gizmo[r]=a,this.dispatchEvent({type:r+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[r]=s,this.plane[r]=s,this.gizmo[r]=s};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),t!==void 0&&this.connect(t)}}class cl extends l.Object3D{constructor(){super(),Q(this,"isTransformControlsGizmo",!0),Q(this,"type","TransformControlsGizmo"),Q(this,"tempVector",new l.Vector3(0,0,0)),Q(this,"tempEuler",new l.Euler),Q(this,"alignVector",new l.Vector3(0,1,0)),Q(this,"zeroVector",new l.Vector3(0,0,0)),Q(this,"lookAtMatrix",new l.Matrix4),Q(this,"tempQuaternion",new l.Quaternion),Q(this,"tempQuaternion2",new l.Quaternion),Q(this,"identityQuaternion",new l.Quaternion),Q(this,"unitX",new l.Vector3(1,0,0)),Q(this,"unitY",new l.Vector3(0,1,0)),Q(this,"unitZ",new l.Vector3(0,0,1)),Q(this,"gizmo"),Q(this,"picker"),Q(this,"helper"),Q(this,"rotationAxis",new l.Vector3),Q(this,"cameraPosition",new l.Vector3),Q(this,"worldPositionStart",new l.Vector3),Q(this,"worldQuaternionStart",new l.Quaternion),Q(this,"worldPosition",new l.Vector3),Q(this,"worldQuaternion",new l.Quaternion),Q(this,"eye",new l.Vector3),Q(this,"camera",null),Q(this,"enabled",!0),Q(this,"axis",null),Q(this,"mode","translate"),Q(this,"space","world"),Q(this,"size",1),Q(this,"dragging",!1),Q(this,"showX",!0),Q(this,"showY",!0),Q(this,"showZ",!0),Q(this,"updateMatrixWorld",()=>{let te=this.space;this.mode==="scale"&&(te="local");const ce=te==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let le=[];le=le.concat(this.picker[this.mode].children),le=le.concat(this.gizmo[this.mode].children),le=le.concat(this.helper[this.mode].children);for(let me=0;me<le.length;me++){const B=le[me];B.visible=!0,B.rotation.set(0,0,0),B.position.copy(this.worldPosition);let z;if(this.camera.isOrthographicCamera?z=(this.camera.top-this.camera.bottom)/this.camera.zoom:z=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),B.scale.set(1,1,1).multiplyScalar(z*this.size/7),B.tag==="helper"){B.visible=!1,B.name==="AXIS"?(B.position.copy(this.worldPositionStart),B.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),B.quaternion.copy(ce).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(ce).dot(this.eye))>.9&&(B.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),B.quaternion.copy(ce).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(ce).dot(this.eye))>.9&&(B.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),B.quaternion.copy(ce).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(ce).dot(this.eye))>.9&&(B.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),B.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),B.quaternion.multiply(this.tempQuaternion),B.visible=this.dragging),this.axis==="E"&&(B.visible=!1)):B.name==="START"?(B.position.copy(this.worldPositionStart),B.visible=this.dragging):B.name==="END"?(B.position.copy(this.worldPosition),B.visible=this.dragging):B.name==="DELTA"?(B.position.copy(this.worldPositionStart),B.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),B.scale.copy(this.tempVector),B.visible=this.dragging):(B.quaternion.copy(ce),this.dragging?B.position.copy(this.worldPositionStart):B.position.copy(this.worldPosition),this.axis&&(B.visible=this.axis.search(B.name)!==-1));continue}B.quaternion.copy(ce),this.mode==="translate"||this.mode==="scale"?((B.name==="X"||B.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(ce).dot(this.eye))>.99&&(B.scale.set(1e-10,1e-10,1e-10),B.visible=!1),(B.name==="Y"||B.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(ce).dot(this.eye))>.99&&(B.scale.set(1e-10,1e-10,1e-10),B.visible=!1),(B.name==="Z"||B.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(ce).dot(this.eye))>.99&&(B.scale.set(1e-10,1e-10,1e-10),B.visible=!1),B.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(ce).dot(this.eye))<.2&&(B.scale.set(1e-10,1e-10,1e-10),B.visible=!1),B.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(ce).dot(this.eye))<.2&&(B.scale.set(1e-10,1e-10,1e-10),B.visible=!1),B.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(ce).dot(this.eye))<.2&&(B.scale.set(1e-10,1e-10,1e-10),B.visible=!1),B.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(ce).dot(this.eye)<0?B.tag==="fwd"?B.visible=!1:B.scale.x*=-1:B.tag==="bwd"&&(B.visible=!1)),B.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(ce).dot(this.eye)<0?B.tag==="fwd"?B.visible=!1:B.scale.y*=-1:B.tag==="bwd"&&(B.visible=!1)),B.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(ce).dot(this.eye)<0?B.tag==="fwd"?B.visible=!1:B.scale.z*=-1:B.tag==="bwd"&&(B.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(ce),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(ce).invert()),B.name.search("E")!==-1&&B.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),B.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),B.quaternion.copy(this.tempQuaternion)),B.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),B.quaternion.copy(this.tempQuaternion)),B.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),B.quaternion.copy(this.tempQuaternion))),B.visible=B.visible&&(B.name.indexOf("X")===-1||this.showX),B.visible=B.visible&&(B.name.indexOf("Y")===-1||this.showY),B.visible=B.visible&&(B.name.indexOf("Z")===-1||this.showZ),B.visible=B.visible&&(B.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),B.material.tempOpacity=B.material.tempOpacity||B.material.opacity,B.material.tempColor=B.material.tempColor||B.material.color.clone(),B.material.color.copy(B.material.tempColor),B.material.opacity=B.material.tempOpacity,this.enabled?this.axis&&(B.name===this.axis?(B.material.opacity=1,B.material.color.lerp(new l.Color(1,1,1),.5)):this.axis.split("").some(function(F){return B.name===F})?(B.material.opacity=1,B.material.color.lerp(new l.Color(1,1,1),.5)):(B.material.opacity*=.25,B.material.color.lerp(new l.Color(1,1,1),.5))):(B.material.opacity*=.5,B.material.color.lerp(new l.Color(1,1,1),.5))}super.updateMatrixWorld()});const e=new l.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:l.DoubleSide,fog:!1,toneMapped:!1}),t=new l.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const s=e.clone();s.color.set(16711680);const i=e.clone();i.color.set(65280);const a=e.clone();a.color.set(255);const c=e.clone();c.opacity=.25;const h=c.clone();h.color.set(16776960);const d=c.clone();d.color.set(65535);const f=c.clone();f.color.set(16711935),e.clone().color.set(16776960);const p=t.clone();p.color.set(16711680);const _=t.clone();_.color.set(65280);const y=t.clone();y.color.set(255);const x=t.clone();x.color.set(65535);const m=t.clone();m.color.set(16711935);const M=t.clone();M.color.set(16776960);const v=t.clone();v.color.set(7895160);const C=M.clone();C.opacity=.25;const O=new l.CylinderGeometry(0,.05,.2,12,1,!1),S=new l.BoxGeometry(.125,.125,.125),A=new l.BufferGeometry;A.setAttribute("position",new l.Float32BufferAttribute([0,0,0,1,0,0],3));const b=(te,ce)=>{const le=new l.BufferGeometry,me=[];for(let B=0;B<=64*ce;++B)me.push(0,Math.cos(B/32*Math.PI)*te,Math.sin(B/32*Math.PI)*te);return le.setAttribute("position",new l.Float32BufferAttribute(me,3)),le},P=()=>{const te=new l.BufferGeometry;return te.setAttribute("position",new l.Float32BufferAttribute([0,0,0,1,1,1],3)),te},w={X:[[new l.Mesh(O,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new l.Mesh(O,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new l.Line(A,p)]],Y:[[new l.Mesh(O,i),[0,1,0],null,null,"fwd"],[new l.Mesh(O,i),[0,1,0],[Math.PI,0,0],null,"bwd"],[new l.Line(A,_),null,[0,0,Math.PI/2]]],Z:[[new l.Mesh(O,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new l.Mesh(O,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new l.Line(A,y),null,[0,-Math.PI/2,0]]],XYZ:[[new l.Mesh(new l.OctahedronGeometry(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new l.Mesh(new l.PlaneGeometry(.295,.295),h.clone()),[.15,.15,0]],[new l.Line(A,M),[.18,.3,0],null,[.125,1,1]],[new l.Line(A,M),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new l.Mesh(new l.PlaneGeometry(.295,.295),d.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new l.Line(A,x),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new l.Line(A,x),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new l.Mesh(new l.PlaneGeometry(.295,.295),f.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new l.Line(A,m),[.18,0,.3],null,[.125,1,1]],[new l.Line(A,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},L={X:[[new l.Mesh(new l.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new l.Mesh(new l.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new l.Mesh(new l.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new l.Mesh(new l.OctahedronGeometry(.2,0),n)]],XY:[[new l.Mesh(new l.PlaneGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new l.Mesh(new l.PlaneGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new l.Mesh(new l.PlaneGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},D={START:[[new l.Mesh(new l.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],END:[[new l.Mesh(new l.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new l.Line(P(),r),null,null,null,"helper"]],X:[[new l.Line(A,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new l.Line(A,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new l.Line(A,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V={X:[[new l.Line(b(1,.5),p)],[new l.Mesh(new l.OctahedronGeometry(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new l.Line(b(1,.5),_),null,[0,0,-Math.PI/2]],[new l.Mesh(new l.OctahedronGeometry(.04,0),i),[0,0,.99],null,[3,1,1]]],Z:[[new l.Line(b(1,.5),y),null,[0,Math.PI/2,0]],[new l.Mesh(new l.OctahedronGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new l.Line(b(1.25,1),C),null,[0,Math.PI/2,0]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),C),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),C),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),C),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new l.Mesh(new l.CylinderGeometry(.03,0,.15,4,1,!1),C),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new l.Line(b(1,1),v),null,[0,Math.PI/2,0]]]},G={AXIS:[[new l.Line(A,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Y={X:[[new l.Mesh(new l.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new l.Mesh(new l.TorusGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new l.Mesh(new l.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new l.Mesh(new l.TorusGeometry(1.25,.1,2,24),n)]],XYZE:[[new l.Mesh(new l.SphereGeometry(.7,10,8),n)]]},W={X:[[new l.Mesh(S,s),[.8,0,0],[0,0,-Math.PI/2]],[new l.Line(A,p),null,null,[.8,1,1]]],Y:[[new l.Mesh(S,i),[0,.8,0]],[new l.Line(A,_),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new l.Mesh(S,a),[0,0,.8],[Math.PI/2,0,0]],[new l.Line(A,y),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new l.Mesh(S,h),[.85,.85,0],null,[2,2,.2]],[new l.Line(A,M),[.855,.98,0],null,[.125,1,1]],[new l.Line(A,M),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new l.Mesh(S,d),[0,.85,.85],null,[.2,2,2]],[new l.Line(A,x),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new l.Line(A,x),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new l.Mesh(S,f),[.85,0,.85],null,[2,.2,2]],[new l.Line(A,m),[.855,0,.98],null,[.125,1,1]],[new l.Line(A,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new l.Mesh(new l.BoxGeometry(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new l.Mesh(new l.BoxGeometry(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new l.Mesh(new l.BoxGeometry(.125,.125,.125),c.clone()),[0,0,1.1]]]},$={X:[[new l.Mesh(new l.CylinderGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new l.Mesh(new l.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new l.Mesh(new l.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new l.Mesh(S,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new l.Mesh(S,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new l.Mesh(S,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new l.Mesh(new l.BoxGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new l.Mesh(new l.BoxGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new l.Mesh(new l.BoxGeometry(.2,.2,.2),n),[0,0,1.1]]]},q={X:[[new l.Line(A,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new l.Line(A,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new l.Line(A,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},ne=te=>{const ce=new l.Object3D;for(let le in te)for(let me=te[le].length;me--;){const B=te[le][me][0].clone(),z=te[le][me][1],F=te[le][me][2],k=te[le][me][3],R=te[le][me][4];B.name=le,B.tag=R,z&&B.position.set(z[0],z[1],z[2]),F&&B.rotation.set(F[0],F[1],F[2]),k&&B.scale.set(k[0],k[1],k[2]),B.updateMatrix();const T=B.geometry.clone();T.applyMatrix4(B.matrix),B.geometry=T,B.renderOrder=1/0,B.position.set(0,0,0),B.rotation.set(0,0,0),B.scale.set(1,1,1),ce.add(B)}return ce};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=ne(w)),this.add(this.gizmo.rotate=ne(V)),this.add(this.gizmo.scale=ne(W)),this.add(this.picker.translate=ne(L)),this.add(this.picker.rotate=ne(Y)),this.add(this.picker.scale=ne($)),this.add(this.helper.translate=ne(D)),this.add(this.helper.rotate=ne(G)),this.add(this.helper.scale=ne(q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class ul extends l.Mesh{constructor(){super(new l.PlaneGeometry(1e5,1e5,2,2),new l.MeshBasicMaterial({visible:!1,wireframe:!0,side:l.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),Q(this,"isTransformControlsPlane",!0),Q(this,"type","TransformControlsPlane"),Q(this,"unitX",new l.Vector3(1,0,0)),Q(this,"unitY",new l.Vector3(0,1,0)),Q(this,"unitZ",new l.Vector3(0,0,1)),Q(this,"tempVector",new l.Vector3),Q(this,"dirVector",new l.Vector3),Q(this,"alignVector",new l.Vector3),Q(this,"tempMatrix",new l.Matrix4),Q(this,"identityQuaternion",new l.Quaternion),Q(this,"cameraQuaternion",new l.Quaternion),Q(this,"worldPosition",new l.Vector3),Q(this,"worldQuaternion",new l.Quaternion),Q(this,"eye",new l.Vector3),Q(this,"axis",null),Q(this,"mode","translate"),Q(this,"space","world"),Q(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var hl=Object.defineProperty,fl=(o,e,t)=>e in o?hl(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Be=(o,e,t)=>(fl(o,typeof e!="symbol"?e+"":e,t),t);const Ut=new l.Euler(0,0,0,"YXZ"),Nt=new l.Vector3,dl={type:"change"},pl={type:"lock"},ml={type:"unlock"},Ps=Math.PI/2;class Ts extends l.EventDispatcher{constructor(e,t){super(),Be(this,"camera"),Be(this,"domElement"),Be(this,"isLocked"),Be(this,"minPolarAngle"),Be(this,"maxPolarAngle"),Be(this,"pointerSpeed"),Be(this,"onMouseMove",n=>{if(!this.domElement||this.isLocked===!1)return;const r=n.movementX||n.mozMovementX||n.webkitMovementX||0,s=n.movementY||n.mozMovementY||n.webkitMovementY||0;Ut.setFromQuaternion(this.camera.quaternion),Ut.y-=r*.002*this.pointerSpeed,Ut.x-=s*.002*this.pointerSpeed,Ut.x=Math.max(Ps-this.maxPolarAngle,Math.min(Ps-this.minPolarAngle,Ut.x)),this.camera.quaternion.setFromEuler(Ut),this.dispatchEvent(dl)}),Be(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(pl),this.isLocked=!0):(this.dispatchEvent(ml),this.isLocked=!1))}),Be(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),Be(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Be(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Be(this,"dispose",()=>{this.disconnect()}),Be(this,"getObject",()=>this.camera),Be(this,"direction",new l.Vector3(0,0,-1)),Be(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),Be(this,"moveForward",n=>{Nt.setFromMatrixColumn(this.camera.matrix,0),Nt.crossVectors(this.camera.up,Nt),this.camera.position.addScaledVector(Nt,n)}),Be(this,"moveRight",n=>{Nt.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Nt,n)}),Be(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),Be(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}var gl=Object.defineProperty,yl=(o,e,t)=>e in o?gl(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,fe=(o,e,t)=>(yl(o,typeof e!="symbol"?e+"":e,t),t);const Cn=new l.Ray,Is=new l.Plane,_l=Math.cos(70*(Math.PI/180)),Os=(o,e)=>(o%e+e)%e;class Ls extends l.EventDispatcher{constructor(e,t){super(),fe(this,"object"),fe(this,"domElement"),fe(this,"enabled",!0),fe(this,"target",new l.Vector3),fe(this,"minDistance",0),fe(this,"maxDistance",1/0),fe(this,"minZoom",0),fe(this,"maxZoom",1/0),fe(this,"minPolarAngle",0),fe(this,"maxPolarAngle",Math.PI),fe(this,"minAzimuthAngle",-1/0),fe(this,"maxAzimuthAngle",1/0),fe(this,"enableDamping",!1),fe(this,"dampingFactor",.05),fe(this,"enableZoom",!0),fe(this,"zoomSpeed",1),fe(this,"enableRotate",!0),fe(this,"rotateSpeed",1),fe(this,"enablePan",!0),fe(this,"panSpeed",1),fe(this,"screenSpacePanning",!0),fe(this,"keyPanSpeed",7),fe(this,"zoomToCursor",!1),fe(this,"autoRotate",!1),fe(this,"autoRotateSpeed",2),fe(this,"reverseOrbit",!1),fe(this,"reverseHorizontalOrbit",!1),fe(this,"reverseVerticalOrbit",!1),fe(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),fe(this,"mouseButtons",{LEFT:l.MOUSE.ROTATE,MIDDLE:l.MOUSE.DOLLY,RIGHT:l.MOUSE.PAN}),fe(this,"touches",{ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN}),fe(this,"target0"),fe(this,"position0"),fe(this,"zoom0"),fe(this,"_domElementKeyEvents",null),fe(this,"getPolarAngle"),fe(this,"getAzimuthalAngle"),fe(this,"setPolarAngle"),fe(this,"setAzimuthalAngle"),fe(this,"getDistance"),fe(this,"listenToKeyEvents"),fe(this,"stopListenToKeyEvents"),fe(this,"saveState"),fe(this,"reset"),fe(this,"update"),fe(this,"connect"),fe(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>d.phi,this.getAzimuthalAngle=()=>d.theta,this.setPolarAngle=K=>{let oe=Os(K,2*Math.PI),ge=d.phi;ge<0&&(ge+=2*Math.PI),oe<0&&(oe+=2*Math.PI);let Me=Math.abs(oe-ge);2*Math.PI-Me<Me&&(oe<ge?oe+=2*Math.PI:ge+=2*Math.PI),f.phi=oe-ge,n.update()},this.setAzimuthalAngle=K=>{let oe=Os(K,2*Math.PI),ge=d.theta;ge<0&&(ge+=2*Math.PI),oe<0&&(oe+=2*Math.PI);let Me=Math.abs(oe-ge);2*Math.PI-Me<Me&&(oe<ge?oe+=2*Math.PI:ge+=2*Math.PI),f.theta=oe-ge,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=K=>{K.addEventListener("keydown",Pt),this._domElementKeyEvents=K},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Pt),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),c=a.NONE},this.update=(()=>{const K=new l.Vector3,oe=new l.Vector3(0,1,0),ge=new l.Quaternion().setFromUnitVectors(e.up,oe),Me=ge.clone().invert(),ke=new l.Vector3,dt=new l.Quaternion,It=2*Math.PI;return function(){const no=n.object.position;ge.setFromUnitVectors(e.up,oe),Me.copy(ge).invert(),K.copy(no).sub(n.target),K.applyQuaternion(ge),d.setFromVector3(K),n.autoRotate&&c===a.NONE&&G(D()),n.enableDamping?(d.theta+=f.theta*n.dampingFactor,d.phi+=f.phi*n.dampingFactor):(d.theta+=f.theta,d.phi+=f.phi);let pt=n.minAzimuthAngle,mt=n.maxAzimuthAngle;isFinite(pt)&&isFinite(mt)&&(pt<-Math.PI?pt+=It:pt>Math.PI&&(pt-=It),mt<-Math.PI?mt+=It:mt>Math.PI&&(mt-=It),pt<=mt?d.theta=Math.max(pt,Math.min(mt,d.theta)):d.theta=d.theta>(pt+mt)/2?Math.max(pt,d.theta):Math.min(mt,d.theta)),d.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,d.phi)),d.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),n.zoomToCursor&&P||n.object.isOrthographicCamera?d.radius=le(d.radius):d.radius=le(d.radius*g),K.setFromSpherical(d),K.applyQuaternion(Me),no.copy(n.target).add(K),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(f.theta*=1-n.dampingFactor,f.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(f.set(0,0,0),p.set(0,0,0));let pn=!1;if(n.zoomToCursor&&P){let mn=null;if(n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera){const gn=K.length();mn=le(gn*g);const En=gn-mn;n.object.position.addScaledVector(A,En),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const gn=new l.Vector3(b.x,b.y,0);gn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/g)),n.object.updateProjectionMatrix(),pn=!0;const En=new l.Vector3(b.x,b.y,0);En.unproject(n.object),n.object.position.sub(En).add(gn),n.object.updateMatrixWorld(),mn=K.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;mn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(mn).add(n.object.position):(Cn.origin.copy(n.object.position),Cn.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Cn.direction))<_l?e.lookAt(n.target):(Is.setFromNormalAndCoplanarPoint(n.object.up,n.target),Cn.intersectPlane(Is,n.target))))}else n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera&&(pn=g!==1,pn&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/g)),n.object.updateProjectionMatrix()));return g=1,P=!1,pn||ke.distanceToSquared(n.object.position)>h||8*(1-dt.dot(n.object.quaternion))>h?(n.dispatchEvent(r),ke.copy(n.object.position),dt.copy(n.object.quaternion),pn=!1,!0):!1}})(),this.connect=K=>{n.domElement=K,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",$e),n.domElement.addEventListener("pointerdown",he),n.domElement.addEventListener("pointercancel",Ie),n.domElement.addEventListener("wheel",ft)},this.dispose=()=>{var K,oe,ge,Me,ke,dt;n.domElement&&(n.domElement.style.touchAction="auto"),(K=n.domElement)==null||K.removeEventListener("contextmenu",$e),(oe=n.domElement)==null||oe.removeEventListener("pointerdown",he),(ge=n.domElement)==null||ge.removeEventListener("pointercancel",Ie),(Me=n.domElement)==null||Me.removeEventListener("wheel",ft),(ke=n.domElement)==null||ke.ownerDocument.removeEventListener("pointermove",_e),(dt=n.domElement)==null||dt.ownerDocument.removeEventListener("pointerup",Ie),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Pt)};const n=this,r={type:"change"},s={type:"start"},i={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=a.NONE;const h=1e-6,d=new l.Spherical,f=new l.Spherical;let g=1;const p=new l.Vector3,_=new l.Vector2,y=new l.Vector2,x=new l.Vector2,m=new l.Vector2,M=new l.Vector2,v=new l.Vector2,C=new l.Vector2,O=new l.Vector2,S=new l.Vector2,A=new l.Vector3,b=new l.Vector2;let P=!1;const w=[],L={};function D(){return 2*Math.PI/60/60*n.autoRotateSpeed}function V(){return Math.pow(.95,n.zoomSpeed)}function G(K){n.reverseOrbit||n.reverseHorizontalOrbit?f.theta+=K:f.theta-=K}function Y(K){n.reverseOrbit||n.reverseVerticalOrbit?f.phi+=K:f.phi-=K}const W=(()=>{const K=new l.Vector3;return function(ge,Me){K.setFromMatrixColumn(Me,0),K.multiplyScalar(-ge),p.add(K)}})(),$=(()=>{const K=new l.Vector3;return function(ge,Me){n.screenSpacePanning===!0?K.setFromMatrixColumn(Me,1):(K.setFromMatrixColumn(Me,0),K.crossVectors(n.object.up,K)),K.multiplyScalar(ge),p.add(K)}})(),q=(()=>{const K=new l.Vector3;return function(ge,Me){const ke=n.domElement;if(ke&&n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera){const dt=n.object.position;K.copy(dt).sub(n.target);let It=K.length();It*=Math.tan(n.object.fov/2*Math.PI/180),W(2*ge*It/ke.clientHeight,n.object.matrix),$(2*Me*It/ke.clientHeight,n.object.matrix)}else ke&&n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera?(W(ge*(n.object.right-n.object.left)/n.object.zoom/ke.clientWidth,n.object.matrix),$(Me*(n.object.top-n.object.bottom)/n.object.zoom/ke.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function ne(K){n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera?g/=K:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function te(K){n.object instanceof l.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof l.OrthographicCamera&&n.object.isOrthographicCamera?g*=K:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ce(K){if(!n.zoomToCursor||!n.domElement)return;P=!0;const oe=n.domElement.getBoundingClientRect(),ge=K.clientX-oe.left,Me=K.clientY-oe.top,ke=oe.width,dt=oe.height;b.x=ge/ke*2-1,b.y=-(Me/dt)*2+1,A.set(b.x,b.y,1).unproject(n.object).sub(n.object.position).normalize()}function le(K){return Math.max(n.minDistance,Math.min(n.maxDistance,K))}function me(K){_.set(K.clientX,K.clientY)}function B(K){ce(K),C.set(K.clientX,K.clientY)}function z(K){m.set(K.clientX,K.clientY)}function F(K){y.set(K.clientX,K.clientY),x.subVectors(y,_).multiplyScalar(n.rotateSpeed);const oe=n.domElement;oe&&(G(2*Math.PI*x.x/oe.clientHeight),Y(2*Math.PI*x.y/oe.clientHeight)),_.copy(y),n.update()}function k(K){O.set(K.clientX,K.clientY),S.subVectors(O,C),S.y>0?ne(V()):S.y<0&&te(V()),C.copy(O),n.update()}function R(K){M.set(K.clientX,K.clientY),v.subVectors(M,m).multiplyScalar(n.panSpeed),q(v.x,v.y),m.copy(M),n.update()}function T(K){ce(K),K.deltaY<0?te(V()):K.deltaY>0&&ne(V()),n.update()}function I(K){let oe=!1;switch(K.code){case n.keys.UP:q(0,n.keyPanSpeed),oe=!0;break;case n.keys.BOTTOM:q(0,-n.keyPanSpeed),oe=!0;break;case n.keys.LEFT:q(n.keyPanSpeed,0),oe=!0;break;case n.keys.RIGHT:q(-n.keyPanSpeed,0),oe=!0;break}oe&&(K.preventDefault(),n.update())}function U(){if(w.length==1)_.set(w[0].pageX,w[0].pageY);else{const K=.5*(w[0].pageX+w[1].pageX),oe=.5*(w[0].pageY+w[1].pageY);_.set(K,oe)}}function Z(){if(w.length==1)m.set(w[0].pageX,w[0].pageY);else{const K=.5*(w[0].pageX+w[1].pageX),oe=.5*(w[0].pageY+w[1].pageY);m.set(K,oe)}}function j(){const K=w[0].pageX-w[1].pageX,oe=w[0].pageY-w[1].pageY,ge=Math.sqrt(K*K+oe*oe);C.set(0,ge)}function E(){n.enableZoom&&j(),n.enablePan&&Z()}function J(){n.enableZoom&&j(),n.enableRotate&&U()}function re(K){if(w.length==1)y.set(K.pageX,K.pageY);else{const ge=dn(K),Me=.5*(K.pageX+ge.x),ke=.5*(K.pageY+ge.y);y.set(Me,ke)}x.subVectors(y,_).multiplyScalar(n.rotateSpeed);const oe=n.domElement;oe&&(G(2*Math.PI*x.x/oe.clientHeight),Y(2*Math.PI*x.y/oe.clientHeight)),_.copy(y)}function ie(K){if(w.length==1)M.set(K.pageX,K.pageY);else{const oe=dn(K),ge=.5*(K.pageX+oe.x),Me=.5*(K.pageY+oe.y);M.set(ge,Me)}v.subVectors(M,m).multiplyScalar(n.panSpeed),q(v.x,v.y),m.copy(M)}function X(K){const oe=dn(K),ge=K.pageX-oe.x,Me=K.pageY-oe.y,ke=Math.sqrt(ge*ge+Me*Me);O.set(0,ke),S.set(0,Math.pow(O.y/C.y,n.zoomSpeed)),ne(S.y),C.copy(O)}function N(K){n.enableZoom&&X(K),n.enablePan&&ie(K)}function ae(K){n.enableZoom&&X(K),n.enableRotate&&re(K)}function he(K){var oe,ge;n.enabled!==!1&&(w.length===0&&((oe=n.domElement)==null||oe.ownerDocument.addEventListener("pointermove",_e),(ge=n.domElement)==null||ge.ownerDocument.addEventListener("pointerup",Ie)),Gn(K),K.pointerType==="touch"?Tt(K):Oe(K))}function _e(K){n.enabled!==!1&&(K.pointerType==="touch"?Ze(K):He(K))}function Ie(K){var oe,ge,Me;Rn(K),w.length===0&&((oe=n.domElement)==null||oe.releasePointerCapture(K.pointerId),(ge=n.domElement)==null||ge.ownerDocument.removeEventListener("pointermove",_e),(Me=n.domElement)==null||Me.ownerDocument.removeEventListener("pointerup",Ie)),n.dispatchEvent(i),c=a.NONE}function Oe(K){let oe;switch(K.button){case 0:oe=n.mouseButtons.LEFT;break;case 1:oe=n.mouseButtons.MIDDLE;break;case 2:oe=n.mouseButtons.RIGHT;break;default:oe=-1}switch(oe){case l.MOUSE.DOLLY:if(n.enableZoom===!1)return;B(K),c=a.DOLLY;break;case l.MOUSE.ROTATE:if(K.ctrlKey||K.metaKey||K.shiftKey){if(n.enablePan===!1)return;z(K),c=a.PAN}else{if(n.enableRotate===!1)return;me(K),c=a.ROTATE}break;case l.MOUSE.PAN:if(K.ctrlKey||K.metaKey||K.shiftKey){if(n.enableRotate===!1)return;me(K),c=a.ROTATE}else{if(n.enablePan===!1)return;z(K),c=a.PAN}break;default:c=a.NONE}c!==a.NONE&&n.dispatchEvent(s)}function He(K){if(n.enabled!==!1)switch(c){case a.ROTATE:if(n.enableRotate===!1)return;F(K);break;case a.DOLLY:if(n.enableZoom===!1)return;k(K);break;case a.PAN:if(n.enablePan===!1)return;R(K);break}}function ft(K){n.enabled===!1||n.enableZoom===!1||c!==a.NONE&&c!==a.ROTATE||(K.preventDefault(),n.dispatchEvent(s),T(K),n.dispatchEvent(i))}function Pt(K){n.enabled===!1||n.enablePan===!1||I(K)}function Tt(K){switch(jn(K),w.length){case 1:switch(n.touches.ONE){case l.TOUCH.ROTATE:if(n.enableRotate===!1)return;U(),c=a.TOUCH_ROTATE;break;case l.TOUCH.PAN:if(n.enablePan===!1)return;Z(),c=a.TOUCH_PAN;break;default:c=a.NONE}break;case 2:switch(n.touches.TWO){case l.TOUCH.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;E(),c=a.TOUCH_DOLLY_PAN;break;case l.TOUCH.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;J(),c=a.TOUCH_DOLLY_ROTATE;break;default:c=a.NONE}break;default:c=a.NONE}c!==a.NONE&&n.dispatchEvent(s)}function Ze(K){switch(jn(K),c){case a.TOUCH_ROTATE:if(n.enableRotate===!1)return;re(K),n.update();break;case a.TOUCH_PAN:if(n.enablePan===!1)return;ie(K),n.update();break;case a.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;N(K),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;ae(K),n.update();break;default:c=a.NONE}}function $e(K){n.enabled!==!1&&K.preventDefault()}function Gn(K){w.push(K)}function Rn(K){delete L[K.pointerId];for(let oe=0;oe<w.length;oe++)if(w[oe].pointerId==K.pointerId){w.splice(oe,1);return}}function jn(K){let oe=L[K.pointerId];oe===void 0&&(oe=new l.Vector2,L[K.pointerId]=oe),oe.set(K.pageX,K.pageY)}function dn(K){const oe=K.pointerId===w[0].pointerId?w[1]:w[0];return L[oe.pointerId]}t!==void 0&&this.connect(t),this.update()}}class xl extends Ls{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=l.MOUSE.PAN,this.mouseButtons.RIGHT=l.MOUSE.ROTATE,this.touches.ONE=l.TOUCH.PAN,this.touches.TWO=l.TOUCH.DOLLY_ROTATE}}function Ds(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let e="";for(let t=0,n=o.length;t<n;t++)e+=String.fromCharCode(o[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Ht=new l.Vector3;function qe(o,e,t,n,r,s){const i=2*Math.PI*r/4,a=Math.max(s-2*r,0),c=Math.PI/4;Ht.copy(e),Ht[n]=0,Ht.normalize();const h=.5*i/(i+a),d=1-Ht.angleTo(o)/c;return Math.sign(Ht[t])===1?d*h:a/(i+a)+h+h*(1-d)}class vl extends l.BoxGeometry{constructor(e=1,t=1,n=1,r=2,s=.1){if(r=r*2+1,s=Math.min(e/2,t/2,n/2,s),super(1,1,1,r,r,r),r===1)return;const i=this.toNonIndexed();this.index=null,this.attributes.position=i.attributes.position,this.attributes.normal=i.attributes.normal,this.attributes.uv=i.attributes.uv;const a=new l.Vector3,c=new l.Vector3,h=new l.Vector3(e,t,n).divideScalar(2).subScalar(s),d=this.attributes.position.array,f=this.attributes.normal.array,g=this.attributes.uv.array,p=d.length/6,_=new l.Vector3,y=.5/r;for(let x=0,m=0;x<d.length;x+=3,m+=2)switch(a.fromArray(d,x),c.copy(a),c.x-=Math.sign(c.x)*y,c.y-=Math.sign(c.y)*y,c.z-=Math.sign(c.z)*y,c.normalize(),d[x+0]=h.x*Math.sign(a.x)+c.x*s,d[x+1]=h.y*Math.sign(a.y)+c.y*s,d[x+2]=h.z*Math.sign(a.z)+c.z*s,f[x+0]=c.x,f[x+1]=c.y,f[x+2]=c.z,Math.floor(x/p)){case 0:_.set(1,0,0),g[m+0]=qe(_,c,"z","y",s,n),g[m+1]=1-qe(_,c,"y","z",s,t);break;case 1:_.set(-1,0,0),g[m+0]=1-qe(_,c,"z","y",s,n),g[m+1]=1-qe(_,c,"y","z",s,t);break;case 2:_.set(0,1,0),g[m+0]=1-qe(_,c,"x","z",s,e),g[m+1]=qe(_,c,"z","x",s,n);break;case 3:_.set(0,-1,0),g[m+0]=1-qe(_,c,"x","z",s,e),g[m+1]=1-qe(_,c,"z","x",s,n);break;case 4:_.set(0,0,1),g[m+0]=1-qe(_,c,"x","y",s,e),g[m+1]=1-qe(_,c,"y","x",s,t);break;case 5:_.set(0,0,-1),g[m+0]=qe(_,c,"x","y",s,e),g[m+1]=1-qe(_,c,"y","x",s,t);break}}}class Bs extends l.ExtrudeGeometry{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:r=8,bevelThickness:s=10,font:i,height:a=50,size:c=100,lineHeight:h=1,letterSpacing:d=0,...f}=t;if(i===void 0)super();else{const g=i.generateShapes(e,c,{lineHeight:h,letterSpacing:d});super(g,{...f,bevelEnabled:n,bevelSize:r,bevelThickness:s,depth:a})}this.type="TextGeometry"}}const wl={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},bl={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};function ks(o,e,t){const n=t.length-o-1;if(e>=t[n])return n-1;if(e<=t[o])return o;let r=o,s=n,i=Math.floor((r+s)/2);for(;e<t[i]||e>=t[i+1];)e<t[i]?s=i:r=i,i=Math.floor((r+s)/2);return i}function Ml(o,e,t,n){const r=[],s=[],i=[];r[0]=1;for(let a=1;a<=t;++a){s[a]=e-n[o+1-a],i[a]=n[o+a]-e;let c=0;for(let h=0;h<a;++h){const d=i[h+1],f=s[a-h],g=r[h]/(d+f);r[h]=c+d*g,c=f*g}r[a]=c}return r}function Sl(o,e,t,n){const r=ks(o,n,e),s=Ml(r,n,o,e),i=new l.Vector4(0,0,0,0);for(let a=0;a<=o;++a){const c=t[r-o+a],h=s[a],d=c.w*h;i.x+=c.x*d,i.y+=c.y*d,i.z+=c.z*d,i.w+=c.w*h}return i}function Al(o,e,t,n,r){const s=[];for(let f=0;f<=t;++f)s[f]=0;const i=[];for(let f=0;f<=n;++f)i[f]=s.slice(0);const a=[];for(let f=0;f<=t;++f)a[f]=s.slice(0);a[0][0]=1;const c=s.slice(0),h=s.slice(0);for(let f=1;f<=t;++f){c[f]=e-r[o+1-f],h[f]=r[o+f]-e;let g=0;for(let p=0;p<f;++p){const _=h[p+1],y=c[f-p];a[f][p]=_+y;const x=a[p][f-1]/a[f][p];a[p][f]=g+_*x,g=y*x}a[f][f]=g}for(let f=0;f<=t;++f)i[0][f]=a[f][t];for(let f=0;f<=t;++f){let g=0,p=1;const _=[];for(let y=0;y<=t;++y)_[y]=s.slice(0);_[0][0]=1;for(let y=1;y<=n;++y){let x=0;const m=f-y,M=t-y;f>=y&&(_[p][0]=_[g][0]/a[M+1][m],x=_[p][0]*a[m][M]);const v=m>=-1?1:-m,C=f-1<=M?y-1:t-f;for(let S=v;S<=C;++S)_[p][S]=(_[g][S]-_[g][S-1])/a[M+1][m+S],x+=_[p][S]*a[m+S][M];f<=M&&(_[p][y]=-_[g][y-1]/a[M+1][f],x+=_[p][y]*a[f][M]),i[y][f]=x;const O=g;g=p,p=O}}let d=t;for(let f=1;f<=n;++f){for(let g=0;g<=t;++g)i[f][g]*=d;d*=t-f}return i}function Cl(o,e,t,n,r){const s=r<o?r:o,i=[],a=ks(o,n,e),c=Al(a,n,o,s,e),h=[];for(let d=0;d<t.length;++d){const f=t[d].clone(),g=f.w;f.x*=g,f.y*=g,f.z*=g,h[d]=f}for(let d=0;d<=s;++d){const f=h[a-o].clone().multiplyScalar(c[d][0]);for(let g=1;g<=o;++g)f.add(h[a-o+g].clone().multiplyScalar(c[d][g]));i[d]=f}for(let d=s+1;d<=r+1;++d)i[d]=new l.Vector4(0,0,0);return i}function Pl(o,e){let t=1;for(let r=2;r<=o;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=o-e;++r)n*=r;return t/n}function Tl(o){const e=o.length,t=[],n=[];for(let s=0;s<e;++s){const i=o[s];t[s]=new l.Vector3(i.x,i.y,i.z),n[s]=i.w}const r=[];for(let s=0;s<e;++s){const i=t[s].clone();for(let a=1;a<=s;++a)i.sub(r[s-a].clone().multiplyScalar(Pl(s,a)*n[a]));r[s]=i.divideScalar(n[0])}return r}function Il(o,e,t,n,r){const s=Cl(o,e,t,n,r);return Tl(s)}class Fs extends l.Curve{constructor(e,t,n,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let i=0;i<n.length;++i){const a=n[i];this.controlPoints[i]=new l.Vector4(a.x,a.y,a.z,a.w)}}getPoint(e,t){const n=t||new l.Vector3,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Sl(this.degree,this.knots,this.controlPoints,r);return s.w!=1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t){const n=t||new l.Vector3,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=Il(this.degree,this.knots,this.controlPoints,r,1);return n.copy(s[1]).normalize(),n}}let xe,De,je;class Ol extends l.Loader{constructor(e){super(e)}load(e,t,n,r){const s=this,i=s.path===""?l.LoaderUtils.extractUrlBase(e):s.path,a=new l.FileLoader(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{t(s.parse(c,i))}catch(h){r?r(h):console.error(h),s.manager.itemError(e)}},n,r)}parse(e,t){if(Ul(e))xe=new Fl().parse(e);else{const r=Rs(e);if(!Nl(r))throw new Error("THREE.FBXLoader: Unknown format.");if(zs(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+zs(r));xe=new kl().parse(r)}const n=new l.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Ll(n,this.manager).parse(xe)}}class Ll{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){De=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),s=new Dl().parse(r);return this.parseScene(r,s,n),je}parseConnections(){const e=new Map;return"Connections"in xe&&xe.Connections.connections.forEach(function(n){const r=n[0],s=n[1],i=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:i};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:r,relationship:i};e.get(s).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in xe.Objects){const n=xe.Objects.Video;for(const r in n){const s=n[r],i=parseInt(r);if(e[i]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const h=this.parseImage(n[r]);t[s.RelativeFilename||s.Filename]=h}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const i=new Uint8Array(t);return window.URL.createObjectURL(new Blob([i],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in xe.Objects){const n=xe.Objects.Texture;for(const r in n){const s=this.parseTexture(n[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,i=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(n.wrapS=i===0?l.RepeatWrapping:l.ClampToEdgeWrapping,n.wrapT=a===0?l.RepeatWrapping:l.ClampToEdgeWrapping,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,s=De.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let i;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new l.Texture):(c.setPath(this.textureLoader.path),i=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new l.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(r),i}parseMaterials(e){const t=new Map;if("Material"in xe.Objects){const n=xe.Objects.Material;for(const r in n){const s=this.parseMaterial(n[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!De.has(n))return null;const i=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new l.MeshPhongMaterial;break;case"lambert":a=new l.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new l.MeshPhongMaterial;break}return a.setValues(i),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new l.Color().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new l.Color().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new l.Color().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new l.Color().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new l.Color().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new l.Color().fromArray(e.SpecularColor.value));const s=this;return De.get(n).children.forEach(function(i){const a=i.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(t,i.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,i.ID),r.map!==void 0&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,i.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,i.ID),r.emissiveMap!==void 0&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,i.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,i.ID),r.envMap!==void 0&&(r.envMap.mapping=l.EquirectangularReflectionMapping,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=s.getTexture(t,i.ID),r.specularMap!==void 0&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,i.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in xe.Objects&&t in xe.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=De.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in xe.Objects){const n=xe.Objects.Deformer;for(const r in n){const s=n[r],i=De.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(i,n);a.ID=r,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=i.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(i,n),a.id=r,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const i={ID:r.ID,indices:[],weights:[],transformLink:new l.Matrix4().fromArray(s.TransformLink.a)};"Indexes"in s&&(i.indices=s.Indexes.a,i.weights=s.Weights.a),n.push(i)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],i=t[s.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;a.geoID=De.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){je=new l.Group;const r=this.parseModels(e.skeletons,t,n),s=xe.Objects.Model,i=this;r.forEach(function(c){const h=s[c.ID];i.setLookAtProperties(c,h),De.get(c.ID).parents.forEach(function(f){const g=r.get(f.ID);g!==void 0&&g.add(c)}),c.parent===null&&je.add(c)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),je.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=Vs(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const a=new Bl().parse();je.children.length===1&&je.children[0].isGroup&&(je.children[0].animations=a,je=je.children[0]),je.animations=a}parseModels(e,t,n){const r=new Map,s=xe.Objects.Model;for(const i in s){const a=parseInt(i),c=s[i],h=De.get(a);let d=this.buildSkeleton(h,e,a,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(h);break;case"Light":d=this.createLight(h);break;case"Mesh":d=this.createMesh(h,t,n);break;case"NurbsCurve":d=this.createCurve(h,t);break;case"LimbNode":case"Root":d=new l.Bone;break;case"Null":default:d=new l.Group;break}d.name=c.attrName?l.PropertyBinding.sanitizeNodeName(c.attrName):"",d.ID=a}this.getTransformData(d,c),r.set(a,d)}return r}buildSkeleton(e,t,n,r){let s=null;return e.parents.forEach(function(i){for(const a in t){const c=t[a];c.rawBones.forEach(function(h,d){if(h.ID===i.ID){const f=s;s=new l.Bone,s.matrixWorld.copy(h.transformLink),s.name=r?l.PropertyBinding.sanitizeNodeName(r):"",s.ID=n,c.bones[d]=s,f!==null&&s.add(f)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(r){const s=xe.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new l.Object3D;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let i=1e3;n.FarPlane!==void 0&&(i=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const h=a/c;let d=45;n.FieldOfView!==void 0&&(d=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new l.PerspectiveCamera(d,h,s,i),f!==null&&t.setFocalLength(f);break;case 1:t=new l.OrthographicCamera(-a/2,a/2,c/2,-c/2,s,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new l.Object3D;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const s=xe.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new l.Object3D;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new l.Color().fromArray(n.Color.value));let i=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(i=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new l.PointLight(s,i,a,c);break;case 1:t=new l.DirectionalLight(s,i);break;case 2:let h=Math.PI/3;n.InnerAngle!==void 0&&(h=l.MathUtils.degToRad(n.InnerAngle.value));let d=0;n.OuterAngle!==void 0&&(d=l.MathUtils.degToRad(n.OuterAngle.value),d=Math.max(d,1)),t=new l.SpotLight(s,i,a,h,d,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new l.PointLight(s,i);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,s=null,i=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(s=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?i=a:a.length>0?i=a[0]:(i=new l.MeshPhongMaterial({color:13421772}),a.push(i)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(r=new l.SkinnedMesh(s,i),r.normalizeSkinWeights()):r=new l.Mesh(s,i),r}createCurve(e,t){const n=e.children.reduce(function(s,i){return t.has(i.ID)&&(s=t.get(i.ID)),s},null),r=new l.LineBasicMaterial({color:3342591,linewidth:1});return new l.Line(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Gs(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&De.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=xe.Objects.Model[r.ID];if("Lcl_Translation"in s){const i=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),je.add(e.target)):e.lookAt(new l.Vector3().fromArray(i))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const s in e){const i=e[s];De.get(parseInt(i.ID)).parents.forEach(function(c){if(t.has(c.ID)){const h=c.ID;De.get(h).parents.forEach(function(f){n.has(f.ID)&&n.get(f.ID).bind(new l.Skeleton(i.bones),r[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in xe.Objects){const t=xe.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new l.Matrix4().fromArray(s.Matrix.a)}):e[r.Node]=new l.Matrix4().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in xe&&"AmbientColor"in xe.GlobalSettings){const e=xe.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const s=new l.Color(t,n,r);je.add(new l.AmbientLight(s,1))}}}}class Dl{parse(e){const t=new Map;if("Geometry"in xe.Objects){const n=xe.Objects.Geometry;for(const r in n){const s=De.get(parseInt(r)),i=this.parseGeometry(s,n[r],e);t.set(parseInt(r),i)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,s=[],i=e.parents.map(function(f){return xe.Objects.Model[f.ID]});if(i.length===0)return;const a=e.children.reduce(function(f,g){return r[g.ID]!==void 0&&(f=r[g.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&s.push(n.morphTargets[f.ID])});const c=i[0],h={};"RotationOrder"in c&&(h.eulerOrder=Gs(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const d=Vs(h);return this.genGeometry(t,a,s,d)}genGeometry(e,t,n,r){const s=new l.BufferGeometry;e.attrName&&(s.name=e.attrName);const i=this.parseGeoNode(e,t),a=this.genBuffers(i),c=new l.Float32BufferAttribute(a.vertex,3);if(c.applyMatrix4(r),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new l.Float32BufferAttribute(a.colors,3)),t&&(s.setAttribute("skinIndex",new l.Uint16BufferAttribute(a.weightsIndices,4)),s.setAttribute("skinWeight",new l.Float32BufferAttribute(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const h=new l.Matrix3().getNormalMatrix(r),d=new l.Float32BufferAttribute(a.normal,3);d.applyNormalMatrix(h),s.setAttribute("normal",d)}if(a.uvs.forEach(function(h,d){ma==="uv2"&&d++;const f=d===0?"uv":`uv${d}`;s.setAttribute(f,new l.Float32BufferAttribute(a.uvs[d],2))}),i.material&&i.material.mappingType!=="AllSame"){let h=a.materialIndex[0],d=0;if(a.materialIndex.forEach(function(f,g){f!==h&&(s.addGroup(d,g-d,h),h=f,d=g)}),s.groups.length>0){const f=s.groups[s.groups.length-1],g=f.start+f.count;g!==a.materialIndex.length&&s.addGroup(g,a.materialIndex.length-g,h)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,r),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(i,a){n.weightTable[i]===void 0&&(n.weightTable[i]=[]),n.weightTable[i].push({id:s,weight:r.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,s=!1,i=[],a=[],c=[],h=[],d=[],f=[];const g=this;return e.vertexIndices.forEach(function(p,_){let y,x=!1;p<0&&(p=p^-1,x=!0);let m=[],M=[];if(i.push(p*3,p*3+1,p*3+2),e.color){const v=Pn(_,n,p,e.color);c.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(v){M.push(v.weight),m.push(v.id)}),M.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const v=[0,0,0,0],C=[0,0,0,0];M.forEach(function(O,S){let A=O,b=m[S];C.forEach(function(P,w,L){if(A>P){L[w]=A,A=P;const D=v[w];v[w]=b,b=D}})}),m=v,M=C}for(;M.length<4;)M.push(0),m.push(0);for(let v=0;v<4;++v)d.push(M[v]),f.push(m[v])}if(e.normal){const v=Pn(_,n,p,e.normal);a.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(y=Pn(_,n,p,e.material)[0]),e.uv&&e.uv.forEach(function(v,C){const O=Pn(_,n,p,v);h[C]===void 0&&(h[C]=[]),h[C].push(O[0]),h[C].push(O[1])}),r++,x&&(g.genFace(t,e,i,y,a,c,h,d,f,r),n++,r=0,i=[],a=[],c=[],h=[],d=[],f=[])}),t}genFace(e,t,n,r,s,i,a,c,h,d){for(let f=2;f<d;f++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(f-1)*3]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+2]]),e.vertex.push(t.vertexPositions[n[f*3]]),e.vertex.push(t.vertexPositions[n[f*3+1]]),e.vertex.push(t.vertexPositions[n[f*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(f-1)*4]),e.vertexWeights.push(c[(f-1)*4+1]),e.vertexWeights.push(c[(f-1)*4+2]),e.vertexWeights.push(c[(f-1)*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.weightsIndices.push(h[0]),e.weightsIndices.push(h[1]),e.weightsIndices.push(h[2]),e.weightsIndices.push(h[3]),e.weightsIndices.push(h[(f-1)*4]),e.weightsIndices.push(h[(f-1)*4+1]),e.weightsIndices.push(h[(f-1)*4+2]),e.weightsIndices.push(h[(f-1)*4+3]),e.weightsIndices.push(h[f*4]),e.weightsIndices.push(h[f*4+1]),e.weightsIndices.push(h[f*4+2]),e.weightsIndices.push(h[f*4+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(f-1)*3]),e.colors.push(i[(f-1)*3+1]),e.colors.push(i[(f-1)*3+2]),e.colors.push(i[f*3]),e.colors.push(i[f*3+1]),e.colors.push(i[f*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(f-1)*3]),e.normal.push(s[(f-1)*3+1]),e.normal.push(s[(f-1)*3+2]),e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2])),t.uv&&t.uv.forEach(function(g,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(f-1)*2]),e.uvs[p].push(a[p][(f-1)*2+1]),e.uvs[p].push(a[p][f*2]),e.uvs[p].push(a[p][f*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(i){i.rawTargets.forEach(function(a){const c=xe.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(e,t,c,r,a.name)})})}genMorphGeometry(e,t,n,r,s){const i=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],h=e.attributes.position.count*3,d=new Float32Array(h);for(let _=0;_<c.length;_++){const y=c[_]*3;d[y]=a[_*3],d[y+1]=a[_*3+1],d[y+2]=a[_*3+2]}const f={vertexIndices:i,vertexPositions:d},g=this.genBuffers(f),p=new l.Float32BufferAttribute(g.vertex,3);p.name=s||n.attrName,p.applyMatrix4(r),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let s=[];return n==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,s=[];for(let i=0;i<r.length;++i)s.push(i);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Fs===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new l.BufferGeometry;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new l.BufferGeometry;const n=t-1,r=e.KnotVector.a,s=[],i=e.Points.a;for(let f=0,g=i.length;f<g;f+=4)s.push(new l.Vector4().fromArray(i,f));let a,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=n,c=r.length-1-a;for(let f=0;f<n;++f)s.push(s[f])}const d=new Fs(n,r,s,a,c).getPoints(s.length*12);return new l.BufferGeometry().setFromPoints(d)}}class Bl{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],s=this.addClip(r);e.push(s)}return e}parseClips(){if(xe.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=xe.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=xe.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(zl),values:t[n].KeyValueFloat.a},s=De.get(r.id);if(s!==void 0){const i=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(i).curves.x=r:a.match(/Y/)?e.get(i).curves.y=r:a.match(/Z/)?e.get(i).curves.z=r:a.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=r)}}}parseAnimationLayers(e){const t=xe.Objects.AnimationLayer,n=new Map;for(const r in t){const s=[],i=De.get(parseInt(r));i!==void 0&&(i.children.forEach(function(c,h){if(e.has(c.ID)){const d=e.get(c.ID);if(d.curves.x!==void 0||d.curves.y!==void 0||d.curves.z!==void 0){if(s[h]===void 0){const f=De.get(c.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID;if(f!==void 0){const g=xe.Objects.Model[f.toString()];if(g===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const p={modelName:g.attrName?l.PropertyBinding.sanitizeNodeName(g.attrName):"",ID:g.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};je.traverse(function(_){_.ID===g.id&&(p.transform=_.matrix,_.userData.transformData&&(p.eulerOrder=_.userData.transformData.eulerOrder))}),p.transform||(p.transform=new l.Matrix4),"PreRotation"in g&&(p.preRotation=g.PreRotation.value),"PostRotation"in g&&(p.postRotation=g.PostRotation.value),s[h]=p}}s[h]&&(s[h][d.attr]=d)}else if(d.curves.morph!==void 0){if(s[h]===void 0){const f=De.get(c.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,g=De.get(f).parents[0].ID,p=De.get(g).parents[0].ID,_=De.get(p).parents[0].ID,y=xe.Objects.Model[_],x={modelName:y.attrName?l.PropertyBinding.sanitizeNodeName(y.attrName):"",morphName:xe.Objects.Deformer[f].attrName};s[h]=x}s[h][d.attr]=d}}}),n.set(parseInt(r),s))}return n}parseAnimStacks(e){const t=xe.Objects.AnimationStack,n={};for(const r in t){const s=De.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(s[0].ID);n[r]={name:t[r].attrName,layer:i}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new l.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new l.Vector3,r=new l.Quaternion,s=new l.Vector3;if(e.transform&&e.transform.decompose(n,r,s),n=n.toArray(),r=new l.Euler().setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,n,r){const s=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(s,t,n);return new l.VectorKeyframeTrack(e+"."+r,s,i)}generateRotationTrack(e,t,n,r,s,i){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(l.MathUtils.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(l.MathUtils.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(l.MathUtils.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);r!==void 0&&(r=r.map(l.MathUtils.degToRad),r.push(i),r=new l.Euler().fromArray(r),r=new l.Quaternion().setFromEuler(r)),s!==void 0&&(s=s.map(l.MathUtils.degToRad),s.push(i),s=new l.Euler().fromArray(s),s=new l.Quaternion().setFromEuler(s).invert());const h=new l.Quaternion,d=new l.Euler,f=[];for(let g=0;g<c.length;g+=3)d.set(c[g],c[g+1],c[g+2],i),h.setFromEuler(d),r!==void 0&&h.premultiply(r),s!==void 0&&h.multiply(s),h.toArray(f,g/3*4);return new l.QuaternionKeyframeTrack(e+".quaternion",a,f)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),r=je.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new l.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let s=1;s<t.length;s++){const i=t[s];i!==r&&(t[n]=i,r=i,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,s=[];let i=-1,a=-1,c=-1;return e.forEach(function(h){if(t.x&&(i=t.x.times.indexOf(h)),t.y&&(a=t.y.times.indexOf(h)),t.z&&(c=t.z.times.indexOf(h)),i!==-1){const d=t.x.values[i];s.push(d),r[0]=d}else s.push(r[0]);if(a!==-1){const d=t.y.values[a];s.push(d),r[1]=d}else s.push(r[1]);if(c!==-1){const d=t.z.values[c];s.push(d),r[2]=d}else s.push(r[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,s=Math.abs(r);if(s>=180){const i=s/180,a=r/i;let c=n+a;const h=e.times[t-1],f=(e.times[t]-h)/i;let g=h+f;const p=[],_=[];for(;g<e.times[t];)p.push(g),g+=f,_.push(c),c+=a;e.times=js(e.times,t,p),e.values=js(e.values,t,_)}}}}class kl{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Ns,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,s){const i=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(i||a)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),d=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):h?t.parseNodeProperty(r,h,n[++s]):d?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},i=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),i.id!==""&&(a[n][i.id]=s)):typeof i.id=="number"?(a[n]={},a[n][i.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof i.id=="number"&&(s.id=i.id),i.name!==""&&(s.attrName=i.name),i.type!==""&&(s.attrType=i.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const c=s.split(",").slice(1),h=parseInt(c[0]),d=parseInt(c[1]);let f=s.split(",").slice(3);f=f.map(function(g){return g.trim().replace(/^"/,"")}),r="connections",s=[h,d],Gl(s,f),i[r]===void 0&&(i[r]=[])}r==="Node"&&(i.id=s),r in i&&Array.isArray(i[r])?i[r].push(s):r!=="a"?i[r]=s:i.a=s,this.setCurrentProp(i,r),r==="a"&&s.slice(-1)!==","&&(i.a=lr(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=lr(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(d){return d.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],i=r[1],a=r[2],c=r[3];let h=r[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=lr(h);break}this.getPrevNode()[s]={type:i,type2:a,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),s)}}class Fl{parse(e){const t=new Us(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new Ns;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(r===0)return null;const c=[];for(let g=0;g<s;g++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",d=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(n.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const g=this.parseNode(e,t);g!==null&&this.parseSubNode(a,n,g)}return n.propertyList=c,typeof h=="number"&&(n.id=h),d!==""&&(n.attrName=d),f!==""&&(n.attrType=f),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(s,i){i!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],s=n.propertyList[1];const i=n.propertyList[2],a=n.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[r]={type:s,type2:i,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),i=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=Qa(new Uint8Array(e.getArrayBuffer(i))),c=new Us(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Us{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Ds(new Uint8Array(t))}}class Ns{add(e,t){this[e]=t}}function Ul(o){const e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===Rs(o,0,e.length)}function Nl(o){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const s=o[r-1];return o=o.slice(t+r),t++,s}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function zs(o){const e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function zl(o){return o/46186158e3}const Vl=[];function Pn(o,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=o;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const s=r*n.dataSize,i=s+n.dataSize;return Rl(Vl,n.buffer,s,i)}const ar=new l.Euler,zt=new l.Vector3;function Vs(o){const e=new l.Matrix4,t=new l.Matrix4,n=new l.Matrix4,r=new l.Matrix4,s=new l.Matrix4,i=new l.Matrix4,a=new l.Matrix4,c=new l.Matrix4,h=new l.Matrix4,d=new l.Matrix4,f=new l.Matrix4,g=new l.Matrix4,p=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(zt.fromArray(o.translation)),o.preRotation){const w=o.preRotation.map(l.MathUtils.degToRad);w.push(o.eulerOrder),t.makeRotationFromEuler(ar.fromArray(w))}if(o.rotation){const w=o.rotation.map(l.MathUtils.degToRad);w.push(o.eulerOrder),n.makeRotationFromEuler(ar.fromArray(w))}if(o.postRotation){const w=o.postRotation.map(l.MathUtils.degToRad);w.push(o.eulerOrder),r.makeRotationFromEuler(ar.fromArray(w)),r.invert()}o.scale&&s.scale(zt.fromArray(o.scale)),o.scalingOffset&&a.setPosition(zt.fromArray(o.scalingOffset)),o.scalingPivot&&i.setPosition(zt.fromArray(o.scalingPivot)),o.rotationOffset&&c.setPosition(zt.fromArray(o.rotationOffset)),o.rotationPivot&&h.setPosition(zt.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(f.copy(o.parentMatrix),d.copy(o.parentMatrixWorld));const _=t.clone().multiply(n).multiply(r),y=new l.Matrix4;y.extractRotation(d);const x=new l.Matrix4;x.copyPosition(d);const m=x.clone().invert().multiply(d),M=y.clone().invert().multiply(m),v=s,C=new l.Matrix4;if(p===0)C.copy(y).multiply(_).multiply(M).multiply(v);else if(p===1)C.copy(y).multiply(M).multiply(_).multiply(v);else{const L=new l.Matrix4().scale(new l.Vector3().setFromMatrixScale(f)).clone().invert(),D=M.clone().multiply(L);C.copy(y).multiply(_).multiply(D).multiply(v)}const O=h.clone().invert(),S=i.clone().invert();let A=e.clone().multiply(c).multiply(h).multiply(t).multiply(n).multiply(r).multiply(O).multiply(a).multiply(i).multiply(s).multiply(S);const b=new l.Matrix4().copyPosition(A),P=d.clone().multiply(b);return g.copyPosition(P),A=g.clone().multiply(C),A.premultiply(d.invert()),A}function Gs(o){o=o||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function lr(o){return o.split(",").map(function(t){return parseFloat(t)})}function Rs(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),Ds(new Uint8Array(o,e,t))}function Gl(o,e){for(let t=0,n=o.length,r=e.length;t<r;t++,n++)o[n]=e[t]}function Rl(o,e,t,n){for(let r=t,s=0;r<n;r++,s++)o[s]=e[r];return o}function js(o,e,t){return o.slice(0,e).concat(t).concat(o.slice(e))}var jl=Object.defineProperty,El=(o,e,t)=>e in o?jl(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,cr=(o,e,t)=>(El(o,typeof e!="symbol"?e+"":e,t),t);class Yl extends l.Loader{constructor(e){super(e)}load(e,t,n,r){const s=new l.FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,i=>{if(typeof i!="string")throw new Error("unsupported data type");const a=JSON.parse(i),c=this.parse(a);t&&t(c)},n,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new ur(e)}}class ur{constructor(e){cr(this,"data"),this.data=e}generateShapes(e,t=100,n){const r=[],s={letterSpacing:0,lineHeight:1,...n},i=Wl(e,t,this.data,s);for(let a=0,c=i.length;a<c;a++)Array.prototype.push.apply(r,i[a].toShapes(!1));return r}}cr(ur,"isFont"),cr(ur,"type");function Wl(o,e,t,n){const r=Array.from(o),s=e/t.resolution,i=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let c=0,h=0;for(let d=0;d<r.length;d++){const f=r[d];if(f===`
`)c=0,h-=i*n.lineHeight;else{const g=Xl(f,s,c,h,t);g&&(c+=g.offsetX+n.letterSpacing,a.push(g.path))}}return a}function Xl(o,e,t,n,r){const s=r.glyphs[o]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+o+'" does not exists in font family '+r.familyName+".");return}const i=new l.ShapePath;let a,c,h,d,f,g,p,_;if(s.o){const y=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let x=0,m=y.length;x<m;)switch(y[x++]){case"m":a=parseInt(y[x++])*e+t,c=parseInt(y[x++])*e+n,i.moveTo(a,c);break;case"l":a=parseInt(y[x++])*e+t,c=parseInt(y[x++])*e+n,i.lineTo(a,c);break;case"q":h=parseInt(y[x++])*e+t,d=parseInt(y[x++])*e+n,f=parseInt(y[x++])*e+t,g=parseInt(y[x++])*e+n,i.quadraticCurveTo(f,g,h,d);break;case"b":h=parseInt(y[x++])*e+t,d=parseInt(y[x++])*e+n,f=parseInt(y[x++])*e+t,g=parseInt(y[x++])*e+n,p=parseInt(y[x++])*e+t,_=parseInt(y[x++])*e+n,i.bezierCurveTo(f,g,p,_,h,d);break}}return{offsetX:s.ha*e,path:i}}class Es extends l.DataTextureLoader{constructor(e){super(e),this.type=l.HalfFloatType}parse(e){const i=function(b,P){switch(b){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},d=`
`,f=function(b,P,w){P=P||1024;let D=b.pos,V=-1,G=0,Y="",W=String.fromCharCode.apply(null,new Uint16Array(b.subarray(D,D+128)));for(;0>(V=W.indexOf(d))&&G<P&&D<b.byteLength;)Y+=W,G+=W.length,D+=128,W+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(D,D+128)));return-1<V?(b.pos+=G+V+1,Y+W.slice(0,V)):!1},g=function(b){const P=/^#\?(\S+)/,w=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,L=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,D=/^\s*FORMAT=(\S+)\s*$/,V=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,G={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,W;for((b.pos>=b.byteLength||!(Y=f(b)))&&i(1,"no header found"),(W=Y.match(P))||i(3,"bad initial token"),G.valid|=1,G.programtype=W[1],G.string+=Y+`
`;Y=f(b),Y!==!1;){if(G.string+=Y+`
`,Y.charAt(0)==="#"){G.comments+=Y+`
`;continue}if((W=Y.match(w))&&(G.gamma=parseFloat(W[1])),(W=Y.match(L))&&(G.exposure=parseFloat(W[1])),(W=Y.match(D))&&(G.valid|=2,G.format=W[1]),(W=Y.match(V))&&(G.valid|=4,G.height=parseInt(W[1],10),G.width=parseInt(W[2],10)),G.valid&2&&G.valid&4)break}return G.valid&2||i(3,"missing format specifier"),G.valid&4||i(3,"missing image size specifier"),G},p=function(b,P,w){const L=P;if(L<8||L>32767||b[0]!==2||b[1]!==2||b[2]&128)return new Uint8Array(b);L!==(b[2]<<8|b[3])&&i(3,"wrong scanline width");const D=new Uint8Array(4*P*w);D.length||i(4,"unable to allocate buffer space");let V=0,G=0;const Y=4*L,W=new Uint8Array(4),$=new Uint8Array(Y);let q=w;for(;q>0&&G<b.byteLength;){G+4>b.byteLength&&i(1),W[0]=b[G++],W[1]=b[G++],W[2]=b[G++],W[3]=b[G++],(W[0]!=2||W[1]!=2||(W[2]<<8|W[3])!=L)&&i(3,"bad rgbe scanline format");let ne=0,te;for(;ne<Y&&G<b.byteLength;){te=b[G++];const le=te>128;if(le&&(te-=128),(te===0||ne+te>Y)&&i(3,"bad scanline data"),le){const me=b[G++];for(let B=0;B<te;B++)$[ne++]=me}else $.set(b.subarray(G,G+te),ne),ne+=te,G+=te}const ce=L;for(let le=0;le<ce;le++){let me=0;D[V]=$[le+me],me+=L,D[V+1]=$[le+me],me+=L,D[V+2]=$[le+me],me+=L,D[V+3]=$[le+me],V+=4}q--}return D},_=function(b,P,w,L){const D=b[P+3],V=Math.pow(2,D-128)/255;w[L+0]=b[P+0]*V,w[L+1]=b[P+1]*V,w[L+2]=b[P+2]*V,w[L+3]=1},y=function(b,P,w,L){const D=b[P+3],V=Math.pow(2,D-128)/255;w[L+0]=l.DataUtils.toHalfFloat(Math.min(b[P+0]*V,65504)),w[L+1]=l.DataUtils.toHalfFloat(Math.min(b[P+1]*V,65504)),w[L+2]=l.DataUtils.toHalfFloat(Math.min(b[P+2]*V,65504)),w[L+3]=l.DataUtils.toHalfFloat(1)},x=new Uint8Array(e);x.pos=0;const m=g(x),M=m.width,v=m.height,C=p(x.subarray(x.pos),M,v);let O,S,A;switch(this.type){case l.FloatType:A=C.length/4;const b=new Float32Array(A*4);for(let w=0;w<A;w++)_(C,w*4,b,w*4);O=b,S=l.FloatType;break;case l.HalfFloatType:A=C.length/4;const P=new Uint16Array(A*4);for(let w=0;w<A;w++)y(C,w*4,P,w*4);O=P,S=l.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:M,height:v,data:O,header:m.string,gamma:m.gamma,exposure:m.exposure,type:S}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(i,a){switch(i.type){case l.FloatType:case l.HalfFloatType:"colorSpace"in i?i.colorSpace="srgb-linear":i.encoding=3e3,i.minFilter=l.LinearFilter,i.magFilter=l.LinearFilter,i.generateMipmaps=!1,i.flipY=!0;break}t&&t(i,a)}return super.load(e,s,n,r)}}const Zl="srgb";class $t extends l.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,r){const s=this,i=new l.FileLoader(s.manager);i.setPath(s.path),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(e,function(a){try{t(s.parse(a))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},n,r)}parse(e){const t=this;function n(B,z){if(B.nodeType!==1)return;const F=C(B);let k=!1,R=null;switch(B.nodeName){case"svg":z=_(B,z);break;case"style":s(B);break;case"g":z=_(B,z);break;case"path":z=_(B,z),B.hasAttribute("d")&&(R=r(B));break;case"rect":z=_(B,z),R=c(B);break;case"polygon":z=_(B,z),R=h(B);break;case"polyline":z=_(B,z),R=d(B);break;case"circle":z=_(B,z),R=f(B);break;case"ellipse":z=_(B,z),R=g(B);break;case"line":z=_(B,z),R=p(B);break;case"defs":k=!0;break;case"use":z=_(B,z);const U=(B.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Z=B.viewportElement.getElementById(U);Z?n(Z,z):console.warn("SVGLoader: 'use node' references non-existent node id: "+U);break}R&&(z.fill!==void 0&&z.fill!=="none"&&R.color.setStyle(z.fill,Zl),S(R,ce),D.push(R),R.userData={node:B,style:z});const T=B.childNodes;for(let I=0;I<T.length;I++){const U=T[I];k&&U.nodeName!=="style"&&U.nodeName!=="defs"||n(U,z)}F&&(G.pop(),G.length>0?ce.copy(G[G.length-1]):ce.identity())}function r(B){const z=new l.ShapePath,F=new l.Vector2,k=new l.Vector2,R=new l.Vector2;let T=!0,I=!1;const U=B.getAttribute("d");if(U===""||U==="none")return null;const Z=U.match(/[a-df-z][^a-df-z]*/gi);for(let j=0,E=Z.length;j<E;j++){const J=Z[j],re=J.charAt(0),ie=J.slice(1).trim();T===!0&&(I=!0,T=!1);let X;switch(re){case"M":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=2)F.x=X[N+0],F.y=X[N+1],k.x=F.x,k.y=F.y,N===0?z.moveTo(F.x,F.y):z.lineTo(F.x,F.y),N===0&&R.copy(F);break;case"H":X=x(ie);for(let N=0,ae=X.length;N<ae;N++)F.x=X[N],k.x=F.x,k.y=F.y,z.lineTo(F.x,F.y),N===0&&I===!0&&R.copy(F);break;case"V":X=x(ie);for(let N=0,ae=X.length;N<ae;N++)F.y=X[N],k.x=F.x,k.y=F.y,z.lineTo(F.x,F.y),N===0&&I===!0&&R.copy(F);break;case"L":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=2)F.x=X[N+0],F.y=X[N+1],k.x=F.x,k.y=F.y,z.lineTo(F.x,F.y),N===0&&I===!0&&R.copy(F);break;case"C":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=6)z.bezierCurveTo(X[N+0],X[N+1],X[N+2],X[N+3],X[N+4],X[N+5]),k.x=X[N+2],k.y=X[N+3],F.x=X[N+4],F.y=X[N+5],N===0&&I===!0&&R.copy(F);break;case"S":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=4)z.bezierCurveTo(y(F.x,k.x),y(F.y,k.y),X[N+0],X[N+1],X[N+2],X[N+3]),k.x=X[N+0],k.y=X[N+1],F.x=X[N+2],F.y=X[N+3],N===0&&I===!0&&R.copy(F);break;case"Q":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=4)z.quadraticCurveTo(X[N+0],X[N+1],X[N+2],X[N+3]),k.x=X[N+0],k.y=X[N+1],F.x=X[N+2],F.y=X[N+3],N===0&&I===!0&&R.copy(F);break;case"T":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=2){const he=y(F.x,k.x),_e=y(F.y,k.y);z.quadraticCurveTo(he,_e,X[N+0],X[N+1]),k.x=he,k.y=_e,F.x=X[N+0],F.y=X[N+1],N===0&&I===!0&&R.copy(F)}break;case"A":X=x(ie,[3,4],7);for(let N=0,ae=X.length;N<ae;N+=7){if(X[N+5]==F.x&&X[N+6]==F.y)continue;const he=F.clone();F.x=X[N+5],F.y=X[N+6],k.x=F.x,k.y=F.y,i(z,X[N],X[N+1],X[N+2],X[N+3],X[N+4],he,F),N===0&&I===!0&&R.copy(F)}break;case"m":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=2)F.x+=X[N+0],F.y+=X[N+1],k.x=F.x,k.y=F.y,N===0?z.moveTo(F.x,F.y):z.lineTo(F.x,F.y),N===0&&R.copy(F);break;case"h":X=x(ie);for(let N=0,ae=X.length;N<ae;N++)F.x+=X[N],k.x=F.x,k.y=F.y,z.lineTo(F.x,F.y),N===0&&I===!0&&R.copy(F);break;case"v":X=x(ie);for(let N=0,ae=X.length;N<ae;N++)F.y+=X[N],k.x=F.x,k.y=F.y,z.lineTo(F.x,F.y),N===0&&I===!0&&R.copy(F);break;case"l":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=2)F.x+=X[N+0],F.y+=X[N+1],k.x=F.x,k.y=F.y,z.lineTo(F.x,F.y),N===0&&I===!0&&R.copy(F);break;case"c":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=6)z.bezierCurveTo(F.x+X[N+0],F.y+X[N+1],F.x+X[N+2],F.y+X[N+3],F.x+X[N+4],F.y+X[N+5]),k.x=F.x+X[N+2],k.y=F.y+X[N+3],F.x+=X[N+4],F.y+=X[N+5],N===0&&I===!0&&R.copy(F);break;case"s":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=4)z.bezierCurveTo(y(F.x,k.x),y(F.y,k.y),F.x+X[N+0],F.y+X[N+1],F.x+X[N+2],F.y+X[N+3]),k.x=F.x+X[N+0],k.y=F.y+X[N+1],F.x+=X[N+2],F.y+=X[N+3],N===0&&I===!0&&R.copy(F);break;case"q":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=4)z.quadraticCurveTo(F.x+X[N+0],F.y+X[N+1],F.x+X[N+2],F.y+X[N+3]),k.x=F.x+X[N+0],k.y=F.y+X[N+1],F.x+=X[N+2],F.y+=X[N+3],N===0&&I===!0&&R.copy(F);break;case"t":X=x(ie);for(let N=0,ae=X.length;N<ae;N+=2){const he=y(F.x,k.x),_e=y(F.y,k.y);z.quadraticCurveTo(he,_e,F.x+X[N+0],F.y+X[N+1]),k.x=he,k.y=_e,F.x=F.x+X[N+0],F.y=F.y+X[N+1],N===0&&I===!0&&R.copy(F)}break;case"a":X=x(ie,[3,4],7);for(let N=0,ae=X.length;N<ae;N+=7){if(X[N+5]==0&&X[N+6]==0)continue;const he=F.clone();F.x+=X[N+5],F.y+=X[N+6],k.x=F.x,k.y=F.y,i(z,X[N],X[N+1],X[N+2],X[N+3],X[N+4],he,F),N===0&&I===!0&&R.copy(F)}break;case"Z":case"z":z.currentPath.autoClose=!0,z.currentPath.curves.length>0&&(F.copy(R),z.currentPath.currentPoint.copy(F),T=!0);break;default:console.warn(J)}I=!1}return z}function s(B){if(!(!B.sheet||!B.sheet.cssRules||!B.sheet.cssRules.length))for(let z=0;z<B.sheet.cssRules.length;z++){const F=B.sheet.cssRules[z];if(F.type!==1)continue;const k=F.selectorText.split(/,/gm).filter(Boolean).map(R=>R.trim());for(let R=0;R<k.length;R++){const T=Object.fromEntries(Object.entries(F.style).filter(([,I])=>I!==""));V[k[R]]=Object.assign(V[k[R]]||{},T)}}}function i(B,z,F,k,R,T,I,U){if(z==0||F==0){B.lineTo(U.x,U.y);return}k=k*Math.PI/180,z=Math.abs(z),F=Math.abs(F);const Z=(I.x-U.x)/2,j=(I.y-U.y)/2,E=Math.cos(k)*Z+Math.sin(k)*j,J=-Math.sin(k)*Z+Math.cos(k)*j;let re=z*z,ie=F*F;const X=E*E,N=J*J,ae=X/re+N/ie;if(ae>1){const $e=Math.sqrt(ae);z=$e*z,F=$e*F,re=z*z,ie=F*F}const he=re*N+ie*X,_e=(re*ie-he)/he;let Ie=Math.sqrt(Math.max(0,_e));R===T&&(Ie=-Ie);const Oe=Ie*z*J/F,He=-Ie*F*E/z,ft=Math.cos(k)*Oe-Math.sin(k)*He+(I.x+U.x)/2,Pt=Math.sin(k)*Oe+Math.cos(k)*He+(I.y+U.y)/2,Tt=a(1,0,(E-Oe)/z,(J-He)/F),Ze=a((E-Oe)/z,(J-He)/F,(-E-Oe)/z,(-J-He)/F)%(Math.PI*2);B.currentPath.absellipse(ft,Pt,z,F,Tt,Tt+Ze,T===0,k)}function a(B,z,F,k){const R=B*F+z*k,T=Math.sqrt(B*B+z*z)*Math.sqrt(F*F+k*k);let I=Math.acos(Math.max(-1,Math.min(1,R/T)));return B*k-z*F<0&&(I=-I),I}function c(B){const z=v(B.getAttribute("x")||0),F=v(B.getAttribute("y")||0),k=v(B.getAttribute("rx")||B.getAttribute("ry")||0),R=v(B.getAttribute("ry")||B.getAttribute("rx")||0),T=v(B.getAttribute("width")),I=v(B.getAttribute("height")),U=1-.551915024494,Z=new l.ShapePath;return Z.moveTo(z+k,F),Z.lineTo(z+T-k,F),(k!==0||R!==0)&&Z.bezierCurveTo(z+T-k*U,F,z+T,F+R*U,z+T,F+R),Z.lineTo(z+T,F+I-R),(k!==0||R!==0)&&Z.bezierCurveTo(z+T,F+I-R*U,z+T-k*U,F+I,z+T-k,F+I),Z.lineTo(z+k,F+I),(k!==0||R!==0)&&Z.bezierCurveTo(z+k*U,F+I,z,F+I-R*U,z,F+I-R),Z.lineTo(z,F+R),(k!==0||R!==0)&&Z.bezierCurveTo(z,F+R*U,z+k*U,F,z+k,F),Z}function h(B){function z(T,I,U){const Z=v(I),j=v(U);R===0?k.moveTo(Z,j):k.lineTo(Z,j),R++}const F=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,k=new l.ShapePath;let R=0;return B.getAttribute("points").replace(F,z),k.currentPath.autoClose=!0,k}function d(B){function z(T,I,U){const Z=v(I),j=v(U);R===0?k.moveTo(Z,j):k.lineTo(Z,j),R++}const F=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,k=new l.ShapePath;let R=0;return B.getAttribute("points").replace(F,z),k.currentPath.autoClose=!1,k}function f(B){const z=v(B.getAttribute("cx")||0),F=v(B.getAttribute("cy")||0),k=v(B.getAttribute("r")||0),R=new l.Path;R.absarc(z,F,k,0,Math.PI*2);const T=new l.ShapePath;return T.subPaths.push(R),T}function g(B){const z=v(B.getAttribute("cx")||0),F=v(B.getAttribute("cy")||0),k=v(B.getAttribute("rx")||0),R=v(B.getAttribute("ry")||0),T=new l.Path;T.absellipse(z,F,k,R,0,Math.PI*2);const I=new l.ShapePath;return I.subPaths.push(T),I}function p(B){const z=v(B.getAttribute("x1")||0),F=v(B.getAttribute("y1")||0),k=v(B.getAttribute("x2")||0),R=v(B.getAttribute("y2")||0),T=new l.ShapePath;return T.moveTo(z,F),T.lineTo(k,R),T.currentPath.autoClose=!1,T}function _(B,z){z=Object.assign({},z);let F={};if(B.hasAttribute("class")){const I=B.getAttribute("class").split(/\s/).filter(Boolean).map(U=>U.trim());for(let U=0;U<I.length;U++)F=Object.assign(F,V["."+I[U]])}B.hasAttribute("id")&&(F=Object.assign(F,V["#"+B.getAttribute("id")]));function k(I,U,Z){Z===void 0&&(Z=function(E){return E.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),E}),B.hasAttribute(I)&&(z[U]=Z(B.getAttribute(I))),F[I]&&(z[U]=Z(F[I])),B.style&&B.style[I]!==""&&(z[U]=Z(B.style[I]))}function R(I){return Math.max(0,Math.min(1,v(I)))}function T(I){return Math.max(0,v(I))}return k("fill","fill"),k("fill-opacity","fillOpacity",R),k("fill-rule","fillRule"),k("opacity","opacity",R),k("stroke","stroke"),k("stroke-opacity","strokeOpacity",R),k("stroke-width","strokeWidth",T),k("stroke-linejoin","strokeLineJoin"),k("stroke-linecap","strokeLineCap"),k("stroke-miterlimit","strokeMiterLimit",T),k("visibility","visibility"),z}function y(B,z){return B-(z-B)}function x(B,z,F){if(typeof B!="string")throw new TypeError("Invalid input: "+typeof B);const k={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},R=0,T=1,I=2,U=3;let Z=R,j=!0,E="",J="";const re=[];function ie(he,_e,Ie){const Oe=new SyntaxError('Unexpected character "'+he+'" at index '+_e+".");throw Oe.partial=Ie,Oe}function X(){E!==""&&(J===""?re.push(Number(E)):re.push(Number(E)*Math.pow(10,Number(J)))),E="",J=""}let N;const ae=B.length;for(let he=0;he<ae;he++){if(N=B[he],Array.isArray(z)&&z.includes(re.length%F)&&k.FLAGS.test(N)){Z=T,E=N,X();continue}if(Z===R){if(k.WHITESPACE.test(N))continue;if(k.DIGIT.test(N)||k.SIGN.test(N)){Z=T,E=N;continue}if(k.POINT.test(N)){Z=I,E=N;continue}k.COMMA.test(N)&&(j&&ie(N,he,re),j=!0)}if(Z===T){if(k.DIGIT.test(N)){E+=N;continue}if(k.POINT.test(N)){E+=N,Z=I;continue}if(k.EXP.test(N)){Z=U;continue}k.SIGN.test(N)&&E.length===1&&k.SIGN.test(E[0])&&ie(N,he,re)}if(Z===I){if(k.DIGIT.test(N)){E+=N;continue}if(k.EXP.test(N)){Z=U;continue}k.POINT.test(N)&&E[E.length-1]==="."&&ie(N,he,re)}if(Z===U){if(k.DIGIT.test(N)){J+=N;continue}if(k.SIGN.test(N)){if(J===""){J+=N;continue}J.length===1&&k.SIGN.test(J)&&ie(N,he,re)}}k.WHITESPACE.test(N)?(X(),Z=R,j=!1):k.COMMA.test(N)?(X(),Z=R,j=!0):k.SIGN.test(N)?(X(),Z=T,E=N):k.POINT.test(N)?(X(),Z=I,E=N):ie(N,he,re)}return X(),re}const m=["mm","cm","in","pt","pc","px"],M={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function v(B){let z="px";if(typeof B=="string"||B instanceof String)for(let k=0,R=m.length;k<R;k++){const T=m[k];if(B.endsWith(T)){z=T,B=B.substring(0,B.length-T.length);break}}let F;return z==="px"&&t.defaultUnit!=="px"?F=M.in[t.defaultUnit]/t.defaultDPI:(F=M[z][t.defaultUnit],F<0&&(F=M[z].in*t.defaultDPI)),F*parseFloat(B)}function C(B){if(!(B.hasAttribute("transform")||B.nodeName==="use"&&(B.hasAttribute("x")||B.hasAttribute("y"))))return null;const z=O(B);return G.length>0&&z.premultiply(G[G.length-1]),ce.copy(z),G.push(z),z}function O(B){const z=new l.Matrix3,F=Y;if(B.nodeName==="use"&&(B.hasAttribute("x")||B.hasAttribute("y"))){const k=v(B.getAttribute("x")),R=v(B.getAttribute("y"));z.translate(k,R)}if(B.hasAttribute("transform")){const k=B.getAttribute("transform").split(")");for(let R=k.length-1;R>=0;R--){const T=k[R].trim();if(T==="")continue;const I=T.indexOf("("),U=T.length;if(I>0&&I<U){const Z=T.slice(0,I),j=x(T.slice(I+1));switch(F.identity(),Z){case"translate":if(j.length>=1){const E=j[0];let J=0;j.length>=2&&(J=j[1]),F.translate(E,J)}break;case"rotate":if(j.length>=1){let E=0,J=0,re=0;E=j[0]*Math.PI/180,j.length>=3&&(J=j[1],re=j[2]),W.makeTranslation(-J,-re),$.makeRotation(E),q.multiplyMatrices($,W),W.makeTranslation(J,re),F.multiplyMatrices(W,q)}break;case"scale":if(j.length>=1){const E=j[0];let J=E;j.length>=2&&(J=j[1]),F.scale(E,J)}break;case"skewX":j.length===1&&F.set(1,Math.tan(j[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":j.length===1&&F.set(1,0,0,Math.tan(j[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":j.length===6&&F.set(j[0],j[2],j[4],j[1],j[3],j[5],0,0,1);break}}z.premultiply(F)}}return z}function S(B,z){function F(I){te.set(I.x,I.y,1).applyMatrix3(z),I.set(te.x,te.y)}function k(I){const U=I.xRadius,Z=I.yRadius,j=Math.cos(I.aRotation),E=Math.sin(I.aRotation),J=new l.Vector3(U*j,U*E,0),re=new l.Vector3(-Z*E,Z*j,0),ie=J.applyMatrix3(z),X=re.applyMatrix3(z),N=Y.set(ie.x,X.x,0,ie.y,X.y,0,0,0,1),ae=W.copy(N).invert(),Ie=$.copy(ae).transpose().multiply(ae).elements,Oe=L(Ie[0],Ie[1],Ie[4]),He=Math.sqrt(Oe.rt1),ft=Math.sqrt(Oe.rt2);if(I.xRadius=1/He,I.yRadius=1/ft,I.aRotation=Math.atan2(Oe.sn,Oe.cs),!((I.aEndAngle-I.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const Tt=W.set(He,0,0,0,ft,0,0,0,1),Ze=$.set(Oe.cs,Oe.sn,0,-Oe.sn,Oe.cs,0,0,0,1),$e=Tt.multiply(Ze).multiply(N),Gn=Rn=>{const{x:jn,y:dn}=new l.Vector3(Math.cos(Rn),Math.sin(Rn),0).applyMatrix3($e);return Math.atan2(dn,jn)};I.aStartAngle=Gn(I.aStartAngle),I.aEndAngle=Gn(I.aEndAngle),A(z)&&(I.aClockwise=!I.aClockwise)}}function R(I){const U=P(z),Z=w(z);I.xRadius*=U,I.yRadius*=Z;const j=U>Number.EPSILON?Math.atan2(z.elements[1],z.elements[0]):Math.atan2(-z.elements[3],z.elements[4]);I.aRotation+=j,A(z)&&(I.aStartAngle*=-1,I.aEndAngle*=-1,I.aClockwise=!I.aClockwise)}const T=B.subPaths;for(let I=0,U=T.length;I<U;I++){const j=T[I].curves;for(let E=0;E<j.length;E++){const J=j[E];J.isLineCurve?(F(J.v1),F(J.v2)):J.isCubicBezierCurve?(F(J.v0),F(J.v1),F(J.v2),F(J.v3)):J.isQuadraticBezierCurve?(F(J.v0),F(J.v1),F(J.v2)):J.isEllipseCurve&&(ne.set(J.aX,J.aY),F(ne),J.aX=ne.x,J.aY=ne.y,b(z)?k(J):R(J))}}}function A(B){const z=B.elements;return z[0]*z[4]-z[1]*z[3]<0}function b(B){const z=B.elements,F=z[0]*z[3]+z[1]*z[4];if(F===0)return!1;const k=P(B),R=w(B);return Math.abs(F/(k*R))>Number.EPSILON}function P(B){const z=B.elements;return Math.sqrt(z[0]*z[0]+z[1]*z[1])}function w(B){const z=B.elements;return Math.sqrt(z[3]*z[3]+z[4]*z[4])}function L(B,z,F){let k,R,T,I,U;const Z=B+F,j=B-F,E=Math.sqrt(j*j+4*z*z);return Z>0?(k=.5*(Z+E),U=1/k,R=B*U*F-z*U*z):Z<0?R=.5*(Z-E):(k=.5*E,R=-.5*E),j>0?T=j+E:T=j-E,Math.abs(T)>2*Math.abs(z)?(U=-2*z/T,I=1/Math.sqrt(1+U*U),T=U*I):Math.abs(z)===0?(T=1,I=0):(U=-.5*T/z,T=1/Math.sqrt(1+U*U),I=U*T),j>0&&(U=T,T=-I,I=U),{rt1:k,rt2:R,cs:T,sn:I}}const D=[],V={},G=[],Y=new l.Matrix3,W=new l.Matrix3,$=new l.Matrix3,q=new l.Matrix3,ne=new l.Vector2,te=new l.Vector3,ce=new l.Matrix3,le=new DOMParser().parseFromString(e,"image/svg+xml");return n(le.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:D,xml:le.documentElement}}static createShapes(e){const n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:n.ORIGIN,t:0};function s(y,x,m,M){const v=y.x,C=x.x,O=m.x,S=M.x,A=y.y,b=x.y,P=m.y,w=M.y,L=(S-O)*(A-P)-(w-P)*(v-O),D=(C-v)*(A-P)-(b-A)*(v-O),V=(w-P)*(C-v)-(S-O)*(b-A),G=L/V,Y=D/V;if(V===0&&L!==0||G<=0||G>=1||Y<0||Y>1)return null;if(L===0&&V===0){for(let W=0;W<2;W++)if(i(W===0?m:M,y,x),r.loc==n.ORIGIN){const $=W===0?m:M;return{x:$.x,y:$.y,t:r.t}}else if(r.loc==n.BETWEEN){const $=+(v+r.t*(C-v)).toPrecision(10),q=+(A+r.t*(b-A)).toPrecision(10);return{x:$,y:q,t:r.t}}return null}else{for(let q=0;q<2;q++)if(i(q===0?m:M,y,x),r.loc==n.ORIGIN){const ne=q===0?m:M;return{x:ne.x,y:ne.y,t:r.t}}const W=+(v+G*(C-v)).toPrecision(10),$=+(A+G*(b-A)).toPrecision(10);return{x:W,y:$,t:G}}}function i(y,x,m){const M=m.x-x.x,v=m.y-x.y,C=y.x-x.x,O=y.y-x.y,S=M*O-C*v;if(y.x===x.x&&y.y===x.y){r.loc=n.ORIGIN,r.t=0;return}if(y.x===m.x&&y.y===m.y){r.loc=n.DESTINATION,r.t=1;return}if(S<-Number.EPSILON){r.loc=n.LEFT;return}if(S>Number.EPSILON){r.loc=n.RIGHT;return}if(M*C<0||v*O<0){r.loc=n.BEHIND;return}if(Math.sqrt(M*M+v*v)<Math.sqrt(C*C+O*O)){r.loc=n.BEYOND;return}let A;M!==0?A=C/M:A=O/v,r.loc=n.BETWEEN,r.t=A}function a(y,x){const m=[],M=[];for(let v=1;v<y.length;v++){const C=y[v-1],O=y[v];for(let S=1;S<x.length;S++){const A=x[S-1],b=x[S],P=s(C,O,A,b);P!==null&&m.find(w=>w.t<=P.t+Number.EPSILON&&w.t>=P.t-Number.EPSILON)===void 0&&(m.push(P),M.push(new l.Vector2(P.x,P.y)))}}return M}function c(y,x,m){const M=new l.Vector2;x.getCenter(M);const v=[];return m.forEach(C=>{C.boundingBox.containsPoint(M)&&a(y,C.points).forEach(S=>{v.push({identifier:C.identifier,isCW:C.isCW,point:S})})}),v.sort((C,O)=>C.point.x-O.point.x),v}function h(y,x,m,M,v){(v==null||v==="")&&(v="nonzero");const C=new l.Vector2;y.boundingBox.getCenter(C);const O=[new l.Vector2(m,C.y),new l.Vector2(M,C.y)],S=c(O,y.boundingBox,x);S.sort((D,V)=>D.point.x-V.point.x);const A=[],b=[];S.forEach(D=>{D.identifier===y.identifier?A.push(D):b.push(D)});const P=A[0].point.x,w=[];let L=0;for(;L<b.length&&b[L].point.x<P;)w.length>0&&w[w.length-1]===b[L].identifier?w.pop():w.push(b[L].identifier),L++;if(w.push(y.identifier),v==="evenodd"){const D=w.length%2===0,V=w[w.length-2];return{identifier:y.identifier,isHole:D,for:V}}else if(v==="nonzero"){let D=!0,V=null,G=null;for(let Y=0;Y<w.length;Y++){const W=w[Y];D?(G=x[W].isCW,D=!1,V=W):G!==x[W].isCW&&(G=x[W].isCW,D=!0)}return{identifier:y.identifier,isHole:D,for:V}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let d=999999999,f=-999999999,g=e.subPaths.map(y=>{const x=y.getPoints();let m=-999999999,M=999999999,v=-999999999,C=999999999;for(let O=0;O<x.length;O++){const S=x[O];S.y>m&&(m=S.y),S.y<M&&(M=S.y),S.x>v&&(v=S.x),S.x<C&&(C=S.x)}return f<=v&&(f=v+1),d>=C&&(d=C-1),{curves:y.curves,points:x,isCW:l.ShapeUtils.isClockWise(x),identifier:-1,boundingBox:new l.Box2(new l.Vector2(C,M),new l.Vector2(v,m))}});g=g.filter(y=>y.points.length>1);for(let y=0;y<g.length;y++)g[y].identifier=y;const p=g.map(y=>h(y,g,d,f,e.userData?e.userData.style.fillRule:void 0)),_=[];return g.forEach(y=>{if(!p[y.identifier].isHole){const m=new l.Shape;m.curves=y.curves,p.filter(v=>v.isHole&&v.for===y.identifier).forEach(v=>{const C=g[v.identifier],O=new l.Path;O.curves=C.curves,m.holes.push(O)}),_.push(m)}}),_}static getStrokeStyle(e,t,n,r,s){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",n=n!==void 0?n:"miter",r=r!==void 0?r:"butt",s=s!==void 0?s:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:r,strokeMiterLimit:s}}static pointsToStroke(e,t,n,r){const s=[],i=[],a=[];if($t.pointsToStrokeWithBuffers(e,t,n,r,s,i,a)===0)return null;const c=new l.BufferGeometry;return c.setAttribute("position",new l.Float32BufferAttribute(s,3)),c.setAttribute("normal",new l.Float32BufferAttribute(i,3)),c.setAttribute("uv",new l.Float32BufferAttribute(a,2)),c}static pointsToStrokeWithBuffers(e,t,n,r,s,i,a,c){const h=new l.Vector2,d=new l.Vector2,f=new l.Vector2,g=new l.Vector2,p=new l.Vector2,_=new l.Vector2,y=new l.Vector2,x=new l.Vector2,m=new l.Vector2,M=new l.Vector2,v=new l.Vector2,C=new l.Vector2,O=new l.Vector2,S=new l.Vector2,A=new l.Vector2,b=new l.Vector2,P=new l.Vector2;n=n!==void 0?n:12,r=r!==void 0?r:.001,c=c!==void 0?c:0,e=j(e);const w=e.length;if(w<2)return 0;const L=e[0].equals(e[w-1]);let D,V=e[0],G;const Y=t.strokeWidth/2,W=1/(w-1);let $=0,q,ne,te,ce,le=!1,me=0,B=c*3,z=c*2;F(e[0],e[1],h).multiplyScalar(Y),x.copy(e[0]).sub(h),m.copy(e[0]).add(h),M.copy(x),v.copy(m);for(let E=1;E<w;E++){D=e[E],E===w-1?L?G=e[1]:G=void 0:G=e[E+1];const J=h;if(F(V,D,J),f.copy(J).multiplyScalar(Y),C.copy(D).sub(f),O.copy(D).add(f),q=$+W,ne=!1,G!==void 0){F(D,G,d),f.copy(d).multiplyScalar(Y),S.copy(D).sub(f),A.copy(D).add(f),te=!0,f.subVectors(G,V),J.dot(f)<0&&(te=!1),E===1&&(le=te),f.subVectors(G,D),f.normalize();const re=Math.abs(J.dot(f));if(re>Number.EPSILON){const ie=Y/re;f.multiplyScalar(-ie),g.subVectors(D,V),p.copy(g).setLength(ie).add(f),b.copy(p).negate();const X=p.length(),N=g.length();g.divideScalar(N),_.subVectors(G,D);const ae=_.length();switch(_.divideScalar(ae),g.dot(b)<N&&_.dot(b)<ae&&(ne=!0),P.copy(p).add(D),b.add(D),ce=!1,ne?te?(A.copy(b),O.copy(b)):(S.copy(b),C.copy(b)):T(),t.strokeLineJoin){case"bevel":I(te,ne,q);break;case"round":U(te,ne),te?R(D,C,S,q,0):R(D,A,O,q,1);break;case"miter":case"miter-clip":default:const he=Y*t.strokeMiterLimit/X;if(he<1)if(t.strokeLineJoin!=="miter-clip"){I(te,ne,q);break}else U(te,ne),te?(_.subVectors(P,C).multiplyScalar(he).add(C),y.subVectors(P,S).multiplyScalar(he).add(S),k(C,q,0),k(_,q,0),k(D,q,.5),k(D,q,.5),k(_,q,0),k(y,q,0),k(D,q,.5),k(y,q,0),k(S,q,0)):(_.subVectors(P,O).multiplyScalar(he).add(O),y.subVectors(P,A).multiplyScalar(he).add(A),k(O,q,1),k(_,q,1),k(D,q,.5),k(D,q,.5),k(_,q,1),k(y,q,1),k(D,q,.5),k(y,q,1),k(A,q,1));else ne?(te?(k(m,$,1),k(x,$,0),k(P,q,0),k(m,$,1),k(P,q,0),k(b,q,1)):(k(m,$,1),k(x,$,0),k(P,q,1),k(x,$,0),k(b,q,0),k(P,q,1)),te?S.copy(P):A.copy(P)):te?(k(C,q,0),k(P,q,0),k(D,q,.5),k(D,q,.5),k(P,q,0),k(S,q,0)):(k(O,q,1),k(P,q,1),k(D,q,.5),k(D,q,.5),k(P,q,1),k(A,q,1)),ce=!0;break}}else T()}else T();!L&&E===w-1&&Z(e[0],M,v,te,!0,$),$=q,V=D,x.copy(S),m.copy(A)}if(!L)Z(D,C,O,te,!1,q);else if(ne&&s){let E=P,J=b;le!==te&&(E=b,J=P),te?(ce||le)&&(J.toArray(s,0*3),J.toArray(s,3*3),ce&&E.toArray(s,1*3)):(ce||!le)&&(J.toArray(s,1*3),J.toArray(s,3*3),ce&&E.toArray(s,0*3))}return me;function F(E,J,re){return re.subVectors(J,E),re.set(-re.y,re.x).normalize()}function k(E,J,re){s&&(s[B]=E.x,s[B+1]=E.y,s[B+2]=0,i&&(i[B]=0,i[B+1]=0,i[B+2]=1),B+=3,a&&(a[z]=J,a[z+1]=re,z+=2)),me+=3}function R(E,J,re,ie,X){h.copy(J).sub(E).normalize(),d.copy(re).sub(E).normalize();let N=Math.PI;const ae=h.dot(d);Math.abs(ae)<1&&(N=Math.abs(Math.acos(ae))),N/=n,f.copy(J);for(let he=0,_e=n-1;he<_e;he++)g.copy(f).rotateAround(E,N),k(f,ie,X),k(g,ie,X),k(E,ie,.5),f.copy(g);k(g,ie,X),k(re,ie,X),k(E,ie,.5)}function T(){k(m,$,1),k(x,$,0),k(C,q,0),k(m,$,1),k(C,q,0),k(O,q,1)}function I(E,J,re){J?E?(k(m,$,1),k(x,$,0),k(C,q,0),k(m,$,1),k(C,q,0),k(b,q,1),k(C,re,0),k(S,re,0),k(b,re,.5)):(k(m,$,1),k(x,$,0),k(O,q,1),k(x,$,0),k(b,q,0),k(O,q,1),k(O,re,1),k(b,re,0),k(A,re,1)):E?(k(C,re,0),k(S,re,0),k(D,re,.5)):(k(O,re,1),k(A,re,0),k(D,re,.5))}function U(E,J){J&&(E?(k(m,$,1),k(x,$,0),k(C,q,0),k(m,$,1),k(C,q,0),k(b,q,1),k(C,$,0),k(D,q,.5),k(b,q,1),k(D,q,.5),k(S,$,0),k(b,q,1)):(k(m,$,1),k(x,$,0),k(O,q,1),k(x,$,0),k(b,q,0),k(O,q,1),k(O,$,1),k(b,q,0),k(D,q,.5),k(D,q,.5),k(b,q,0),k(A,$,1)))}function Z(E,J,re,ie,X,N){switch(t.strokeLineCap){case"round":X?R(E,re,J,N,.5):R(E,J,re,N,.5);break;case"square":if(X)h.subVectors(J,E),d.set(h.y,-h.x),f.addVectors(h,d).add(E),g.subVectors(d,h).add(E),ie?(f.toArray(s,1*3),g.toArray(s,0*3),g.toArray(s,3*3)):(f.toArray(s,1*3),a[3*2+1]===1?g.toArray(s,3*3):f.toArray(s,3*3),g.toArray(s,0*3));else{h.subVectors(re,E),d.set(h.y,-h.x),f.addVectors(h,d).add(E),g.subVectors(d,h).add(E);const ae=s.length;ie?(f.toArray(s,ae-1*3),g.toArray(s,ae-2*3),g.toArray(s,ae-4*3)):(g.toArray(s,ae-2*3),f.toArray(s,ae-1*3),g.toArray(s,ae-4*3))}break}}function j(E){let J=!1;for(let ie=1,X=E.length-1;ie<X;ie++)if(E[ie].distanceTo(E[ie+1])<r){J=!0;break}if(!J)return E;const re=[];re.push(E[0]);for(let ie=1,X=E.length-1;ie<X;ie++)E[ie].distanceTo(E[ie+1])>=r&&re.push(E[ie]);return re.push(E[E.length-1]),re}}}const hr=new WeakMap;class Kl extends l.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const s=new l.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,i=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(i,a).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const h=t.attributeTypes[c];h.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=h.name)}const n=JSON.stringify(t);if(hr.has(e)){const c=hr.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,i=e.byteLength,a=this._getWorker(s,i).then(c=>(r=c,new Promise((h,d)=>{r._callbacks[s]={resolve:h,reject:d},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),hr.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new l.BufferGeometry;e.index&&t.setIndex(new l.BufferAttribute(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],s=r.name,i=r.array,a=r.itemSize;t.setAttribute(s,new l.BufferAttribute(i,a))}return t}_loadLibrary(e,t){const n=new l.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,s)=>{n.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=ql.toString(),i=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const i=s.data;switch(i.type){case"decode":r._callbacks[i.id].resolve(i);break;case"error":r._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function ql(){let o,e;onmessage=function(i){const a=i.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(d){o.onModuleLoaded=function(f){d({draco:f})},DracoDecoderModule(o)});break;case"decode":const c=a.buffer,h=a.taskConfig;e.then(d=>{const f=d.draco,g=new f.Decoder,p=new f.DecoderBuffer;p.Init(new Int8Array(c),c.byteLength);try{const _=t(f,g,p,h),y=_.attributes.map(x=>x.array.buffer);_.index&&y.push(_.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:_},y)}catch(_){console.error(_),self.postMessage({type:"error",id:a.id,error:_.message})}finally{f.destroy(p),f.destroy(g)}});break}};function t(i,a,c,h){const d=h.attributeIDs,f=h.attributeTypes;let g,p;const _=a.GetEncodedGeometryType(c);if(_===i.TRIANGULAR_MESH)g=new i.Mesh,p=a.DecodeBufferToMesh(c,g);else if(_===i.POINT_CLOUD)g=new i.PointCloud,p=a.DecodeBufferToPointCloud(c,g);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||g.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const y={index:null,attributes:[]};for(const x in d){const m=self[f[x]];let M,v;if(h.useUniqueIDs)v=d[x],M=a.GetAttributeByUniqueId(g,v);else{if(v=a.GetAttributeId(g,i[d[x]]),v===-1)continue;M=a.GetAttribute(g,v)}y.attributes.push(r(i,a,g,x,m,M))}return _===i.TRIANGULAR_MESH&&(y.index=n(i,a,g)),i.destroy(g),y}function n(i,a,c){const d=c.num_faces()*3,f=d*4,g=i._malloc(f);a.GetTrianglesUInt32Array(c,f,g);const p=new Uint32Array(i.HEAPF32.buffer,g,d).slice();return i._free(g),{array:p,itemSize:1}}function r(i,a,c,h,d,f){const g=f.num_components(),_=c.num_points()*g,y=_*d.BYTES_PER_ELEMENT,x=s(i,d),m=i._malloc(y);a.GetAttributeDataArrayForAllPoints(c,f,x,y,m);const M=new d(i.HEAPF32.buffer,m,_).slice();return i._free(m),{name:h,array:M,itemSize:g}}function s(i,a){switch(a){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}const Ql=["args","material-uniforms-color-value"],Jl=u.defineComponent({__name:"Reflector",props:{color:{default:"#333"},textureWidth:{default:512},textureHeight:{default:512},clipBias:{default:0},multisample:{default:4},shader:{default:ir.ReflectorShader}},setup(o,{expose:e}){const t=o,{extend:n,invalidate:r}=ee.useTresContext(),s=u.shallowRef();n({Reflector:ir});const{color:i,textureWidth:a,textureHeight:c,clipBias:h,multisample:d,shader:f}=u.toRefs(t);return u.watch(t,()=>r()),e({instance:s}),(g,p)=>(u.openBlock(),u.createElementBlock("TresReflector",{ref_key:"reflectorRef",ref:s,args:[void 0,{textureWidth:u.unref(a),textureHeight:u.unref(c),clipBias:u.unref(h),multisample:u.unref(d),shader:u.unref(f)}],"material-uniforms-color-value":u.unref(i)},[u.renderSlot(g.$slots,"default",{},()=>[p[0]||(p[0]=u.createElementVNode("TresPlaneGeometry",{args:[5,5]},null,-1))])],8,Ql))}}),Hl=["args","center"],$l=u.defineComponent({__name:"Text3D",props:{font:{},text:{},size:{default:.5},height:{default:.2},curveSegments:{default:5},bevelEnabled:{type:Boolean,default:!0},bevelThickness:{default:.05},bevelSize:{default:.02},bevelOffset:{default:0},bevelSegments:{default:4},center:{type:Boolean,default:!1},needUpdates:{type:Boolean,default:!1}},async setup(o,{expose:e}){let t,n;const r=o,{center:s,font:i,text:a,needUpdates:c,size:h,height:d,curveSegments:f,bevelEnabled:g,bevelThickness:p,bevelSize:_,bevelOffset:y,bevelSegments:x}=u.toRefs(r),{extend:m,invalidate:M}=ee.useTresContext();u.watch(r,()=>M()),m({TextGeometry:Bs});const v=new Yl,C=u.useSlots(),O=u.computed(()=>{var P;return a!=null&&a.value?a.value:C.default?(P=C.default()[0].children)==null?void 0:P.trim():c.value?"":"TresJS"}),S=u.shallowRef();e({instance:S});const A=([t,n]=u.withAsyncContext(()=>new Promise((P,w)=>{try{typeof i.value=="string"?v.load(i.value,L=>{P(L)}):P(i.value)}catch(L){w(console.error("cientos",L))}})),t=await t,n(),t),b=u.computed(()=>({font:A,size:u.toValue(h),height:u.toValue(d),curveSegments:u.toValue(f),bevelEnabled:u.toValue(g),bevelThickness:u.toValue(p),bevelSize:u.toValue(_),bevelOffset:u.toValue(y),bevelSegments:u.toValue(x)}));return u.watchEffect(()=>{S.value&&c.value&&(S.value.geometry.dispose(),S.value.geometry=new Bs(O.value,b.value),s.value&&S.value.geometry.center())}),(P,w)=>u.unref(i)?(u.openBlock(),u.createElementBlock("TresMesh",{key:0,ref_key:"text3DRef",ref:S},[O.value?(u.openBlock(),u.createElementBlock("TresTextGeometry",{key:0,args:[O.value,b.value],center:u.unref(s)},null,8,Hl)):u.createCommentVNode("",!0),u.renderSlot(P.$slots,"default")],512)):u.createCommentVNode("",!0)}});function ec(o,e){const t=u.ref(e),n=new l.AnimationMixer(t.value),r=u.shallowReactive({});o.forEach(i=>{const a=n.clipAction(i,t.value);r[i.name]=a});const{onBeforeRender:s}=ee.useLoop();return s(({delta:i})=>{n.update(i)}),{actions:r,mixer:n}}function Ys(o){const e=u.ref(null),{height:t,width:n,settings:r,depth:s,autoRender:i=u.ref(!0)}=u.isReactive(o)?u.toRefs(o):u.toRefs(u.reactive(o)),{onBeforeRender:a}=ee.useLoop(),{camera:c,renderer:h,scene:d,sizes:f,invalidate:g}=ee.useTresContext();return u.watch(()=>[n==null?void 0:n.value,f.width.value,t==null?void 0:t.value,f.height.value],()=>{var p;(p=e.value)==null||p.dispose(),e.value=new l.WebGLRenderTarget((n==null?void 0:n.value)||f.width.value,(t==null?void 0:t.value)||f.height.value,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,type:l.HalfFloatType,...r==null?void 0:r.value}),s!=null&&s.value&&(e.value.depthTexture=new l.DepthTexture((n==null?void 0:n.value)||f.width.value,(t==null?void 0:t.value)||f.height.value,l.FloatType)),g()},{immediate:!0}),a(()=>{i.value&&(h.value.setRenderTarget(e.value),h.value.clear(),h.value.render(d.value,c.value),h.value.setRenderTarget(null))},Number.POSITIVE_INFINITY),u.onBeforeUnmount(()=>{var p;(p=e.value)==null||p.dispose()}),e}const tc=u.defineComponent({__name:"component",props:{width:{},height:{},depth:{type:Boolean,default:!1},settings:{default:void 0},autoRender:{type:Boolean,default:!0}},setup(o,{expose:e}){const n=Ys(o);return e({instance:n}),()=>{}}}),Ws=(o,e=16,t,n,r)=>{const s=new Float32Array(e*16),i=u.ref(new l.InterleavedBuffer(s,16));return(()=>{if(!o)return;const c=new il(o);n&&c.setWeightAttribute(n),c.build();const h=new l.Vector3,d=new l.Vector3,f=new l.Color,g=new l.Object3D;o.updateMatrixWorld(!0);for(let p=0;p<e;p++)c.sample(h,d,f),typeof r=="function"?r({dummy:g,sampledMesh:o,position:h,normal:d,color:f},p):g.position.copy(h),g.updateMatrix(),t&&t.setMatrixAt(p,g.matrix),g.matrix.toArray(i.value.array,p*16);t&&(t.instanceMatrix.needsUpdate=!0),i.value.needsUpdate=!0})(),{buffer:i}},nc=u.defineComponent({__name:"component",props:{transform:{type:Function},weight:{},count:{},mesh:{},instanceMesh:{}},setup(o,{expose:e}){const t=o,n=u.ref(),r=u.ref(),s=u.ref(),{invalidate:i}=ee.useTresContext();return u.watch(t,()=>i()),u.watchEffect(()=>{var a,c;r.value=t.instanceMesh??((a=n.value)==null?void 0:a.children.find(h=>Object.prototype.hasOwnProperty.call(h,"instanceMatrix"))),s.value=t.mesh??((c=n.value)==null?void 0:c.children.find(h=>h.type==="Mesh")),Ws(s.value,t.count,r.value,t.weight,t.transform)}),e({samplerRef:n}),(a,c)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"samplerRef",ref:n},[u.renderSlot(a.$slots,"default")],512))}}),Tn={sunset:"venice/venice_sunset_1k.hdr",studio:"studio/poly_haven_studio_1k.hdr",city:"city/canary_wharf_1k.hdr",umbrellas:"outdoor/outdoor_umbrellas_1k.hdr",night:"outdoor/satara_night_1k.hdr",forest:"outood/mossy_forest_1k.hdr",snow:"outdoor/snowy_forest_path_01_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",hangar:"indoor/small_hangar_01_1k.hdr",urban:"indoor/abandoned_games_room_02_1k.hdr",modern:"city/modern_buildings_2_1k.hdr",shangai:"city/shanghai_bund_1k.hdr"},rc="https://raw.githubusercontent.com/Tresjs/assets/main/textures/hdr/";async function Xs(o,e){const{scene:t,invalidate:n}=ee.useTresContext(),{preset:r,blur:s,files:i=u.ref([]),path:a=u.ref(""),background:c}=u.toRefs(o);u.watch(o,()=>{n()});const h=u.ref(null),d=u.computed(()=>Array.isArray(i.value)),f=u.computed(()=>d.value?l.CubeTextureLoader:Es);return u.watch([i,a],async([g,p])=>{if(g&&g.length>0&&!(r!=null&&r.value)){try{h.value=await ee.useLoader(f.value,d.value?[...u.unref(g)]:u.unref(g),_=>{p&&_.setPath(u.unref(p))})}catch(_){throw new Error(`Failed to load environment map: ${_}`)}h.value&&(h.value.mapping=d.value?l.CubeReflectionMapping:l.EquirectangularReflectionMapping)}},{immediate:!0}),u.watch(h,g=>{t.value&&g&&(t.value.environment=g)},{immediate:!0}),u.watch([c,h],([g,p])=>{if(t.value){const _=e!=null&&e.value?e.value.texture:p;_&&(t.value.background=g?_:null)}},{immediate:!0}),u.watch(()=>s==null?void 0:s.value,g=>{t.value&&g&&(t.value.backgroundBlurriness=g)},{immediate:!0}),u.watch(()=>r==null?void 0:r.value,async g=>{if(g&&g in Tn){const p=rc,_=Tn[g];try{h.value=await ee.useLoader(Es,_,y=>{p&&y.setPath(p)})}catch(y){throw new Error(`Failed to load environment map: ${y}`)}h.value&&h.value&&(h.value.mapping=l.EquirectangularReflectionMapping),n()}else if(g&&!(g in Tn))throw new Error(`Preset must be one of: ${Object.keys(Tn).join(", ")}`)},{immediate:!0}),h}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Le={LEFT:1,RIGHT:2,MIDDLE:4},H=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Vt={NONE:0,IN:1,OUT:-1};function Lt(o){return o.isPerspectiveCamera}function vt(o){return o.isOrthographicCamera}const Gt=Math.PI*2,Zs=Math.PI/2,Ks=1e-5,en=Math.PI/180;function tt(o,e,t){return Math.max(e,Math.min(t,o))}function Pe(o,e=Ks){return Math.abs(o)<e}function Se(o,e,t=Ks){return Pe(o-e,t)}function qs(o,e){return Math.round(o/e)*e}function tn(o){return isFinite(o)?o:o<0?-Number.MAX_VALUE:Number.MAX_VALUE}function nn(o){return Math.abs(o)<Number.MAX_VALUE?o:o*(1/0)}function In(o,e,t,n,r=1/0,s){n=Math.max(1e-4,n);const i=2/n,a=i*s,c=1/(1+a+.48*a*a+.235*a*a*a);let h=o-e;const d=e,f=r*n;h=tt(h,-f,f),e=o-h;const g=(t.value+i*h)*s;t.value=(t.value-i*g)*c;let p=e+(h+g)*c;return d-o>0==p>d&&(p=d,t.value=(p-d)/s),p}function Qs(o,e,t,n,r=1/0,s,i){n=Math.max(1e-4,n);const a=2/n,c=a*s,h=1/(1+c+.48*c*c+.235*c*c*c);let d=e.x,f=e.y,g=e.z,p=o.x-d,_=o.y-f,y=o.z-g;const x=d,m=f,M=g,v=r*n,C=v*v,O=p*p+_*_+y*y;if(O>C){const Y=Math.sqrt(O);p=p/Y*v,_=_/Y*v,y=y/Y*v}d=o.x-p,f=o.y-_,g=o.z-y;const S=(t.x+a*p)*s,A=(t.y+a*_)*s,b=(t.z+a*y)*s;t.x=(t.x-a*S)*h,t.y=(t.y-a*A)*h,t.z=(t.z-a*b)*h,i.x=d+(p+S)*h,i.y=f+(_+A)*h,i.z=g+(y+b)*h;const P=x-o.x,w=m-o.y,L=M-o.z,D=i.x-x,V=i.y-m,G=i.z-M;return P*D+w*V+L*G>0&&(i.x=x,i.y=m,i.z=M,t.x=(i.x-x)/s,t.y=(i.y-m)/s,t.z=(i.z-M)/s),i}function fr(o,e){e.set(0,0),o.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=o.length,e.y/=o.length}function dr(o,e){return vt(o)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class sc{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,i=r.length;s<i;s++)r[s].call(this,e)}}}var pr;const ic="2.9.0",On=1/8,oc=/Mac/.test((pr=globalThis==null?void 0:globalThis.navigator)===null||pr===void 0?void 0:pr.platform);let de,Js,Ln,mr,Ee,ye,be,Rt,rn,st,it,Dt,Hs,$s,Qe,sn,jt,ei,gr,ti,yr,_r,Dn;class Ue extends sc{static install(e){de=e.THREE,Js=Object.freeze(new de.Vector3(0,0,0)),Ln=Object.freeze(new de.Vector3(0,1,0)),mr=Object.freeze(new de.Vector3(0,0,1)),Ee=new de.Vector2,ye=new de.Vector3,be=new de.Vector3,Rt=new de.Vector3,rn=new de.Vector3,st=new de.Vector3,it=new de.Vector3,Dt=new de.Vector3,Hs=new de.Vector3,$s=new de.Vector3,Qe=new de.Spherical,sn=new de.Spherical,jt=new de.Box3,ei=new de.Box3,gr=new de.Sphere,ti=new de.Quaternion,yr=new de.Quaternion,_r=new de.Matrix4,Dn=new de.Raycaster}static get ACTION(){return H}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=H.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Vt.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new de.Vector3,this._focalOffsetVelocity=new de.Vector3,this._zoomVelocity={value:0},this._truckInternal=(m,M,v)=>{let C,O;if(Lt(this._camera)){const S=ye.copy(this._camera.position).sub(this._target),A=this._camera.getEffectiveFOV()*en,b=S.length()*Math.tan(A*.5);C=this.truckSpeed*m*b/this._elementRect.height,O=this.truckSpeed*M*b/this._elementRect.height}else if(vt(this._camera)){const S=this._camera;C=m*(S.right-S.left)/S.zoom/this._elementRect.width,O=M*(S.top-S.bottom)/S.zoom/this._elementRect.height}else return;this.verticalDragToForward?(v?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(C,0,!0),this.forward(-O,!0)):v?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y+O,this._focalOffsetEnd.z,!0):this.truck(C,O,!0)},this._rotateInternal=(m,M)=>{const v=Gt*this.azimuthRotateSpeed*m/this._elementRect.height,C=Gt*this.polarRotateSpeed*M/this._elementRect.height;this.rotate(v,C,!0)},this._dollyInternal=(m,M,v)=>{const C=Math.pow(.95,-m*this.dollySpeed),O=this._sphericalEnd.radius,S=this._sphericalEnd.radius*C,A=tt(S,this.minDistance,this.maxDistance),b=A-S;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(S,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(b,!0),this._dollyToNoClamp(A,!0)):this._dollyToNoClamp(A,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?S:A)-O,this._dollyControlCoord.set(M,v)),this._lastDollyDirection=Math.sign(-m)},this._zoomInternal=(m,M,v)=>{const C=Math.pow(.95,m*this.dollySpeed),O=this._zoom,S=this._zoom*C;this.zoomTo(S,!0),this.dollyToCursor&&(this._changedZoom+=S-O,this._dollyControlCoord.set(M,v))},typeof de>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new de.Quaternion().setFromUnitVectors(this._camera.up,Ln),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=H.NONE,this._target=new de.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new de.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new de.Spherical().setFromVector3(ye.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new de.Vector3,new de.Vector3,new de.Vector3,new de.Vector3],this._updateNearPlaneCorners(),this._boundary=new de.Box3(new de.Vector3(-1/0,-1/0,-1/0),new de.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new de.Vector2,this.mouseButtons={left:H.ROTATE,middle:H.DOLLY,right:H.TRUCK,wheel:Lt(this._camera)?H.DOLLY:vt(this._camera)?H.ZOOM:H.NONE},this.touches={one:H.TOUCH_ROTATE,two:Lt(this._camera)?H.TOUCH_DOLLY_TRUCK:vt(this._camera)?H.TOUCH_ZOOM_TRUCK:H.NONE,three:H.TOUCH_TRUCK};const n=new de.Vector2,r=new de.Vector2,s=new de.Vector2,i=m=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),O=m.clientX/C.width,S=m.clientY/C.height;if(O<this._interactiveArea.left||O>this._interactiveArea.right||S<this._interactiveArea.top||S>this._interactiveArea.bottom)return}const M=m.pointerType!=="mouse"?null:(m.buttons&Le.LEFT)===Le.LEFT?Le.LEFT:(m.buttons&Le.MIDDLE)===Le.MIDDLE?Le.MIDDLE:(m.buttons&Le.RIGHT)===Le.RIGHT?Le.RIGHT:null;if(M!==null){const C=this._findPointerByMouseButton(M);C&&this._disposePointer(C)}if((m.buttons&Le.LEFT)===Le.LEFT&&this._lockedPointer)return;const v={pointerId:m.pointerId,clientX:m.clientX,clientY:m.clientY,deltaX:0,deltaY:0,mouseButton:M};this._activePointers.push(v),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,g(m)},a=m=>{m.cancelable&&m.preventDefault();const M=m.pointerId,v=this._lockedPointer||this._findPointerById(M);if(v){if(v.clientX=m.clientX,v.clientY=m.clientY,v.deltaX=m.movementX,v.deltaY=m.movementY,this._state=0,m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(m.buttons&Le.LEFT)===Le.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(m.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(m.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);p()}},c=m=>{const M=this._findPointerById(m.pointerId);if(!(M&&M===this._lockedPointer)){if(M&&this._disposePointer(M),m.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=H.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=H.NONE;_()}};let h=-1;const d=m=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===H.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const S=this._domElement.getBoundingClientRect(),A=m.clientX/S.width,b=m.clientY/S.height;if(A<this._interactiveArea.left||A>this._interactiveArea.right||b<this._interactiveArea.top||b>this._interactiveArea.bottom)return}if(m.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===H.ROTATE||this.mouseButtons.wheel===H.TRUCK){const S=performance.now();h-S<1e3&&this._getClientRect(this._elementRect),h=S}const M=oc?-1:-3,v=m.deltaMode===1?m.deltaY/M:m.deltaY/(M*10),C=this.dollyToCursor?(m.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(m.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case H.ROTATE:{this._rotateInternal(m.deltaX,m.deltaY),this._isUserControllingRotate=!0;break}case H.TRUCK:{this._truckInternal(m.deltaX,m.deltaY,!1),this._isUserControllingTruck=!0;break}case H.OFFSET:{this._truckInternal(m.deltaX,m.deltaY,!0),this._isUserControllingOffset=!0;break}case H.DOLLY:{this._dollyInternal(-v,C,O),this._isUserControllingDolly=!0;break}case H.ZOOM:{this._zoomInternal(-v,C,O),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},f=m=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Ue.ACTION.NONE){const M=m instanceof PointerEvent?m.pointerId:0,v=this._findPointerById(M);v&&this._disposePointer(v),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}m.preventDefault()}},g=m=>{if(!this._enabled)return;if(fr(this._activePointers,Ee),this._getClientRect(this._elementRect),n.copy(Ee),r.copy(Ee),this._activePointers.length>=2){const v=Ee.x-this._activePointers[1].clientX,C=Ee.y-this._activePointers[1].clientY,O=Math.sqrt(v*v+C*C);s.set(0,O);const S=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,A=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(S,A)}if(this._state=0,!m)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in m&&m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(m.buttons&Le.LEFT)===Le.LEFT&&(this._state=this._state|this.mouseButtons.left),(m.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(m.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&H.ROTATE)===H.ROTATE||(this._state&H.TOUCH_ROTATE)===H.TOUCH_ROTATE||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&H.TRUCK)===H.TRUCK||(this._state&H.TOUCH_TRUCK)===H.TOUCH_TRUCK||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&H.DOLLY)===H.DOLLY||(this._state&H.TOUCH_DOLLY)===H.TOUCH_DOLLY||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&H.ZOOM)===H.ZOOM||(this._state&H.TOUCH_ZOOM)===H.TOUCH_ZOOM||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&H.OFFSET)===H.OFFSET||(this._state&H.TOUCH_OFFSET)===H.TOUCH_OFFSET||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,fr(this._activePointers,Ee);const M=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,v=M?-M.deltaX:r.x-Ee.x,C=M?-M.deltaY:r.y-Ee.y;if(r.copy(Ee),((this._state&H.ROTATE)===H.ROTATE||(this._state&H.TOUCH_ROTATE)===H.TOUCH_ROTATE||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(v,C),this._isUserControllingRotate=!0),(this._state&H.DOLLY)===H.DOLLY||(this._state&H.ZOOM)===H.ZOOM){const O=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,A=this.dollyDragInverted?-1:1;(this._state&H.DOLLY)===H.DOLLY?(this._dollyInternal(A*C*On,O,S),this._isUserControllingDolly=!0):(this._zoomInternal(A*C*On,O,S),this._isUserControllingZoom=!0)}if((this._state&H.TOUCH_DOLLY)===H.TOUCH_DOLLY||(this._state&H.TOUCH_ZOOM)===H.TOUCH_ZOOM||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_ZOOM_ROTATE)===H.TOUCH_ZOOM_ROTATE){const O=Ee.x-this._activePointers[1].clientX,S=Ee.y-this._activePointers[1].clientY,A=Math.sqrt(O*O+S*S),b=s.y-A;s.set(0,A);const P=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&H.TOUCH_DOLLY)===H.TOUCH_DOLLY||(this._state&H.TOUCH_DOLLY_ROTATE)===H.TOUCH_DOLLY_ROTATE||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET?(this._dollyInternal(b*On,P,w),this._isUserControllingDolly=!0):(this._zoomInternal(b*On,P,w),this._isUserControllingZoom=!0)}((this._state&H.TRUCK)===H.TRUCK||(this._state&H.TOUCH_TRUCK)===H.TOUCH_TRUCK||(this._state&H.TOUCH_DOLLY_TRUCK)===H.TOUCH_DOLLY_TRUCK||(this._state&H.TOUCH_ZOOM_TRUCK)===H.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(v,C,!1),this._isUserControllingTruck=!0),((this._state&H.OFFSET)===H.OFFSET||(this._state&H.TOUCH_OFFSET)===H.TOUCH_OFFSET||(this._state&H.TOUCH_DOLLY_OFFSET)===H.TOUCH_DOLLY_OFFSET||(this._state&H.TOUCH_ZOOM_OFFSET)===H.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(v,C,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{fr(this._activePointers,Ee),r.copy(Ee),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",y),this._domElement.ownerDocument.addEventListener("pointerlockerror",x),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),g())},this.unlockPointer=()=>{var m,M,v;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(m=this._domElement)===null||m===void 0||m.ownerDocument.exitPointerLock(),(M=this._domElement)===null||M===void 0||M.ownerDocument.removeEventListener("pointerlockchange",y),(v=this._domElement)===null||v===void 0||v.ownerDocument.removeEventListener("pointerlockerror",x),this.cancel()};const y=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},x=()=>{this.unlockPointer()};this._addAllEventListeners=m=>{this._domElement=m,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",i),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",d,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",i),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",d,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement.ownerDocument.removeEventListener("pointerlockerror",x))},this.cancel=()=>{this._state!==H.NONE&&(this._state=H.NONE,this._activePointers.length=0,_())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=tt(e.width,0,1),this._interactiveArea.height=tt(e.height,0,1),this._interactiveArea.x=tt(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=tt(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=tt(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=tt(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const i=!n||Se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(i)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Vt.NONE,this._changedDolly=0,this._dollyToNoClamp(tt(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const i=this._collisionTest(),a=Se(i,this._spherical.radius);if(!(n>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,i)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(rn).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=tt(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Se(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),st.setFromMatrixColumn(this._camera.matrix,0),it.setFromMatrixColumn(this._camera.matrix,1),st.multiplyScalar(e),it.multiplyScalar(-t);const r=ye.copy(st).add(it),s=be.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,n)}forward(e,t=!1){ye.setFromMatrixColumn(this._camera.matrix,0),ye.crossVectors(this._camera.up,ye),ye.multiplyScalar(e);const n=be.copy(this._targetEnd).add(ye);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return ye.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ye.x,this._targetEnd.y+ye.y,this._targetEnd.z+ye.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const s=ye.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const i=!r||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}lookInDirectionOf(e,t,n,r=!1){const a=ye.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:i=0,paddingTop:a=0}={}){const c=[],h=e.isBox3?jt.copy(e):jt.setFromObject(e);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const d=qs(this._sphericalEnd.theta,Zs),f=qs(this._sphericalEnd.phi,Zs);c.push(this.rotateTo(d,f,t));const g=ye.setFromSpherical(this._sphericalEnd).normalize(),p=ti.setFromUnitVectors(g,mr),_=Se(Math.abs(g.y),1);_&&p.multiply(yr.setFromAxisAngle(Ln,d)),p.multiply(this._yAxisUpSpaceInverse);const y=ei.makeEmpty();be.copy(h.min).applyQuaternion(p),y.expandByPoint(be),be.copy(h.min).setX(h.max.x).applyQuaternion(p),y.expandByPoint(be),be.copy(h.min).setY(h.max.y).applyQuaternion(p),y.expandByPoint(be),be.copy(h.max).setZ(h.min.z).applyQuaternion(p),y.expandByPoint(be),be.copy(h.min).setZ(h.max.z).applyQuaternion(p),y.expandByPoint(be),be.copy(h.max).setY(h.min.y).applyQuaternion(p),y.expandByPoint(be),be.copy(h.max).setX(h.min.x).applyQuaternion(p),y.expandByPoint(be),be.copy(h.max).applyQuaternion(p),y.expandByPoint(be),y.min.x-=r,y.min.y-=i,y.max.x+=s,y.max.y+=a,p.setFromUnitVectors(mr,g),_&&p.premultiply(yr.invert()),p.premultiply(this._yAxisUpSpace);const x=y.getSize(ye),m=y.getCenter(be).applyQuaternion(p);if(Lt(this._camera)){const M=this.getDistanceToFitBox(x.x,x.y,x.z,n);c.push(this.moveTo(m.x,m.y,m.z,t)),c.push(this.dollyTo(M,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(vt(this._camera)){const M=this._camera,v=M.right-M.left,C=M.top-M.bottom,O=n?Math.max(v/x.x,C/x.y):Math.min(v/x.x,C/x.y);c.push(this.moveTo(m.x,m.y,m.z,t)),c.push(this.zoomTo(O,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const n=[],s="isObject3D"in e?Ue.createBoundingSphere(e,gr):gr.copy(e);if(n.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),Lt(this._camera)){const i=this.getDistanceToFitSphere(s.radius);n.push(this.dollyTo(i,t))}else if(vt(this._camera)){const i=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*s.radius,h=Math.min(i/c,a/c);n.push(this.zoomTo(h,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,s,i,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Vt.NONE,this._changedDolly=0;const c=be.set(r,s,i),h=ye.set(e,t,n);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(h.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const d=!a||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold)&&Se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(d)}lerpLookAt(e,t,n,r,s,i,a,c,h,d,f,g,p,_=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Vt.NONE,this._changedDolly=0;const y=ye.set(r,s,i),x=be.set(e,t,n);Qe.setFromVector3(x.sub(y).applyQuaternion(this._yAxisUpSpace));const m=Rt.set(d,f,g),M=be.set(a,c,h);sn.setFromVector3(M.sub(m).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(y.lerp(m,p));const v=sn.theta-Qe.theta,C=sn.phi-Qe.phi,O=sn.radius-Qe.radius;this._sphericalEnd.set(Qe.radius+O*p,Qe.phi+C*p,Qe.theta+v*p),this.normalizeRotations(),this._needsUpdate=!0,_||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const S=!_||Se(this._target.x,this._targetEnd.x,this.restThreshold)&&Se(this._target.y,this._targetEnd.y,this.restThreshold)&&Se(this._target.z,this._targetEnd.z,this.restThreshold)&&Se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const s=this.getPosition(ye),i=this.setLookAt(s.x,s.y,s.z,e,t,n,r);return this._sphericalEnd.phi=tt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),i}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||Se(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Se(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Se(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),st.setFromMatrixColumn(this._camera.matrixWorldInverse,0),it.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Dt.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=ye.set(e,t,n),s=r.distanceTo(this._camera.position),i=r.sub(this._camera.position);st.multiplyScalar(i.x),it.multiplyScalar(i.y),Dt.multiplyScalar(i.z),ye.copy(st).add(it).add(Dt),ye.z=ye.z+s,this.dollyTo(s,!1),this.setFocalOffset(-ye.x,ye.y,-ye.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new de.Vector4,typeof e=="number"?this._viewport.set(e,t,n,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,r=!1){if(dr(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,i=this._camera.getEffectiveFOV()*en,a=this._camera.aspect;return((r?s>a:s<a)?t:e/a)*.5/Math.tan(i*.5)+n*.5}getDistanceToFitSphere(e){if(dr(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*en,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:n;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new de.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new de.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new de.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new de.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Gt,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Gt),this._spherical.theta+=Gt*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Gt)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Se(this._camera.up.x,this._cameraUp0.x)||!Se(this._camera.up.y,this._cameraUp0.y)||!Se(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ye);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ln),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ye.subVectors(this._target,this._camera.position).normalize(),t=be.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ye);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=Hs.subVectors(this._targetEnd,this._target),i=$s.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(Pe(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const f=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=In(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,f,1/0,e),this._needsUpdate=!0}if(Pe(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const f=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=In(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,f,1/0,e),this._needsUpdate=!0}if(Pe(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const f=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=In(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,f,this.maxSpeed,e),this._needsUpdate=!0}if(Pe(s.x)&&Pe(s.y)&&Pe(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const f=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Qs(this._target,this._targetEnd,this._targetVelocity,f,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Pe(i.x)&&Pe(i.y)&&Pe(i.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const f=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Qs(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,f,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Pe(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const f=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=In(this._zoom,this._zoomEnd,this._zoomVelocity,f,1/0,e)}if(this.dollyToCursor){if(Lt(this._camera)&&this._changedDolly!==0){const f=this._spherical.radius-this._lastDistance,g=this._camera,p=this._getCameraDirection(rn),_=ye.copy(p).cross(g.up).normalize();_.lengthSq()===0&&(_.x=1);const y=be.crossVectors(_,p),x=this._sphericalEnd.radius*Math.tan(g.getEffectiveFOV()*en*.5),M=(this._sphericalEnd.radius-f-this._sphericalEnd.radius)/this._sphericalEnd.radius,v=Rt.copy(this._targetEnd).add(_.multiplyScalar(this._dollyControlCoord.x*x*g.aspect)).add(y.multiplyScalar(this._dollyControlCoord.y*x)),C=ye.copy(this._targetEnd).lerp(v,M),O=this._lastDollyDirection===Vt.IN&&this._spherical.radius<=this.minDistance,S=this._lastDollyDirection===Vt.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(O||S)){this._sphericalEnd.radius-=f,this._spherical.radius-=f;const b=be.copy(p).multiplyScalar(-f);C.add(b)}this._boundary.clampPoint(C,C);const A=be.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(A),this._changedDolly-=f,Pe(this._changedDolly)&&(this._changedDolly=0)}else if(vt(this._camera)&&this._changedZoom!==0){const f=this._zoom-this._lastZoom,g=this._camera,p=ye.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(g.near+g.far)/(g.near-g.far)).unproject(g),_=be.set(0,0,-1).applyQuaternion(g.quaternion),y=Rt.copy(p).add(_.multiplyScalar(-p.dot(g.up))),m=-(this._zoom-f-this._zoom)/this._zoom,M=this._getCameraDirection(rn),v=this._targetEnd.dot(M),C=ye.copy(this._targetEnd).lerp(y,m),O=C.dot(M),S=M.multiplyScalar(O-v);C.sub(S),this._boundary.clampPoint(C,C);const A=be.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(A),this._changedZoom-=f,Pe(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Pe(this._focalOffset.x)||!Pe(this._focalOffset.y)||!Pe(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),st.setFromMatrixColumn(this._camera.matrix,0),it.setFromMatrixColumn(this._camera.matrix,1),Dt.setFromMatrixColumn(this._camera.matrix,2),st.multiplyScalar(this._focalOffset.x),it.multiplyScalar(-this._focalOffset.y),Dt.multiplyScalar(this._focalOffset.z),ye.copy(st).add(it).add(Dt),this._camera.position.add(ye)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ye.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const d=this._needsUpdate;return d&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):d?(this.dispatchEvent({type:"update"}),Pe(t,this.restThreshold)&&Pe(n,this.restThreshold)&&Pe(r,this.restThreshold)&&Pe(s.x,this.restThreshold)&&Pe(s.y,this.restThreshold)&&Pe(s.z,this.restThreshold)&&Pe(i.x,this.restThreshold)&&Pe(i.y,this.restThreshold)&&Pe(i.z,this.restThreshold)&&Pe(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!d&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=d,this._needsUpdate=!1,d}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:tn(this.maxDistance),minZoom:this.minZoom,maxZoom:tn(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:tn(this.maxPolarAngle),minAzimuthAngle:tn(this.minAzimuthAngle),maxAzimuthAngle:tn(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ye.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=nn(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=nn(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=nn(n.maxPolarAngle),this.minAzimuthAngle=nn(n.minAzimuthAngle),this.maxAzimuthAngle=nn(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),Qe.setFromVector3(ye.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Qe.theta,Qe.phi,t),this.dollyTo(Qe.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",ic),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(r===0)return e;const s=be.copy(t).add(e),a=this._boundary.clampPoint(s,Rt).sub(s),c=a.lengthSq();if(c===0)return e.add(t);if(c===r)return e;if(n===0)return e.add(t).add(a);{const h=1+n*c/t.dot(a);return e.add(be.copy(t).multiplyScalar(h)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Lt(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*en,r=Math.tan(n*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(vt(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,s=e.top*t,i=e.bottom*t;this._nearPlaneCorners[0].set(n,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(n,i,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||dr(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(rn);_r.lookAt(Js,n,this._camera.up);for(let r=0;r<4;r++){const s=be.copy(this._nearPlaneCorners[r]);s.applyMatrix4(_r);const i=Rt.addVectors(this._target,s);Dn.set(i,n),Dn.far=this._spherical.radius+1;const a=Dn.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new de.Sphere){const n=t,r=n.center;jt.makeEmpty(),e.traverseVisible(i=>{i.isMesh&&jt.expandByObject(i)}),jt.getCenter(r);let s=0;return e.traverseVisible(i=>{if(!i.isMesh)return;const a=i,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const d=c.attributes.position;for(let f=0,g=d.count;f<g;f++)ye.fromBufferAttribute(d,f),s=Math.max(s,r.distanceToSquared(ye))}),n.radius=Math.sqrt(s),n}}const ni=o=>!!(o&&o.isPerspectiveCamera),ri=o=>!!(o&&o.isOrthographicCamera),ac=["min-polar-angle","max-polar-angle","min-azimuth-angle","max-azimuth-angle","distance","min-distance","max-distance","infinity-dolly","min-zoom","max-zoom","smooth-time","dragging-smooth-time","max-speed","azimuth-rotate-speed","polar-rotate-speed","dolly-speed","dolly-drag-inverted","truck-speed","dolly-to-cursor","drag-to-offset","vertical-drag-to-forward","boundary-friction","rest-threshold","collider-meshes","args","mouse-buttons","touches"],si=(o,e)=>({left:Ue.ACTION.ROTATE,middle:Ue.ACTION.DOLLY,right:Ue.ACTION.TRUCK,wheel:ni(o)?Ue.ACTION.DOLLY:ri(o)?Ue.ACTION.ZOOM:Ue.ACTION.NONE,...e}),ii=(o,e)=>({one:Ue.ACTION.TOUCH_ROTATE,two:ni(o)?Ue.ACTION.TOUCH_DOLLY_TRUCK:ri(o)?Ue.ACTION.TOUCH_ZOOM_TRUCK:Ue.ACTION.NONE,three:Ue.ACTION.TOUCH_TRUCK,...e}),lc=u.defineComponent({__name:"CameraControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},minPolarAngle:{default:0},maxPolarAngle:{default:Math.PI},minAzimuthAngle:{default:Number.NEGATIVE_INFINITY},maxAzimuthAngle:{default:Number.POSITIVE_INFINITY},distance:{default:()=>ee.useTresContext().camera.value.position.z},minDistance:{default:Number.EPSILON},maxDistance:{default:Number.POSITIVE_INFINITY},infinityDolly:{type:Boolean,default:!1},minZoom:{default:.01},maxZoom:{default:Number.POSITIVE_INFINITY},smoothTime:{default:.25},draggingSmoothTime:{default:.125},maxSpeed:{default:Number.POSITIVE_INFINITY},azimuthRotateSpeed:{default:1},polarRotateSpeed:{default:1},dollySpeed:{default:1},dollyDragInverted:{type:Boolean,default:!1},truckSpeed:{default:2},dollyToCursor:{type:Boolean,default:!1},dragToOffset:{type:Boolean,default:!1},verticalDragToForward:{type:Boolean,default:!1},boundaryFriction:{default:0},restThreshold:{default:.01},colliderMeshes:{default:()=>[]},mouseButtons:{default:()=>si(ee.useTresContext().camera.value)},touches:{default:()=>ii(ee.useTresContext().camera.value)}},emits:["change","start","end"],setup(o,{expose:e,emit:t}){const n=o,r=t,{makeDefault:s,minPolarAngle:i,maxPolarAngle:a,minAzimuthAngle:c,maxAzimuthAngle:h,distance:d,minDistance:f,maxDistance:g,infinityDolly:p,minZoom:_,maxZoom:y,smoothTime:x,draggingSmoothTime:m,maxSpeed:M,azimuthRotateSpeed:v,polarRotateSpeed:C,dollySpeed:O,dollyDragInverted:S,truckSpeed:A,dollyToCursor:b,dragToOffset:P,verticalDragToForward:w,boundaryFriction:L,restThreshold:D,colliderMeshes:V}=u.toRefs(n),G={Box3:l.Box3,MathUtils:{clamp:l.MathUtils.clamp},Matrix4:l.Matrix4,Quaternion:l.Quaternion,Raycaster:l.Raycaster,Sphere:l.Sphere,Spherical:l.Spherical,Vector2:l.Vector2,Vector3:l.Vector3,Vector4:l.Vector4};Ue.install({THREE:G});const{camera:Y,renderer:W,extend:$,controls:q,invalidate:ne}=ee.useTresContext();u.watch(n,()=>{ne()});const te=u.computed(()=>si(n.camera||Y.value,n.mouseButtons)),ce=u.computed(()=>ii(n.camera||Y.value,n.touches)),le=u.ref(null);$({CameraControls:Ue}),u.watchEffect(()=>{me(),le.value&&s.value?q.value=le.value:q.value=null});function me(){Ce(le.value,"update",()=>{r("change",le.value),ne()}),Ce(le.value,"controlend",()=>r("end",le.value)),Ce(le.value,"controlstart",()=>r("start",le.value))}const{onBeforeRender:B}=ee.useLoop();return B(({delta:z,invalidate:F})=>{var k,R;(k=le.value)!=null&&k.enabled&&((R=le.value)==null||R.update(z),F())}),u.onUnmounted(()=>{le.value&&le.value.disconnect()}),e({instance:le}),(z,F)=>(z.camera||u.unref(Y))&&(z.domElement||u.unref(W))?(u.openBlock(),u.createElementBlock("TresCameraControls",{key:0,ref_key:"controlsRef",ref:le,"min-polar-angle":u.unref(i),"max-polar-angle":u.unref(a),"min-azimuth-angle":u.unref(c),"max-azimuth-angle":u.unref(h),distance:u.unref(d),"min-distance":u.unref(f),"max-distance":u.unref(g),"infinity-dolly":u.unref(p),"min-zoom":u.unref(_),"max-zoom":u.unref(y),"smooth-time":u.unref(x),"dragging-smooth-time":u.unref(m),"max-speed":u.unref(M),"azimuth-rotate-speed":u.unref(v),"polar-rotate-speed":u.unref(C),"dolly-speed":u.unref(O),"dolly-drag-inverted":u.unref(S),"truck-speed":u.unref(A),"dolly-to-cursor":u.unref(b),"drag-to-offset":u.unref(P),"vertical-drag-to-forward":u.unref(w),"boundary-friction":u.unref(L),"rest-threshold":u.unref(D),"collider-meshes":u.unref(V),args:[z.camera||u.unref(Y),z.domElement||u.unref(W).domElement],"mouse-buttons":te.value,touches:ce.value},null,8,ac)):u.createCommentVNode("",!0)}}),cc=u.defineComponent({__name:"KeyboardControls",props:{makeDefault:{type:Boolean,default:!0},camera:{},domElement:{},moveSpeed:{default:.2},selector:{}},emits:["isLock","change"],setup(o,{expose:e,emit:t}){const n=o,r=t,{moveSpeed:s}=u.toRefs(n),{camera:i,controls:a,renderer:c,invalidate:h}=ee.useTresContext();u.watch(n,()=>{h()});const d=u.ref(0),f=u.ref(0),{w:g,s:p,a:_,d:y,Up:x,Down:m,Left:M,Right:v}=jo();u.watchEffect(()=>{_.value||M.value?d.value=-s.value:y.value||v.value?d.value=s.value:d.value=0,g.value||x.value?f.value=s.value:p.value||m.value?f.value=-s.value:f.value=0}),e({instance:a});const C=L=>r("isLock",L),O=L=>r("change",L),S=new l.Vector3,A=new l.Vector3,b=new l.Quaternion,P=(L,D)=>{var Y;if(!((Y=i.value)!=null&&Y.position)&&!S)return;const V=i.value,G=L*.001;V==null||V.translateZ(-D),b.set(A.x*G,A.y*G,A.z*G,1).normalize(),V==null||V.quaternion.multiply(b),(d.value||f.value)&&r("change",a.value)},{onBeforeRender:w}=ee.useLoop();return w(({delta:L,invalidate:D})=>{var V;a.value instanceof Ts&&((V=a.value)!=null&&V.isLocked)&&(P(L,f.value),a.value.moveRight(d.value),D())}),(L,D)=>(u.openBlock(),u.createBlock(u.unref(oi),{selector:L.selector,"make-default":L.makeDefault,camera:L.camera||u.unref(i),"dom-element":L.domElement||u.unref(c).domElement,onIsLock:C,onChange:O},null,8,["selector","make-default","camera","dom-element"]))}}),uc=["args","auto-rotate","auto-rotate-speed","enable-damping","damping-factor","enable-pan","key-pan-speed","keys","max-azimuth-angle","min-azimuth-angle","max-polar-angle","min-polar-angle","min-distance","max-distance","min-zoom","max-zoom","enable-zoom","zoom-speed","enable-rotate","rotate-speed"],hc=u.defineComponent({__name:"MapControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},target:{},enableDamping:{type:Boolean,default:!0},dampingFactor:{default:.05},autoRotate:{type:Boolean,default:!1},autoRotateSpeed:{default:2},enablePan:{type:Boolean,default:!0},keyPanSpeed:{default:7},keys:{},maxAzimuthAngle:{default:Number.POSITIVE_INFINITY},minAzimuthAngle:{default:Number.NEGATIVE_INFINITY},maxPolarAngle:{default:Math.PI},minPolarAngle:{default:0},minDistance:{default:0},maxDistance:{default:Number.POSITIVE_INFINITY},minZoom:{default:0},maxZoom:{default:Number.POSITIVE_INFINITY},touches:{},enableZoom:{type:Boolean,default:!0},zoomSpeed:{default:1},enableRotate:{type:Boolean,default:!0},rotateSpeed:{default:1}},emits:["change","start","end"],setup(o,{expose:e,emit:t}){const n=o,{autoRotate:r,autoRotateSpeed:s,enableDamping:i,dampingFactor:a,enablePan:c,keyPanSpeed:h,maxAzimuthAngle:d,minAzimuthAngle:f,maxPolarAngle:g,minPolarAngle:p,minDistance:_,maxDistance:y,minZoom:x,maxZoom:m,enableZoom:M,zoomSpeed:v,enableRotate:C,rotateSpeed:O}=u.toRefs(n),{camera:S,renderer:A,extend:b,controls:P,invalidate:w}=ee.useTresContext();u.watch(n,()=>{w()});const L=u.ref(null);b({MapControls:xl}),u.watch(P,V=>{V&&n.makeDefault?P.value=V:P.value=null});const{onBeforeRender:D}=ee.useLoop();return D(({invalidate:V})=>{L.value&&(i.value||r.value)&&(L.value.update(),V())}),u.onUnmounted(()=>{L.value&&L.value.dispose()}),e({instance:L}),(V,G)=>(V.camera||u.unref(S))&&(V.domElement||u.unref(A))?(u.openBlock(),u.createElementBlock("TresMapControls",{key:0,ref_key:"controlsRef",ref:L,args:[V.camera||u.unref(S),V.domElement||u.unref(A).domElement],"auto-rotate":u.unref(r),"auto-rotate-speed":u.unref(s),"enable-damping":u.unref(i),"damping-factor":u.unref(a),"enable-pan":u.unref(c),"key-pan-speed":u.unref(h),keys:V.keys,"max-azimuth-angle":u.unref(d),"min-azimuth-angle":u.unref(f),"max-polar-angle":u.unref(g),"min-polar-angle":u.unref(p),"min-distance":u.unref(_),"max-distance":u.unref(y),"min-zoom":u.unref(x),"max-zoom":u.unref(m),"enable-zoom":u.unref(M),"zoom-speed":u.unref(v),"enable-rotate":u.unref(C),"rotate-speed":u.unref(O)},null,8,uc)):u.createCommentVNode("",!0)}}),fc=["target","auto-rotate","auto-rotate-speed","enable-damping","damping-factor","enable-pan","key-pan-speed","keys","max-azimuth-angle","min-azimuth-angle","max-polar-angle","min-polar-angle","min-distance","max-distance","min-zoom","max-zoom","touches","enable-zoom","zoom-speed","enable-rotate","rotate-speed","args"],dc=u.defineComponent({__name:"OrbitControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},target:{default:()=>[0,0,0]},enableDamping:{type:Boolean,default:!0},dampingFactor:{default:.05},autoRotate:{type:Boolean,default:!1},autoRotateSpeed:{default:2},enablePan:{type:Boolean,default:!0},keyPanSpeed:{default:7},keys:{},maxAzimuthAngle:{default:Number.POSITIVE_INFINITY},minAzimuthAngle:{default:Number.NEGATIVE_INFINITY},maxPolarAngle:{default:Math.PI},minPolarAngle:{default:0},minDistance:{default:0},maxDistance:{default:Number.POSITIVE_INFINITY},minZoom:{default:0},maxZoom:{default:Number.POSITIVE_INFINITY},touches:{default:()=>({ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN})},enableZoom:{type:Boolean,default:!0},zoomSpeed:{default:1},enableRotate:{type:Boolean,default:!0},rotateSpeed:{default:1}},emits:["change","start","end"],setup(o,{expose:e,emit:t}){const n=o,r=t,{makeDefault:s,autoRotate:i,autoRotateSpeed:a,enableDamping:c,dampingFactor:h,enablePan:d,keyPanSpeed:f,maxAzimuthAngle:g,minAzimuthAngle:p,maxPolarAngle:_,minPolarAngle:y,minDistance:x,maxDistance:m,minZoom:M,maxZoom:v,enableZoom:C,zoomSpeed:O,enableRotate:S,touches:A,rotateSpeed:b,target:P}=u.toRefs(n),{camera:w,renderer:L,extend:D,controls:V,invalidate:G}=ee.useTresContext(),Y=u.ref(null);D({OrbitControls:Ls}),u.watch(Y,q=>{W(),q&&s.value?V.value=q:V.value=null});function W(){Ce(Y.value,"change",()=>{r("change",Y.value),G()}),Ce(Y.value,"start",()=>r("start",Y.value)),Ce(Y.value,"end",()=>r("end",Y.value))}const{onBeforeRender:$}=ee.useLoop();return $(({invalidate:q})=>{Y.value&&(c.value||i.value)&&(Y.value.update(),i.value&&q())}),u.onUnmounted(()=>{Y.value&&Y.value.dispose()}),e({instance:Y}),(q,ne)=>(q.camera||u.unref(w))&&(q.domElement||u.unref(L))?(u.openBlock(),u.createElementBlock("TresOrbitControls",{key:0,ref_key:"controlsRef",ref:Y,target:u.unref(P),"auto-rotate":u.unref(i),"auto-rotate-speed":u.unref(a),"enable-damping":u.unref(c),"damping-factor":u.unref(h),"enable-pan":u.unref(d),"key-pan-speed":u.unref(f),keys:q.keys,"max-azimuth-angle":u.unref(g),"min-azimuth-angle":u.unref(p),"max-polar-angle":u.unref(_),"min-polar-angle":u.unref(y),"min-distance":u.unref(x),"max-distance":u.unref(m),"min-zoom":u.unref(M),"max-zoom":u.unref(v),touches:u.unref(A),"enable-zoom":u.unref(C),"zoom-speed":u.unref(O),"enable-rotate":u.unref(S),"rotate-speed":u.unref(b),args:[q.camera||u.unref(w),q.domElement||u.unref(L).domElement]},null,8,fc)):u.createCommentVNode("",!0)}}),pc=["args"],oi=u.defineComponent({__name:"PointerLockControls",props:{makeDefault:{type:Boolean,default:!1},camera:{},domElement:{},selector:{}},emits:["isLock","change"],setup(o,{expose:e,emit:t}){const n=o,r=t,{camera:s,renderer:i,extend:a,controls:c,invalidate:h}=ee.useTresContext();u.watch(n,()=>{h()});const d=u.ref(null);let f;a({PointerLockControls:Ts});const g=p=>{r("isLock",p)};return u.watch(d,p=>{p&&n.makeDefault?c.value=p:c.value=null,f=document.getElementById(n.selector||"")||i.value.domElement,Ce(c.value,"change",()=>{r("change",c.value),h()}),Ce(f,"click",()=>{var y,x,m;(y=d.value)==null||y.lock(),(x=d.value)==null||x.addEventListener("lock",()=>g(!0)),(m=d.value)==null||m.addEventListener("unlock",()=>g(!1)),h()})}),u.onUnmounted(()=>{var p,_;(p=c.value)==null||p.removeEventListener("lock",()=>g(!0)),(_=c.value)==null||_.removeEventListener("unlock",()=>g(!1)),d.value&&d.value.dispose()}),e({instance:c}),(p,_)=>(p.camera||u.unref(s))&&(p.domElement||u.unref(i))?(u.openBlock(),u.createElementBlock("TresPointerLockControls",{key:0,ref_key:"controlsRef",ref:d,args:[p.camera||u.unref(s),p.domElement||u.unref(i).domElement]},null,8,pc)):u.createCommentVNode("",!0)}}),mc=u.defineComponent({__name:"ScrollControls",props:{pages:{default:4},distance:{default:4},smoothScroll:{default:.1},horizontal:{type:Boolean,default:!1},htmlScroll:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{expose:e,emit:t}){const n=o,r=t,{logWarning:s}=ee.useLogger();n.smoothScroll<0&&s("SmoothControl must be greater than zero"),n.pages<0&&s("Pages must be greater than zero");const{camera:i,controls:a,renderer:c,invalidate:h}=ee.useTresContext();u.watch(n,()=>{h()});const d=u.shallowRef(),f=document.createElement("div"),{y:g}=Wo(),{x:p,y:_,isScrolling:y}=Go(f),{height:x,width:m}=$r();let M=0;const v=u.ref(!1),C=u.ref(0),O=u.ref(0),S=u.ref(0),A=n.horizontal?"x":"y",b=u.watch(i,w=>{if(v.value){b();return}M=n.horizontal?(w==null?void 0:w.position.x)||0:(w==null?void 0:w.position.y)||0,v.value=!0},{immediate:!0});u.watch(y,w=>{a.value&&(a.value.enabled=!w)},{immediate:!0}),u.watch(g,w=>{!y.value&&!n.htmlScroll||(O.value=w/x.value/(S.value/x.value-1),C.value=-1*O.value,r("update:modelValue",O.value))}),u.watch(_,w=>{O.value=w/x.value/(S.value/x.value),C.value=-1*O.value,r("update:modelValue",O.value)}),u.watch(p,w=>{O.value=w/m.value/(S.value/m.value-1),C.value=+O.value,r("update:modelValue",O.value)}),u.watch(c,w=>{var D,V;const L=w==null?void 0:w.domElement;if(n.htmlScroll&&(w!=null&&w.domElement))L!=null&&L.style.width&&(L!=null&&L.style.position)&&(L!=null&&L.style.top)&&(L!=null&&L.style.left)&&(L.style.width="100%",L.style.position="fixed",L.style.zIndex=" -99999",L.style.top="0",L.style.left="0"),S.value=document.body.scrollHeight;else{const G=document.createElement("div"),Y=document.createElement("div");f.style[n.horizontal?"overflowX":"overflowY"]="auto",f.style[n.horizontal?"overflowY":"overflowX"]="hidden",f.style.position="absolute",f.style.width="100%",f.style.height=" 100%",f.style.top="0",f.style.left="0",f.classList.add("scrollContainer"),G.style.position="sticky",G.style.top="0px",G.style.left="0px",G.style.width="100%",G.style.height="100%",G.style.overflow="hidden",f.appendChild(G),Y.style.height=n.horizontal?"100%":`${x.value*n.pages}px`,Y.style.width=n.horizontal?`${m.value*n.pages}px`:"100vw",Y.style.pointerEvents="none",L.style.position="fixed",L.style.zIndex="0",L!=null&&L.style.width&&(L.style.width="100%"),f.appendChild(Y),w!=null&&w.domElement.parentNode&&(w.domElement.parentNode.style.position="relative"),(V=(D=w==null?void 0:w.domElement)==null?void 0:D.parentNode)==null||V.appendChild(f),S.value=n.horizontal?m.value*n.pages:x.value*n.pages}},{immediate:!0});const{onBeforeRender:P}=ee.useLoop();return P(({invalidate:w})=>{var L;if((L=i.value)!=null&&L.position){const D=(C.value*n.distance-i.value.position[A]+M)*n.smoothScroll;i.value.position[A]+=D,d.value.children.length>0&&(d.value.position[A]+=D),w()}}),e({instance:d}),(w,L)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"wrapperRef",ref:d},[u.renderSlot(w.$slots,"default")],512))}}),gc=["object","args","mode","enabled","axis","translation-snap","rotation-snap","scale-snap","space","size","show-x","show-y","show-z"],yc=u.defineComponent({__name:"TransformControls",props:{object:{},camera:{},mode:{default:"translate"},enabled:{type:Boolean,default:!0},axis:{default:"XYZ"},translationSnap:{},rotationSnap:{},scaleSnap:{},space:{default:"world"},size:{default:1},showX:{type:Boolean,default:!0},showY:{type:Boolean,default:!0},showZ:{type:Boolean,default:!0}},emits:["dragging","change","mouseDown","mouseUp","objectChange"],setup(o,{expose:e,emit:t}){const n=o,r=t,{object:s,mode:i,enabled:a,axis:c,translationSnap:h,rotationSnap:d,scaleSnap:f,space:g,size:p,showX:_,showY:y,showZ:x}=u.toRefs(n),m=u.shallowRef(null),{controls:M,camera:v,renderer:C,extend:O,invalidate:S}=ee.useTresContext();u.watch([s,i,a,c,h,d,f,g,p,_,y,x],()=>{S()}),O({TransformControls:ll});const A=()=>{S(),r("change")},b=V=>{M.value&&(M.value.enabled=!V.value),S(),r("dragging",V.value)},P=()=>{S(),r("mouseDown")},w=()=>{S(),r("mouseDown")},L=()=>{S(),r("objectChange")};function D(){Ce(m.value,"change",A),Ce(m.value,"dragging-changed",b),Ce(m.value,"mouseDown",P),Ce(m.value,"mouseUp",w),Ce(m.value,"objectChange",L)}return u.watch(m,V=>{V&&D()}),u.onUnmounted(()=>{m.value&&m.value.dispose()}),e({instance:m}),(V,G)=>{var Y;return(V.camera||u.unref(v))&&u.unref(C)?(u.openBlock(),u.createElementBlock("TresTransformControls",{ref_key:"controlsRef",ref:m,key:(Y=V.camera||u.unref(v))==null?void 0:Y.uuid,object:u.unref(s),args:[V.camera||u.unref(v),u.unref(C).domElement],mode:u.unref(i),enabled:u.unref(a),axis:u.unref(c),"translation-snap":u.unref(h),"rotation-snap":u.unref(d),"scale-snap":u.unref(f),space:u.unref(g),size:u.unref(p),"show-x":u.unref(_),"show-y":u.unref(y),"show-z":u.unref(x),visible:!0},null,8,gc)):u.createCommentVNode("",!0)}}}),_c=["geometry","render-order"],xc=u.defineComponent({__name:"component",props:{src:{},skipStrokes:{type:Boolean,default:!1},skipFills:{type:Boolean,default:!1},fillMaterial:{},strokeMaterial:{},fillMeshProps:{},strokeMeshProps:{},depth:{default:"renderOrder"}},setup(o,{expose:e}){const t=o,{src:n,skipStrokes:r,skipFills:s,fillMaterial:i,strokeMaterial:a,fillMeshProps:c,strokeMeshProps:h,depth:d}=u.toRefs(t),f=u.shallowRef(),g=u.shallowRef([]),p=u.shallowRef([]);e({instance:f}),u.watchEffect(async()=>_(n.value).then(m=>p.value=m.paths)),u.watch([s,r,i,a,p],x);async function _(m){const M=m.startsWith("<svg")?encodeURI(`data:image/svg+xml;utf8,${m}`):m;return ee.useLoader($t,M)}u.onUnmounted(y);function y(){g.value.forEach(m=>m.geometry.dispose())}function x(){var O,S,A;y();const m=[],[M,v]=(()=>{const b={flat:!1,renderOrder:!1,offsetZ:!0},P={flat:0,renderOrder:0,offsetZ:.025},w=d.value;return typeof w=="number"?[!0,w]:[b[w],P[w]]})();let C=0;for(const b of p.value){const P=((O=b.userData)==null?void 0:O.style)??{},w=Object.assign({color:P.fill,opacity:P.fillOpacity,transparent:!0,side:l.DoubleSide,depthWrite:M},t.fillMaterial);if(!s.value&&P.fill!==void 0&&P.fill!=="none")for(const L of $t.createShapes(b)){const D=new l.ShapeGeometry(L);D.scale(1,-1,1),v&&D.translate(0,0,C++*v),m.push({geometry:D,material:w,isStroke:!1})}if(!r.value&&P.stroke!==void 0&&P.stroke!=="none"){const L=Object.assign({color:(S=b.userData)==null?void 0:S.style.stroke,opacity:(A=b.userData)==null?void 0:A.style.strokeOpacity,transparent:!0,side:l.DoubleSide,depthWrite:M},t.strokeMaterial);for(const D of b.subPaths){const V=D.getPoints().map(Y=>new l.Vector2(Y.x,-Y.y)),G=$t.pointsToStroke(V,P||"none");v&&G.translate(0,0,C++*v),m.push({geometry:G,material:L,isStroke:!0})}}}g.value=m}return(m,M)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"svgRef",ref:f},[(u.openBlock(!0),u.createElementBlock(u.Fragment,null,u.renderList(g.value,({geometry:v,material:C,isStroke:O},S)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({key:`${S}`,ref_for:!0},O?u.unref(h):u.unref(c),{geometry:v,"render-order":u.unref(d)==="renderOrder"?S:0}),[u.createElementVNode("TresMeshBasicMaterial",u.mergeProps({ref_for:!0},C),null,16)],16,_c))),128))],512))}});async function ai(o){return await ee.useLoader(Ol,o)}const vc=["object"],wc=u.defineComponent({__name:"component",props:{path:{},castShadow:{type:Boolean,default:!1},receiveShadow:{type:Boolean,default:!1}},async setup(o,{expose:e}){let t,n;const r=o,s=u.ref();e({instance:s});const i=([t,n]=u.withAsyncContext(()=>ai(r.path)),t=await t,n(),t);return(r.castShadow||r.receiveShadow)&&i.traverse(a=>{a.isMesh&&(a.castShadow=r.castShadow,a.receiveShadow=r.receiveShadow)}),(a,c)=>(u.openBlock(),u.createElementBlock("primitive",u.mergeProps({ref_key:"modelRef",ref:s,object:u.unref(i)},a.$attrs),null,16,vc))}});function li(o,e){if(e===l.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===l.TriangleFanDrawMode||e===l.TriangleStripDrawMode){let t=o.getIndex();if(t===null){const i=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,r=[];if(e===l.TriangleFanDrawMode)for(let i=1;i<=n;i++)r.push(t.getX(0)),r.push(t.getX(i)),r.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(r.push(t.getX(i)),r.push(t.getX(i+1)),r.push(t.getX(i+2))):(r.push(t.getX(i+2)),r.push(t.getX(i+1)),r.push(t.getX(i)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=o.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}class bc extends l.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Pc(t)}),this.register(function(t){return new Tc(t)}),this.register(function(t){return new Nc(t)}),this.register(function(t){return new zc(t)}),this.register(function(t){return new Vc(t)}),this.register(function(t){return new Oc(t)}),this.register(function(t){return new Lc(t)}),this.register(function(t){return new Dc(t)}),this.register(function(t){return new Bc(t)}),this.register(function(t){return new Cc(t)}),this.register(function(t){return new kc(t)}),this.register(function(t){return new Ic(t)}),this.register(function(t){return new Uc(t)}),this.register(function(t){return new Fc(t)}),this.register(function(t){return new Sc(t)}),this.register(function(t){return new Gc(t)}),this.register(function(t){return new Rc(t)})}load(e,t,n,r){const s=this;let i;if(this.resourcePath!=="")i=this.resourcePath;else if(this.path!==""){const h=l.LoaderUtils.extractUrlBase(e);i=l.LoaderUtils.resolveURL(h,this.path)}else i=l.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const a=function(h){r?r(h):console.error(h),s.manager.itemError(e),s.manager.itemEnd(e)},c=new l.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(h){try{s.parse(h,i,function(d){t(d),s.manager.itemEnd(e)},a)}catch(d){a(d)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const i={},a={},c=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===ci){try{i[ve.KHR_BINARY_GLTF]=new jc(e)}catch(f){r&&r(f);return}s=JSON.parse(i[ve.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new tu(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const f=this.pluginCallbacks[d](h);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[f.name]=f,i[f.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const f=s.extensionsUsed[d],g=s.extensionsRequired||[];switch(f){case ve.KHR_MATERIALS_UNLIT:i[f]=new Ac;break;case ve.KHR_DRACO_MESH_COMPRESSION:i[f]=new Ec(s,this.dracoLoader);break;case ve.KHR_TEXTURE_TRANSFORM:i[f]=new Yc;break;case ve.KHR_MESH_QUANTIZATION:i[f]=new Wc;break;default:g.indexOf(f)>=0&&a[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}h.setExtensions(i),h.setPlugins(a),h.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function Mc(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const ve={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Sc{constructor(e){this.parser=e,this.name=ve.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let h;const d=new l.Color(16777215);c.color!==void 0&&d.setRGB(c.color[0],c.color[1],c.color[2],l.LinearSRGBColorSpace);const f=c.range!==void 0?c.range:0;switch(c.type){case"directional":h=new l.DirectionalLight(d),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new l.PointLight(d),h.distance=f;break;case"spot":h=new l.SpotLight(d),h.distance=f,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,h.angle=c.spot.outerConeAngle,h.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return h.position.set(0,0,0),h.decay=2,ht(h,c),c.intensity!==void 0&&(h.intensity=c.intensity),h.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(h),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class Ac{constructor(){this.name=ve.KHR_MATERIALS_UNLIT}getMaterialType(){return l.MeshBasicMaterial}extendParams(e,t,n){const r=[];e.color=new l.Color(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const i=s.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],l.LinearSRGBColorSpace),e.opacity=i[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,l.SRGBColorSpace))}return Promise.all(r)}}class Cc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Pc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.Vector2(a,a)}return Promise.all(s)}}class Tc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Ic{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(s)}}class Oc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new l.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=r.extensions[this.name];if(i.sheenColorFactor!==void 0){const a=i.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],l.LinearSRGBColorSpace)}return i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture,l.SRGBColorSpace)),i.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(s)}}class Lc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(s)}}class Dc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const a=i.attenuationColor||[1,1,1];return t.attenuationColor=new l.Color().setRGB(a[0],a[1],a[2],l.LinearSRGBColorSpace),Promise.all(s)}}class Bc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class kc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return t.specularColor=new l.Color().setRGB(a[0],a[1],a[2],l.LinearSRGBColorSpace),i.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture,l.SRGBColorSpace)),Promise.all(s)}}class Fc{constructor(e){this.parser=e,this.name=ve.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return t.bumpScale=i.bumpFactor!==void 0?i.bumpFactor:1,i.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(s)}}class Uc{constructor(e){this.parser=e,this.name=ve.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.anisotropyStrength!==void 0&&(t.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(t.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(s)}}class Nc{constructor(e){this.parser=e,this.name=ve.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,i)}}class zc{constructor(e){this.parser=e,this.name=ve.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const i=s.extensions[t],a=r.images[i.source];let c=n.textureLoader;if(a.uri){const h=n.options.manager.getHandler(a.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return n.loadTextureImage(e,i.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Vc{constructor(e){this.parser=e,this.name=ve.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const i=s.extensions[t],a=r.images[i.source];let c=n.textureLoader;if(a.uri){const h=n.options.manager.getHandler(a.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return n.loadTextureImage(e,i.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Gc{constructor(e){this.name=ve.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const c=r.byteOffset||0,h=r.byteLength||0,d=r.count,f=r.byteStride,g=new Uint8Array(a,c,h);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(d,f,g,r.mode,r.filter).then(function(p){return p.buffer}):i.ready.then(function(){const p=new ArrayBuffer(d*f);return i.decodeGltfBuffer(new Uint8Array(p),d,f,g,r.mode,r.filter),p})})}else return null}}class Rc{constructor(e){this.name=ve.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const h of r.primitives)if(h.mode!==Je.TRIANGLES&&h.mode!==Je.TRIANGLE_STRIP&&h.mode!==Je.TRIANGLE_FAN&&h.mode!==void 0)return null;const i=n.extensions[this.name].attributes,a=[],c={};for(const h in i)a.push(this.parser.getDependency("accessor",i[h]).then(d=>(c[h]=d,c[h])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(h=>{const d=h.pop(),f=d.isGroup?d.children:[d],g=h[0].count,p=[];for(const _ of f){const y=new l.Matrix4,x=new l.Vector3,m=new l.Quaternion,M=new l.Vector3(1,1,1),v=new l.InstancedMesh(_.geometry,_.material,g);for(let C=0;C<g;C++)c.TRANSLATION&&x.fromBufferAttribute(c.TRANSLATION,C),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,C),c.SCALE&&M.fromBufferAttribute(c.SCALE,C),v.setMatrixAt(C,y.compose(x,m,M));for(const C in c)if(C==="_COLOR_0"){const O=c[C];v.instanceColor=new l.InstancedBufferAttribute(O.array,O.itemSize,O.normalized)}else C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&_.geometry.setAttribute(C,c[C]);l.Object3D.prototype.copy.call(v,_),this.parser.assignFinalMaterial(v),p.push(v)}return d.isGroup?(d.clear(),d.add(...p),d):p[0]}))}}const ci="glTF",on=12,ui={JSON:1313821514,BIN:5130562};class jc{constructor(e){this.name=ve.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,on),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ci)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-on,s=new DataView(e,on);let i=0;for(;i<r;){const a=s.getUint32(i,!0);i+=4;const c=s.getUint32(i,!0);if(i+=4,c===ui.JSON){const h=new Uint8Array(e,on+i,a);this.content=n.decode(h)}else if(c===ui.BIN){const h=on+i;this.body=e.slice(h,h+a)}i+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ec{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ve.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},c={},h={};for(const d in i){const f=vr[d]||d.toLowerCase();a[f]=i[d]}for(const d in e.attributes){const f=vr[d]||d.toLowerCase();if(i[d]!==void 0){const g=n.accessors[e.attributes[d]],p=Et[g.componentType];h[f]=p.name,c[f]=g.normalized===!0}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(f,g){r.decodeDracoFile(d,function(p){for(const _ in p.attributes){const y=p.attributes[_],x=c[_];x!==void 0&&(y.normalized=x)}f(p)},a,h,l.LinearSRGBColorSpace,g)})})}}class Yc{constructor(){this.name=ve.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Wc{constructor(){this.name=ve.KHR_MESH_QUANTIZATION}}class hi extends l.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let i=0;i!==r;i++)t[i]=n[s+i];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,i=this.sampleValues,a=this.valueSize,c=a*2,h=a*3,d=r-t,f=(n-t)/d,g=f*f,p=g*f,_=e*h,y=_-h,x=-2*p+3*g,m=p-g,M=1-x,v=m-g+f;for(let C=0;C!==a;C++){const O=i[y+C+a],S=i[y+C+c]*d,A=i[_+C+a],b=i[_+C]*d;s[C]=M*O+v*S+x*A+m*b}return s}}const Xc=new l.Quaternion;class Zc extends hi{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return Xc.fromArray(s).normalize().toArray(s),s}}const Je={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Et={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fi={9728:l.NearestFilter,9729:l.LinearFilter,9984:l.NearestMipmapNearestFilter,9985:l.LinearMipmapNearestFilter,9986:l.NearestMipmapLinearFilter,9987:l.LinearMipmapLinearFilter},di={33071:l.ClampToEdgeWrapping,33648:l.MirroredRepeatWrapping,10497:l.RepeatWrapping},xr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},wt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Kc={CUBICSPLINE:void 0,LINEAR:l.InterpolateLinear,STEP:l.InterpolateDiscrete},wr={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function qc(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new l.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.FrontSide})),o.DefaultMaterial}function Bt(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function ht(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Qc(o,e,t){let n=!1,r=!1,s=!1;for(let h=0,d=e.length;h<d;h++){const f=e[h];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(o);const i=[],a=[],c=[];for(let h=0,d=e.length;h<d;h++){const f=e[h];if(n){const g=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):o.attributes.position;i.push(g)}if(r){const g=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):o.attributes.normal;a.push(g)}if(s){const g=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):o.attributes.color;c.push(g)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(h){const d=h[0],f=h[1],g=h[2];return n&&(o.morphAttributes.position=d),r&&(o.morphAttributes.normal=f),s&&(o.morphAttributes.color=g),o.morphTargetsRelative=!0,o})}function Jc(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hc(o){let e;const t=o.extensions&&o.extensions[ve.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+br(t.attributes):e=o.indices+":"+br(o.attributes)+":"+o.mode,o.targets!==void 0)for(let n=0,r=o.targets.length;n<r;n++)e+=":"+br(o.targets[n]);return e}function br(o){let e="";const t=Object.keys(o).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+o[t[n]]+";";return e}function Mr(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function $c(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const eu=new l.Matrix4;class tu{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Mc,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,s=!1,i=-1;if(typeof navigator<"u"){const a=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);r=n&&c?parseInt(c[1],10):-1,s=a.indexOf("Firefox")>-1,i=s?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&r<17||s&&i<98?this.textureLoader=new l.TextureLoader(this.options.manager):this.textureLoader=new l.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const a={scene:i[0][r.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:r.asset,parser:n,userData:{}};return Bt(s,a,r),ht(a,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const i=t[r].joints;for(let a=0,c=i.length;a<c;a++)e[i[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const i=e[r];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(i,a)=>{const c=this.associations.get(i);c!=null&&this.associations.set(a,c);for(const[h,d]of i.children.entries())s(d,a.children[h])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ve.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,i){n.load(l.LoaderUtils.resolveURL(t.uri,r.path),s,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const i=xr[r.type],a=Et[r.componentType],c=r.normalized===!0,h=new a(r.count*i);return Promise.resolve(new l.BufferAttribute(h,i,c))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(i){const a=i[0],c=xr[r.type],h=Et[r.componentType],d=h.BYTES_PER_ELEMENT,f=d*c,g=r.byteOffset||0,p=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,_=r.normalized===!0;let y,x;if(p&&p!==f){const m=Math.floor(g/p),M="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count;let v=t.cache.get(M);v||(y=new h(a,m*p,r.count*p/d),v=new l.InterleavedBuffer(y,p/d),t.cache.add(M,v)),x=new l.InterleavedBufferAttribute(v,c,g%p/d,_)}else a===null?y=new h(r.count*c):y=new h(a,g,r.count*c),x=new l.BufferAttribute(y,c,_);if(r.sparse!==void 0){const m=xr.SCALAR,M=Et[r.sparse.indices.componentType],v=r.sparse.indices.byteOffset||0,C=r.sparse.values.byteOffset||0,O=new M(i[1],v,r.sparse.count*m),S=new h(i[2],C,r.sparse.count*c);a!==null&&(x=new l.BufferAttribute(x.array.slice(),x.itemSize,x.normalized));for(let A=0,b=O.length;A<b;A++){const P=O[A];if(x.setX(P,S[A*c]),c>=2&&x.setY(P,S[A*c+1]),c>=3&&x.setZ(P,S[A*c+2]),c>=4&&x.setW(P,S[A*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return x})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,i=t.images[s];let a=this.textureLoader;if(i.uri){const c=n.manager.getHandler(i.uri);c!==null&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,n){const r=this,s=this.json,i=s.textures[e],a=s.images[t],c=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(t,n).then(function(d){d.flipY=!1,d.name=i.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const g=(s.samplers||{})[i.sampler]||{};return d.magFilter=fi[g.magFilter]||l.LinearFilter,d.minFilter=fi[g.minFilter]||l.LinearMipmapLinearFilter,d.wrapS=di[g.wrapS]||l.RepeatWrapping,d.wrapT=di[g.wrapT]||l.RepeatWrapping,r.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[c]=h,h}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const i=r.images[e],a=self.URL||self.webkitURL;let c=i.uri||"",h=!1;if(i.bufferView!==void 0)c=n.getDependency("bufferView",i.bufferView).then(function(f){h=!0;const g=new Blob([f],{type:i.mimeType});return c=a.createObjectURL(g),c});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(c).then(function(f){return new Promise(function(g,p){let _=g;t.isImageBitmapLoader===!0&&(_=function(y){const x=new l.Texture(y);x.needsUpdate=!0,g(x)}),t.load(l.LoaderUtils.resolveURL(f,s.path),_,void 0,p)})}).then(function(f){return h===!0&&a.revokeObjectURL(c),ht(f,i),f.userData.mimeType=i.mimeType||$c(i.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),f});return this.sourceCache[e]=d,d}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(i){if(!i)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(i=i.clone(),i.channel=n.texCoord),s.extensions[ve.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[ve.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(i);i=s.extensions[ve.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),s.associations.set(i,c)}}return r!==void 0&&(i.colorSpace=r),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new l.PointsMaterial,l.Material.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new l.LineBasicMaterial,l.Material.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(a,c)),n=c}if(r||s||i){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),s&&(c.vertexColors=!0),i&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return l.MeshStandardMaterial}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let i;const a={},c=s.extensions||{},h=[];if(c[ve.KHR_MATERIALS_UNLIT]){const f=r[ve.KHR_MATERIALS_UNLIT];i=f.getMaterialType(),h.push(f.extendParams(a,s,t))}else{const f=s.pbrMetallicRoughness||{};if(a.color=new l.Color(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const g=f.baseColorFactor;a.color.setRGB(g[0],g[1],g[2],l.LinearSRGBColorSpace),a.opacity=g[3]}f.baseColorTexture!==void 0&&h.push(t.assignTexture(a,"map",f.baseColorTexture,l.SRGBColorSpace)),a.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,a.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),h.push(t.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),i=this._invokeOne(function(g){return g.getMaterialType&&g.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(g){return g.extendMaterialParams&&g.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=l.DoubleSide);const d=s.alphaMode||wr.OPAQUE;if(d===wr.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===wr.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&i!==l.MeshBasicMaterial&&(h.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new l.Vector2(1,1),s.normalTexture.scale!==void 0)){const f=s.normalTexture.scale;a.normalScale.set(f,f)}if(s.occlusionTexture!==void 0&&i!==l.MeshBasicMaterial&&(h.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&i!==l.MeshBasicMaterial){const f=s.emissiveFactor;a.emissive=new l.Color().setRGB(f[0],f[1],f[2],l.LinearSRGBColorSpace)}return s.emissiveTexture!==void 0&&i!==l.MeshBasicMaterial&&h.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,l.SRGBColorSpace)),Promise.all(h).then(function(){const f=new i(a);return s.name&&(f.name=s.name),ht(f,s),t.associations.set(f,{materials:e}),s.extensions&&Bt(r,f,s),f})}createUniqueName(e){const t=l.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(a){return n[ve.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return pi(c,a,t)})}const i=[];for(let a=0,c=e.length;a<c;a++){const h=e[a],d=Hc(h),f=r[d];if(f)i.push(f.promise);else{let g;h.extensions&&h.extensions[ve.KHR_DRACO_MESH_COMPRESSION]?g=s(h):g=pi(new l.BufferGeometry,h,t),r[d]={primitive:h,promise:g},i.push(g)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,r=this.extensions,s=n.meshes[e],i=s.primitives,a=[];for(let c=0,h=i.length;c<h;c++){const d=i[c].material===void 0?qc(this.cache):this.getDependency("material",i[c].material);a.push(d)}return a.push(t.loadGeometries(i)),Promise.all(a).then(function(c){const h=c.slice(0,c.length-1),d=c[c.length-1],f=[];for(let p=0,_=d.length;p<_;p++){const y=d[p],x=i[p];let m;const M=h[p];if(x.mode===Je.TRIANGLES||x.mode===Je.TRIANGLE_STRIP||x.mode===Je.TRIANGLE_FAN||x.mode===void 0)m=s.isSkinnedMesh===!0?new l.SkinnedMesh(y,M):new l.Mesh(y,M),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),x.mode===Je.TRIANGLE_STRIP?m.geometry=li(m.geometry,l.TriangleStripDrawMode):x.mode===Je.TRIANGLE_FAN&&(m.geometry=li(m.geometry,l.TriangleFanDrawMode));else if(x.mode===Je.LINES)m=new l.LineSegments(y,M);else if(x.mode===Je.LINE_STRIP)m=new l.Line(y,M);else if(x.mode===Je.LINE_LOOP)m=new l.LineLoop(y,M);else if(x.mode===Je.POINTS)m=new l.Points(y,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+x.mode);Object.keys(m.geometry.morphAttributes).length>0&&Jc(m,s),m.name=t.createUniqueName(s.name||"mesh_"+e),ht(m,s),x.extensions&&Bt(r,m,x),t.assignFinalMaterial(m),f.push(m)}for(let p=0,_=f.length;p<_;p++)t.associations.set(f[p],{meshes:e,primitives:p});if(f.length===1)return s.extensions&&Bt(r,f[0],s),f[0];const g=new l.Group;s.extensions&&Bt(r,g,s),t.associations.set(g,{meshes:e});for(let p=0,_=f.length;p<_;p++)g.add(f[p]);return g})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new l.PerspectiveCamera(l.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new l.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ht(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),i=r,a=[],c=[];for(let h=0,d=i.length;h<d;h++){const f=i[h];if(f){a.push(f);const g=new l.Matrix4;s!==null&&g.fromArray(s.array,h*16),c.push(g)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new l.Skeleton(a,c)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,i=[],a=[],c=[],h=[],d=[];for(let f=0,g=r.channels.length;f<g;f++){const p=r.channels[f],_=r.samplers[p.sampler],y=p.target,x=y.node,m=r.parameters!==void 0?r.parameters[_.input]:_.input,M=r.parameters!==void 0?r.parameters[_.output]:_.output;y.node!==void 0&&(i.push(this.getDependency("node",x)),a.push(this.getDependency("accessor",m)),c.push(this.getDependency("accessor",M)),h.push(_),d.push(y))}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c),Promise.all(h),Promise.all(d)]).then(function(f){const g=f[0],p=f[1],_=f[2],y=f[3],x=f[4],m=[];for(let M=0,v=g.length;M<v;M++){const C=g[M],O=p[M],S=_[M],A=y[M],b=x[M];if(C===void 0)continue;C.updateMatrix&&C.updateMatrix();const P=n._createAnimationTracks(C,O,S,A,b);if(P)for(let w=0;w<P.length;w++)m.push(P[w])}return new l.AnimationClip(s,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const i=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&i.traverse(function(a){if(a.isMesh)for(let c=0,h=r.weights.length;c<h;c++)a.morphTargetInfluences[c]=r.weights[c]}),i})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],s=n._loadNodeShallow(e),i=[],a=r.children||[];for(let h=0,d=a.length;h<d;h++)i.push(n.getDependency("node",a[h]));const c=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(i),c]).then(function(h){const d=h[0],f=h[1],g=h[2];g!==null&&d.traverse(function(p){p.isSkinnedMesh&&p.bind(g,eu)});for(let p=0,_=f.length;p<_;p++)d.add(f[p]);return d})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],i=s.name?r.createUniqueName(s.name):"",a=[],c=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return c&&a.push(c),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(h){return r._getNodeRef(r.cameraCache,s.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){a.push(h)}),this.nodeCache[e]=Promise.all(a).then(function(h){let d;if(s.isBone===!0?d=new l.Bone:h.length>1?d=new l.Group:h.length===1?d=h[0]:d=new l.Object3D,d!==h[0])for(let f=0,g=h.length;f<g;f++)d.add(h[f]);if(s.name&&(d.userData.name=s.name,d.name=i),ht(d,s),s.extensions&&Bt(n,d,s),s.matrix!==void 0){const f=new l.Matrix4;f.fromArray(s.matrix),d.applyMatrix4(f)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new l.Group;n.name&&(s.name=r.createUniqueName(n.name)),ht(s,n),n.extensions&&Bt(t,s,n);const i=n.nodes||[],a=[];for(let c=0,h=i.length;c<h;c++)a.push(r.getDependency("node",i[c]));return Promise.all(a).then(function(c){for(let d=0,f=c.length;d<f;d++)s.add(c[d]);const h=d=>{const f=new Map;for(const[g,p]of r.associations)(g instanceof l.Material||g instanceof l.Texture)&&f.set(g,p);return d.traverse(g=>{const p=r.associations.get(g);p!=null&&f.set(g,p)}),f};return r.associations=h(s),s})}_createAnimationTracks(e,t,n,r,s){const i=[],a=e.name?e.name:e.uuid,c=[];wt[s.path]===wt.weights?e.traverse(function(g){g.morphTargetInfluences&&c.push(g.name?g.name:g.uuid)}):c.push(a);let h;switch(wt[s.path]){case wt.weights:h=l.NumberKeyframeTrack;break;case wt.rotation:h=l.QuaternionKeyframeTrack;break;case wt.position:case wt.scale:h=l.VectorKeyframeTrack;break;default:switch(n.itemSize){case 1:h=l.NumberKeyframeTrack;break;case 2:case 3:default:h=l.VectorKeyframeTrack;break}break}const d=r.interpolation!==void 0?Kc[r.interpolation]:l.InterpolateLinear,f=this._getArrayFromAccessor(n);for(let g=0,p=c.length;g<p;g++){const _=new h(c[g]+"."+wt[s.path],t.array,f,d);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),i.push(_)}return i}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=Mr(t.constructor),r=new Float32Array(t.length);for(let s=0,i=t.length;s<i;s++)r[s]=t[s]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof l.QuaternionKeyframeTrack?Zc:hi;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function nu(o,e,t){const n=e.attributes,r=new l.Box3;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,h=a.max;if(c!==void 0&&h!==void 0){if(r.set(new l.Vector3(c[0],c[1],c[2]),new l.Vector3(h[0],h[1],h[2])),a.normalized){const d=Mr(Et[a.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new l.Vector3,c=new l.Vector3;for(let h=0,d=s.length;h<d;h++){const f=s[h];if(f.POSITION!==void 0){const g=t.json.accessors[f.POSITION],p=g.min,_=g.max;if(p!==void 0&&_!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(_[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(_[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(_[2]))),g.normalized){const y=Mr(Et[g.componentType]);c.multiplyScalar(y)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}o.boundingBox=r;const i=new l.Sphere;r.getCenter(i.center),i.radius=r.min.distanceTo(r.max)/2,o.boundingSphere=i}function pi(o,e,t){const n=e.attributes,r=[];function s(i,a){return t.getDependency("accessor",i).then(function(c){o.setAttribute(a,c)})}for(const i in n){const a=vr[i]||i.toLowerCase();a in o.attributes||r.push(s(n[i],a))}if(e.indices!==void 0&&!o.index){const i=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});r.push(i)}return l.ColorManagement.workingColorSpace!==l.LinearSRGBColorSpace&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${l.ColorManagement.workingColorSpace}" not supported.`),ht(o,e),nu(o,e,t),Promise.all(r).then(function(){return e.targets!==void 0?Qc(o,e.targets,t):o})}let bt=null;function ru(o,e){return t=>{e&&e(t),o.draco&&(bt||(bt=new Kl),bt.setDecoderPath(o.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),t.setDRACOLoader&&t.setDRACOLoader(bt))}}async function mi(o,e={draco:!1},t){const n=await ee.useLoader(bc,o,ru(e,t));return bt==null||bt.dispose(),bt=null,n}const su=["object"],iu=u.defineComponent({__name:"component",props:{path:{},draco:{type:Boolean,default:!1},decoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.4.1/"},castShadow:{type:Boolean,default:!1},receiveShadow:{type:Boolean,default:!1}},async setup(o,{expose:e}){let t,n;const r=o,s=u.ref();e({instance:s});const{scene:i}=([t,n]=u.withAsyncContext(()=>mi(r.path,{draco:r.draco,decoderPath:r.decoderPath})),t=await t,n(),t);return(r.castShadow||r.receiveShadow)&&i.traverse(a=>{a.isMesh&&(a.castShadow=r.castShadow,a.receiveShadow=r.receiveShadow)}),(a,c)=>(u.openBlock(),u.createElementBlock("primitive",u.mergeProps({ref_key:"modelRef",ref:s,object:u.unref(i)},a.$attrs),null,16,su))}}),gi="[TresJS - Cientos â–² â–  â™¥] ";function ou(o,e){console.error(`${gi} ${o}`,e||"")}function au(o){console.warn(`${gi} ${o}`)}function lu(o,e){}function yi(){return{logError:ou,logWarning:au,logMessage:lu}}let Sr=0;function cu(){const o=u.ref(!1),e=u.ref(0),t=u.ref([]),{logError:n}=yi();return new Promise(r=>{l.DefaultLoadingManager.onStart=()=>{o.value=!1},l.DefaultLoadingManager.onLoad=()=>{o.value=!0},l.DefaultLoadingManager.onProgress=(s,i,a)=>{i===a&&(Sr=a,o.value=!0,t.value.push(s)),e.value=Math.round((i-Sr)/(a-Sr)*100||100)},l.DefaultLoadingManager.onError=s=>{n("Error loading assets",new Error(s)),o.value=!0},r({items:t,hasFinishLoading:o,progress:e})})}async function uu(o,e){const{logError:t}=yi();if(!o)return t("Error no path provided");const{unsuspend:n,start:r,crossOrigin:s,muted:i,loop:a,...c}={unsuspend:"loadedmetadata",crossOrigin:"Anonymous",muted:!0,loop:!0,start:!0,playsInline:!0,...e};function h(){return new Promise((d,f)=>{const g=Object.assign(document.createElement("video"),{src:typeof o=="string"&&o||void 0,crossOrigin:s,loop:a,muted:i,autoplay:!0,...c}),p=new l.VideoTexture(g);return g.addEventListener(n,()=>d(p)),g.addEventListener("error",()=>f(new Error("Error loading video"))),p})}try{const d=await h();return r&&d.image&&d.image.play(),d}catch{t("Error loading resource")}}var hu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function an(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Bn(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _i={exports:{}};(function(o,e){(function(t){o.exports=t()})(function(){return function t(n,r,s){function i(h,d){if(!r[h]){if(!n[h]){var f=typeof Bn=="function"&&Bn;if(!d&&f)return f(h,!0);if(a)return a(h,!0);throw new Error("Cannot find module '"+h+"'")}d=r[h]={exports:{}},n[h][0].call(d.exports,function(g){var p=n[h][1][g];return i(p||g)},d,d.exports,t,n,r,s)}return r[h].exports}for(var a=typeof Bn=="function"&&Bn,c=0;c<s.length;c++)i(s[c]);return i}({1:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){var _=t("crypto");function y(S,A){A=M(S,A);var b;return(b=A.algorithm!=="passthrough"?_.createHash(A.algorithm):new O).write===void 0&&(b.write=b.update,b.end=b.update),C(A,b).dispatch(S),b.update||b.end(""),b.digest?b.digest(A.encoding==="buffer"?void 0:A.encoding):(S=b.read(),A.encoding!=="buffer"?S.toString(A.encoding):S)}(r=n.exports=y).sha1=function(S){return y(S)},r.keys=function(S){return y(S,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},r.MD5=function(S){return y(S,{algorithm:"md5",encoding:"hex"})},r.keysMD5=function(S){return y(S,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var x=_.getHashes?_.getHashes().slice():["sha1","md5"],m=(x.push("passthrough"),["buffer","hex","binary","base64"]);function M(S,A){var b={};if(b.algorithm=(A=A||{}).algorithm||"sha1",b.encoding=A.encoding||"hex",b.excludeValues=!!A.excludeValues,b.algorithm=b.algorithm.toLowerCase(),b.encoding=b.encoding.toLowerCase(),b.ignoreUnknown=A.ignoreUnknown===!0,b.respectType=A.respectType!==!1,b.respectFunctionNames=A.respectFunctionNames!==!1,b.respectFunctionProperties=A.respectFunctionProperties!==!1,b.unorderedArrays=A.unorderedArrays===!0,b.unorderedSets=A.unorderedSets!==!1,b.unorderedObjects=A.unorderedObjects!==!1,b.replacer=A.replacer||void 0,b.excludeKeys=A.excludeKeys||void 0,S===void 0)throw new Error("Object argument required.");for(var P=0;P<x.length;++P)x[P].toLowerCase()===b.algorithm.toLowerCase()&&(b.algorithm=x[P]);if(x.indexOf(b.algorithm)===-1)throw new Error('Algorithm "'+b.algorithm+'"  not supported. supported values: '+x.join(", "));if(m.indexOf(b.encoding)===-1&&b.algorithm!=="passthrough")throw new Error('Encoding "'+b.encoding+'"  not supported. supported values: '+m.join(", "));return b}function v(S){if(typeof S=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(S))!=null}function C(S,A,b){b=b||[];function P(w){return A.update?A.update(w,"utf8"):A.write(w,"utf8")}return{dispatch:function(w){return this["_"+((w=S.replacer?S.replacer(w):w)===null?"null":typeof w)](w)},_object:function(w){var L,D=Object.prototype.toString.call(w),V=/\[object (.*)\]/i.exec(D);if(V=(V=V?V[1]:"unknown:["+D+"]").toLowerCase(),0<=(D=b.indexOf(w)))return this.dispatch("[CIRCULAR:"+D+"]");if(b.push(w),a!==void 0&&a.isBuffer&&a.isBuffer(w))return P("buffer:"),P(w);if(V==="object"||V==="function"||V==="asyncfunction")return D=Object.keys(w),S.unorderedObjects&&(D=D.sort()),S.respectType===!1||v(w)||D.splice(0,0,"prototype","__proto__","constructor"),S.excludeKeys&&(D=D.filter(function(G){return!S.excludeKeys(G)})),P("object:"+D.length+":"),L=this,D.forEach(function(G){L.dispatch(G),P(":"),S.excludeValues||L.dispatch(w[G]),P(",")});if(!this["_"+V]){if(S.ignoreUnknown)return P("["+V+"]");throw new Error('Unknown object type "'+V+'"')}this["_"+V](w)},_array:function(w,G){G=G!==void 0?G:S.unorderedArrays!==!1;var D=this;if(P("array:"+w.length+":"),!G||w.length<=1)return w.forEach(function(Y){return D.dispatch(Y)});var V=[],G=w.map(function(Y){var W=new O,$=b.slice();return C(S,W,$).dispatch(Y),V=V.concat($.slice(b.length)),W.read().toString()});return b=b.concat(V),G.sort(),this._array(G,!1)},_date:function(w){return P("date:"+w.toJSON())},_symbol:function(w){return P("symbol:"+w.toString())},_error:function(w){return P("error:"+w.toString())},_boolean:function(w){return P("bool:"+w.toString())},_string:function(w){P("string:"+w.length+":"),P(w.toString())},_function:function(w){P("fn:"),v(w)?this.dispatch("[native]"):this.dispatch(w.toString()),S.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(w.name)),S.respectFunctionProperties&&this._object(w)},_number:function(w){return P("number:"+w.toString())},_xml:function(w){return P("xml:"+w.toString())},_null:function(){return P("Null")},_undefined:function(){return P("Undefined")},_regexp:function(w){return P("regex:"+w.toString())},_uint8array:function(w){return P("uint8array:"),this.dispatch(Array.prototype.slice.call(w))},_uint8clampedarray:function(w){return P("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(w))},_int8array:function(w){return P("int8array:"),this.dispatch(Array.prototype.slice.call(w))},_uint16array:function(w){return P("uint16array:"),this.dispatch(Array.prototype.slice.call(w))},_int16array:function(w){return P("int16array:"),this.dispatch(Array.prototype.slice.call(w))},_uint32array:function(w){return P("uint32array:"),this.dispatch(Array.prototype.slice.call(w))},_int32array:function(w){return P("int32array:"),this.dispatch(Array.prototype.slice.call(w))},_float32array:function(w){return P("float32array:"),this.dispatch(Array.prototype.slice.call(w))},_float64array:function(w){return P("float64array:"),this.dispatch(Array.prototype.slice.call(w))},_arraybuffer:function(w){return P("arraybuffer:"),this.dispatch(new Uint8Array(w))},_url:function(w){return P("url:"+w.toString())},_map:function(w){return P("map:"),w=Array.from(w),this._array(w,S.unorderedSets!==!1)},_set:function(w){return P("set:"),w=Array.from(w),this._array(w,S.unorderedSets!==!1)},_file:function(w){return P("file:"),this.dispatch([w.name,w.size,w.type,w.lastModfied])},_blob:function(){if(S.ignoreUnknown)return P("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return P("domwindow")},_bigint:function(w){return P("bigint:"+w.toString())},_process:function(){return P("process")},_timer:function(){return P("timer")},_pipe:function(){return P("pipe")},_tcp:function(){return P("tcp")},_udp:function(){return P("udp")},_tty:function(){return P("tty")},_statwatcher:function(){return P("statwatcher")},_securecontext:function(){return P("securecontext")},_connection:function(){return P("connection")},_zlib:function(){return P("zlib")},_context:function(){return P("context")},_nodescript:function(){return P("nodescript")},_httpparser:function(){return P("httpparser")},_dataview:function(){return P("dataview")},_signal:function(){return P("signal")},_fsevent:function(){return P("fsevent")},_tlswrap:function(){return P("tlswrap")}}}function O(){return{buf:"",write:function(S){this.buf+=S},end:function(S){this.buf+=S},read:function(){return this.buf}}}r.writeToStream=function(S,A,b){return b===void 0&&(b=A,A={}),C(A=M(S,A),b).dispatch(S)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){(function(_){var y=typeof Uint8Array<"u"?Uint8Array:Array,x=43,m=47,M=48,v=97,C=65,O=45,S=95;function A(b){return b=b.charCodeAt(0),b===x||b===O?62:b===m||b===S?63:b<M?-1:b<M+10?b-M+26+26:b<C+26?b-C:b<v+26?b-v+26:void 0}_.toByteArray=function(b){var P,w;if(0<b.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var L=b.length,L=b.charAt(L-2)==="="?2:b.charAt(L-1)==="="?1:0,D=new y(3*b.length/4-L),V=0<L?b.length-4:b.length,G=0;function Y(W){D[G++]=W}for(P=0;P<V;P+=4,0)Y((16711680&(w=A(b.charAt(P))<<18|A(b.charAt(P+1))<<12|A(b.charAt(P+2))<<6|A(b.charAt(P+3))))>>16),Y((65280&w)>>8),Y(255&w);return L==2?Y(255&(w=A(b.charAt(P))<<2|A(b.charAt(P+1))>>4)):L==1&&(Y((w=A(b.charAt(P))<<10|A(b.charAt(P+1))<<4|A(b.charAt(P+2))>>2)>>8&255),Y(255&w)),D},_.fromByteArray=function(b){var P,w,L,D,V=b.length%3,G="";function Y(W){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(W)}for(P=0,L=b.length-V;P<L;P+=3)w=(b[P]<<16)+(b[P+1]<<8)+b[P+2],G+=Y((D=w)>>18&63)+Y(D>>12&63)+Y(D>>6&63)+Y(63&D);switch(V){case 1:G=(G+=Y((w=b[b.length-1])>>2))+Y(w<<4&63)+"==";break;case 2:G=(G=(G+=Y((w=(b[b.length-2]<<8)+b[b.length-1])>>10))+Y(w>>4&63))+Y(w<<2&63)+"="}return G}})(r===void 0?this.base64js={}:r)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,r){(function(s,i,x,c,h,d,f,g,p){var _=t("base64-js"),y=t("ieee754");function x(T,I,U){if(!(this instanceof x))return new x(T,I,U);var Z,j,E,J,re=typeof T;if(I==="base64"&&re=="string")for(T=(J=T).trim?J.trim():J.replace(/^\s+|\s+$/g,"");T.length%4!=0;)T+="=";if(re=="number")Z=q(T);else if(re=="string")Z=x.byteLength(T,I);else{if(re!="object")throw new Error("First argument needs to be a number, array or string.");Z=q(T.length)}if(x._useTypedArrays?j=x._augment(new Uint8Array(Z)):((j=this).length=Z,j._isBuffer=!0),x._useTypedArrays&&typeof T.byteLength=="number")j._set(T);else if(ne(J=T)||x.isBuffer(J)||J&&typeof J=="object"&&typeof J.length=="number")for(E=0;E<Z;E++)x.isBuffer(T)?j[E]=T.readUInt8(E):j[E]=T[E];else if(re=="string")j.write(T,0,I);else if(re=="number"&&!x._useTypedArrays&&!U)for(E=0;E<Z;E++)j[E]=0;return j}function m(T,I,U,Z){return x._charsWritten=me(function(j){for(var E=[],J=0;J<j.length;J++)E.push(255&j.charCodeAt(J));return E}(I),T,U,Z)}function M(T,I,U,Z){return x._charsWritten=me(function(j){for(var E,J,re=[],ie=0;ie<j.length;ie++)J=j.charCodeAt(ie),E=J>>8,J=J%256,re.push(J),re.push(E);return re}(I),T,U,Z)}function v(T,I,U){var Z="";U=Math.min(T.length,U);for(var j=I;j<U;j++)Z+=String.fromCharCode(T[j]);return Z}function C(T,I,U,E){E||(R(typeof U=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+1<T.length,"Trying to read beyond buffer length"));var j,E=T.length;if(!(E<=I))return U?(j=T[I],I+1<E&&(j|=T[I+1]<<8)):(j=T[I]<<8,I+1<E&&(j|=T[I+1])),j}function O(T,I,U,E){E||(R(typeof U=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+3<T.length,"Trying to read beyond buffer length"));var j,E=T.length;if(!(E<=I))return U?(I+2<E&&(j=T[I+2]<<16),I+1<E&&(j|=T[I+1]<<8),j|=T[I],I+3<E&&(j+=T[I+3]<<24>>>0)):(I+1<E&&(j=T[I+1]<<16),I+2<E&&(j|=T[I+2]<<8),I+3<E&&(j|=T[I+3]),j+=T[I]<<24>>>0),j}function S(T,I,U,Z){if(Z||(R(typeof U=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+1<T.length,"Trying to read beyond buffer length")),!(T.length<=I))return Z=C(T,I,U,!0),32768&Z?-1*(65535-Z+1):Z}function A(T,I,U,Z){if(Z||(R(typeof U=="boolean","missing or invalid endian"),R(I!=null,"missing offset"),R(I+3<T.length,"Trying to read beyond buffer length")),!(T.length<=I))return Z=O(T,I,U,!0),2147483648&Z?-1*(4294967295-Z+1):Z}function b(T,I,U,Z){return Z||(R(typeof U=="boolean","missing or invalid endian"),R(I+3<T.length,"Trying to read beyond buffer length")),y.read(T,I,U,23,4)}function P(T,I,U,Z){return Z||(R(typeof U=="boolean","missing or invalid endian"),R(I+7<T.length,"Trying to read beyond buffer length")),y.read(T,I,U,52,8)}function w(T,I,U,Z,j){if(j||(R(I!=null,"missing value"),R(typeof Z=="boolean","missing or invalid endian"),R(U!=null,"missing offset"),R(U+1<T.length,"trying to write beyond buffer length"),z(I,65535)),j=T.length,!(j<=U))for(var E=0,J=Math.min(j-U,2);E<J;E++)T[U+E]=(I&255<<8*(Z?E:1-E))>>>8*(Z?E:1-E)}function L(T,I,U,Z,j){if(j||(R(I!=null,"missing value"),R(typeof Z=="boolean","missing or invalid endian"),R(U!=null,"missing offset"),R(U+3<T.length,"trying to write beyond buffer length"),z(I,4294967295)),j=T.length,!(j<=U))for(var E=0,J=Math.min(j-U,4);E<J;E++)T[U+E]=I>>>8*(Z?E:3-E)&255}function D(T,I,U,Z,j){j||(R(I!=null,"missing value"),R(typeof Z=="boolean","missing or invalid endian"),R(U!=null,"missing offset"),R(U+1<T.length,"Trying to write beyond buffer length"),F(I,32767,-32768)),T.length<=U||w(T,0<=I?I:65535+I+1,U,Z,j)}function V(T,I,U,Z,j){j||(R(I!=null,"missing value"),R(typeof Z=="boolean","missing or invalid endian"),R(U!=null,"missing offset"),R(U+3<T.length,"Trying to write beyond buffer length"),F(I,2147483647,-2147483648)),T.length<=U||L(T,0<=I?I:4294967295+I+1,U,Z,j)}function G(T,I,U,Z,j){j||(R(I!=null,"missing value"),R(typeof Z=="boolean","missing or invalid endian"),R(U!=null,"missing offset"),R(U+3<T.length,"Trying to write beyond buffer length"),k(I,34028234663852886e22,-34028234663852886e22)),T.length<=U||y.write(T,I,U,Z,23,4)}function Y(T,I,U,Z,j){j||(R(I!=null,"missing value"),R(typeof Z=="boolean","missing or invalid endian"),R(U!=null,"missing offset"),R(U+7<T.length,"Trying to write beyond buffer length"),k(I,17976931348623157e292,-17976931348623157e292)),T.length<=U||y.write(T,I,U,Z,52,8)}r.Buffer=x,r.SlowBuffer=x,r.INSPECT_MAX_BYTES=50,x.poolSize=8192,x._useTypedArrays=function(){try{var T=new ArrayBuffer(0),I=new Uint8Array(T);return I.foo=function(){return 42},I.foo()===42&&typeof I.subarray=="function"}catch{return!1}}(),x.isEncoding=function(T){switch(String(T).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},x.isBuffer=function(T){return!(T==null||!T._isBuffer)},x.byteLength=function(T,I){var U;switch(T+="",I||"utf8"){case"hex":U=T.length/2;break;case"utf8":case"utf-8":U=ce(T).length;break;case"ascii":case"binary":case"raw":U=T.length;break;case"base64":U=le(T).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":U=2*T.length;break;default:throw new Error("Unknown encoding")}return U},x.concat=function(T,I){if(R(ne(T),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),T.length===0)return new x(0);if(T.length===1)return T[0];if(typeof I!="number")for(j=I=0;j<T.length;j++)I+=T[j].length;for(var U=new x(I),Z=0,j=0;j<T.length;j++){var E=T[j];E.copy(U,Z),Z+=E.length}return U},x.prototype.write=function(T,I,U,Z){isFinite(I)?isFinite(U)||(Z=U,U=void 0):(ie=Z,Z=I,I=U,U=ie),I=Number(I)||0;var j,E,J,re,ie=this.length-I;switch((!U||ie<(U=Number(U)))&&(U=ie),Z=String(Z||"utf8").toLowerCase()){case"hex":j=function(X,N,ae,he){ae=Number(ae)||0;var _e=X.length-ae;(!he||_e<(he=Number(he)))&&(he=_e),R((_e=N.length)%2==0,"Invalid hex string"),_e/2<he&&(he=_e/2);for(var Ie=0;Ie<he;Ie++){var Oe=parseInt(N.substr(2*Ie,2),16);R(!isNaN(Oe),"Invalid hex string"),X[ae+Ie]=Oe}return x._charsWritten=2*Ie,Ie}(this,T,I,U);break;case"utf8":case"utf-8":E=this,J=I,re=U,j=x._charsWritten=me(ce(T),E,J,re);break;case"ascii":case"binary":j=m(this,T,I,U);break;case"base64":E=this,J=I,re=U,j=x._charsWritten=me(le(T),E,J,re);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":j=M(this,T,I,U);break;default:throw new Error("Unknown encoding")}return j},x.prototype.toString=function(T,I,U){var Z,j,E,J,re=this;if(T=String(T||"utf8").toLowerCase(),I=Number(I)||0,(U=U!==void 0?Number(U):re.length)===I)return"";switch(T){case"hex":Z=function(ie,X,N){var ae=ie.length;(!X||X<0)&&(X=0),(!N||N<0||ae<N)&&(N=ae);for(var he="",_e=X;_e<N;_e++)he+=te(ie[_e]);return he}(re,I,U);break;case"utf8":case"utf-8":Z=function(ie,X,N){var ae="",he="";N=Math.min(ie.length,N);for(var _e=X;_e<N;_e++)ie[_e]<=127?(ae+=B(he)+String.fromCharCode(ie[_e]),he=""):he+="%"+ie[_e].toString(16);return ae+B(he)}(re,I,U);break;case"ascii":case"binary":Z=v(re,I,U);break;case"base64":j=re,J=U,Z=(E=I)===0&&J===j.length?_.fromByteArray(j):_.fromByteArray(j.slice(E,J));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Z=function(ie,X,N){for(var ae=ie.slice(X,N),he="",_e=0;_e<ae.length;_e+=2)he+=String.fromCharCode(ae[_e]+256*ae[_e+1]);return he}(re,I,U);break;default:throw new Error("Unknown encoding")}return Z},x.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},x.prototype.copy=function(T,I,U,Z){if(I=I||0,(Z=Z||Z===0?Z:this.length)!==(U=U||0)&&T.length!==0&&this.length!==0){R(U<=Z,"sourceEnd < sourceStart"),R(0<=I&&I<T.length,"targetStart out of bounds"),R(0<=U&&U<this.length,"sourceStart out of bounds"),R(0<=Z&&Z<=this.length,"sourceEnd out of bounds"),Z>this.length&&(Z=this.length);var j=(Z=T.length-I<Z-U?T.length-I+U:Z)-U;if(j<100||!x._useTypedArrays)for(var E=0;E<j;E++)T[E+I]=this[E+U];else T._set(this.subarray(U,U+j),I)}},x.prototype.slice=function(T,I){var U=this.length;if(T=$(T,U,0),I=$(I,U,U),x._useTypedArrays)return x._augment(this.subarray(T,I));for(var Z=I-T,j=new x(Z,void 0,!0),E=0;E<Z;E++)j[E]=this[E+T];return j},x.prototype.get=function(T){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(T)},x.prototype.set=function(T,I){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(T,I)},x.prototype.readUInt8=function(T,I){if(I||(R(T!=null,"missing offset"),R(T<this.length,"Trying to read beyond buffer length")),!(T>=this.length))return this[T]},x.prototype.readUInt16LE=function(T,I){return C(this,T,!0,I)},x.prototype.readUInt16BE=function(T,I){return C(this,T,!1,I)},x.prototype.readUInt32LE=function(T,I){return O(this,T,!0,I)},x.prototype.readUInt32BE=function(T,I){return O(this,T,!1,I)},x.prototype.readInt8=function(T,I){if(I||(R(T!=null,"missing offset"),R(T<this.length,"Trying to read beyond buffer length")),!(T>=this.length))return 128&this[T]?-1*(255-this[T]+1):this[T]},x.prototype.readInt16LE=function(T,I){return S(this,T,!0,I)},x.prototype.readInt16BE=function(T,I){return S(this,T,!1,I)},x.prototype.readInt32LE=function(T,I){return A(this,T,!0,I)},x.prototype.readInt32BE=function(T,I){return A(this,T,!1,I)},x.prototype.readFloatLE=function(T,I){return b(this,T,!0,I)},x.prototype.readFloatBE=function(T,I){return b(this,T,!1,I)},x.prototype.readDoubleLE=function(T,I){return P(this,T,!0,I)},x.prototype.readDoubleBE=function(T,I){return P(this,T,!1,I)},x.prototype.writeUInt8=function(T,I,U){U||(R(T!=null,"missing value"),R(I!=null,"missing offset"),R(I<this.length,"trying to write beyond buffer length"),z(T,255)),I>=this.length||(this[I]=T)},x.prototype.writeUInt16LE=function(T,I,U){w(this,T,I,!0,U)},x.prototype.writeUInt16BE=function(T,I,U){w(this,T,I,!1,U)},x.prototype.writeUInt32LE=function(T,I,U){L(this,T,I,!0,U)},x.prototype.writeUInt32BE=function(T,I,U){L(this,T,I,!1,U)},x.prototype.writeInt8=function(T,I,U){U||(R(T!=null,"missing value"),R(I!=null,"missing offset"),R(I<this.length,"Trying to write beyond buffer length"),F(T,127,-128)),I>=this.length||(0<=T?this.writeUInt8(T,I,U):this.writeUInt8(255+T+1,I,U))},x.prototype.writeInt16LE=function(T,I,U){D(this,T,I,!0,U)},x.prototype.writeInt16BE=function(T,I,U){D(this,T,I,!1,U)},x.prototype.writeInt32LE=function(T,I,U){V(this,T,I,!0,U)},x.prototype.writeInt32BE=function(T,I,U){V(this,T,I,!1,U)},x.prototype.writeFloatLE=function(T,I,U){G(this,T,I,!0,U)},x.prototype.writeFloatBE=function(T,I,U){G(this,T,I,!1,U)},x.prototype.writeDoubleLE=function(T,I,U){Y(this,T,I,!0,U)},x.prototype.writeDoubleBE=function(T,I,U){Y(this,T,I,!1,U)},x.prototype.fill=function(T,I,U){if(I=I||0,U=U||this.length,R(typeof(T=typeof(T=T||0)=="string"?T.charCodeAt(0):T)=="number"&&!isNaN(T),"value is not a number"),R(I<=U,"end < start"),U!==I&&this.length!==0){R(0<=I&&I<this.length,"start out of bounds"),R(0<=U&&U<=this.length,"end out of bounds");for(var Z=I;Z<U;Z++)this[Z]=T}},x.prototype.inspect=function(){for(var T=[],I=this.length,U=0;U<I;U++)if(T[U]=te(this[U]),U===r.INSPECT_MAX_BYTES){T[U+1]="...";break}return"<Buffer "+T.join(" ")+">"},x.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(x._useTypedArrays)return new x(this).buffer;for(var T=new Uint8Array(this.length),I=0,U=T.length;I<U;I+=1)T[I]=this[I];return T.buffer};var W=x.prototype;function $(T,I,U){return typeof T!="number"?U:I<=(T=~~T)?I:0<=T||0<=(T+=I)?T:0}function q(T){return(T=~~Math.ceil(+T))<0?0:T}function ne(T){return(Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"})(T)}function te(T){return T<16?"0"+T.toString(16):T.toString(16)}function ce(T){for(var I=[],U=0;U<T.length;U++){var Z=T.charCodeAt(U);if(Z<=127)I.push(T.charCodeAt(U));else for(var j=U,E=(55296<=Z&&Z<=57343&&U++,encodeURIComponent(T.slice(j,U+1)).substr(1).split("%")),J=0;J<E.length;J++)I.push(parseInt(E[J],16))}return I}function le(T){return _.toByteArray(T)}function me(T,I,U,Z){for(var j=0;j<Z&&!(j+U>=I.length||j>=T.length);j++)I[j+U]=T[j];return j}function B(T){try{return decodeURIComponent(T)}catch{return"ï¿½"}}function z(T,I){R(typeof T=="number","cannot write a non-number as a number"),R(0<=T,"specified a negative value for writing an unsigned value"),R(T<=I,"value is larger than maximum value for type"),R(Math.floor(T)===T,"value has a fractional component")}function F(T,I,U){R(typeof T=="number","cannot write a non-number as a number"),R(T<=I,"value larger than maximum allowed value"),R(U<=T,"value smaller than minimum allowed value"),R(Math.floor(T)===T,"value has a fractional component")}function k(T,I,U){R(typeof T=="number","cannot write a non-number as a number"),R(T<=I,"value larger than maximum allowed value"),R(U<=T,"value smaller than minimum allowed value")}function R(T,I){if(!T)throw new Error(I||"Failed assertion")}x._augment=function(T){return T._isBuffer=!0,T._get=T.get,T._set=T.set,T.get=W.get,T.set=W.set,T.write=W.write,T.toString=W.toString,T.toLocaleString=W.toString,T.toJSON=W.toJSON,T.copy=W.copy,T.slice=W.slice,T.readUInt8=W.readUInt8,T.readUInt16LE=W.readUInt16LE,T.readUInt16BE=W.readUInt16BE,T.readUInt32LE=W.readUInt32LE,T.readUInt32BE=W.readUInt32BE,T.readInt8=W.readInt8,T.readInt16LE=W.readInt16LE,T.readInt16BE=W.readInt16BE,T.readInt32LE=W.readInt32LE,T.readInt32BE=W.readInt32BE,T.readFloatLE=W.readFloatLE,T.readFloatBE=W.readFloatBE,T.readDoubleLE=W.readDoubleLE,T.readDoubleBE=W.readDoubleBE,T.writeUInt8=W.writeUInt8,T.writeUInt16LE=W.writeUInt16LE,T.writeUInt16BE=W.writeUInt16BE,T.writeUInt32LE=W.writeUInt32LE,T.writeUInt32BE=W.writeUInt32BE,T.writeInt8=W.writeInt8,T.writeInt16LE=W.writeInt16LE,T.writeInt16BE=W.writeInt16BE,T.writeInt32LE=W.writeInt32LE,T.writeInt32BE=W.writeInt32BE,T.writeFloatLE=W.writeFloatLE,T.writeFloatBE=W.writeFloatBE,T.writeDoubleLE=W.writeDoubleLE,T.writeDoubleBE=W.writeDoubleBE,T.fill=W.fill,T.inspect=W.inspect,T.toArrayBuffer=W.toArrayBuffer,T}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,r){(function(s,i,_,c,h,d,f,g,p){var _=t("buffer").Buffer,y=4,x=new _(y);x.fill(0),n.exports={hash:function(m,M,v,C){for(var O=M(function(w,L){w.length%y!=0&&(D=w.length+(y-w.length%y),w=_.concat([w,x],D));for(var D,V=[],G=L?w.readInt32BE:w.readInt32LE,Y=0;Y<w.length;Y+=y)V.push(G.call(w,Y));return V}(m=_.isBuffer(m)?m:new _(m),C),8*m.length),M=C,S=new _(v),A=M?S.writeInt32BE:S.writeInt32LE,b=0;b<O.length;b++)A.call(S,O[b],4*b,!0);return S}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,r){(function(s,i,_,c,h,d,f,g,p){var _=t("buffer").Buffer,y=t("./sha"),x=t("./sha256"),m=t("./rng"),M={sha1:y,sha256:x,md5:t("./md5")},v=64,C=new _(v);function O(w,L){var D=M[w=w||"sha1"],V=[];return D||S("algorithm:",w,"is not yet supported"),{update:function(G){return _.isBuffer(G)||(G=new _(G)),V.push(G),G.length,this},digest:function(G){var Y=_.concat(V),Y=L?function(W,$,q){_.isBuffer($)||($=new _($)),_.isBuffer(q)||(q=new _(q)),$.length>v?$=W($):$.length<v&&($=_.concat([$,C],v));for(var ne=new _(v),te=new _(v),ce=0;ce<v;ce++)ne[ce]=54^$[ce],te[ce]=92^$[ce];return q=W(_.concat([ne,q])),W(_.concat([te,q]))}(D,L,Y):D(Y);return V=null,G?Y.toString(G):Y}}}function S(){var w=[].slice.call(arguments).join(" ");throw new Error([w,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}C.fill(0),r.createHash=function(w){return O(w)},r.createHmac=O,r.randomBytes=function(w,L){if(!L||!L.call)return new _(m(w));try{L.call(this,void 0,new _(m(w)))}catch(D){L(D)}};var A,b=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],P=function(w){r[w]=function(){S("sorry,",w,"is not implemented yet")}};for(A in b)P(b[A])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){var _=t("./helpers");function y(S,A){S[A>>5]|=128<<A%32,S[14+(A+64>>>9<<4)]=A;for(var b=1732584193,P=-271733879,w=-1732584194,L=271733878,D=0;D<S.length;D+=16){var V=b,G=P,Y=w,W=L,b=m(b,P,w,L,S[D+0],7,-680876936),L=m(L,b,P,w,S[D+1],12,-389564586),w=m(w,L,b,P,S[D+2],17,606105819),P=m(P,w,L,b,S[D+3],22,-1044525330);b=m(b,P,w,L,S[D+4],7,-176418897),L=m(L,b,P,w,S[D+5],12,1200080426),w=m(w,L,b,P,S[D+6],17,-1473231341),P=m(P,w,L,b,S[D+7],22,-45705983),b=m(b,P,w,L,S[D+8],7,1770035416),L=m(L,b,P,w,S[D+9],12,-1958414417),w=m(w,L,b,P,S[D+10],17,-42063),P=m(P,w,L,b,S[D+11],22,-1990404162),b=m(b,P,w,L,S[D+12],7,1804603682),L=m(L,b,P,w,S[D+13],12,-40341101),w=m(w,L,b,P,S[D+14],17,-1502002290),b=M(b,P=m(P,w,L,b,S[D+15],22,1236535329),w,L,S[D+1],5,-165796510),L=M(L,b,P,w,S[D+6],9,-1069501632),w=M(w,L,b,P,S[D+11],14,643717713),P=M(P,w,L,b,S[D+0],20,-373897302),b=M(b,P,w,L,S[D+5],5,-701558691),L=M(L,b,P,w,S[D+10],9,38016083),w=M(w,L,b,P,S[D+15],14,-660478335),P=M(P,w,L,b,S[D+4],20,-405537848),b=M(b,P,w,L,S[D+9],5,568446438),L=M(L,b,P,w,S[D+14],9,-1019803690),w=M(w,L,b,P,S[D+3],14,-187363961),P=M(P,w,L,b,S[D+8],20,1163531501),b=M(b,P,w,L,S[D+13],5,-1444681467),L=M(L,b,P,w,S[D+2],9,-51403784),w=M(w,L,b,P,S[D+7],14,1735328473),b=v(b,P=M(P,w,L,b,S[D+12],20,-1926607734),w,L,S[D+5],4,-378558),L=v(L,b,P,w,S[D+8],11,-2022574463),w=v(w,L,b,P,S[D+11],16,1839030562),P=v(P,w,L,b,S[D+14],23,-35309556),b=v(b,P,w,L,S[D+1],4,-1530992060),L=v(L,b,P,w,S[D+4],11,1272893353),w=v(w,L,b,P,S[D+7],16,-155497632),P=v(P,w,L,b,S[D+10],23,-1094730640),b=v(b,P,w,L,S[D+13],4,681279174),L=v(L,b,P,w,S[D+0],11,-358537222),w=v(w,L,b,P,S[D+3],16,-722521979),P=v(P,w,L,b,S[D+6],23,76029189),b=v(b,P,w,L,S[D+9],4,-640364487),L=v(L,b,P,w,S[D+12],11,-421815835),w=v(w,L,b,P,S[D+15],16,530742520),b=C(b,P=v(P,w,L,b,S[D+2],23,-995338651),w,L,S[D+0],6,-198630844),L=C(L,b,P,w,S[D+7],10,1126891415),w=C(w,L,b,P,S[D+14],15,-1416354905),P=C(P,w,L,b,S[D+5],21,-57434055),b=C(b,P,w,L,S[D+12],6,1700485571),L=C(L,b,P,w,S[D+3],10,-1894986606),w=C(w,L,b,P,S[D+10],15,-1051523),P=C(P,w,L,b,S[D+1],21,-2054922799),b=C(b,P,w,L,S[D+8],6,1873313359),L=C(L,b,P,w,S[D+15],10,-30611744),w=C(w,L,b,P,S[D+6],15,-1560198380),P=C(P,w,L,b,S[D+13],21,1309151649),b=C(b,P,w,L,S[D+4],6,-145523070),L=C(L,b,P,w,S[D+11],10,-1120210379),w=C(w,L,b,P,S[D+2],15,718787259),P=C(P,w,L,b,S[D+9],21,-343485551),b=O(b,V),P=O(P,G),w=O(w,Y),L=O(L,W)}return Array(b,P,w,L)}function x(S,A,b,P,w,L){return O((A=O(O(A,S),O(P,L)))<<w|A>>>32-w,b)}function m(S,A,b,P,w,L,D){return x(A&b|~A&P,S,A,w,L,D)}function M(S,A,b,P,w,L,D){return x(A&P|b&~P,S,A,w,L,D)}function v(S,A,b,P,w,L,D){return x(A^b^P,S,A,w,L,D)}function C(S,A,b,P,w,L,D){return x(b^(A|~P),S,A,w,L,D)}function O(S,A){var b=(65535&S)+(65535&A);return(S>>16)+(A>>16)+(b>>16)<<16|65535&b}n.exports=function(S){return _.hash(S,y,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){n.exports=function(_){for(var y,x=new Array(_),m=0;m<_;m++)!(3&m)&&(y=4294967296*Math.random()),x[m]=y>>>((3&m)<<3)&255;return x}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){var _=t("./helpers");function y(M,v){M[v>>5]|=128<<24-v%32,M[15+(v+64>>9<<4)]=v;for(var C,O,S,A=Array(80),b=1732584193,P=-271733879,w=-1732584194,L=271733878,D=-1009589776,V=0;V<M.length;V+=16){for(var G=b,Y=P,W=w,$=L,q=D,ne=0;ne<80;ne++){A[ne]=ne<16?M[V+ne]:m(A[ne-3]^A[ne-8]^A[ne-14]^A[ne-16],1);var te=x(x(m(b,5),(te=P,O=w,S=L,(C=ne)<20?te&O|~te&S:!(C<40)&&C<60?te&O|te&S|O&S:te^O^S)),x(x(D,A[ne]),(C=ne)<20?1518500249:C<40?1859775393:C<60?-1894007588:-899497514)),D=L,L=w,w=m(P,30),P=b,b=te}b=x(b,G),P=x(P,Y),w=x(w,W),L=x(L,$),D=x(D,q)}return Array(b,P,w,L,D)}function x(M,v){var C=(65535&M)+(65535&v);return(M>>16)+(v>>16)+(C>>16)<<16|65535&C}function m(M,v){return M<<v|M>>>32-v}n.exports=function(M){return _.hash(M,y,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){function _(v,C){var O=(65535&v)+(65535&C);return(v>>16)+(C>>16)+(O>>16)<<16|65535&O}function y(v,C){var O,S=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),A=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),b=new Array(64);v[C>>5]|=128<<24-C%32,v[15+(C+64>>9<<4)]=C;for(var P,w,L=0;L<v.length;L+=16){for(var D=A[0],V=A[1],G=A[2],Y=A[3],W=A[4],$=A[5],q=A[6],ne=A[7],te=0;te<64;te++)b[te]=te<16?v[te+L]:_(_(_((w=b[te-2],m(w,17)^m(w,19)^M(w,10)),b[te-7]),(w=b[te-15],m(w,7)^m(w,18)^M(w,3))),b[te-16]),O=_(_(_(_(ne,m(w=W,6)^m(w,11)^m(w,25)),W&$^~W&q),S[te]),b[te]),P=_(m(P=D,2)^m(P,13)^m(P,22),D&V^D&G^V&G),ne=q,q=$,$=W,W=_(Y,O),Y=G,G=V,V=D,D=_(O,P);A[0]=_(D,A[0]),A[1]=_(V,A[1]),A[2]=_(G,A[2]),A[3]=_(Y,A[3]),A[4]=_(W,A[4]),A[5]=_($,A[5]),A[6]=_(q,A[6]),A[7]=_(ne,A[7])}return A}var x=t("./helpers"),m=function(v,C){return v>>>C|v<<32-C},M=function(v,C){return v>>>C};n.exports=function(v){return x.hash(v,y,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){r.read=function(_,y,x,m,L){var v,C,O=8*L-m-1,S=(1<<O)-1,A=S>>1,b=-7,P=x?L-1:0,w=x?-1:1,L=_[y+P];for(P+=w,v=L&(1<<-b)-1,L>>=-b,b+=O;0<b;v=256*v+_[y+P],P+=w,b-=8);for(C=v&(1<<-b)-1,v>>=-b,b+=m;0<b;C=256*C+_[y+P],P+=w,b-=8);if(v===0)v=1-A;else{if(v===S)return C?NaN:1/0*(L?-1:1);C+=Math.pow(2,m),v-=A}return(L?-1:1)*C*Math.pow(2,v-m)},r.write=function(_,y,x,m,M,D){var C,O,S=8*D-M-1,A=(1<<S)-1,b=A>>1,P=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=m?0:D-1,L=m?1:-1,D=y<0||y===0&&1/y<0?1:0;for(y=Math.abs(y),isNaN(y)||y===1/0?(O=isNaN(y)?1:0,C=A):(C=Math.floor(Math.log(y)/Math.LN2),y*(m=Math.pow(2,-C))<1&&(C--,m*=2),2<=(y+=1<=C+b?P/m:P*Math.pow(2,1-b))*m&&(C++,m/=2),A<=C+b?(O=0,C=A):1<=C+b?(O=(y*m-1)*Math.pow(2,M),C+=b):(O=y*Math.pow(2,b-1)*Math.pow(2,M),C=0));8<=M;_[x+w]=255&O,w+=L,O/=256,M-=8);for(C=C<<M|O,S+=M;0<S;_[x+w]=255&C,w+=L,C/=256,S-=8);_[x+w-L]|=128*D}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,r){(function(s,i,a,c,h,d,f,g,p){var _,y,x;function m(){}(s=n.exports={}).nextTick=(y=typeof window<"u"&&window.setImmediate,x=typeof window<"u"&&window.postMessage&&window.addEventListener,y?function(M){return window.setImmediate(M)}:x?(_=[],window.addEventListener("message",function(M){var v=M.source;v!==window&&v!==null||M.data!=="process-tick"||(M.stopPropagation(),0<_.length&&_.shift()())},!0),function(M){_.push(M),window.postMessage("process-tick","*")}):function(M){setTimeout(M,0)}),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.binding=function(M){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(M){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(_i);var fu=_i.exports;const du=an(fu);var xi=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],pu=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],vi=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],mu=xi,gu=mu.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),Ar=vi;Ar=Ar.slice().filter(function(o){return!/^(gl\_|texture)/.test(o)});var yu=Ar.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),_u=Tu,xu=xi,wi=pu,vu=vi,wu=gu,bu=yu,nt=999,bi=9999,Cr=0,Pr=1,Mi=2,Si=3,Ai=4,ln=5,Mu=6,Su=7,Au=8,Ci=9,Cu=10,Pi=11,Pu=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Tu(o){var e=0,t=0,n=nt,r,s,i=[],a=[],c=1,h=0,d=0,f=!1,g=!1,p="",_;o=o||{};var y=vu,x=xu;o.version==="300 es"&&(y=bu,x=wu);for(var m={},M={},e=0;e<y.length;e++)m[y[e]]=!0;for(var e=0;e<x.length;e++)M[x[e]]=!0;return function($){return a=[],$!==null?C($):O()};function v($){$.length&&a.push({type:Pu[n],data:$,position:d,line:c,column:h})}function C($){e=0,$.toString&&($=$.toString()),p+=$.replace(/\r\n/g,`
`),_=p.length;for(var q;r=p[e],e<_;){switch(q=e,n){case Cr:e=w();break;case Pr:e=P();break;case Mi:e=b();break;case Si:e=L();break;case Ai:e=G();break;case Pi:e=V();break;case ln:e=Y();break;case bi:e=W();break;case Ci:e=A();break;case nt:e=S();break}if(q!==e)switch(p[q]){case`
`:h=0,++c;break;default:++h;break}}return t+=e,p=p.slice(e),a}function O($){return i.length&&v(i.join("")),n=Cu,v("(eof)"),a}function S(){return i=i.length?[]:i,s==="/"&&r==="*"?(d=t+e-1,n=Cr,s=r,e+1):s==="/"&&r==="/"?(d=t+e-1,n=Pr,s=r,e+1):r==="#"?(n=Mi,d=t+e,e):/\s/.test(r)?(n=Ci,d=t+e,e):(f=/\d/.test(r),g=/[^\w_]/.test(r),d=t+e,n=f?Ai:g?Si:bi,e)}function A(){return/[^\s]/g.test(r)?(v(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function b(){return(r==="\r"||r===`
`)&&s!=="\\"?(v(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function P(){return b()}function w(){return r==="/"&&s==="*"?(i.push(r),v(i.join("")),n=nt,e+1):(i.push(r),s=r,e+1)}function L(){if(s==="."&&/\d/.test(r))return n=ln,e;if(s==="/"&&r==="*")return n=Cr,e;if(s==="/"&&r==="/")return n=Pr,e;if(r==="."&&i.length){for(;D(i););return n=ln,e}if(r===";"||r===")"||r==="("){if(i.length)for(;D(i););return v(r),n=nt,e+1}var $=i.length===2&&r!=="=";if(/[\w_\d\s]/.test(r)||$){for(;D(i););return n=nt,e}return i.push(r),s=r,e+1}function D($){var q=0,ne,te;do{if(ne=wi.indexOf($.slice(0,$.length+q).join("")),te=wi[ne],ne===-1){if(q--+$.length>0)continue;te=$.slice(0,1).join("")}return v(te),d+=te.length,i=i.slice(te.length),i.length}while(!0)}function V(){return/[^a-fA-F0-9]/.test(r)?(v(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function G(){return r==="."||/[eE]/.test(r)?(i.push(r),n=ln,s=r,e+1):r==="x"&&i.length===1&&i[0]==="0"?(n=Pi,i.push(r),s=r,e+1):/[^\d]/.test(r)?(v(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function Y(){return r==="f"&&(i.push(r),s=r,e+=1),/[eE]/.test(r)||(r==="-"||r==="+")&&/[eE]/.test(s)?(i.push(r),s=r,e+1):/[^\d]/.test(r)?(v(i.join("")),n=nt,e):(i.push(r),s=r,e+1)}function W(){if(/[^\d\w_]/.test(r)){var $=i.join("");return M[$]?n=Au:m[$]?n=Su:n=Mu,v(i.join("")),n=nt,e}return i.push(r),s=r,e+1}}var Iu=_u,Ou=Lu;function Lu(o,e){var t=Iu(e),n=[];return n=n.concat(t(o)),n=n.concat(t(null)),n}const Du=an(Ou);var Bu=ku;function ku(o){for(var e=[],t=0;t<o.length;t++)o[t].type!=="eof"&&e.push(o[t].data);return e.join("")}const Ti=an(Bu);var Fu=Uu;function Uu(o){var e=null,t=null,n=0,r=0,s=0,i=0,a=0,c=[],h,d,f;for(h=0,d;h<o.length;h++)if(f=o[h],f.data==="{"){if(n&&n++||(d=p(h,Mt(")"),Mt()),d<0)||(i=d,d=p(d,Mt("("),Mt(")")),d<0)||(a=d,d=p(d,cn),d<0)||o[d].type!=="ident"||(t=o[d].data,d=p(d,cn),d<0))continue;n=1,r=h,e=o[d].data,s=d;var g=p(d,cn);switch(o[g]&&o[g].data){case"lowp":case"highp":case"mediump":s=g}}else if(n&&f.data==="}"){if(--n)continue;c.push({name:t,type:e,body:[r+1,h],args:[a,i+1],outer:[s,h+1]})}for(h=0;h<o.length;h++)if(f=o[h],f.data===";"){if(d=p(h,Mt(")"),Mt()),d<0||(i=d,d=p(d,Mt("("),Mt(")")),d<0)||(a=d,d=p(d,cn),d<0)||o[d].type!=="ident"||(t=o[d].data,d=p(d,cn),d<0)||o[d].type==="operator"||o[d].data==="return")continue;e=o[d].data,c.push({name:t,type:e,body:!1,args:[a,i+1],outer:[d,h+1]})}return c.sort(function(_,y){return _.outer[0]-y.outer[0]});function p(_,y,x){for(var m=_-1;m>=0;m--){if(y(o[m]))return m;if(x&&x(o[m]))return-1}return-1}}function Mt(o){return function(e){return e.type==="operator"&&(!o||e.data===o)}}function cn(o){return o.type!=="whitespace"}const Nu=an(Fu);function zu(o,e){if(typeof o!="object"||o===null)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var n=t.call(o,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(o)}function Ii(o){var e=zu(o,"string");return typeof e=="symbol"?e:String(e)}function Ae(o,e,t){return e=Ii(e),e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}function Oi(o,e){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),t.push.apply(t,n)}return t}function Yt(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Oi(Object(t),!0).forEach(function(n){Ae(o,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):Oi(Object(t)).forEach(function(n){Object.defineProperty(o,n,Object.getOwnPropertyDescriptor(t,n))})}return o}function Vu(o,e){if(o==null)return{};var t={},n=Object.keys(o),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=o[r]);return t}function Gu(o,e){if(o==null)return{};var t=Vu(o,e),n,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);for(r=0;r<s.length;r++)n=s[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(o,n)&&(t[n]=o[n])}return t}function Ru(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function ju(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,Ii(n.key),n)}}function Eu(o,e,t){return e&&ju(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),o}function Li(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Tr(o,e){return Tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Tr(o,e)}function Yu(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),e&&Tr(o,e)}function kn(o){return kn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},kn(o)}function Wu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Xu(o,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Li(o)}function Zu(o){var e=Wu();return function(){var n=kn(o),r;if(e){var s=kn(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Xu(this,r)}}var pe={position:"csm_Position",positionRaw:"csm_PositionRaw",pointSize:"csm_PointSize",fragColor:"csm_FragColor",diffuseColor:"csm_DiffuseColor",normal:"csm_Normal",roughness:"csm_Roughness",metalness:"csm_Metalness",emissive:"csm_Emissive",ao:"csm_AO",bump:"csm_Bump",depthAlpha:"csm_DepthAlpha"},Ye,Wt,Ku=(Ye={},Ae(Ye,"".concat(pe.normal),{"#include <beginnormal_vertex>":`
    vec3 objectNormal = `.concat(pe.normal,`;
    #ifdef USE_TANGENT
	    vec3 objectTangent = vec3( tangent.xyz );
    #endif
    `)}),Ae(Ye,"".concat(pe.position),{"#include <begin_vertex>":`
    vec3 transformed = `.concat(pe.position,`;
  `)}),Ae(Ye,"".concat(pe.positionRaw),{"#include <begin_vertex>":`
    vec4 csm_internal_positionUnprojected = `.concat(pe.positionRaw,`;
    mat4x4 csm_internal_unprojectMatrix = projectionMatrix * modelViewMatrix;
    #ifdef USE_INSTANCING
      csm_internal_unprojectMatrix = csm_internal_unprojectMatrix * instanceMatrix;
    #endif
    csm_internal_positionUnprojected = inverse(csm_internal_unprojectMatrix) * csm_internal_positionUnprojected;
    vec3 transformed = csm_internal_positionUnprojected.xyz;
  `)}),Ae(Ye,"".concat(pe.pointSize),{"gl_PointSize = size;":`
    gl_PointSize = `.concat(pe.pointSize,`;
    `)}),Ae(Ye,"".concat(pe.diffuseColor),{"#include <color_fragment>":`
    #include <color_fragment>
    diffuseColor = `.concat(pe.diffuseColor,`;
  `)}),Ae(Ye,"".concat(pe.fragColor),{"#include <dithering_fragment>":`
    #include <dithering_fragment>
    gl_FragColor  = `.concat(pe.fragColor,`;
  `)}),Ae(Ye,"".concat(pe.emissive),{"vec3 totalEmissiveRadiance = emissive;":`
    vec3 totalEmissiveRadiance = `.concat(pe.emissive,`;
    `)}),Ae(Ye,"".concat(pe.roughness),{"#include <roughnessmap_fragment>":`
    #include <roughnessmap_fragment>
    roughnessFactor = `.concat(pe.roughness,`;
    `)}),Ae(Ye,"".concat(pe.metalness),{"#include <metalnessmap_fragment>":`
    #include <metalnessmap_fragment>
    metalnessFactor = `.concat(pe.metalness,`;
    `)}),Ae(Ye,"".concat(pe.ao),{"#include <aomap_fragment>":`
    #include <aomap_fragment>
    reflectedLight.indirectDiffuse *= 1. - `.concat(pe.ao,`;
    `)}),Ae(Ye,"".concat(pe.bump),{"#include <normal_fragment_maps>":`
    #include <normal_fragment_maps>

    vec3 csm_internal_orthogonal = `.concat(pe.bump," - (dot(").concat(pe.bump,`, normal) * normal);
    vec3 csm_internal_projectedbump = mat3(csm_internal_vModelViewMatrix) * csm_internal_orthogonal;
    normal = normalize(normal - csm_internal_projectedbump);
    `)}),Ae(Ye,"".concat(pe.depthAlpha),{"gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );":`
      gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity * `.concat(pe.depthAlpha,` );
    `),"gl_FragColor = packDepthToRGBA( fragCoordZ );":`
      gl_FragColor = packDepthToRGBA( fragCoordZ );
      gl_FragColor.a *= `.concat(pe.depthAlpha,`;
    `)}),Ye),qu=(Wt={},Ae(Wt,"".concat(pe.position),{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`
    gl_Position = projectionMatrix * modelViewMatrix * vec4( `.concat(pe.position,`, 1.0 );
  `)}),Ae(Wt,"".concat(pe.positionRaw),{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`
    gl_Position = `.concat(pe.position,`;
  `)}),Ae(Wt,"".concat(pe.diffuseColor),{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`
    gl_FragColor = `.concat(pe.diffuseColor,`;
  `)}),Ae(Wt,"".concat(pe.fragColor),{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`
    gl_FragColor = `.concat(pe.fragColor,`;
  `)}),Wt),Qu=`

#ifdef IS_VERTEX
    // csm_Position & csm_PositionRaw
    #ifdef IS_UNKNOWN
        vec3 csm_Position = vec3(0.0);
        vec4 csm_PositionRaw = vec4(0.0);
        vec3 csm_Normal = vec3(0.0);
    #else
        vec3 csm_Position = position;
        vec4 csm_PositionRaw = projectionMatrix * modelViewMatrix * vec4(position, 1.);
        vec3 csm_Normal = normal;
    #endif

    // csm_PointSize
    #ifdef IS_POINTSMATERIAL
        float csm_PointSize = size;
    #endif
#else
    // csm_DiffuseColor & csm_FragColor
    #if defined IS_UNKNOWN || defined IS_SHADERMATERIAL || defined IS_MESHDEPTHMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_SHADOWMATERIAL
        vec4 csm_DiffuseColor = vec4(1.0, 0.0, 1.0, 1.0);
        vec4 csm_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
    #else
        #ifdef USE_MAP
            vec4 _csm_sampledDiffuseColor = texture2D(map, vMapUv);

            #ifdef DECODE_VIDEO_TEXTURE
            // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)
            _csm_sampledDiffuseColor = vec4(mix(pow(_csm_sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), _csm_sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(_csm_sampledDiffuseColor.rgb, vec3(0.04045)))), _csm_sampledDiffuseColor.w);
            #endif

            vec4 csm_DiffuseColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;
            vec4 csm_FragColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;
        #else
            vec4 csm_DiffuseColor = vec4(diffuse, opacity);
            vec4 csm_FragColor = vec4(diffuse, opacity);
        #endif
    #endif

    // csm_Emissive, csm_Roughness, csm_Metalness
    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL
        vec3 csm_Emissive = emissive;
        float csm_Roughness = roughness;
        float csm_Metalness = metalness;
    #endif

    // csm_AO
    #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHBASICMATERIAL || defined IS_MESHLAMBERTMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHTOONMATERIAL
        float csm_AO = 0.0;
    #endif

    // csm_Bump
    #if defined IS_MESHLAMBERTMATERIAL || defined IS_MESHMATCAPMATERIAL || defined IS_MESHNORMALMATERIAL || defined IS_MESHPHONGMATERIAL || defined IS_MESHPHYSICALMATERIAL || defined IS_MESHSTANDARDMATERIAL || defined IS_MESHTOONMATERIAL || defined IS_SHADOWMATERIAL 
        vec3 csm_Bump = vec3(0.0);
    #endif

    float csm_DepthAlpha = 1.0;
#endif
`,Ju=`
    varying mat4 csm_internal_vModelViewMatrix;
`,Hu=`
    csm_internal_vModelViewMatrix = modelViewMatrix;
`,$u=`
    varying mat4 csm_internal_vModelViewMatrix;
`,eh=`
    
`,We,th=(We={},Ae(We,"".concat(pe.position),"*"),Ae(We,"".concat(pe.positionRaw),"*"),Ae(We,"".concat(pe.normal),"*"),Ae(We,"".concat(pe.pointSize),["PointsMaterial"]),Ae(We,"".concat(pe.diffuseColor),"*"),Ae(We,"".concat(pe.fragColor),"*"),Ae(We,"".concat(pe.emissive),["MeshStandardMaterial","MeshPhysicalMaterial"]),Ae(We,"".concat(pe.roughness),["MeshStandardMaterial","MeshPhysicalMaterial"]),Ae(We,"".concat(pe.metalness),["MeshStandardMaterial","MeshPhysicalMaterial"]),Ae(We,"".concat(pe.ao),["MeshStandardMaterial","MeshPhysicalMaterial","MeshBasicMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshToonMaterial"]),Ae(We,"".concat(pe.bump),["MeshLambertMaterial","MeshMatcapMaterial","MeshNormalMaterial","MeshPhongMaterial","MeshPhysicalMaterial","MeshStandardMaterial","MeshToonMaterial","ShadowMaterial"]),Ae(We,"".concat(pe.depthAlpha),"*"),We),nh=["baseMaterial","fragmentShader","vertexShader","uniforms","patchMap","cacheKey","silent"],rh=function(e,t,n){return e.split(t).join(n)},sh=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},ih=function(e,t){return new RegExp("\\b".concat(sh(t),"\\b")).test(e)};function oh(o){try{new o}catch(e){if(e.message.indexOf("is not a constructor")>=0)return!1}return!0}function ah(o,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;Object.assign(o,e);var n=Object.getPrototypeOf(e);Object.entries(Object.getOwnPropertyDescriptors(n)).filter(function(r){var s=typeof r[1].get=="function",i=typeof r[1].set=="function",a=typeof r[1].value=="function",c=r[0]==="constructor";return(s||i||a)&&!c}).forEach(function(r){if(typeof o[r[0]]=="function"){t||console.warn("Function ".concat(r[0]," already exists on CSM, renaming to base_").concat(r[0]));var s="base_".concat(r[0]);o[s]=r[1].value.bind(o);return}Object.defineProperty(o,r[0],r[1])})}function lh(o){var e=o.toString().trim(),t=e.substring(e.indexOf("{")+1,e.lastIndexOf("}"));return t.trim().length===0}function Di(o){return o.replace(/\s/g,"")}function ch(o,e,t){var n=o.lastIndexOf(e);return n===-1?o:o.substring(0,n)+t+o.substring(n+e.length)}var uh=function(o){Yu(t,o);var e=Zu(t);function t(n){var r,s=n.baseMaterial,i=n.fragmentShader,a=n.vertexShader,c=n.uniforms,h=n.patchMap,d=n.cacheKey,f=n.silent,g=Gu(n,nh);Ru(this,t);var p;if(oh(s)?p=new s(g):(p=s,Object.assign(p,g)),p.type==="RawShaderMaterial")throw new Error("CustomShaderMaterial does not support RawShaderMaterial");r=e.call(this),ah(Li(r),p,f),r.__csm={patchMap:h||{},fragmentShader:i||"",vertexShader:a||"",cacheKey:d,baseMaterial:s,instanceID:Zr.MathUtils.generateUUID(),type:p.type,isAlreadyExtended:!lh(p.onBeforeCompile),cacheHash:"",silent:f},r.uniforms=Yt(Yt({},r.uniforms||{}),c||{});{var _=r.__csm,y=_.fragmentShader,x=_.vertexShader,m=r.uniforms;r.__csm.cacheHash=r.getCacheHash(),r.generateMaterial(y,x,m)}return r}return Eu(t,[{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.uniforms=r.uniforms||this.uniforms,Object.assign(this.__csm,r);var s=this.__csm,i=s.fragmentShader,a=s.vertexShader,c=this.uniforms,h=this.getCacheHash();this.__csm.cacheHash=h,this.generateMaterial(i,a,c)}},{key:"clone",value:function(){var r={baseMaterial:this.__csm.baseMaterial,fragmentShader:this.__csm.fragmentShader,vertexShader:this.__csm.vertexShader,uniforms:this.uniforms,silent:this.__csm.silent,patchMap:this.__csm.patchMap,cacheKey:this.__csm.cacheKey},s=new this.constructor(r);return Object.assign(this,s),s}},{key:"getCacheHash",value:function(){var r=this.__csm,s=r.fragmentShader,i=r.vertexShader,a=this.uniforms,c=Object.values(a).reduce(function(d,f){var g=f.value;return d+JSON.stringify(g)},""),h=Di(s)+Di(i)+c;return h.trim().length>0?du(h):this.customProgramCacheKey()}},{key:"generateMaterial",value:function(r,s,i){var a=this,c=this.parseShader(r),h=this.parseShader(s);this.uniforms=i||{},this.customProgramCacheKey=function(){return a.__csm.cacheHash};var d=function(p){try{if(c){var _=a.patchShader(c,p.fragmentShader,!0);p.fragmentShader=a.getMaterialDefine()+_}if(h){var y=a.patchShader(h,p.vertexShader);p.vertexShader=`#define IS_VERTEX;
`+y,p.vertexShader=a.getMaterialDefine()+p.vertexShader}p.uniforms=Yt(Yt({},p.uniforms),a.uniforms),a.uniforms=p.uniforms}catch(x){console.error(x)}};if(this.__csm.isAlreadyExtended){var f=this.onBeforeCompile;this.onBeforeCompile=function(g,p){f(g,p),d(g)}}else this.onBeforeCompile=d;this.needsUpdate=!0}},{key:"patchShader",value:function(r,s,i){var a=this,c=s,h=Yt(Yt({},this.getPatchMapForMaterial()),this.__csm.patchMap);Object.keys(h).forEach(function(g){Object.keys(h[g]).forEach(function(p){var _=th[g],y=a.__csm.type;if(g==="*"||ih(r.main,g))if(!_||Array.isArray(_)&&_.includes(y)||_==="*")c=rh(c,p,h[g][p]);else throw new Error("CSM: ".concat(g," is not available in ").concat(y,". Shader cannot compile."))})}),c=c.replace("void main() {",`
        #ifndef CSM_IS_HEAD_DEFAULTS_DEFINED
          `.concat(i?$u:Ju,`
          #define CSM_IS_HEAD_DEFAULTS_DEFINED 1
        #endif

        `).concat(r.header,`
        
        void main() {
          #ifndef CSM_IS_DEFAULTS_DEFINED
            `).concat(Qu,`
            #define CSM_IS_DEFAULTS_DEFINED 1
          #endif
          
          #ifndef CSM_IS_MAIN_DEFAULTS_DEFINED
            `).concat(i?eh:Hu,`
            #define CSM_IS_MAIN_DEFAULTS_DEFINED 1
          #endif

          // CSM_START
      `));var d=this.__csm.isAlreadyExtended,f=c.includes("// CSM_END");return d&&f?c=ch(c,"// CSM_END",`
          // CSM_END
          `.concat(r.main,`
          // CSM_END
        `)):c=c.replace("// CSM_START",`
        // CSM_START
        `.concat(r.main,`
        // CSM_END
          `)),c=r.defines+c,c}},{key:"parseShader",value:function(r){if(r){var s=r.replace(/\/\*\*(.*?)\*\/|\/\/(.*?)\n/gm,""),i=Du(s),a=Nu(i),c=a.map(function(f){return f.name}).indexOf("main"),h=Ti(i.slice(0,c>=0?a[c].outer[0]:void 0)),d=c>=0?this.getShaderFromIndex(i,a[c].body):"";return{defines:"",header:h,main:d}}}},{key:"getMaterialDefine",value:function(){var r=this.__csm.type;return r?"#define IS_".concat(r.toUpperCase(),`;
`):`#define IS_UNKNOWN;
`}},{key:"getPatchMapForMaterial",value:function(){switch(this.__csm.type){case"ShaderMaterial":return qu;default:return Ku}}},{key:"getShaderFromIndex",value:function(r,s){return Ti(r.slice(s[0],s[1]))}}]),t}(Zr.Material);const hh=["args"],fh=u.defineComponent({__name:"index",props:{baseMaterial:{},vertexShader:{},fragmentShader:{},silent:{type:Boolean},uniforms:{}},setup(o,{expose:e}){const t=o,n=u.shallowRef(null),{extend:r,invalidate:s}=ee.useTresContext();return r({CustomShaderMaterial:uh}),u.watch(t,()=>s()),e({instance:n}),(i,a)=>(u.openBlock(),u.createElementBlock("TresCustomShaderMaterial",{ref_key:"customShaderMaterialClass",ref:n,args:[t]},null,8,hh))}});class Bi extends l.ShaderMaterial{constructor(t={}){super();ue(this,"clock");this.vertexShader=`
      #define STANDARD
      varying vec3 vViewPosition;
      #ifdef USE_TRANSMISSION
      varying vec3 vWorldPosition;
      #endif
    
      varying vec2 vUv;
      varying vec4 vPos;
      varying vec3 vNormalW;
      varying vec3 vPositionW;

      #include <common>
      #include <uv_pars_vertex>
      #include <envmap_pars_vertex>
      #include <color_pars_vertex>
      #include <fog_pars_vertex>
      #include <morphtarget_pars_vertex>
      #include <skinning_pars_vertex>
      #include <logdepthbuf_pars_vertex>
      #include <clipping_planes_pars_vertex>

      void main() {
        
        #include <uv_vertex>
        #include <color_vertex>
        #include <morphcolor_vertex>
      
        #if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
      
          #include <beginnormal_vertex>
          #include <morphnormal_vertex>
          #include <skinbase_vertex>
          #include <skinnormal_vertex>
          #include <defaultnormal_vertex>
      
        #endif
      
        #include <begin_vertex>
        #include <morphtarget_vertex>
        #include <skinning_vertex>
        #include <project_vertex>
        #include <logdepthbuf_vertex>
        #include <clipping_planes_vertex>
      
        #include <worldpos_vertex>
        #include <envmap_vertex>
        #include <fog_vertex>

        mat4 modelViewProjectionMatrix = projectionMatrix * modelViewMatrix;

        vUv = uv;
        vPos = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );
        vPositionW = vec3( vec4( transformed, 1.0 ) * modelMatrix);
        vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );
        
        gl_Position = modelViewProjectionMatrix * vec4( transformed, 1.0 );

      }`,this.fragmentShader=` 
      varying vec2 vUv;
      varying vec3 vPositionW;
      varying vec4 vPos;
      varying vec3 vNormalW;
      
      uniform float time;
      uniform float fresnelOpacity;
      uniform float scanlineSize;
      uniform float fresnelAmount;
      uniform float signalSpeed;
      uniform float hologramBrightness;
      uniform float hologramOpacity;
      uniform bool blinkFresnelOnly;
      uniform bool enableBlinking;
      uniform vec3 hologramColor;

      float flicker( float amt, float time ) {return clamp( fract( cos( time ) * 43758.5453123 ), amt, 1.0 );}
      float random(in float a, in float b) { return fract((cos(dot(vec2(a,b) ,vec2(12.9898,78.233))) * 43758.5453)); }

      void main() {
        vec2 vCoords = vPos.xy;
        vCoords /= vPos.w;
        vCoords = vCoords * 0.5 + 0.5;
        vec2 myUV = fract( vCoords );

        // Defines hologram main color
        vec4 hologramColor = vec4(hologramColor, mix(hologramBrightness, vUv.y, 0.5));

        // Add scanlines
        float scanlines = 10.;
        scanlines += 20. * sin(time *signalSpeed * 20.8 - myUV.y * 60. * scanlineSize);
        scanlines *= smoothstep(1.3 * cos(time *signalSpeed + myUV.y * scanlineSize), 0.78, 0.9);
        scanlines *= max(0.25, sin(time *signalSpeed) * 1.0);

        // Scanlines offsets
        float r = random(vUv.x, vUv.y);
        float g = random(vUv.y * 20.2, vUv.y * .2);
        float b = random(vUv.y * .9, vUv.y * .2);

        // Scanline composition
        hologramColor += vec4(r*scanlines, b*scanlines, r, 1.0) / 84.;
        vec4 scanlineMix = mix(vec4(0.0), hologramColor, hologramColor.a);

        // Calculates fresnel
        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);
        float fresnelEffect = dot(viewDirectionW, vNormalW) * (1.6 - fresnelOpacity/2.);
        fresnelEffect = clamp(fresnelAmount - fresnelEffect, 0., fresnelOpacity);

        // Blinkin effect
        //Suggested by Octano - https://x.com/OtanoDesign?s=20
        float blinkValue = enableBlinking ? 0.6 - signalSpeed : 1.0;
        float blink = flicker(blinkValue, time * signalSpeed * .02);

        // Final shader composition
        vec3 finalColor;

        if(blinkFresnelOnly){
          finalColor = scanlineMix.rgb + fresnelEffect * blink;
        }else{
          finalColor = scanlineMix.rgb * blink + fresnelEffect;
        }

        gl_FragColor = vec4( finalColor, hologramOpacity);

      }`,this.uniforms={time:new l.Uniform(0),fresnelOpacity:new l.Uniform(t.fresnelOpacity!==void 0?t.fresnelOpacity:1),fresnelAmount:new l.Uniform(t.fresnelAmount!==void 0?t.fresnelAmount:.45),scanlineSize:new l.Uniform(t.scanlineSize!==void 0?t.scanlineSize:8),hologramBrightness:new l.Uniform(t.hologramBrightness!==void 0?t.hologramBrightness:1),signalSpeed:new l.Uniform(t.signalSpeed!==void 0?t.signalSpeed:1),hologramColor:new l.Uniform(t.hologramColor!==void 0?new l.Color(t.hologramColor):new l.Color("#00d5ff")),enableBlinking:new l.Uniform(t.enableBlinking!==void 0?t.enableBlinking:!0),blinkFresnelOnly:new l.Uniform(t.blinkFresnelOnly!==void 0?t.blinkFresnelOnly:!0),hologramOpacity:new l.Uniform(t.hologramOpacity!==void 0?t.hologramOpacity:1)},this.clock=new l.Clock,this.setValues(t),this.depthTest=t.depthTest!==void 0?t.depthTest:!1,this.blending=t.blendMode!==void 0?t.blendMode:l.AdditiveBlending,this.transparent=!0,this.side=t.side!==void 0?t.side:l.FrontSide}update(){this.uniforms.time.value=this.clock.getElapsedTime()}}const dh=["uniforms-fresnelAmount-value","uniforms-enableBlinking-value","uniforms-fresnelOpacity-value","uniforms-hologramBrightness-value","uniforms-scanlineSize-value","uniforms-signalSpeed-value","uniforms-hologramColor-value","uniforms-hologramOpacity-value","uniforms-blinkFresnelOnly-value","enableAdditive","side"],ph=u.defineComponent({__name:"index",props:{fresnelAmount:{default:.45},fresnelOpacity:{default:1},blinkFresnelOnly:{type:Boolean,default:!0},enableBlinking:{type:Boolean,default:!0},enableAdditive:{type:Boolean,default:!0},hologramBrightness:{default:.7},scanlineSize:{default:8},signalSpeed:{default:.45},hologramOpacity:{default:1},hologramColor:{default:"#00d5ff"},side:{default:l.FrontSide}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),{extend:r}=ee.useTresContext();r({HolographicMaterial:Bi}),e({root:n,constructor:Bi});const{onBeforeRender:s}=ee.useLoop();return s(({invalidate:i})=>{var a;(a=n.value)==null||a.update(),i()}),(i,a)=>(u.openBlock(),u.createElementBlock("TresHolographicMaterial",{ref_key:"MeshHolographicMaterialClass",ref:n,"uniforms-fresnelAmount-value":t.fresnelAmount,"uniforms-enableBlinking-value":t.enableBlinking,"uniforms-fresnelOpacity-value":t.fresnelOpacity,"uniforms-hologramBrightness-value":t.hologramBrightness,"uniforms-scanlineSize-value":t.scanlineSize,"uniforms-signalSpeed-value":t.signalSpeed,"uniforms-hologramColor-value":t.hologramColor,"uniforms-hologramOpacity-value":t.hologramOpacity,"uniforms-blinkFresnelOnly-value":t.blinkFresnelOnly,enableAdditive:t.enableAdditive,side:t.side},null,8,dh))}});function St(o,e,t){return Math.max(e,Math.min(t,o))}function mh(o,e){return(o%e+e)%e}function gh(o,e,t,n,r){return n+(o-e)*(r-n)/(t-e)}function Ir(o,e,t){return(1-t)*o+t*e}const yh="",At="srgb",Or="srgb-linear",_h="display-p3",ki="display-p3-linear",Lr="linear",Fi="srgb",Ui="rec709",Ni="p3";class un{constructor(e,t,n,r,s,i,a,c,h){un.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,i,a,c,h)}set(e,t,n,r,s,i,a,c,h){const d=this.elements;return d[0]=e,d[1]=r,d[2]=a,d[3]=t,d[4]=s,d[5]=c,d[6]=n,d[7]=i,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,i=n[0],a=n[3],c=n[6],h=n[1],d=n[4],f=n[7],g=n[2],p=n[5],_=n[8],y=r[0],x=r[3],m=r[6],M=r[1],v=r[4],C=r[7],O=r[2],S=r[5],A=r[8];return s[0]=i*y+a*M+c*O,s[3]=i*x+a*v+c*S,s[6]=i*m+a*C+c*A,s[1]=h*y+d*M+f*O,s[4]=h*x+d*v+f*S,s[7]=h*m+d*C+f*A,s[2]=g*y+p*M+_*O,s[5]=g*x+p*v+_*S,s[8]=g*m+p*C+_*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],i=e[4],a=e[5],c=e[6],h=e[7],d=e[8];return t*i*d-t*a*h-n*s*d+n*a*c+r*s*h-r*i*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],i=e[4],a=e[5],c=e[6],h=e[7],d=e[8],f=d*i-a*h,g=a*c-d*s,p=h*s-i*c,_=t*f+n*g+r*p;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/_;return e[0]=f*y,e[1]=(r*h-d*n)*y,e[2]=(a*n-r*i)*y,e[3]=g*y,e[4]=(d*t-r*c)*y,e[5]=(r*s-a*t)*y,e[6]=p*y,e[7]=(n*c-h*t)*y,e[8]=(i*t-n*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,i,a){const c=Math.cos(s),h=Math.sin(s);return this.set(n*c,n*h,-n*(c*i+h*a)+i+e,-r*h,r*c,-r*(-h*i+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Dr.makeScale(e,t)),this}rotate(e){return this.premultiply(Dr.makeRotation(-e)),this}translate(e,t){return this.premultiply(Dr.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Dr=new un,zi=new un().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Vi=new un().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),hn={[Or]:{transfer:Lr,primaries:Ui,luminanceCoefficients:[.2126,.7152,.0722],toReference:o=>o,fromReference:o=>o},[At]:{transfer:Fi,primaries:Ui,luminanceCoefficients:[.2126,.7152,.0722],toReference:o=>o.convertSRGBToLinear(),fromReference:o=>o.convertLinearToSRGB()},[ki]:{transfer:Lr,primaries:Ni,luminanceCoefficients:[.2289,.6917,.0793],toReference:o=>o.applyMatrix3(Vi),fromReference:o=>o.applyMatrix3(zi)},[_h]:{transfer:Fi,primaries:Ni,luminanceCoefficients:[.2289,.6917,.0793],toReference:o=>o.convertSRGBToLinear().applyMatrix3(Vi),fromReference:o=>o.applyMatrix3(zi).convertLinearToSRGB()}},xh=new Set([Or,ki]),rt={enabled:!0,_workingColorSpace:Or,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(o){if(!xh.has(o))throw new Error(`Unsupported working color space, "${o}".`);this._workingColorSpace=o},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;const n=hn[e].toReference,r=hn[t].fromReference;return r(n(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this._workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this._workingColorSpace)},getPrimaries:function(o){return hn[o].primaries},getTransfer:function(o){return o===yh?Lr:hn[o].transfer},getLuminanceCoefficients:function(o,e=this._workingColorSpace){return o.fromArray(hn[e].luminanceCoefficients)}};function Br(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function kr(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}const Gi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ct={h:0,s:0,l:0},Fn={h:0,s:0,l:0};function Fr(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}class Un{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=At){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,rt.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=rt.workingColorSpace){return this.r=e,this.g=t,this.b=n,rt.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=rt.workingColorSpace){if(e=mh(e,1),t=St(t,0,1),n=St(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,i=2*n-s;this.r=Fr(i,s,e+1/3),this.g=Fr(i,s,e),this.b=Fr(i,s,e-1/3)}return rt.toWorkingColorSpace(this,r),this}setStyle(e,t=At){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],i=s.length;if(i===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(i===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=At){const n=Gi[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Br(e.r),this.g=Br(e.g),this.b=Br(e.b),this}copyLinearToSRGB(e){return this.r=kr(e.r),this.g=kr(e.g),this.b=kr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=At){return rt.fromWorkingColorSpace(Ge.copy(this),e),Math.round(St(Ge.r*255,0,255))*65536+Math.round(St(Ge.g*255,0,255))*256+Math.round(St(Ge.b*255,0,255))}getHexString(e=At){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=rt.workingColorSpace){rt.fromWorkingColorSpace(Ge.copy(this),t);const n=Ge.r,r=Ge.g,s=Ge.b,i=Math.max(n,r,s),a=Math.min(n,r,s);let c,h;const d=(a+i)/2;if(a===i)c=0,h=0;else{const f=i-a;switch(h=d<=.5?f/(i+a):f/(2-i-a),i){case n:c=(r-s)/f+(r<s?6:0);break;case r:c=(s-n)/f+2;break;case s:c=(n-r)/f+4;break}c/=6}return e.h=c,e.s=h,e.l=d,e}getRGB(e,t=rt.workingColorSpace){return rt.fromWorkingColorSpace(Ge.copy(this),t),e.r=Ge.r,e.g=Ge.g,e.b=Ge.b,e}getStyle(e=At){rt.fromWorkingColorSpace(Ge.copy(this),e);const t=Ge.r,n=Ge.g,r=Ge.b;return e!==At?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Ct),this.setHSL(Ct.h+e,Ct.s+t,Ct.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ct),e.getHSL(Fn);const n=Ir(Ct.h,Fn.h,t),r=Ir(Ct.s,Fn.s,t),s=Ir(Ct.l,Fn.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ge=new Un;Un.NAMES=Gi;class Ur{constructor(e=0,t=0){Ur.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(St(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,i=this.y-e.y;return this.x=s*n-i*r+e.x,this.y=s*r+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class vh extends l.MeshStandardMaterial{constructor(t={}){super();ue(this,"isMeshPhysicalMaterial");ue(this,"clearcoatMap");ue(this,"clearcoatRoughness");ue(this,"clearcoatRoughnessMap");ue(this,"clearcoatNormalScale");ue(this,"clearcoatNormalMap");ue(this,"ior");ue(this,"transmissionMap");ue(this,"thickness");ue(this,"thicknessMap");ue(this,"attenuationDistance");ue(this,"attenuationColor");ue(this,"specularIntensity");ue(this,"specularIntensityMap");ue(this,"specularColor");ue(this,"specularColorMap");ue(this,"_clearcoat");ue(this,"_transmission");this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ur(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get(){return St(2.5*(this.ior-1)/(this.ior+1),0,1)},set(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.roughness=0,this.transmissionMap=null,this.thickness=.5,this.thicknessMap=null,this.attenuationDistance=Number.POSITIVE_INFINITY,this.attenuationColor=new Un(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Un(1,1,1),this.specularColorMap=null,this._clearcoat=.5,this._transmission=1,this.setValues(t)}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}const wh=u.defineComponent({__name:"index",setup(o,{expose:e}){const t=u.shallowRef(),{extend:n}=ee.useTresContext();return n({MeshGlassMaterial:vh}),e({instance:t}),(r,s)=>(u.openBlock(),u.createElementBlock("TresMeshGlassMaterial",{ref_key:"MeshGlassMaterialClass",ref:t},null,512))}}),bh=Number.parseInt(l.REVISION.replace(/\D+/g,""));class Mh extends l.ShaderMaterial{constructor(t=new l.Vector2){super({uniforms:{inputBuffer:new l.Uniform(null),depthBuffer:new l.Uniform(null),resolution:new l.Uniform(new l.Vector2),texelSize:new l.Uniform(new l.Vector2),halfTexelSize:new l.Uniform(new l.Vector2),kernel:new l.Uniform(0),scale:new l.Uniform(1),cameraNear:new l.Uniform(0),cameraFar:new l.Uniform(1),depthEdge0:new l.Uniform(0),depthEdge1:new l.Uniform(1),depthScale:new l.Uniform(0),depthBias:new l.Uniform(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float depthEdge0;
        uniform float depthEdge1;
        uniform float depthScale;
        uniform float depthBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(
              1.0 - depthEdge1, 1.0 - depthEdge0,
              1.0 - (depth.r * depth.a) + depthBias
            );
            depthFactor = clamp(depthScale * depthFactor + 0.25, 0.0, 1.0);
          #endif

          gl_FragColor = 0.25 * (
            texture2D(inputBuffer, mix(vUv0, vUv, depthFactor))
            + texture2D(inputBuffer, mix(vUv1, vUv, depthFactor))
            + texture2D(inputBuffer, mix(vUv2, vUv, depthFactor))
            + texture2D(inputBuffer, mix(vUv3, vUv, depthFactor))
          );
          
          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${bh>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:l.NoBlending,depthWrite:!1,depthTest:!1});ue(this,"kernel");this.toneMapped=!1,this.setTexelSize(t.x,t.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(t,n){this.uniforms.texelSize.value.set(t,n),this.uniforms.halfTexelSize.value.set(t,n).multiplyScalar(.5)}setResolution(t){this.uniforms.resolution.value.copy(t)}}class Sh{constructor({resolution:e,width:t=500,height:n=500,depthEdge0:r=0,depthEdge1:s=1,depthScale:i=0,depthBias:a=.25}){ue(this,"renderTargetA");ue(this,"renderTargetB");ue(this,"convolutionMaterial");ue(this,"scene");ue(this,"camera");ue(this,"screen");ue(this,"renderToScreen",!1);this.renderTargetA=new l.WebGLRenderTarget(e,e,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:l.HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new Mh,this.convolutionMaterial.setTexelSize(1/t,1/n),this.convolutionMaterial.setResolution(new l.Vector2(t,n)),this.scene=new l.Scene,this.camera=new l.Camera,this.convolutionMaterial.uniforms.depthEdge0.value=r,this.convolutionMaterial.uniforms.depthEdge1.value=s,this.convolutionMaterial.uniforms.depthScale.value=i,this.convolutionMaterial.uniforms.depthBias.value=a,this.convolutionMaterial.defines.USE_DEPTH=i>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),h=new Float32Array([0,0,2,0,0,2]),d=new l.BufferGeometry;d.setAttribute("position",new l.BufferAttribute(c,3)),d.setAttribute("uv",new l.BufferAttribute(h,2)),this.screen=new l.Mesh(d,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const r=this.scene,s=this.camera,i=this.renderTargetA,a=this.renderTargetB,c=this.convolutionMaterial,h=c.uniforms;h.depthBuffer.value=t.depthTexture;const d=c.kernel;let f=t,g,p,_;for(p=0,_=d.length-1;p<_;++p)g=p&1?a:i,h.kernel.value=d[p],h.inputBuffer.value=f.texture,e.setRenderTarget(g),e.render(r,s),f=g;h.kernel.value=d[p],h.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,s)}dispose(){this.screen.material.dispose(),this.screen.geometry.dispose(),this.renderTargetA.dispose(),this.renderTargetB.dispose(),this.convolutionMaterial.dispose()}}class Ah extends l.MeshStandardMaterial{constructor(t={}){super(t);ue(this,"_tDepth",{value:null});ue(this,"_distortionMap",{value:null});ue(this,"_tSharp",{value:null});ue(this,"_tBlur",{value:null});ue(this,"_textureMatrix",{value:null});ue(this,"_mix",{value:.5});ue(this,"_sharpMix",{value:0});ue(this,"_blurMixSmooth",{value:0});ue(this,"_blurMixRough",{value:0});ue(this,"_sharpDepthEdgeMin",{value:.9});ue(this,"_sharpDepthEdgeMax",{value:1});ue(this,"_sharpDepthScale",{value:0});ue(this,"_sharpDepthBias",{value:0});ue(this,"_distortion",{value:1});this.setValues(t)}onBeforeCompile(t){var n;(n=t.defines)!=null&&n.USE_UV||(t.defines.USE_UV="");for(const r of Object.keys(t.defines))t.defines[r.toUpperCase()]=t.defines[r];t.uniforms.tSharp=this._tSharp,t.uniforms.tDepth=this._tDepth,t.uniforms.tBlur=this._tBlur,t.uniforms.distortionMap=this._distortionMap,t.uniforms.textureMatrix=this._textureMatrix,t.uniforms.mixMain=this._mix,t.uniforms.sharpMix=this._sharpMix,t.uniforms.sharpDepthScale=this._sharpDepthScale,t.uniforms.sharpDepthEdgeMin=this._sharpDepthEdgeMin,t.uniforms.sharpDepthEdgeMax=this._sharpDepthEdgeMax,t.uniforms.sharpDepthBias=this._sharpDepthBias,t.uniforms.blurMixSmooth=this._blurMixSmooth,t.uniforms.blurMixRough=this._blurMixRough,t.uniforms.distortion=this._distortion,t.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),t.fragmentShader=`
        uniform sampler2D tSharp;
        uniform sampler2D tBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float mixMain;
        uniform float sharpMix;
        uniform float blurMixSmooth;
        uniform float blurMixRough;
        uniform float sharpDepthScale;
        uniform float sharpDepthBias;
        uniform float sharpDepthEdgeMin;
        uniform float sharpDepthEdgeMax;
        varying vec4 my_vUv;
        ${t.fragmentShader}`,t.fragmentShader=t.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      vec4 new_vUv = my_vUv;

      #ifdef USE_DISTORTION
        float distortionFactor = (texture(distortionMap, vUv).r - 0.5) * distortion;
        new_vUv.x += distortionFactor;
        new_vUv.y += distortionFactor;
      #endif

      #ifdef USE_NORMALMAP

        vec4 normalColor = texture(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        vec2 normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;

        vec4 sharp = texture(tSharp, normal_uv);

        #ifdef USE_BLUR
          vec4 blur = texture(tBlur, normal_uv);
        #endif

        #ifdef USE_DEPTH
          vec4 depth = texture(tDepth, normal_uv);
        #endif

      #else

        vec4 sharp = textureProj(tSharp, new_vUv);

        #ifdef USE_BLUR
          vec4 blur = textureProj(tBlur, new_vUv);
        #endif

        #ifdef USE_DEPTH
          vec4 depth = textureProj(tDepth, new_vUv);
        #endif

      #endif

      #ifdef USE_DEPTH
        float depthFactor = smoothstep(
          1.0 - sharpDepthEdgeMax, 1.0 - sharpDepthEdgeMin,
          1.0 - (depth.r * depth.a) + sharpDepthBias
        );
        depthFactor = clamp(sharpDepthScale * depthFactor, 0.0, 1.0);

        sharp *= depthFactor;
      #endif

      sharp *= (1.0 - roughnessFactor);
      `),t.fragmentShader=t.fragmentShader.replace("#include <opaque_fragment>",`

      #ifdef USE_BLUR
        outgoingLight += mixMain * (
          vec3(sharp) * sharpMix
          + vec3(blur) * (blurMixSmooth * (1.0 - roughnessFactor) + blurMixRough * roughnessFactor)
        );
      #else
        outgoingLight += mixMain * vec3(sharp) * sharpMix;
      #endif

      #include <opaque_fragment>
      `)}get tSharp(){return this._tSharp.value}set tSharp(t){this._tSharp.value=t}get tDepth(){return this._tDepth.value}set tDepth(t){this._tDepth.value=t}get distortionMap(){return this._distortionMap.value}set distortionMap(t){this._distortionMap.value=t}get tBlur(){return this._tBlur.value}set tBlur(t){this._tBlur.value=t}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(t){this._textureMatrix.value=t}get sharpMix(){return this._sharpMix.value}set sharpMix(t){this._sharpMix.value=t}get blurMixSmooth(){return this._blurMixSmooth.value}set blurMixSmooth(t){this._blurMixSmooth.value=t}get blurMixRough(){return this._blurMixRough.value}set blurMixRough(t){this._blurMixRough.value=t}get mix(){return this._mix.value}set mix(t){this._mix.value=t}get sharpDepthScale(){return this._sharpDepthScale.value}set sharpDepthScale(t){this._sharpDepthScale.value=t}get sharpDepthBias(){return this._sharpDepthBias.value}set sharpDepthBias(t){this._sharpDepthBias.value=t}get sharpDepthEdgeMin(){return this._sharpDepthEdgeMin.value}set sharpDepthEdgeMin(t){this._sharpDepthEdgeMin.value=t}get sharpDepthEdgeMax(){return this._sharpDepthEdgeMax.value}set sharpDepthEdgeMax(t){this._sharpDepthEdgeMax.value=t}get distortion(){return this._distortion.value}set distortion(t){this._distortion.value=t}}const Ch=["texture-matrix","t-sharp","t-depth","t-blur","defines-USE_BLUR","defines-USE_DEPTH","defines-USE_DISTORTION"],Ph=u.defineComponent({__name:"index",props:{resolution:{default:256},mix:{default:1},sharpMix:{default:1},sharpDepthScale:{default:1},sharpDepthBias:{default:0},sharpDepthEdgeMin:{default:0},sharpDepthEdgeMax:{default:.2},blurMixSmooth:{default:1},blurMixRough:{default:1},blurDepthScale:{default:1},blurDepthBias:{default:0},blurDepthEdgeMin:{default:0},blurDepthEdgeMax:{default:.2},blurSize:{default:()=>[0,0]},distortionMap:{},distortion:{default:0},reflectorOffset:{default:0},color:{default:()=>new l.Color(3355443)},roughness:{default:1},metalness:{default:0},map:{},lightMap:{},lightMapIntensity:{default:1},aoMap:{},aoMapIntensity:{default:1},emissive:{default:()=>new l.Color(0)},emissiveIntensity:{default:1},emissiveMap:{},bumpMap:{},bumpScale:{default:1},normalMap:{},normalMapType:{default:l.TangentSpaceNormalMap},normalScale:{default:()=>new l.Vector2(1,1)},displacementMap:{},displacementScale:{default:1},displacementBias:{default:0},roughnessMap:{default:null},metalnessMap:{},alphaMap:{},envMap:{},envMapRotation:{default:()=>new l.Euler},envMapIntensity:{default:1},wireframe:{type:Boolean,default:!1},wireframeLinewidth:{default:1},wireframeLinecap:{default:"round"},wireframeLinejoin:{default:"round"},flatShading:{type:Boolean,default:!1},fog:{type:Boolean,default:!0}},setup(o,{expose:e}){const t=o,{extend:n,invalidate:r}=ee.useTresContext();n({MeshReflectionMaterial:Ah});const s=u.computed(()=>500-(Array.isArray(t.blurSize)?t.blurSize[0]:t.blurSize)),i=u.computed(()=>500-(Array.isArray(t.blurSize)?t.blurSize[1]:t.blurSize)),a=u.computed(()=>s.value>0||i.value>0),c=u.computed(()=>t.sharpDepthScale>0||t.blurDepthScale>0),h=u.computed(()=>!!t.distortionMap),d=u.computed(()=>!!t.roughnessMap),f=u.shallowRef();let g;const p={reflectorPlane:new l.Plane,normal:new l.Vector3,reflectorWorldPosition:new l.Vector3,cameraWorldPosition:new l.Vector3,rotationMatrix:new l.Matrix4,lookAtPosition:new l.Vector3(0,0,-1),clipPlane:new l.Vector4,view:new l.Vector3,target:new l.Vector3,q:new l.Vector4,virtualCamera:new l.PerspectiveCamera,textureMatrix:new l.Matrix4},_=new l.WebGLRenderTarget(t.resolution,t.resolution,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,type:l.HalfFloatType,depthBuffer:!0,depthTexture:new l.DepthTexture(t.resolution,t.resolution)}),y=new l.WebGLRenderTarget(t.resolution,t.resolution,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,type:l.HalfFloatType});function x(m,M,v,C){r();const O=m.xr.enabled,S=m.shadowMap.autoUpdate;if(p.reflectorWorldPosition.setFromMatrixPosition(C.matrixWorld),p.cameraWorldPosition.setFromMatrixPosition(v.matrixWorld),p.rotationMatrix.extractRotation(C.matrixWorld),p.normal.set(0,0,1),p.normal.applyMatrix4(p.rotationMatrix),p.reflectorWorldPosition.addScaledVector(p.normal,t.reflectorOffset),p.view.subVectors(p.reflectorWorldPosition,p.cameraWorldPosition),p.view.dot(p.normal)>0)return;C.visible=!1,p.view.reflect(p.normal).negate(),p.view.add(p.reflectorWorldPosition),p.rotationMatrix.extractRotation(v.matrixWorld),p.lookAtPosition.set(0,0,-1),p.lookAtPosition.applyMatrix4(p.rotationMatrix),p.lookAtPosition.add(p.cameraWorldPosition),p.target.subVectors(p.reflectorWorldPosition,p.lookAtPosition),p.target.reflect(p.normal).negate(),p.target.add(p.reflectorWorldPosition),p.virtualCamera.position.copy(p.view),p.virtualCamera.up.set(0,1,0),p.virtualCamera.up.applyMatrix4(p.rotationMatrix),p.virtualCamera.up.reflect(p.normal),p.virtualCamera.lookAt(p.target),p.virtualCamera.far=v.far,p.virtualCamera.updateMatrixWorld(),p.virtualCamera.projectionMatrix.copy(v.projectionMatrix),p.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.textureMatrix.multiply(p.virtualCamera.projectionMatrix),p.textureMatrix.multiply(p.virtualCamera.matrixWorldInverse),p.textureMatrix.multiply(C.matrixWorld),p.reflectorPlane.setFromNormalAndCoplanarPoint(p.normal,p.reflectorWorldPosition),p.reflectorPlane.applyMatrix4(p.virtualCamera.matrixWorldInverse),p.clipPlane.set(p.reflectorPlane.normal.x,p.reflectorPlane.normal.y,p.reflectorPlane.normal.z,p.reflectorPlane.constant);const A=p.virtualCamera.projectionMatrix;p.q.x=(Math.sign(p.clipPlane.x)+A.elements[8])/A.elements[0],p.q.y=(Math.sign(p.clipPlane.y)+A.elements[9])/A.elements[5],p.q.z=-1,p.q.w=(1+A.elements[10])/A.elements[14],p.clipPlane.multiplyScalar(2/p.clipPlane.dot(p.q)),A.elements[2]=p.clipPlane.x,A.elements[6]=p.clipPlane.y,A.elements[10]=p.clipPlane.z+1,A.elements[14]=p.clipPlane.w,m.shadowMap.autoUpdate=!1,m.setRenderTarget(_),m.autoClear||m.clear(),m.render(M,p.virtualCamera),g.render(m,_,y),m.xr.enabled=O,m.shadowMap.autoUpdate=S,C.visible=!0,m.setRenderTarget(null)}return u.watch(()=>[t.resolution],()=>{_.setSize(t.resolution,t.resolution),y.setSize(t.resolution,t.resolution)}),u.watch(()=>[t.resolution,s.value,i.value,t.blurDepthEdgeMin,t.blurDepthEdgeMax,t.blurDepthScale,t.blurDepthBias],()=>{g==null||g.dispose(),g=new Sh({resolution:t.resolution,width:s.value,height:i.value,depthEdge0:t.blurDepthEdgeMin,depthEdge1:t.blurDepthEdgeMax,depthScale:t.blurDepthScale,depthBias:t.blurDepthBias})},{immediate:!0}),u.watch(f,()=>{f.value&&(f.value.onBeforeRender=x)}),u.watch(()=>[a.value],()=>{ee.useLogger().logWarning("MeshReflectionMaterial: Setting blurMixRough or blurMixSmooth to 0, then non-zero triggers a recompile.The TresJS core cannot currently handle recompiled materials.")}),u.watch(c,()=>{ee.useLogger().logWarning("MeshReflectionMaterial: Setting depthScale to 0, then non-zero triggers a recompile.The TresJS core cannot currently handle recompiled materials.")}),u.watch(h,()=>{ee.useLogger().logWarning("MeshReflectionMaterial: Toggling distortionMap triggers a recompile.The TresJS core cannot currently handle recompiled materials.")}),u.watch(d,()=>{ee.useLogger().logWarning("MeshReflectionMaterial: Toggling roughnessMap triggers a recompile.The TresJS core cannot currently handle recompiled materials.")}),u.watch(()=>[t.normalMap],()=>{ee.useLogger().logWarning("MeshReflectionMaterial: Toggling normalMap triggers a recompile.The TresJS core cannot currently handle recompiled materials.")}),u.onBeforeUnmount(()=>{_.dispose(),y.dispose(),g.dispose()}),ee.useLoop().onBeforeRender(({renderer:m,scene:M,camera:v,invalidate:C})=>{var S,A;const O=(A=(S=f.value)==null?void 0:S.__tres)==null?void 0:A.parent;O&&(x(m,M,v,O),C())}),e({instance:f}),(m,M)=>{var v,C,O;return u.openBlock(),u.createElementBlock("TresMeshReflectionMaterial",u.mergeProps({key:`key${a.value?"0":"1"}${c.value?"0":"1"}${h.value?"0":"1"}${d.value?"0":"1"}`,ref_key:"materialRef",ref:f},t,{"texture-matrix":p.textureMatrix,"t-sharp":(v=u.unref(_))==null?void 0:v.texture,"t-depth":(C=u.unref(_))==null?void 0:C.depthTexture,"t-blur":(O=u.unref(y))==null?void 0:O.texture,"defines-USE_BLUR":a.value?"":void 0,"defines-USE_DEPTH":c.value?"":void 0,"defines-USE_DISTORTION":h.value?"":void 0}),null,16,Ch)}}});class Th extends l.MeshStandardMaterial{constructor(t={}){super(t);ue(this,"_time");ue(this,"_factor");this.setValues(t),this._time={value:0},this._factor={value:1}}onBeforeCompile(t){t.uniforms||(t.uniforms={}),t.uniforms.time=this._time,t.uniforms.factor=this._factor,t.vertexShader=`
        uniform float time;
        uniform float factor;
        ${t.vertexShader}
      `,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
          float c = cos( theta );
          float s = sin( theta );
          mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
          vec3 transformed = vec3( position ) * m;
          vNormal = vNormal * m;`)}get time(){return this._time.value}set time(t){this._time.value=t}get factor(){return this._factor.value}set factor(t){this._factor.value=t}}const Ih=["factor"],Oh=u.defineComponent({__name:"index",props:{speed:{default:1},factor:{default:1}},setup(o,{expose:e}){const t=o,n=u.shallowRef(),{extend:r,invalidate:s}=ee.useTresContext();r({MeshWobbleMaterial:Th}),u.watch(t,()=>s());const{onBeforeRender:i}=ee.useLoop();return i(({elapsed:a,invalidate:c})=>{n.value&&(n.value.time=a*(t==null?void 0:t.speed),c())}),e({instance:n}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMeshWobbleMaterial",u.mergeProps({ref_key:"materialRef",ref:n,factor:a.factor},a.$attrs),null,16,Ih))}}),Lh=u.defineComponent({name:"BakeShadows",setup(){const{renderer:o}=ee.useTresContext();u.watchEffect(()=>{o.value.shadowMap.autoUpdate=!1,o.value.shadowMap.needsUpdate=!0})}});var Dh=`void main() {
  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
}`,Bh=`#include <common>

void main() {
  vec2 center = vec2(0., 1.);
  float rotation = 0.0;

  
  
  float size = 0.03;

  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

  bool isPerspective = isPerspectiveMatrix( projectionMatrix );
  if ( isPerspective ) scale *= - mvPosition.z;

  vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
  rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
  mvPosition.xy += rotatedPosition;

  gl_Position = projectionMatrix * mvPosition;
}`;const fn=new l.Vector3(0,0,0),Nr=new l.Vector3(0,0,0),kh=new l.Vector3(0,0,0);function Ri(o,e,t){const n=fn.setFromMatrixPosition(o.matrixWorld);n.project(e);const r=t.width/2,s=t.height/2;return[(Number.isNaN(n.x)?0:n.x)*r+r,-(n.y*s)+s]}function Fh(o,e){const t=fn.setFromMatrixPosition(o.matrixWorld),n=Nr.setFromMatrixPosition(e.matrixWorld),r=t.sub(n),s=e.getWorldDirection(kh);return r.angleTo(s)>Math.PI/2}function Uh(o,e,t,n){const r=fn.setFromMatrixPosition(o.matrixWorld),s=r.clone();s.project(e),t.setFromCamera(new l.Vector2(s.x,s.y),e);const i=t.intersectObjects(n,!0);if(i.length>0){const a=i[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function Nh(o,e){if(e instanceof l.OrthographicCamera)return e.zoom;if(e instanceof l.PerspectiveCamera){const t=fn.setFromMatrixPosition(o.matrixWorld),n=Nr.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function zh(o,e,t){if(e instanceof l.PerspectiveCamera||e instanceof l.OrthographicCamera){const n=fn.setFromMatrixPosition(o.matrixWorld),r=Nr.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(r),i=(t[1]-t[0])/(e.far-e.near),a=t[1]-i*e.far;return Math.round(i*s+a)}}const zr=o=>Math.abs(o)<1e-10?0:o;function ji(o,e,t=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=zr(e[r]*o.elements[r])+(r!==15?",":")");return t+n}const Vh=(o=>e=>ji(e,o))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Gh=(o=>(e,t)=>ji(e,o(t),"translate(-50%,-50%)"))(o=>[1/o,1/o,1/o,1,-1/o,-1/o,-1/o,-1,1/o,1/o,1/o,1,1,1,1,1]),Rh=["geometry","material"],jh=u.defineComponent({__name:"HTML",props:{geometry:{default:new l.PlaneGeometry},material:{},as:{default:"div"},transform:{type:Boolean,default:!1},portal:{},wrapperClass:{},eps:{default:1e-4},distanceFactor:{},fullscreen:{type:Boolean},center:{type:Boolean},pointerEvents:{default:"auto"},sprite:{type:Boolean,default:!1},zIndexRange:{default:()=>[16777271,0]},occlude:{type:[Object,null,Array,Boolean,String]}},emits:["onOcclude"],setup(o,{expose:e,emit:t}){const n=o,r=t,s=u.useSlots(),i=u.useAttrs(),a=u.ref(),c=u.ref(),{geometry:h,material:d,as:f,transform:g,portal:p,wrapperClass:_,eps:y,distanceFactor:x,fullscreen:m,center:M,pointerEvents:v,sprite:C,occlude:O,zIndexRange:S}=u.toRefs(n),{renderer:A,scene:b,camera:P,raycaster:w,sizes:L}=ee.useTresContext(),D=u.computed(()=>document.createElement(f.value)),V=u.ref([0,0]),G=u.ref(0),Y=u.ref(),W=u.computed(()=>g.value?{position:"absolute",top:0,left:0,width:`${L.width.value}px`,height:`${L.height.value}px`,transformStyle:"preserve-3d",pointerEvents:"none",zIndex:2,willChange:"transform"}:{position:"absolute",transform:M.value?"translate3d(-50%,-50%,0)":"none",...m.value&&{top:-L.height.value/2,left:-L.width.value/2,width:`${L.width.value}px`,height:`${L.height.value}px`},zIndex:2,...Object.assign({},i.style),willChange:"transform"}),$=u.computed(()=>({position:"absolute",pointerEvents:v.value})),q=u.ref(null),ne=u.ref(!1),te=u.computed(()=>(O==null?void 0:O.value)&&(O==null?void 0:O.value)!=="blending"||Array.isArray(O==null?void 0:O.value)&&(O==null?void 0:O.value.length)&&u.isRef(O.value[0]));u.watch(()=>O,({value:z})=>{z==="blending"?(D.value.style.zIndex=`${Math.floor(S.value[0]/2)}`,D.value.style.position="absolute",D.value.style.pointerEvents="none"):(D.value.style.zIndex=null,D.value.style.position=null,D.value.style.pointerEvents=null)}),u.watch(()=>{var z;return[a.value,A.value,L.width.value,L.height.value,(z=s.default)==null?void 0:z.call(s)]},([z,F])=>{var k,R,T,I,U,Z;if(z&&F){const j=(p==null?void 0:p.value)||F.domElement;if((k=b.value)==null||k.updateMatrixWorld(),g.value)D.value.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const E=Ri(z,P.value,{width:L.width.value,height:L.height.value});D.value.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${E[0]}px,${E[1]}px,0);transform-origin:0 0;`}j&&!D.value.parentNode&&((R=j.parentNode)==null||R.appendChild(D.value)),g.value?Y.value=u.createVNode("div",{id:"outer",style:W.value},[u.createVNode("div",{id:"inner",style:$.value},[u.createVNode("div",{key:(T=c.value)==null?void 0:T.uuid,id:b==null?void 0:b.value.uuid,class:i.class,style:i.style},(I=s.default)==null?void 0:I.call(s))])]):Y.value=u.createVNode("div",{key:(U=c.value)==null?void 0:U.uuid,id:b==null?void 0:b.value.uuid,style:W.value},(Z=s.default)==null?void 0:Z.call(s)),u.render(Y.value,D.value)}}),u.watchEffect(()=>{_!=null&&_.value&&(D.value.className=_.value)});const ce=u.ref(!0),{onBeforeRender:le}=ee.useLoop();le(({invalidate:z})=>{var F,k,R,T,I,U,Z;if(z(),a.value&&P.value&&A.value){(F=P.value)==null||F.updateMatrixWorld(),a.value.updateWorldMatrix(!0,!1);const j=g.value?V.value:Ri(a.value,P.value,{width:L.width.value||0,height:L.height.value||0});if(g.value||Math.abs(G.value-P.value.zoom)>y.value||Math.abs(V.value[0]-j[0])>y.value||Math.abs(V.value[1]-j[1])>y.value){const E=Fh(a.value,P.value);let J=!1;te.value&&(Array.isArray(O==null?void 0:O.value)?J=O==null?void 0:O.value:(O==null?void 0:O.value)!=="blending"&&(J=[b.value]));const re=ce.value;if(J){const N=Uh(a.value,P.value,w.value,J);ce.value=N&&!E}else ce.value=!E;re!==ce.value&&(r("onOcclude",!ce.value),D.value.style.display=ce.value?"block":"none");const ie=Math.floor(S.value[0]/2),X=O!=null&&O.value?te.value?[S.value[0],ie]:[ie-1,0]:S.value;if(D.value.style.zIndex=`${zh(a.value,P.value,X)}`,D.value.style.willChange="transform",g.value){const[N,ae]=[L.width.value/2,L.height.value/2],he=P.value.projectionMatrix.elements[5]*ae,{isOrthographicCamera:_e,top:Ie,left:Oe,bottom:He,right:ft}=P.value,Pt=Vh(P.value.matrixWorldInverse),Tt=_e?`scale(${he})translate(${zr(-(ft+Oe)/2)}px,${zr((Ie+He)/2)}px)`:`translateZ(${he}px)`;let Ze=a.value.matrixWorld;if(C.value&&(Ze=P.value.matrixWorldInverse.clone().transpose().copyPosition(Ze).scale(a.value.scale),Ze.elements[3]=Ze.elements[7]=Ze.elements[11]=0,Ze.elements[15]=1),D.value.style.width=`${L.width.value}px`,D.value.style.height=`${L.height.value}px`,D.value.style.perspective=_e?"":`${he}px`,(k=Y.value)!=null&&k.el&&((R=Y.value)!=null&&R.children)&&Array.isArray(Y.value.children)){Y.value.el.style.willChange="transform",Y.value.el.style.transform=`${Tt}${Pt}translate(${N}px,${ae}px)`;const $e=Y.value.children[0];$e&&$e.el&&($e.el.style.willChange="transform",$e.el.style.transform=Gh(Ze,1/(((x==null?void 0:x.value)||10)/400)))}}else{const N=(x==null?void 0:x.value)===void 0?1:Nh(a.value,P.value)*(x==null?void 0:x.value);D.value.style.transform=`translate3d(${j[0]}px,${j[1]}px,0) scale(${N})`}}V.value=j,G.value=P.value.zoom}if(!te.value&&c.value&&!ne.value)if(g.value){if((T=Y.value)!=null&&T.el&&((I=Y.value)!=null&&I.children)){const j=((U=Y.value)==null?void 0:U.children)[0];if(j!=null&&j.clientWidth&&(j!=null&&j.clientHeight)){const{isOrthographicCamera:E}=P.value;if(E||h)i.scale&&(Array.isArray(i.scale)?i.scale instanceof l.Vector3?c.value.scale.copy(i.scale.clone().divideScalar(1)):c.value.scale.set(1/i.scale[0],1/i.scale[1],1/i.scale[2]):c.value.scale.setScalar(1/i.scale));else{const J=((x==null?void 0:x.value)||10)/400,re=j.clientWidth*J,ie=j.clientHeight*J;c.value.scale.set(re,ie,1)}ne.value=!0}}}else{const j=D.value.children[0];if(j!=null&&j.clientWidth&&(j!=null&&j.clientHeight)){const J=j.clientWidth*1,re=j.clientHeight*1;c.value.scale.set(J,re,1),ne.value=!0}q.value.lookAt((Z=P.value)==null?void 0:Z.position)}});const me=u.computed(()=>({vertexShader:g.value?void 0:Bh,fragmentShader:Dh})),B=u.computed(()=>{const z=me.value;return d.value||new l.ShaderMaterial({vertexShader:z.vertexShader,fragmentShader:z.fragmentShader,side:l.DoubleSide})});return u.onUnmounted(()=>{B.value&&B.value.dispose(),D.value.remove()}),e({instance:a}),(z,F)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"groupRef",ref:a},[u.unref(O)&&!te.value?(u.openBlock(),u.createElementBlock("TresMesh",{key:0,ref_key:"meshRef",ref:c,geometry:u.unref(h),material:B.value},null,8,Rh)):u.createCommentVNode("",!0)],512))}});var Ei={exports:{}};(function(o,e){(function(t,n){o.exports=n()})(hu,function(){var t=function(){function n(p){return i.appendChild(p.dom),p}function r(p){for(var _=0;_<i.children.length;_++)i.children[_].style.display=_===p?"block":"none";s=p}var s=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(p){p.preventDefault(),r(++s%i.children.length)},!1);var a=(performance||Date).now(),c=a,h=0,d=n(new t.Panel("FPS","#0ff","#002")),f=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var g=n(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:i,addPanel:n,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){h++;var p=(performance||Date).now();if(f.update(p-a,200),p>c+1e3&&(d.update(1e3*h/(p-c),100),c=p,h=0,g)){var _=performance.memory;g.update(_.usedJSHeapSize/1048576,_.jsHeapSizeLimit/1048576)}return p},update:function(){a=this.end()},domElement:i,setMode:r}};return t.Panel=function(n,r,s){var i=1/0,a=0,c=Math.round,h=c(window.devicePixelRatio||1),d=80*h,f=48*h,g=3*h,p=2*h,_=3*h,y=15*h,x=74*h,m=30*h,M=document.createElement("canvas");M.width=d,M.height=f,M.style.cssText="width:80px;height:48px";var v=M.getContext("2d");return v.font="bold "+9*h+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=s,v.fillRect(0,0,d,f),v.fillStyle=r,v.fillText(n,g,p),v.fillRect(_,y,x,m),v.fillStyle=s,v.globalAlpha=.9,v.fillRect(_,y,x,m),{dom:M,update:function(C,O){i=Math.min(i,C),a=Math.max(a,C),v.fillStyle=s,v.globalAlpha=1,v.fillRect(0,0,d,y),v.fillStyle=r,v.fillText(c(C)+" "+n+" ("+c(i)+"-"+c(a)+")",g,p),v.drawImage(M,_+h,y,x-h,m,_,y,x-h,m),v.fillRect(_+x-h,y,h,m),v.fillStyle=s,v.globalAlpha=.9,v.fillRect(_+x-h,y,h,c((1-C/O)*m))}}},t})})(Ei);var Eh=Ei.exports;const Yh=an(Eh),Wh=u.defineComponent({name:"Stats",props:{showPanel:{type:Number,default:0}},setup(o,{expose:e}){const t=new Yh;e({instance:t});const n=document.body;t.showPanel(o.showPanel||0),n==null||n.appendChild(t.dom);const{onBeforeRender:r,onAfterRender:s}=ee.useLoop();r(()=>t.begin(),Number.NEGATIVE_INFINITY),s(()=>t.end(),Number.POSITIVE_INFINITY),u.onUnmounted(()=>{n==null||n.removeChild(t.dom)})}});class Xh{constructor(e,t,n){this.name=e,this.fg=t,this.bg=n,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=90*this.PR,this.canvas.height=48*this.PR,this.canvas.style.width="90px",this.canvas.style.position="absolute",this.canvas.style.height="48px",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n,r,s=0){let i=1/0,a=0;this.context&&(i=Math.min(i,e),a=Math.max(n,e),r=Math.max(r,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(e.toFixed(s)+" "+this.name+" ("+i.toFixed(s)+"-"+parseFloat(a.toFixed(s))+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,(1-t/r)*this.GRAPH_HEIGHT))}}const Yi=class Xt{constructor({logsPerSecond:e=20,samplesLog:t=100,samplesGraph:n=10,precision:r=2,minimal:s=!1,horizontal:i=!0,mode:a=0}={}){this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.activeQuery=null,this.gpuQueries=[],this.renderCount=0,this.mode=a,this.horizontal=i,this.dom=document.createElement("div"),this.dom.style.cssText="position:fixed;top:0;left:0;opacity:0.9;z-index:10000;",s&&(this.dom.style.cssText+="cursor:pointer"),this.gl=null,this.query=null,this.isRunningCPUProfiling=!1,this.minimal=s,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.frames=0,this.renderCount=0,this.threeRendererPatched=!1,this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.queryCreated=!1,this.fpsPanel=this.addPanel(new Xt.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new Xt.Panel("CPU","#0f0","#020"),1),this.gpuPanel=null,this.gpuPanelCompute=null,this.samplesLog=t,this.samplesGraph=n,this.precision=r,this.logsPerSecond=e,this.minimal?(this.dom.addEventListener("click",c=>{c.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},!1),this.mode=a,this.showPanel(this.mode)):window.addEventListener("resize",()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)})}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(r,s){n.begin(),t.call(this,r,s),n.end()},this.threeRendererPatched=!0}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const n=this.dom.children[t];n.style.display=t===e?"block":"none"}this.mode=e}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(e.isWebGLRenderer&&!this.threeRendererPatched){const t=e;this.patchThreeRenderer(t),this.gl=t.getContext()}else!this.gl&&e instanceof WebGL2RenderingContext&&(this.gl=e);if(e.isWebGPURenderer){e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&(this.gpuPanel=this.addPanel(new Xt.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new Xt.Panel("CPT","#e1e1e1","#212121"),3),this.info=e.info);return}else if(!this.gl&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl){console.error("Stats: Unable to obtain WebGL2 context.");return}}else if(!this.gl){console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas.");return}this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new Xt.Panel("GPU","#ff0","#220"),2))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery!==null&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const i=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=i,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}update(){this.info===void 0?this.processGpuQueries():(this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.renderCount=0,this.totalCpuDuration===0&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}endInternal(){this.frames++;const e=(performance||Date).now();if(e>=this.prevCpuTime+1e3/this.logsPerSecond&&(this.updatePanel(this.msPanel,this.averageCpu),this.updatePanel(this.gpuPanel,this.averageGpu),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.prevCpuTime=e),e>=this.prevTime+1e3){const t=this.frames*1e3/(e-this.prevTime);this.fpsPanel.update(t,t,100,100,0),this.prevTime=e,this.frames=0}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,n){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(n,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t){if(t.logs.length>0){let n=0,r=.01;for(let a=0;a<t.logs.length;a++)n+=t.logs[a],t.logs[a]>r&&(r=t.logs[a]);let s=0,i=.01;for(let a=0;a<t.graph.length;a++)s+=t.graph[a],t.graph[a]>i&&(i=t.graph[a]);e&&e.update(n/Math.min(t.logs.length,this.samplesLog),s/Math.min(t.graph.length,this.samplesGraph),r,i,this.precision)}}get domElement(){return this.dom}get container(){return console.warn("Stats: Deprecated! this.container as been replaced to this.dom "),this.dom}};Yi.Panel=Xh;let Zh=Yi;const Kh=u.defineComponent({name:"StatsGl",props:["logsPerSecond","samplesLog","samplesGraph","precision","horizontal","minimal","mode"],setup(o,{expose:e}){const t=new Zh({logsPerSecond:o.logsPerSecond,samplesLog:o.samplesLog,samplesGraph:o.samplesGraph,precision:o.precision,horizontal:o.horizontal,minimal:o.minimal,mode:o.mode});e({instance:t});const n=document.body,r=t.dom||t.container;n==null||n.appendChild(r);const{renderer:s}=ee.useTresContext(),{onAfterRender:i}=ee.useLoop();t.init(s.value),i(()=>t.update(),Number.POSITIVE_INFINITY),u.onUnmounted(()=>{n==null||n.removeChild(r)})}}),{logError:qh}=ee.useLogger();async function Qh(o,e){const t=new Hn,n=(e==null?void 0:e.fileName)||"scene";t.parse(o,r=>{if(r instanceof ArrayBuffer)Hh(r,`${n}.glb`);else{const s=JSON.stringify(r,null,2);Jh(s,`${n}.gltf`)}},r=>{qh("An error happened while exporting the GLTF",r)},e)}function Jh(o,e){Wi(new Blob([o],{type:"text/plain"}),e)}function Hh(o,e){Wi(new Blob([o],{type:"application/octet-stream"}),e)}function Wi(o,e){const t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=URL.createObjectURL(o),t.download=e,t.click(),t.remove()}const $h=["args"],ef=["color"],tf=u.defineComponent({__name:"Box",props:{args:{default:()=>[1,1,1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{invalidate:n}=ee.useTresContext(),{args:r,color:s}=u.toRefs(t);u.watch(r,()=>n());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"boxRef",ref:i},a.$attrs),[u.createElementVNode("TresBoxGeometry",{args:u.unref(r)},null,8,$h),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(s)},null,8,ef)])],16))}}),Xi=new l.Box3,Nn=new l.Vector3;class Zi extends l.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new l.Float32BufferAttribute(e,3)),this.setAttribute("uv",new l.Float32BufferAttribute(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new l.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new l.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new l.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new l.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new l.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new l.InterleavedBufferAttribute(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new l.WireframeGeometry(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new l.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Xi.setFromBufferAttribute(t),this.boundingBox.union(Xi))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new l.Sphere),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let s=0,i=e.count;s<i;s++)Nn.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Nn)),Nn.fromBufferAttribute(t,s),r=Math.max(r,n.distanceToSquared(Nn));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}l.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new l.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},l.ShaderLib.line={uniforms:l.UniformsUtils.merge([l.UniformsLib.common,l.UniformsLib.fog,l.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Vr extends l.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:l.UniformsUtils.clone(l.ShaderLib.line.uniforms),vertexShader:l.ShaderLib.line.vertexShader,fragmentShader:l.ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Gr=new l.Vector4,Ki=new l.Vector3,qi=new l.Vector3,Ne=new l.Vector4,ze=new l.Vector4,ot=new l.Vector4,Rr=new l.Vector3,jr=new l.Matrix4,Ve=new l.Line3,Qi=new l.Vector3,zn=new l.Box3,Vn=new l.Sphere,at=new l.Vector4;let lt,kt;function Ji(o,e,t){return at.set(0,0,-e,1).applyMatrix4(o.projectionMatrix),at.multiplyScalar(1/at.w),at.x=kt/t.width,at.y=kt/t.height,at.applyMatrix4(o.projectionMatrixInverse),at.multiplyScalar(1/at.w),Math.abs(Math.max(at.x,at.y))}function nf(o,e){const t=o.matrixWorld,n=o.geometry,r=n.attributes.instanceStart,s=n.attributes.instanceEnd,i=Math.min(n.instanceCount,r.count);for(let a=0,c=i;a<c;a++){Ve.start.fromBufferAttribute(r,a),Ve.end.fromBufferAttribute(s,a),Ve.applyMatrix4(t);const h=new l.Vector3,d=new l.Vector3;lt.distanceSqToSegment(Ve.start,Ve.end,d,h),d.distanceTo(h)<kt*.5&&e.push({point:d,pointOnLine:h,distance:lt.origin.distanceTo(d),object:o,face:null,faceIndex:a,uv:null,uv1:null})}}function rf(o,e,t){const n=e.projectionMatrix,s=o.material.resolution,i=o.matrixWorld,a=o.geometry,c=a.attributes.instanceStart,h=a.attributes.instanceEnd,d=Math.min(a.instanceCount,c.count),f=-e.near;lt.at(1,ot),ot.w=1,ot.applyMatrix4(e.matrixWorldInverse),ot.applyMatrix4(n),ot.multiplyScalar(1/ot.w),ot.x*=s.x/2,ot.y*=s.y/2,ot.z=0,Rr.copy(ot),jr.multiplyMatrices(e.matrixWorldInverse,i);for(let g=0,p=d;g<p;g++){if(Ne.fromBufferAttribute(c,g),ze.fromBufferAttribute(h,g),Ne.w=1,ze.w=1,Ne.applyMatrix4(jr),ze.applyMatrix4(jr),Ne.z>f&&ze.z>f)continue;if(Ne.z>f){const v=Ne.z-ze.z,C=(Ne.z-f)/v;Ne.lerp(ze,C)}else if(ze.z>f){const v=ze.z-Ne.z,C=(ze.z-f)/v;ze.lerp(Ne,C)}Ne.applyMatrix4(n),ze.applyMatrix4(n),Ne.multiplyScalar(1/Ne.w),ze.multiplyScalar(1/ze.w),Ne.x*=s.x/2,Ne.y*=s.y/2,ze.x*=s.x/2,ze.y*=s.y/2,Ve.start.copy(Ne),Ve.start.z=0,Ve.end.copy(ze),Ve.end.z=0;const y=Ve.closestPointToPointParameter(Rr,!0);Ve.at(y,Qi);const x=l.MathUtils.lerp(Ne.z,ze.z,y),m=x>=-1&&x<=1,M=Rr.distanceTo(Qi)<kt*.5;if(m&&M){Ve.start.fromBufferAttribute(c,g),Ve.end.fromBufferAttribute(h,g),Ve.start.applyMatrix4(i),Ve.end.applyMatrix4(i);const v=new l.Vector3,C=new l.Vector3;lt.distanceSqToSegment(Ve.start,Ve.end,C,v),t.push({point:C,pointOnLine:v,distance:lt.origin.distanceTo(C),object:o,face:null,faceIndex:g,uv:null,uv1:null})}}}class sf extends l.Mesh{constructor(e=new Zi,t=new Vr({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let i=0,a=0,c=t.count;i<c;i++,a+=2)Ki.fromBufferAttribute(t,i),qi.fromBufferAttribute(n,i),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+Ki.distanceTo(qi);const s=new l.InstancedInterleavedBuffer(r,2,1);return e.setAttribute("instanceDistanceStart",new l.InterleavedBufferAttribute(s,1,0)),e.setAttribute("instanceDistanceEnd",new l.InterleavedBufferAttribute(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;r===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;lt=e.ray;const i=this.matrixWorld,a=this.geometry,c=this.material;kt=c.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),Vn.copy(a.boundingSphere).applyMatrix4(i);let h;if(n)h=kt*.5;else{const f=Math.max(r.near,Vn.distanceToPoint(lt.origin));h=Ji(r,f,c.resolution)}if(Vn.radius+=h,lt.intersectsSphere(Vn)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),zn.copy(a.boundingBox).applyMatrix4(i);let d;if(n)d=kt*.5;else{const f=Math.max(r.near,zn.distanceToPoint(lt.origin));d=Ji(r,f,c.resolution)}zn.expandByScalar(d),lt.intersectsBox(zn)!==!1&&(n?nf(this,t):rf(this,r,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Gr),this.material.uniforms.resolution.value.set(Gr.z,Gr.w))}}class Hi extends Zi{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class of extends sf{constructor(e=new Hi,t=new Vr({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const af=["object"],$i=u.defineComponent({__name:"Line2",props:{points:{},vertexColors:{default:null},color:{default:"white"},lineWidth:{default:1},worldUnits:{type:Boolean,default:!1},alphaToCoverage:{type:Boolean,default:!1},dashed:{type:Boolean,default:!1},dashSize:{default:1},gapSize:{default:1},dashScale:{default:1},dashOffset:{default:0}},setup(o,{expose:e}){const t=o;function n(p,_){if(!p||p.length===0)return Array.from({length:_}).fill(ee.normalizeColor(t.color));if(p.length===1)return Array.from({length:_}).fill(ee.normalizeColor(p[0]));if(p.length===_)return p.map(ee.normalizeColor);const y=_-1,x=p.map(ee.normalizeColor);closed&&x.push(x[0].clone());const m=[x[0]],M=y/(x.length-1);for(let v=1;v<y;v++){const C=v%M/M,O=Math.floor(v/M);m.push(x[O].clone().lerp(x[O+1],C))}return m.push(x[x.length-1]),m}const r=new Vr,s=new Hi,i=new of(s,r),{sizes:a,invalidate:c}=ee.useTresContext(),h=u.computed(()=>Array.isArray(t.vertexColors));function d(p,_){p.color=ee.normalizeColor(_.color),p.linewidth=_.lineWidth,p.alphaToCoverage=_.alphaToCoverage,p.worldUnits=_.worldUnits,p.vertexColors=Array.isArray(_.vertexColors),p.dashed=_.dashed,p.dashScale=_.dashScale,p.dashSize=_.dashSize,p.dashOffset=_.dashOffset,p.gapSize=_.gapSize,p.needsUpdate=!0}function f(p,_,y){const x=_.map(M=>M instanceof l.Vector3?[M.x,M.y,M.z]:M instanceof l.Vector2?[M.x,M.y,0]:Array.isArray(M)&&M.length===2?[M[0],M[1],0]:M).flat();p.setPositions(x.flat());const m=n(y,_.length).map(M=>M.toArray()).flat();p.setColors(m),i.computeLineDistances()}d(r,t),f(s,t.points,t.vertexColors),i.computeLineDistances(),u.watch(()=>[t.color,t.lineWidth,t.alphaToCoverage,t.worldUnits,h,t.dashed,t.dashScale,t.dashSize,t.dashOffset],()=>{d(r,t),c()}),u.watch(()=>[t.points,t.vertexColors],()=>{f(s,t.points,t.vertexColors),c()}),u.watch(()=>[a.height,a.width],()=>{r.resolution=new l.Vector2(a.width.value,a.height.value),c()}),u.onUnmounted(()=>{s.dispose(),r.dispose()});const g=u.shallowRef();return e({instance:g}),(p,_)=>(u.openBlock(),u.createElementBlock("primitive",{ref:g.value,object:u.unref(i)},null,8,af))}}),lf=u.defineComponent({__name:"CatmullRomCurve3",props:{segments:{default:20},closed:{type:Boolean,default:!1},curveType:{default:"centripetal"},tension:{default:.5},points:{},vertexColors:{},color:{},lineWidth:{},alphaToCoverage:{type:Boolean},dashed:{type:Boolean},dashSize:{},dashScale:{},dashOffset:{},gapSize:{},worldUnits:{type:Boolean}},setup(o,{expose:e}){const t=o;function n(c,h,d,f){const g=c.map(p=>p instanceof l.Vector3?p:new l.Vector3(...p));return new l.CatmullRomCurve3(g,h,d,f)}function r(c,h){return c.getPoints(h)}const s=u.computed(()=>n(t.points,t.closed,t.curveType,t.tension)),i=u.computed(()=>r(s.value,t.segments)),a=u.shallowRef();return e({instance:a}),(c,h)=>(u.openBlock(),u.createBlock($i,{ref:a.value,points:i.value,"vertex-colors":t.vertexColors,color:t.color,"line-width":t.lineWidth,"alpha-to-coverage":t.alphaToCoverage,dashed:t.dashed,"dash-size":t.dashSize,"dash-scale":t.dashScale,"dash-offset":t.dashOffset,"gap-size":t.gapSize,"world-units":t.worldUnits},null,8,["points","vertex-colors","color","line-width","alpha-to-coverage","dashed","dash-size","dash-scale","dash-offset","gap-size","world-units"]))}}),cf=["args"],uf=["color"],hf=u.defineComponent({__name:"Circle",props:{args:{default:()=>[1,32,0,Math.PI*2]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"circleRef",ref:i},a.$attrs),[u.createElementVNode("TresCircleGeometry",{args:u.unref(n)},null,8,cf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,uf)])],16))}}),ff=["args"],df=["color"],pf=u.defineComponent({__name:"Cone",props:{args:{default:()=>[1,1,12,12,!1,0,Math.PI*2]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"coneRef",ref:i},a.$attrs),[u.createElementVNode("TresConeGeometry",{args:u.unref(n)},null,8,ff),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,df)])],16))}}),mf=["args"],gf=["color"],yf=u.defineComponent({__name:"Cylinder",props:{args:{default:()=>[1,1,1,32,1,!1,0,Math.PI*2]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"cylinderRef",ref:i},a.$attrs),[u.createElementVNode("TresCylinderGeometry",{args:u.unref(n)},null,8,mf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,gf)])],16))}}),_f=["args"],xf=["color"],vf=u.defineComponent({__name:"Dodecahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef(),{invalidate:i}=ee.useTresContext();return u.watch(n,()=>i()),e({instance:s}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"dodecahedronRef",ref:s},a.$attrs),[u.createElementVNode("TresDodecahedronGeometry",{args:u.unref(n)},null,8,_f),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,xf)])],16))}}),wf=["args"],bf=["color"],Mf=u.defineComponent({__name:"Icosahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"icosahedronRef",ref:i},a.$attrs),[u.createElementVNode("TresIcosahedronGeometry",{args:u.unref(n)},null,8,wf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,bf)])],16))}}),Sf=["args"],Af=["color"],Cf=u.defineComponent({__name:"Octahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"octahedronRef",ref:i},a.$attrs),[u.createElementVNode("TresOctahedronGeometry",{args:u.unref(n)},null,8,Sf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Af)])],16))}}),Pf=["rotation"],Tf=["args"],If=["color"],Of=u.defineComponent({__name:"Plane",props:{args:{default:()=>[1,1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"planeRef",ref:i,rotation:[-Math.PI/2,0,0]},a.$attrs),[u.createElementVNode("TresPlaneGeometry",{args:u.unref(n)},null,8,Tf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,If)])],16,Pf))}}),Lf=["args"],Df=["color"],Bf=u.defineComponent({__name:"Ring",props:{args:{default:()=>[.5,1,32]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"ringRef",ref:i},a.$attrs),[u.createElementVNode("TresRingGeometry",{args:u.unref(n)},null,8,Lf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Df)])],16))}}),kf=["args"],Ff=["color"],Uf=u.defineComponent({__name:"RoundedBox",props:{args:{default:()=>[1,1,1,2,.1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s,extend:i}=ee.useTresContext();i({RoundedBoxGeometry:vl}),u.watch(n,()=>s());const a=u.shallowRef();return e({instance:a}),(c,h)=>(u.openBlock(),u.createElementBlock("TresMesh",{ref_key:"roundedBoxRef",ref:a},[u.createElementVNode("TresRoundedBoxGeometry",{args:u.unref(n)},null,8,kf),u.renderSlot(c.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Ff)])],512))}}),Nf=["args"],zf=["color"],Vf=u.defineComponent({__name:"Sphere",props:{args:{default:()=>[2,32,16]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"sphereRef",ref:i},a.$attrs),[u.createElementVNode("TresSphereGeometry",{args:u.unref(n)},null,8,Nf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,zf)])],16))}}),Gf=["geometry"],Rf=["color"],jf=u.defineComponent({__name:"Superformula",props:{widthSegments:{default:32},heightSegments:{default:32},numArmsA:{default:4},expA:{default:()=>[40,1.3,.9]},numArmsB:{default:4},expB:{default:()=>[40,1.3,.9]},color:{default:"white"}},setup(o,{expose:e}){const t=o,{invalidate:n}=ee.useTresContext(),{cos:r,sin:s,abs:i}=Math,a=u.shallowRef(),c=u.shallowRef(t.color);function h(p,_){const y=new l.BufferGeometry,x=p*_,m=new Float32Array(Array.from({length:3*x}).fill(0)),M=new Float32Array(Array.from({length:3*x}).fill(0)),v=[];for(let C=0;C<_-1;C++){for(let P=0;P<p-1;P++){const w=C*p+P,L=w+1,D=w+p,V=L+p;v.push(w,D,L),v.push(D,V,L)}const O=C*p+p-1,S=C*p,A=O+p,b=S+p;v.push(O,A,S),v.push(A,b,S)}return y.setIndex(v),y.setAttribute("position",new l.BufferAttribute(m,3)),y.setAttribute("normal",new l.BufferAttribute(M,3)),y}function d(p,_,y,x,m){return(i(r(_*p*.25))**x+i(s(_*p*.25))**m)**(-1/y)}function f(p,_,y,x,m,M,v,C,O,S,A){const b=2*Math.PI/S,P=-Math.PI,w=Math.PI/(A-1),L=-.5*Math.PI,D=p.getAttribute("position");let V=0,G=0,Y=L;for(let W=0;W<A;W++){G=P;for(let $=0;$<S;$++){const q=d(G,_,y,x,m),ne=d(Y,M,v,C,O);D.setXYZ(V,q*r(G)*ne*r(Y),ne*s(Y),q*s(G)*ne*r(Y)),V++,G+=b}Y+=w}D.needsUpdate=!0,p.computeVertexNormals()}u.watch(()=>t.color,()=>c.value=t.color),u.watch(()=>[t.widthSegments,t.heightSegments],()=>{a.value&&a.value.dispose(),a.value=h(t.widthSegments,t.heightSegments),n()},{immediate:!0}),u.watch(()=>[t.numArmsA,t.expA[0],t.expA[1],t.expA[2],t.numArmsB,t.expB[0],t.expB[1],t.expB[2]],()=>{f(a.value,t.numArmsA,t.expA[0],t.expA[1],t.expA[2],t.numArmsB,t.expB[0],t.expB[1],t.expB[2],t.widthSegments,t.heightSegments),n()},{immediate:!0}),u.onUnmounted(()=>{a.value&&a.value.dispose()});const g=u.shallowRef();return e({instance:g}),(p,_)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"superformulaRef",ref:g},p.$attrs,{geometry:a.value}),[u.renderSlot(p.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:c.value},null,8,Rf)])],16,Gf))}}),Ef=["rotation"],Yf=["args"],Wf=["color"],Xf=u.defineComponent({__name:"Tetrahedron",props:{args:{default:()=>[1,0]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),s=u.shallowRef();return e({instance:s}),(i,a)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"tetrahedronRef",ref:s,rotation:[-Math.PI/2,0,0]},i.$attrs),[u.createElementVNode("TresTetrahedronGeometry",{args:u.unref(n)},null,8,Yf),u.renderSlot(i.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Wf)])],16,Ef))}}),Zf=["args"],Kf=["color"],qf=u.defineComponent({__name:"Torus",props:{args:{default:()=>[1,1,16,80]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"torusRef",ref:i},a.$attrs),[u.createElementVNode("TresTorusGeometry",{args:u.unref(n)},null,8,Zf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Kf)])],16))}}),Qf=["args"],Jf=["color"],Hf=u.defineComponent({__name:"TorusKnot",props:{args:{default:()=>[1,.4,64,8]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"torusKnotRef",ref:i},a.$attrs),[u.createElementVNode("TresTorusKnotGeometry",{args:u.unref(n)},null,8,Qf),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,Jf)])],16))}}),$f=["args"],ed=["color"],td=u.defineComponent({__name:"Tube",props:{args:{default:()=>[new l.QuadraticBezierCurve3(new l.Vector3(-1,0,0),new l.Vector3(0,1,0),new l.Vector3(1,0,0)),20,.2,8,!1]},color:{default:"#ffffff"}},setup(o,{expose:e}){const t=o,{args:n,color:r}=u.toRefs(t),{invalidate:s}=ee.useTresContext();u.watch(n,()=>s());const i=u.shallowRef();return e({instance:i}),(a,c)=>(u.openBlock(),u.createElementBlock("TresMesh",u.mergeProps({ref_key:"tubeRef",ref:i},a.$attrs),[u.createElementVNode("TresTubeGeometry",{args:u.unref(n)},null,8,$f),u.renderSlot(a.$slots,"default",{},()=>[u.createElementVNode("TresMeshBasicMaterial",{color:u.unref(r)},null,8,ed)])],16))}}),nd=["receive-shadow","rotation"],rd=["args"],sd=u.defineComponent({__name:"Backdrop",props:{floor:{default:.25},segments:{default:20},receiveShadow:{type:Boolean,default:!1}},setup(o,{expose:e}){const t=o,n=h=>h===0?0:2**(10*h-10),{floor:r,segments:s,receiveShadow:i}=u.toRefs(t),a=u.ref(null);u.watch([s,r,a],([h,d,f])=>{if(!f||h===null)return;let g=0;const p=h/h/2,_=f.attributes.position;for(let y=0;y<h+1;y++)for(let x=0;x<h+1;x++)_.setXYZ(g++,y/h-p+(y===0?-d:0),x/h-p,n(y/h));_.needsUpdate=!0,f.computeVertexNormals()});const c=u.shallowRef();return e({instance:c}),(h,d)=>(u.openBlock(),u.createElementBlock("TresGroup",u.mergeProps({ref_key:"backdropRef",ref:c},h.$attrs),[u.createElementVNode("TresMesh",{"receive-shadow":u.unref(i),rotation:[-Math.PI/2,0,Math.PI/2]},[u.createElementVNode("TresPlaneGeometry",{ref_key:"planeRef",ref:a,args:[1,1,u.unref(s),u.unref(s)]},null,8,rd),u.renderSlot(h.$slots,"default",{},()=>[d[0]||(d[0]=u.createElementVNode("TresMeshStandardMaterial",{color:8421504,side:2},null,-1))])],8,nd)],16))}}),id=["object"],od=u.defineComponent({__name:"ContactShadows",props:{opacity:{default:1},blur:{default:1},color:{default:"#000000"},tint:{default:void 0},scale:{default:10},width:{default:1},height:{default:1},far:{default:10},smooth:{type:Boolean,default:!0},resolution:{default:512},frames:{default:Number.POSITIVE_INFINITY},depthWrite:{type:Boolean,default:!1}},setup(o,{expose:e}){const t=o;function n(p,_,y){y.blurPlane.visible=!0,y.blurPlane.material=y.horizontalBlurMaterial,y.horizontalBlurMaterial.uniforms.tDiffuse.value=y.renderTarget.texture,y.horizontalBlurMaterial.uniforms.h.value=p/256,_.setRenderTarget(y.renderTargetBlur),_.render(y.blurPlane,y.shadowCamera),y.blurPlane.material=y.verticalBlurMaterial,y.verticalBlurMaterial.uniforms.tDiffuse.value=y.renderTargetBlur.texture,y.verticalBlurMaterial.uniforms.v.value=p/256,_.setRenderTarget(y.renderTarget),_.render(y.blurPlane,y.shadowCamera),y.blurPlane.visible=!1}function r(p,_,y,x){const{renderTarget:m,shadowCamera:M,depthMaterial:v}=x,C=_.background;_.background=null,_.overrideMaterial=v;const O=y.getClearAlpha();y.setClearAlpha(0),y.setRenderTarget(m),y.render(_,M),_.overrideMaterial=null,n(p.blur,y,x),p.smooth&&n(p.blur*.4,y,x),y.setRenderTarget(null),y.setClearAlpha(O),_.background=C}function s(p){const _=new l.Group,y=new l.WebGLRenderTarget(p.resolution,p.resolution);y.texture.generateMipmaps=!1;const x=new l.WebGLRenderTarget(p.resolution,p.resolution);x.texture.generateMipmaps=!1;const m=new l.PlaneGeometry(p.width,p.height).rotateX(Math.PI/2),M=new l.MeshBasicMaterial({map:y.texture,opacity:p.opacity,transparent:!0,depthWrite:p.depthWrite,color:new l.Color(p.color??"black")}),v=new l.Mesh(m,M);_.add(v),v.scale.y=-1;const C=new l.Mesh(m);C.visible=!1,_.add(C);const O=new l.OrthographicCamera(-p.width/2,p.width/2,p.height/2,-p.height/2,0,.3);O.rotation.x=Math.PI/2,_.add(O);const S=new l.MeshDepthMaterial,A=new l.ShaderMaterial(wl);A.depthTest=!1;const b=new l.ShaderMaterial(bl);return b.depthTest=!1,{renderTarget:y,renderTargetBlur:x,shadowCamera:O,depthMaterial:S,horizontalBlurMaterial:A,verticalBlurMaterial:b,shadowGroup:_,plane:v,blurPlane:C}}function i(p,_){const y=_.shadowCamera;y.left=-p.width/2,y.right=p.width/2,y.top=p.height/2,y.bottom=-p.height/2,y.far=p.far;const x=p.width*(Array.isArray(p.scale)?p.scale[0]:p.scale||1),m=p.height*(Array.isArray(p.scale)?p.scale[1]:p.scale||1);_.shadowGroup.scale.set(x,p.far,m)}function a(p,_){_.renderTarget.dispose(),_.renderTargetBlur.dispose(),_.renderTarget=new l.WebGLRenderTarget(p,p),_.renderTarget.texture.generateMipmaps=!1,_.renderTargetBlur=new l.WebGLRenderTarget(p,p),_.renderTargetBlur.texture.generateMipmaps=!1,_.plane.material.map=_.renderTarget.texture}function c(p,_){_.plane.material.color=new l.Color(p.color??"black"),_.depthMaterial.dispose(),_.depthMaterial=new l.MeshDepthMaterial,_.depthMaterial.onBeforeCompile=function(y){const x=p.tint?new l.Color(p.tint):new l.Color("white"),{r:m,g:M,b:v}=x;y.fragmentShader=`
    ${y.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );",`gl_FragColor = vec4( ${m}, ${M}, ${v}, ( 1.0 - fragCoordZ ) * opacity);`)}
    `}}const{onBeforeRender:h}=ee.useLoop(),d=s(t);let f=0;const g=()=>f=f>=t.frames?t.frames-1:f;return h(({renderer:p,scene:_,invalidate:y})=>{f<t.frames&&(f++,r(t,_,p,d),y())}),u.watch(()=>[t.opacity,t.depthWrite,t.blur,t.smooth],()=>{d.plane.material.opacity=t.opacity??1,d.plane.material.depthWrite=t.depthWrite??!1,g()},{immediate:!0}),u.watch(()=>[t.color,t.tint],()=>{c(t,d),g()},{immediate:!0}),u.watch(()=>[t.resolution],()=>{a(t.resolution,d),g()}),u.watch(()=>[t.width,t.height,t.scale,t.far],()=>{i(t,d),g()},{immediate:!0}),u.onUnmounted(()=>{for(const p of Object.values(d))p&&"dispose"in p&&typeof p.dispose=="function"&&p.dispose()}),e({instance:d.shadowGroup}),(p,_)=>(u.openBlock(),u.createElementBlock("primitive",{object:u.unref(d).shadowGroup},null,8,id))}}),ad=u.defineComponent({__name:"Fit",props:{into:{default:()=>new l.Box3(new l.Vector3(-.5,-.5,-.5),new l.Vector3(.5,.5,.5))},precise:{type:Boolean,default:!1}},setup(o,{expose:e}){const t=o,{invalidate:n}=ee.useTresContext(),r=u.shallowRef(new l.Group),s=u.shallowRef(new l.Group);function i(h,d){if(r.value.position.set(0,0,0),r.value.updateMatrixWorld(),s.value.scale.set(1,1,1),s.value.updateMatrixWorld(),!s.value.children.length||h===null)return;const{box3:f,use:g}=a(h,d),p=new l.Box3;s.value.children.forEach(M=>p.expandByObject(M,d));const _=p.getSize(new l.Vector3),y=f.getSize(new l.Vector3),x=Math.min(y.x/_.x,y.y/_.y,y.z/_.z);s.value.scale.setScalar(x===Number.POSITIVE_INFINITY?1:x),s.value.updateMatrixWorld();const m=r.value.worldToLocal(p.getCenter(new l.Vector3));if(g.position){const M=r.value.worldToLocal(f.getCenter(new l.Vector3));r.value.position.copy(M.sub(m.multiplyScalar(x)))}else r.value.position.copy(m.sub(m.multiplyScalar(x)));n()}function a(h,d){return typeof h=="number"?h=new l.Vector3(h,h,h):Array.isArray(h)&&(h=new l.Vector3(...h)),h&&"isVector3"in h&&h.isVector3?{box3:new l.Box3(new l.Vector3(0,0,0),h),use:{position:!1}}:h&&"isBox3"in h&&h.isBox3?{box3:h,use:{position:!0}}:h&&"isObject3D"in h&&h.isObject3D?{box3:new l.Box3().setFromObject(h,d??!1),use:{position:!0}}:{box3:new l.Box3(new l.Vector3(-.5,-.5,-.5),new l.Vector3(.5,.5,.5)),use:{position:!0}}}u.watch(()=>[t.into,t.precise],()=>i(t.into,t.precise)),u.onMounted(()=>{i(t.into,t.precise),u.nextTick().then(()=>{i(t.into,t.precise)})});const c=u.shallowRef();return e({instance:c,fit:(h=new l.Box3(new l.Vector3(-.5,-.5,-.5),new l.Vector3(.5,.5,.5)),d=!1)=>{i(h,d)},update:()=>i(t.into,t.precise)}),(h,d)=>(u.openBlock(),u.createElementBlock("TresGroup",{ref_key:"outer",ref:c},[u.createElementVNode("TresGroup",{ref_key:"middle",ref:r},[u.createElementVNode("TresGroup",{ref_key:"inner",ref:s},[u.renderSlot(h.$slots,"default")],512)],512)],512))}}),ld=["rotation-x","args"],cd=u.defineComponent({__name:"Ocean",props:{textureWidth:{default:512},textureHeight:{default:512},waterNormals:{default:"https://raw.githubusercontent.com/Tresjs/assets/main/textures/water-normals/Water_1_M_Normal.jpg"},sunDirection:{default:()=>new l.Vector3},sunColor:{default:16777215},waterColor:{default:7695},distortionScale:{default:3.7},size:{default:1},clipBias:{default:0},alpha:{default:1},side:{default:l.FrontSide}},async setup(o,{expose:e}){let t,n;const r=o,{textureWidth:s,textureHeight:i,waterNormals:a,sunDirection:c,sunColor:h,waterColor:d,distortionScale:f,size:g,clipBias:p,alpha:_,side:y}=u.toRefs(r),{extend:x,scene:m}=ee.useTresContext();x({Water:nl});const M=u.shallowRef(),v=u.shallowRef(),C=m.value.fog!==void 0;e({instance:M}),m.value.traverse(A=>{Object.prototype.hasOwnProperty.call(A,"isSky")&&(v.value=A)}),u.onMounted(async()=>{if(await u.nextTick(),v.value){const A=v.value.material.uniforms.sunPosition.value;M.value.material.uniforms.sunDirection.value.copy(A)}});const{normalMap:O}=([t,n]=u.withAsyncContext(()=>ee.useTexture({normalMap:a.value})),t=await t,n(),t);O.wrapS=O.wrapT=l.RepeatWrapping;const{onBeforeRender:S}=ee.useLoop();return S(({delta:A,invalidate:b})=>{M.value.material.uniforms.time.value+=A,b()}),(A,b)=>(u.openBlock(),u.createElementBlock("TresWater",{ref_key:"waterRef",ref:M,"rotation-x":-Math.PI/2,args:[void 0,{textureWidth:u.unref(s),textureHeight:u.unref(i),waterNormals:u.unref(O),sunDirection:u.unref(c),sunColor:u.unref(h),waterColor:u.unref(d),distortionScale:u.unref(f),fog:C,size:u.unref(g),clipBias:u.unref(p),alpha:u.unref(_),side:u.unref(y)}]},[u.renderSlot(A.$slots,"default",{},()=>[b[0]||(b[0]=u.createElementVNode("TresPlaneGeometry",{args:[1e4,1e4]},null,-1))])],8,ld))}}),ud=["size","color","alpha-map","map","opacity","alpha-test","depth-write","transparent","size-attenuation"],hd=["position","velocity"],fd=u.defineComponent({__name:"Precipitation",props:{size:{default:.1},area:{default:()=>[10,10,20]},color:{default:16777215},map:{},alphaMap:{},alphaTest:{default:.01},opacity:{default:.8},count:{default:5e3},speed:{default:.1},randomness:{default:.5},depthWrite:{type:Boolean,default:!1},transparent:{type:Boolean,default:!0},sizeAttenuation:{type:Boolean,default:!0}},setup(o,{expose:e}){const t=o,{size:n,area:r,color:s,alphaMap:i,map:a,opacity:c,alphaTest:h,depthWrite:d,transparent:f,sizeAttenuation:g,count:p,speed:_,randomness:y}=u.toRefs(t),x=u.shallowRef();let m=[],M=[];const v=()=>{m=new Float32Array(p.value*3);for(let A=0;A<p.value;A++){const b=A*3;m[b]=(Math.random()-.5)*r.value[0],m[b+1]=(Math.random()-.5)*r.value[1],m[b+2]=(Math.random()-.5)*r.value[2]}},C=()=>{M=new Float32Array(p.value*2);for(let A=0;A<p.value*2;A+=2)M[A]=(Math.random()-.5)/5*_.value*y.value,M[A+1]=Math.random()/5*_.value};C(),v(),u.watchEffect(()=>{C(),v()});const{onBeforeRender:O}=ee.useLoop();O(({invalidate:A})=>{var b,P;if((b=x.value)!=null&&b.attributes.position.array&&((P=x.value)!=null&&P.attributes.position.count)){const w=x.value.attributes.position.array;for(let L=0;L<x.value.attributes.position.count;L++){const D=M[L*2],V=M[L*2+1];w[L*3]+=D,w[L*3+1]-=V,(w[L*3]<=-r.value[0]/2||w[L*3]>=r.value[0]/2)&&(w[L*3]=w[L*3]*-1),(w[L*3+1]<=-r.value[1]/2||w[L*3+1]>=r.value[1]/2)&&(w[L*3+1]=w[L*3+1]*-1)}x.value.attributes.position.needsUpdate=!0,A()}});const S=u.shallowRef();return e({instance:S}),(A,b)=>(u.openBlock(),u.createElementBlock("TresPoints",{ref_key:"pointsRef",ref:S},[u.createElementVNode("TresPointsMaterial",{size:u.unref(n),color:u.unref(s),"alpha-map":u.unref(i),map:u.unref(a),opacity:u.unref(c),"alpha-test":u.unref(h),"depth-write":u.unref(d),transparent:u.unref(f),"size-attenuation":u.unref(g)},null,8,ud),u.createElementVNode("TresBufferGeometry",{ref_key:"geometryRef",ref:x,position:[u.unref(m),3],velocity:[u.unref(M)]},null,8,hd)],512))}}),dd=["object","material-uniforms-turbidity-value","material-uniforms-rayleigh-value","material-uniforms-mieCoefficient-value","material-uniforms-mieDirectionalG-value","material-uniforms-sunPosition-value","scale"],pd=u.defineComponent({__name:"Sky",props:{turbidity:{default:3.4},rayleigh:{default:3},mieCoefficient:{default:.005},mieDirectionalG:{default:.7},elevation:{default:.6},azimuth:{default:180},distance:{default:45e4}},setup(o,{expose:e}){const t=o,{invalidate:n}=ee.useTresContext();u.watch(t,()=>n());const r=u.shallowRef(),s=new or,i=u.computed(()=>a(t.azimuth,t.elevation));function a(c,h){const d=l.MathUtils.degToRad(90-h),f=l.MathUtils.degToRad(c);return new l.Vector3().setFromSphericalCoords(1,d,f)}return e({instance:r,sunPosition:i.value}),(c,h)=>(u.openBlock(),u.createElementBlock("primitive",{ref_key:"skyRef",ref:r,object:u.unref(s),"material-uniforms-turbidity-value":t.turbidity,"material-uniforms-rayleigh-value":t.rayleigh,"material-uniforms-mieCoefficient-value":t.mieCoefficient,"material-uniforms-mieDirectionalG-value":t.mieDirectionalG,"material-uniforms-sunPosition-value":i.value,scale:t.distance},null,8,dd))}}),md=["position"],gd=["position"],yd=["scale"],_d=["map","depth-test","color-space","color","opacity"],xd=u.defineComponent({__name:"Smoke",props:{color:{default:"#ffffff"},opacity:{default:.5},speed:{default:.4},width:{default:10},depth:{default:1.5},segments:{default:20},texture:{default:"https://raw.githubusercontent.com/Tresjs/assets/main/textures/clouds/defaultCloud.png"},depthTest:{type:Boolean,default:!0}},async setup(o,{expose:e}){let t,n;const r=o,{width:s,depth:i,segments:a,texture:c,color:h,depthTest:d,opacity:f,speed:g}=u.toRefs(r),p=u.shallowRef(),_=u.shallowRef();e({instance:p});const y=[a].map((S,A)=>({x:s.value/2-Math.random()*s.value,y:s.value/2-Math.random()*s.value,scale:.4+Math.sin((A+1)/a.value*Math.PI)*((.2+Math.random())*10),density:Math.max(.2,Math.random()),rotation:Math.max(.002,.005*Math.random())*g.value})),x=(S,A)=>S/6*A*f.value,{map:m}=([t,n]=u.withAsyncContext(()=>ee.useTexture({map:c.value})),t=await t,n(),t),{renderer:M,camera:v}=ee.useTresContext(),C=u.computed(()=>{var S;return(S=M.value)==null?void 0:S.outputColorSpace}),{onBeforeRender:O}=ee.useLoop();return O(({invalidate:S})=>{var A,b;p.value&&v.value&&_.value&&((A=_.value)==null||A.children.forEach((P,w)=>{P.rotation.z+=y[w].rotation}),p.value.lookAt((b=v.value)==null?void 0:b.position),S())}),(S,A)=>(u.openBlock(),u.createElementBlock("TresGroup",u.mergeProps({ref_key:"smokeRef",ref:p},S.$attrs),[u.createElementVNode("TresGroup",{ref_key:"groupRef",ref:_,position:[0,0,u.unref(a)/2*u.unref(i)]},[(u.openBlock(!0),u.createElementBlock(u.Fragment,null,u.renderList(u.unref(y),({scale:b,x:P,y:w,density:L},D)=>(u.openBlock(),u.createElementBlock("TresMesh",{key:`${D}`,position:[P,w,-D*u.unref(i)]},[u.createElementVNode("TresPlaneGeometry",{scale:[b,b,b],rotation:[0,0,0]},null,8,yd),u.createElementVNode("TresMeshStandardMaterial",{map:u.unref(m),"depth-test":u.unref(d),"color-space":C.value,color:u.unref(h),"depth-write":!1,transparent:"",opacity:x(b,L)},null,8,_d)],8,gd))),128))],8,md)],16))}});function vd(o){return Yr(o,{normalizeValue:e=>ee.normalizeColor(e),getDefaultValue:()=>new l.Color(0,0,0),isSingleValue:e=>!Array.isArray(e),isMultipleValues:e=>Array.isArray(e)&&(e.length===0||!Array.isArray(e[0])),isMultipleValuesWithStops:e=>Array.isArray(e)&&e.length>0&&Array.isArray(e[0]),isEmpty:e=>Array.isArray(e)&&e.length===0})}function Er(o){return"isVector3"in o||Array.isArray(o)&&o.length>0&&o.every(e=>typeof e=="number")}function wd(o){return Yr(o,{normalizeValue:e=>ee.normalizeVectorFlexibleParam(e),getDefaultValue:()=>[0,0,0],isSingleValue:e=>Er(e),isMultipleValues:e=>Array.isArray(e)&&e.length>0&&Er(e[0]),isMultipleValuesWithStops:e=>Array.isArray(e)&&e.length>0&&Array.isArray(e[0])&&e[0].length===2&&Er(e[0][1]),isEmpty:e=>Array.isArray(e)&&e.length===0})}function bd(o){return Yr(o,{normalizeValue:e=>e,getDefaultValue:()=>1,isSingleValue:e=>!Array.isArray(e)&&typeof e<"u",isMultipleValues:e=>Array.isArray(e)&&(e.length===0||!Array.isArray(e[0])),isMultipleValuesWithStops:e=>Array.isArray(e)&&e.length>0&&Array.isArray(e[0]),isEmpty:e=>Array.isArray(e)&&e.length===0})}function Yr(o,e){const{normalizeValue:t,getDefaultValue:n,isEmpty:r}=e,s=c=>e.isSingleValue(c),i=c=>e.isMultipleValues(c),a=c=>e.isMultipleValuesWithStops(c);if(r(o))return[[0,n()]];if(s(o))return[[0,t(o)]];if(i(o)){const c=o.length>1?1/(o.length-1):1;return o.map((h,d)=>[c*d,t(h)])}else if(a(o))return o.map(([c,h],d)=>[c,t(h)]);return[[0,n()]]}class Md{constructor(e,t){ue(this,"entries");ue(this,"resolution");this.entries=e,this.resolution=t}useTexture(){return new Cd(this.entries,this.resolution).use()}}class Wr{constructor(e,t,n,r,s,i){ue(this,"data");ue(this,"ref");ue(this,"name");ue(this,"valueMin");ue(this,"valueMax");ue(this,"suffix");ue(this,"renderToCanvasGradient");this.data=u.isRef(e)?e.value:e,this.ref=u.isRef(e)?e:null,this.name=t,this.valueMin=n,this.valueMax=r,this.suffix=s,this.renderToCanvasGradient=i}}class Sd extends Wr{constructor(e,t="color",n=0,r=1,s="rgba",i=Pd){super(e,t,n,r,s,i)}}class eo extends Wr{constructor(e,t="scalar",n=0,r=1,s="x",i=Td){super(e,t,n,r,s,i)}}class Ad extends Wr{constructor(e,t="scalar3",n=0,r=1,s="xyz",i=Id){super(e,t,n,r,s,i)}}class Cd{constructor(e,t){ue(this,"entries");ue(this,"size");ue(this,"dirty",u.shallowRef(0));ue(this,"context");this.entries=e,this.size=Math.max(t,e.length);const n=document.createElement("canvas");n.height=this.size,n.width=this.size,this.context=n.getContext("2d")}use(){const e=this.build(),t=u.shallowRef(e);for(const n of this.entries)n.ref&&u.watch(n.ref,()=>{var r;n.data=(r=n.ref)==null?void 0:r.value,u.triggerRef(this.dirty)});return Fo(this.dirty,()=>{this.build(e),t.value=e},{throttle:1e3/60}),{texture:t,dispose:()=>e.dispose(),yFor:this.entries.reduce((n,r,s)=>(n[r.name]=(s+.5)/this.size,n),{})}}build(e){this.entries.forEach((n,r)=>{const s=this.context.createLinearGradient(0,r,this.size,r);n.renderToCanvasGradient(s,n),this.context.fillStyle=s,this.context.fillRect(0,r,this.size,1)}),e&&(e.source.data=this.context.getImageData(0,0,this.size,this.size));const t=e??new l.DataTexture(this.context.getImageData(0,0,this.size,this.size).data,this.size,this.size,l.RGBAFormat,l.UnsignedByteType,l.UVMapping,l.ClampToEdgeWrapping,l.ClampToEdgeWrapping);return t.needsUpdate=!0,t}}function to(o,e,t,n,r){return gh(St(o,e,t),e,t,n,r)}function Pd(o,e){return vd(e.data).forEach(([t,n])=>o.addColorStop(t,`rgb(${n.r*255}, ${n.g*255}, ${n.b*255})`))}function Td(o,e){return bd(e.data).forEach(([t,n])=>{o.addColorStop(t,`rgb(${to(n,e.valueMin,e.valueMax,0,255)}, 0, 0)`)})}function Id(o,e){return wd(e.data).forEach(([t,n])=>o.addColorStop(t,`rgb(${n.map(r=>to(r,e.valueMin,e.valueMax,0,255))})`))}class Od{constructor(e=256){ue(this,"entries");ue(this,"resolution");this.resolution=e,this.entries=[]}withResolution(e){return this.resolution=e,this}get add(){return new Dd(e=>this.onAdd(e))}build(){return new Md(this.entries,this.resolution)}onAdd(e){return this.entries.push(e),new Ld(e,this)}}class Ld{constructor(e,t){ue(this,"entry");ue(this,"parent");this.entry=e,this.parent=t}id(e){return this.entry.name=e,this}range(e,t){return this.entry.valueMin=e,this.entry.valueMax=t,this}suffix(e){return this.entry.suffix=e,this}canvasGradientRenderer(e){return this.entry.renderToCanvasGradient=e,this}get add(){return this.parent.add}build(){return this.parent.build()}}class Dd{constructor(e){ue(this,"onAdd");this.onAdd=e}GradientTresColor(e){return this.onAdd(new Sd(e))}Gradient01(e){return this.onAdd(new eo(e,"zeroOne",0,1))}GradientScalar(e,t,n){return this.onAdd(new eo(e,"scalar",t,n))}GradientXyz(e,t,n){return this.onAdd(new Ad(e,"position",t,n))}}let Xr=null;function Bd(){return Xr===null&&(Xr=new l.DataTexture(new Uint8Array([0,0,0,0]),1,1)),Xr}const kd=["object"],Fd=u.defineComponent({__name:"component",props:{map:{default:"https://raw.githubusercontent.com/Tresjs/assets/e41a93c56ec7cb5ac2d241f309e23582a5fe1fc6/textures/sparkles/particle.png"},geometry:{default:void 0},directionalLight:{default:void 0},lifetimeSec:{default:.4},cooldownSec:{default:2},normalThreshold:{default:.7},noiseScale:{default:3},scaleNoise:{default:1},offsetNoise:{default:.1},lifetimeNoise:{default:0},size:{default:1},alpha:{default:1},offset:{default:1},surfaceDistance:{default:1},sequenceColor:{default:()=>[[.7,"#82dbc5"],[.8,"#fbb03b"]]},sequenceAlpha:{default:()=>[[0,0],[.1,1],[.5,1],[.9,0]]},sequenceOffset:{default:()=>[0,0,0]},sequenceNoise:{default:()=>[.1,.1,.1]},sequenceSize:{default:()=>[0,1]},sequenceSurfaceDistance:{default:()=>[.05,.08,.1]},mixColor:{default:.5},mixAlpha:{default:1},mixOffset:{default:1},mixSize:{default:0},mixSurfaceDistance:{default:1},mixNoise:{default:1},blending:{default:l.AdditiveBlending},transparent:{type:Boolean,default:!0},depthWrite:{type:Boolean,default:!1}},setup(o,{expose:e}){const t=o,n=Number.parseInt(l.REVISION.replace(/\D+/g,"")),r=u.toRefs(t),s=typeof t.map=="string"?Bd():t.map,{texture:i,yFor:a}=new Od(256).add.GradientTresColor(r.sequenceColor).id("sequenceColor").add.Gradient01(r.sequenceAlpha).id("sequenceAlpha").add.Gradient01(r.sequenceSurfaceDistance).id("sequenceSurfaceDistance").add.Gradient01(r.sequenceSize).id("sequenceSize").add.GradientXyz(r.sequenceOffset,-1,1).id("sequenceOffset").add.GradientXyz(r.sequenceNoise,0,1).id("sequenceNoise").build().useTexture(),c={blending:t.blending,transparent:t.transparent,depthWrite:t.depthWrite,uniforms:{uMap:new l.Uniform(s),uPixelRatio:new l.Uniform(1),uNormal:new l.Uniform(l.Object3D.DEFAULT_UP),uNormalThreshold:new l.Uniform(t.normalThreshold),uTime:new l.Uniform(0),uCooldownRatio:new l.Uniform(1),uSize:new l.Uniform(t.size),uAlpha:new l.Uniform(t.alpha),uOffset:new l.Uniform(t.offset),uSurfaceDistance:new l.Uniform(t.surfaceDistance),uNoiseScale:new l.Uniform(t.noiseScale),uScaleNoise:new l.Uniform(t.scaleNoise),uOffsetNoise:new l.Uniform(t.offsetNoise),uLifetimeNoise:new l.Uniform(t.lifetimeNoise),uMixColor:new l.Uniform(t.mixColor),uMixAlpha:new l.Uniform(t.mixAlpha),uMixOffset:new l.Uniform(t.mixOffset),uMixSize:new l.Uniform(t.mixSize),uMixSurfaceDistance:new l.Uniform(t.mixSurfaceDistance),uMixNoise:new l.Uniform(t.mixNoise),uInfoTexture:new l.Uniform(i.value)},vertexShader:`
    uniform float uPixelRatio;
    uniform vec3 uNormal;
    uniform float uNormalThreshold;
    uniform float uTime;
    uniform float uCooldownRatio;
    uniform float uSize;
    uniform float uAlpha;
    uniform float uOffset;
    uniform float uSurfaceDistance;
    uniform float uNoiseScale;
    uniform float uScaleNoise;
    uniform float uOffsetNoise;
    uniform float uLifetimeNoise;
    uniform float uMixColor;
    uniform float uMixAlpha;
    uniform float uMixOffset;
    uniform float uMixSize;
    uniform float uMixSurfaceDistance;
    uniform float uMixNoise;
    uniform sampler2D uInfoTexture;

    varying vec4 vColor;

    void main() {
      float dotNormal = dot(normal, uNormal) * 0.5 + 0.5;
      float normalP = smoothstep(uNormalThreshold, 1., dotNormal);
      float lifetimeNoise = uLifetimeNoise * mix(normalP, 1.0, uMixNoise);

      float t = uTime + position.x * 1. * uNoiseScale + position.y * 10. * uNoiseScale + 
      position.z * 7.3 * uNoiseScale + sin(lifetimeNoise * (position.x + 13. * position.y)) * lifetimeNoise;

      float lifetimeP = max(-0.0001, mix(-uCooldownRatio, 1. + cos(t) * lifetimeNoise, fract(t)));
      float surfaceDistance = texture2D(uInfoTexture, vec2(
        mix(normalP, lifetimeP, uMixSurfaceDistance),
        ${a.sequenceSurfaceDistance})).x * uSurfaceDistance;

      vec4 modelPosition = modelMatrix * (vec4(position, 1.0) + vec4(normal * surfaceDistance, 0.0));
      vec3 noise = texture2D(uInfoTexture, vec2(
        mix(normalP, lifetimeP, uMixNoise),
        ${a.sequenceNoise})).xyz;
      vec3 offset = uOffset * (texture2D(uInfoTexture, vec2(
        mix(normalP, lifetimeP, uMixOffset),
        ${a.sequenceOffset})).xyz * 2.0 - vec3(1.0, 1.0, 1.0));
      modelPosition.x += cos(t * uNoiseScale * 10.0) * 0.2 * uOffsetNoise * noise.x + offset.x;
      modelPosition.y += sin(t * uNoiseScale * 10.0) * 0.2 * uOffsetNoise * noise.y + offset.y;
      modelPosition.z += cos(t * uNoiseScale * 10.0) * 0.2 * uOffsetNoise * noise.z + offset.z;

      vec4 viewPosition = viewMatrix * modelPosition;
      vec4 projectionPostion = projectionMatrix * viewPosition;
      gl_Position = projectionPostion;

      gl_PointSize = 2.
      * texture2D(uInfoTexture, vec2(mix(normalP, lifetimeP, uMixSize), ${a.sequenceSize})).x
      * mix(1., abs(sin(t * uNoiseScale + position.x * 13.9 + position.y * 73.1)), uScaleNoise)
      * uSize * (100.0 / -viewPosition.z) * uPixelRatio;

      if (gl_PointSize < 0.6 || lifetimeP < 0.0) { gl_Position = vec4(2, 2, 2, 1); }

      vColor = texture2D(uInfoTexture, vec2(mix(normalP, lifetimeP, uMixColor), ${a.sequenceColor}))
      * texture2D(uInfoTexture, vec2(mix(normalP, lifetimeP, uMixAlpha), ${a.sequenceAlpha})).x * uAlpha;
    }`,fragmentShader:`
    varying vec4 vColor;

    uniform sampler2D uMap;
    uniform sampler2D uInfoTexture;

    void main() {
      gl_FragColor = vColor * texture2D(uMap, gl_PointCoord);
      #include <tonemapping_fragment>
      #include <${n>=154?"colorspace_fragment":"encodings_fragment"}>
    }`},h=new l.ShaderMaterial(c),d=new l.Points(void 0,h),f=h.uniforms,g={immediate:!0};[[f.uPixelRatio,ee.useTresContext().sizes.aspectRatio],[f.uSize,r.size],[f.uNormalThreshold,r.normalThreshold],[f.uAlpha,r.alpha],[f.uOffset,r.offset],[f.uOffsetNoise,r.offsetNoise],[f.uMixColor,r.mixColor],[f.uMixAlpha,r.mixAlpha],[f.uMixOffset,r.mixOffset],[f.uMixSize,r.mixSize],[f.uMixSurfaceDistance,r.mixSurfaceDistance],[f.uMixNoise,r.mixNoise],[f.uInfoTexture,i]].forEach(([v,C])=>u.watch(C,()=>{v.value=C.value},g)),u.watch([r.noiseScale,r.lifetimeSec],()=>{f.uNoiseScale.value=r.noiseScale.value*r.lifetimeSec.value},g),u.watch([r.lifetimeSec,r.cooldownSec],()=>{f.uCooldownRatio.value=r.cooldownSec.value/r.lifetimeSec.value},g),u.watch(r.map,()=>{typeof r.map.value=="string"?ee.useTexture([r.map.value]).then(v=>h.uniforms.uMap.value=v):h.uniforms.uMap.value=r.map.value});const _=new l.Quaternion,y=new l.Vector3;ee.useLoop().onBeforeRender(({elapsed:v,invalidate:C})=>{d.getWorldQuaternion(_),y.copy(t.directionalLight?t.directionalLight.position:l.Object3D.DEFAULT_UP).normalize(),y.applyQuaternion(_.invert()),h.uniforms.uNormal.value=y,h.uniforms.uTime.value=v/(t.cooldownSec+t.lifetimeSec),C()});function x(v){return v&&"isObject3D"in v}function m(v){return v&&"isBufferGeometry"in v}u.onMounted(()=>{t.geometry?m(t.geometry)?d.geometry.copy(t.geometry):x(t.geometry)&&"geometry"in t.geometry&&m(t.geometry.geometry)&&d.geometry.copy(t.geometry.geometry):x(d.parent)&&"geometry"in d.parent&&m(d.parent.geometry)?d.geometry.copy(d.parent.geometry):d.geometry=new l.IcosahedronGeometry(1,16),typeof t.map=="string"&&ee.useTexture([t.map]).then(v=>h.uniforms.uMap.value=v)}),u.onUnmounted(()=>{var v;(v=h.uniforms.uMap.value)==null||v.dispose(),i.value.dispose(),h.dispose()});const M=u.shallowRef();return e({instance:d}),(v,C)=>(u.openBlock(),u.createElementBlock("primitive",{ref_key:"sparkleRef",ref:M,object:u.unref(d)},null,8,kd))}}),Ud=["position","a-scale"],Nd=["size","size-attenuation","transparent","alpha-test","alpha-map"],zd=u.defineComponent({__name:"Stars",props:{size:{default:.1},sizeAttenuation:{type:Boolean,default:!0},transparent:{type:Boolean,default:!0},alphaTest:{default:.01},count:{default:5e3},depth:{default:50},radius:{default:100},alphaMap:{default:null}},setup(o,{expose:e}){const t=o,n=u.ref(),r=u.ref(),{radius:s,depth:i,count:a,size:c,sizeAttenuation:h,transparent:d,alphaMap:f,alphaTest:g}=u.toRefs(t),{invalidate:p}=ee.useTresContext();u.watch(t,()=>{p()});const _=()=>{let x=s.value+i.value;const m=u.computed(()=>i.value/a.value),M=[],v=Array.from({length:a.value},()=>(.5+.5*Math.random())*4),C=O=>new l.Vector3().setFromSpherical(new l.Spherical(O,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)).toArray();for(let O=0;O<a.value;O++)x-=m.value*Math.random(),M.push(...C(x));n.value=new Float32Array(M),r.value=new Float32Array(v)};u.watchEffect(()=>{_()});const y=u.shallowRef();return e({instance:y}),(x,m)=>(u.openBlock(),u.createElementBlock("TresPoints",{ref_key:"starsRef",ref:y},[u.createElementVNode("TresBufferGeometry",{position:[n.value,3],"a-scale":[r.value,1]},null,8,Ud),u.createElementVNode("TresPointsMaterial",{size:u.unref(c),"size-attenuation":u.unref(h),transparent:u.unref(d),"alpha-test":u.unref(g),"alpha-map":u.unref(f)},null,8,Nd)],512))}});class Vd extends l.Object3D{constructor(){super();ue(this,"virtualScene",null);this.virtualScene=new l.Scene}add(...t){return this.virtualScene.add(...t),this}destructor(){this.virtualScene.traverse(t=>{t instanceof l.Mesh&&(t.geometry.dispose(),t.material.dispose(),t.material.map&&t.material.map.dispose(),this.virtualScene.remove(t))}),this.virtualScene=null}}const Gd=u.defineComponent({__name:"component",props:{background:{type:[Boolean,String],default:!1},blur:{default:0},files:{default:()=>[]},path:{default:""},preset:{default:void 0},resolution:{default:256},near:{default:1},far:{default:1e3},frames:{default:Number.POSITIVE_INFINITY}},async setup(o,{expose:e}){let t,n;const r=o,s=u.ref(null);e({texture:s});const{extend:i,renderer:a,scene:c}=ee.useTresContext();let h=null;const d=u.ref(null);let f=null;const g=u.ref(null),{onBeforeRender:p}=ee.useLoop();let _=1;p(()=>{f&&g.value&&d.value&&(r.frames===Number.POSITIVE_INFINITY||_<r.frames)&&(f.update(a.value,u.toRaw(g.value.virtualScene)),_++)},-1);const y=([t,n]=u.withAsyncContext(()=>Xs(r,d)),t=await t,n(),t),x=m=>{m?(c.value.environment=m.texture,r.background&&(c.value.background=m.texture)):(c.value.environment=y.value,r.background&&(c.value.background=y.value))};return u.watch(y,()=>{d.value&&x(d.value)},{immediate:!0,deep:!0}),u.watch(()=>u.useSlots().default,m=>{var M,v;if(m&&(h=m,Array.isArray(h)&&h.length>0&&typeof((M=h[0])==null?void 0:M.type)!="symbol")){i({EnvSence:Vd}),d.value=new l.WebGLCubeRenderTarget(r.resolution),d.value.texture.type=l.HalfFloatType,f=new l.CubeCamera(r.near,r.far,d.value),x(d.value);return}(v=d.value)==null||v.dispose(),d.value=null,x()},{immediate:!0,deep:!0}),s.value=y.value,u.onUnmounted(()=>{var m,M;(m=g.value)==null||m.destructor(),(M=d.value)==null||M.dispose()}),(m,M)=>d.value?(u.openBlock(),u.createElementBlock("TresEnvSence",{key:0,ref_key:"envSence",ref:g},[u.renderSlot(m.$slots,"default")],512)):u.createCommentVNode("",!0)}}),Rd={key:0,args:[0,1,64]},jd={key:1,args:[.5,1,64]},Ed={key:2},Yd=["tone-mapped","map","side","color"],Wd=u.defineComponent({__name:"index",props:{args:{default:null},from:{default:"rect"},toneMapped:{type:Boolean,default:!1},map:{default:null},intensity:{default:1},color:{default:new l.Color(16777215)}},setup(o){const e=o,t=u.ref();return u.watchEffect(()=>{t.value&&(t.value.color.multiplyScalar(e.intensity),t.value.needsUpdate=!0)}),(n,r)=>(u.openBlock(),u.createElementBlock("TresMesh",null,[n.from==="circle"?(u.openBlock(),u.createElementBlock("TresRingGeometry",Rd)):n.from==="ring"?(u.openBlock(),u.createElementBlock("TresRingGeometry",jd)):n.from==="rect"?(u.openBlock(),u.createElementBlock("TresPlaneGeometry",Ed)):(u.openBlock(),u.createBlock(e.from,{key:3,args:e})),u.createElementVNode("TresMeshBasicMaterial",{ref_key:"material",ref:t,"tone-mapped":n.toneMapped,map:n.map,side:u.unref(l.DoubleSide),color:n.color},null,8,Yd)]))}});function Xd(o,e){const t={};for(const n of e)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}function Zd(o,e){const t=`set${e[0].toUpperCase()}${e.slice(1)}`;return o[t]!==void 0}function Kd(o){var t,n;let e=o.value;return o.value&&((n=(t=o.value)==null?void 0:t.value)!=null&&n.isMesh)&&(e=o.value.value.position),Array.isArray(o.value)&&(e=new l.Vector3(...e)),e}se.AnimatedSprite=Ao,se.Backdrop=sd,se.BakeShadows=Lh,se.BaseCameraControls=Ue,se.Box=tf,se.CameraControls=lc,se.CatmullRomCurve3=lf,se.Circle=hf,se.Cone=pf,se.ContactShadows=od,se.CustomShaderMaterial=fh,se.Cylinder=yf,se.Dodecahedron=vf,se.Environment=Gd,se.FBXModel=wc,se.Fbo=tc,se.Fit=ad,se.GLTFModel=iu,se.GlobalAudio=Xo,se.HolographicMaterial=ph,se.Html=jh,se.Icosahedron=Mf,se.KeyboardControls=cc,se.Lensflare=ca,se.Levioso=ua,se.Lightformer=Wd,se.Line2=$i,se.MapControls=hc,se.MeshGlassMaterial=wh,se.MeshReflectionMaterial=Ph,se.MeshWobbleMaterial=Oh,se.MouseParallax=ha,se.Ocean=cd,se.Octahedron=Cf,se.OrbitControls=dc,se.Plane=Of,se.PointerLockControls=oi,se.PositionalAudio=pa,se.Precipitation=fd,se.Reflector=Jl,se.Ring=Bf,se.RoundedBox=Uf,se.SVG=xc,se.Sampler=nc,se.ScrollControls=mc,se.Sky=pd,se.Smoke=xd,se.Sparkles=Fd,se.Sphere=Vf,se.Stars=zd,se.Stats=Wh,se.StatsGl=Kh,se.Superformula=jf,se.Tetrahedron=Xf,se.Text3D=$l,se.Torus=qf,se.TorusKnot=Hf,se.TransformControls=yc,se.Tube=td,se.extractBindingPosition=Kd,se.hasSetter=Zd,se.pick=Xd,se.useAnimations=ec,se.useEnvironment=Xs,se.useFBO=Ys,se.useFBX=ai,se.useGLTF=mi,se.useGLTFExporter=Qh,se.useProgress=cu,se.useSurfaceSampler=Ws,se.useVideoTexture=uu,Object.defineProperty(se,Symbol.toStringTag,{value:"Module"})});
